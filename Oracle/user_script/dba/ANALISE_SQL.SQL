SELECT TO_NUMBER(TO_CHAR(DOC.DOC_DATA,'MM'))   MES_FISCAL,
       TO_NUMBER(TO_CHAR(DOC.DOC_DATA,'YYYY')) ANO_FISCAL,
       GUI.GUI_CCT_CODIGO                      CENTRO_CUSTO,
       GUI.GUI_DOC_CBE_CRE_SEQUENCIAL          CREDENCIADO,
       GUI.GUI_PVI_SEQUENCIAL                  GUI_PVI_SEQUENCIAL,
       GUI.GUI_EMP_NUMERO_MATRICULA            GUI_EMP_NUMERO_MATRICULA,
       GUI.GUI_DOC_DEP_CODIGO                  GUI_DOC_DEP_CODIGO,
       DECODE(GUI.GUI_PVI_SEQUENCIAL,NULL,NULL,PVI.PVI_TPV_CODIGO) VINCULO,
       GPR.GPR_AMB_CODIGO                      AMB_CODIGO,
       GPR.GPR_AMB_DV                          AMB_DV,
       AMB.AMB_ESP_TIPO                        TIPO_ESPECIALIDADE,
       AMB.AMB_ESP_NUMERO                      CODIGO_ESPECIALIDADE,
       SUM(DECODE(NVL(TO_NUMBER(GPR.GPR_VALOR_EXCEDENTE),0),0,
                            NVL(TO_NUMBER(GPR.GPR_VALOR),0),
                            NVL((NVL(GPR.GRP_VALOR_CALCULADO,0)* GPR.GPR_QTD)+
                            nvl(GPR.GPR_VALOR_TAXA,0),0))) VALOR_GPR,
       SUM(NVL(GPR.GPR_VALOR_PARTICIPACAO,0)) PARTICIPACAO_GPR,
       SUM(NVL(TDM.TDM_VALOR,0))              VALOR_TDM,
       SUM(NVL(TDM.TDM_VALOR_PARTICIPACAO,0)) PARTICIPACAO_TDM,
       SUM(NVL(DMO.DMO_VALOR_INFORMADO,0))    VALOR_DMO,
       SUM(NVL(DMO.DMO_VALOR_PARTICIPACAO,0)) PARTICIPACAO_DMO,
       SUM(NVL(DMP.DMP_VALOR_INFORMADO,0))    VALOR_DMP,
       SUM(NVL(DMP.DMP_VALOR_PARTICIPACAO,0)) PARTICIPACAO_DMP
FROM   GUIAS_PROCEDIMENTOS           GPR,
       GUIAS                         GUI,
       TAB_DESPESA_MEDICAMENTOS      TDM,
       PESSOAS_VINCULADAS            PVI,       
       DIVERSOS_MEDICAS_HOSPIT       DMO,
       DOCUMENTOS_COBRANCA           DOC,
       AMB                           AMB,
       DESPESAS_MEDICAS_HOSPITALARES DMP
WHERE  GPR.GPR_GUI_DOC_NUMERO             = GUI.GUI_DOC_NUMERO
AND    GPR.GPR_GUI_DOC_CBE_BEN_SIGLA      = GUI.GUI_DOC_CBE_BEN_SIGLA
AND    GPR.GPR_GUI_DOC_CBE_CRE_SEQUENCIAL = GUI.GUI_DOC_CBE_CRE_SEQUENCIAL
AND    GPR.GPR_GUI_DOC_DEP_CODIGO         = GUI.GUI_DOC_DEP_CODIGO 
AND    GPR.GPR_GUI_NUMERO                 = GUI.GUI_NUMERO
AND    GPR.GPR_AMB_CODIGO                 = AMB.AMB_CODIGO
AND    GPR.GPR_AMB_DV                     = AMB.AMB_DV
AND    GUI.GUI_DOC_NUMERO                 = TDM.TDM_GUI_DOC_NUMERO (+)
AND    GUI.GUI_DOC_CBE_BEN_SIGLA          = TDM.TDM_GUI_DOC_CBE_BEN_SIGLA (+)
AND    GUI.GUI_DOC_DEP_CODIGO             = TDM.TDM_GUI_DOC_DEP_CODIGO (+)
AND    GUI.GUI_DOC_CBE_CRE_SEQUENCIAL     = TDM.TDM_GUI_DOC_CBE_CRE_SEQUENCIAL (+)
AND    GUI.GUI_NUMERO                     = TDM.TDM_GUI_NUMERO (+)
AND    GUI.GUI_EMP_NUMERO_MATRICULA       = PVI.PVI_EMP_NUMERO_MATRICULA (+)
AND    GUI.GUI_PVI_SEQUENCIAL             = PVI.PVI_SEQUENCIAL (+)
AND    GUI.GUI_NUMERO                     = DMO.DMO_GUI_NUMERO (+)
AND    GUI.GUI_DOC_CBE_BEN_SIGLA          = DMO.DMO_GUI_DOC_CBE_BEN_SIGLA (+)
AND    GUI.GUI_DOC_CBE_CRE_SEQUENCIAL     = DMO.DMO_GUI_DOC_CBE_CRE_SEQUENCIAL  (+)
AND    GUI.GUI_DOC_DEP_CODIGO             = DMO.DMO_GUI_DOC_DEP_CODIGO (+)
AND    GUI.GUI_DOC_NUMERO                 = DMO.DMO_GUI_DOC_NUMERO (+)
AND    GUI.GUI_DOC_NUMERO                 = DOC.DOC_NUMERO
AND    GUI.GUI_DOC_CBE_BEN_SIGLA          = DOC.DOC_CBE_BEN_SIGLA
AND    GUI.GUI_DOC_CBE_CRE_SEQUENCIAL     = DOC.DOC_CBE_CRE_SEQUENCIAL
AND    GUI.GUI_DOC_DEP_CODIGO             = DOC.DOC_DEP_CODIGO
AND    GUI.GUI_NUMERO                     = DMP.DMP_GUI_NUMERO (+)
AND    GUI.GUI_DOC_CBE_BEN_SIGLA          = DMP.DMP_GUI_DOC_CBE_BEN_SIGLA (+)
AND    GUI.GUI_DOC_CBE_CRE_SEQUENCIAL     = DMP.DMP_GUI_DOC_CBE_CRE_SEQUENCIAL (+)
AND    GUI.GUI_DOC_DEP_CODIGO             = DMP.DMP_GUI_DOC_DEP_CODIGO (+)
AND    GUI.GUI_DOC_NUMERO                 = DMP.DMP_GUI_DOC_NUMERO (+)
AND    DOC.DOC_CBE_BEN_SIGLA              = 'MED'
GROUP BY TO_NUMBER(TO_CHAR(DOC.DOC_DATA,'MM')),
       TO_NUMBER(TO_CHAR(DOC.DOC_DATA,'YYYY')),
       GUI.GUI_CCT_CODIGO,
       GUI.GUI_DOC_CBE_CRE_SEQUENCIAL,
       GUI.GUI_PVI_SEQUENCIAL,
       GUI.GUI_EMP_NUMERO_MATRICULA,
       GUI.GUI_DOC_DEP_CODIGO,
       DECODE(GUI.GUI_PVI_SEQUENCIAL,NULL,NULL,PVI.PVI_TPV_CODIGO),
       GPR.GPR_AMB_CODIGO,
       GPR.GPR_AMB_DV,
       AMB.AMB_ESP_TIPO,
       AMB.AMB_ESP_NUMERO
