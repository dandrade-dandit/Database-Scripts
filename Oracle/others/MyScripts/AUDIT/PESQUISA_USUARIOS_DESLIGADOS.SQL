SET SERVEROUTPUT ON
--TRUNCA A TABELA USUARIOS_DESLIGADOS.
TRUNCATE TABLE USUARIOS_DESLIGADOS;
--INICIA A EXECUÇÃO DO BLOCO PARA CARGA DA TABELA COM AS MATRICULAS DOS USUÁRIOS DESLIGADOS COM 0 A ESQUERDA.
DECLARE
	--CRIA CURSOR COM TODAS AS MATRICULAS COM STATUS 2(DESLIGADO).
	CURSOR C_MAT IS
	SELECT EMP_NUMERO_MATRICULA
	FROM CADASTROS
	WHERE EMP_STATUS = 2
	ORDER BY 1;
	
	--DECLARAÇÃO DE VARIÁVEIS.
	V_MAT NUMBER;
	V_TEMP NUMBER;
	V_MAT_CHAR VARCHAR2(10);
	V_MAT_CHAR2 VARCHAR2(10);
BEGIN
	FOR X IN C_MAT LOOP
		
		--ATRIBUI O VALOR DA MATRICULA À VARIÁVEL.
		V_TEMP := X.EMP_NUMERO_MATRICULA;
		
		--BUSCA O TAMANHO DA MATRICULA.
		SELECT LENGTH(V_TEMP) 
		INTO V_MAT 
		FROM DUAL;
		
		--TRANSFORMA A MATRICULA EM CAMPO TEXTO.
		SELECT TO_CHAR(X.EMP_NUMERO_MATRICULA) 
		INTO V_MAT_CHAR 
		FROM DUAL;
		
		--VERIFICA O TAMANHO DA MATRICULA E COLOCA 0 À ESQUERDA SE FOR O CADO.
		IF V_MAT  = 2 THEN
			SELECT CONCAT('I00000', V_MAT_CHAR) INTO V_MAT_CHAR2 FROM DUAL;
		ELSIF V_MAT  = 3 THEN
			SELECT CONCAT('I0000', V_MAT_CHAR) INTO V_MAT_CHAR2 FROM DUAL;
		ELSIF V_MAT  = 4 THEN
			SELECT CONCAT('I000', V_MAT_CHAR) INTO V_MAT_CHAR2 FROM DUAL;
		ELSIF V_MAT  = 5 THEN
			SELECT CONCAT('I00', V_MAT_CHAR) INTO V_MAT_CHAR2 FROM DUAL;
		ELSIF V_MAT  = 6 THEN
			SELECT CONCAT('I0', V_MAT_CHAR) INTO V_MAT_CHAR2 FROM DUAL;
		ELSE
			SELECT CONCAT('I', V_MAT_CHAR) INTO V_MAT_CHAR2 FROM DUAL;
		END IF;	
		
		--INSERE A LINHA E "COMMITA" A TRANSAÇÃO.
		INSERT INTO USUARIOS_DESLIGADOS VALUES (V_MAT_CHAR2);
		COMMIT;
		
		--IMPRIME A LINHA NA TELA
		--DBMS_OUTPUT.PUT_LINE (V_MAT_CHAR2);
	END LOOP;
END;
--FIM DA EXECUÇÃO.
/


SELECT USERNAME FROM DBA_USERS
WHERE USERNAME IN (SELECT * FROM USUARIOS_DESLIGADOS)
/

SELECT 'DROP USER ' || USERNAME || ';'
FROM DBA_USERS
WHERE USERNAME IN (SELECT * FROM USUARIOS_DESLIGADOS)
/
