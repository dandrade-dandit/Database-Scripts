SELECT * FROM DBA_ROLES
WHERE ROLE NOT IN (
	SELECT 	DISTINCT R.ROLE
	FROM 	DBA_ROLES R
	,	DBA_ROLE_PRIVS T
	WHERE 	GRANTED_ROLE = ROLE
)
/


SELECT 	R.ROLE, COUNT(1)
FROM 	DBA_ROLES R
,	DBA_ROLE_PRIVS T
WHERE 	T.GRANTED_ROLE = ROLE
AND	R.ROLE LIKE '%MAT%'
GROUP BY 
	R.ROLE
HAVING	COUNT(1) < 3
/


SELECT COUNT(1)
FROM DBA_ROLES
WHERE ROLE LIKE '%RH%'
/

--SO PARA O GESTOR ROLES COM 3 OU MENOS USUÁRIOS
SELECT 	R.ROLE, COUNT(1)
FROM 	DBA_ROLES R
,	DBA_ROLE_PRIVS T
WHERE 	T.GRANTED_ROLE = ROLE
AND	R.ROLE LIKE '%RH%'
GROUP BY 
	R.ROLE
HAVING	COUNT(1) = 1
UNION
SELECT 	R.ROLE, COUNT(1)
FROM 	DBA_ROLES R
,	DBA_ROLE_PRIVS T
WHERE 	T.GRANTED_ROLE = ROLE
AND	R.ROLE LIKE '%RH%'
AND	T.GRANTEE  != 'SYS'
GROUP BY 
	R.ROLE
HAVING	COUNT(1) <= 3
/

--ROLES COM 5 OU MENOS USUÁRIOS
SELECT 	R.ROLE, COUNT(1)
FROM 	DBA_ROLES R
,	DBA_ROLE_PRIVS T
WHERE 	T.GRANTED_ROLE = ROLE
AND	(R.ROLE NOT LIKE '%TRACE' AND R.ROLE NOT LIKE '%AGENT' AND R.ROLE NOT LIKE '%JAVA%' AND R.ROLE NOT LIKE '%ROLE' AND R.ROLE NOT LIKE '%DATABASE' AND R.ROLE NOT LIKE 'ORAFORMS%' AND R.ROLE NOT LIKE 'OEM%' AND R.ROLE NOT LIKE 'RECOVE%')
GROUP BY 
	R.ROLE
HAVING	COUNT(1) = 1
UNION
SELECT 	R.ROLE, COUNT(1)
FROM 	DBA_ROLES R
,	DBA_ROLE_PRIVS T
WHERE 	T.GRANTED_ROLE = ROLE
AND	T.GRANTEE  != 'SYS'
AND	(R.ROLE NOT LIKE '%TRACE' AND R.ROLE NOT LIKE '%AGENT' AND R.ROLE NOT LIKE '%JAVA%' AND R.ROLE NOT LIKE '%ROLE' AND R.ROLE NOT LIKE '%DATABASE' AND R.ROLE NOT LIKE 'ORAFORMS%' AND R.ROLE NOT LIKE 'OEM%' AND R.ROLE NOT LIKE 'RECOVE%')
GROUP BY 
	R.ROLE
HAVING	COUNT(1) <= 5
/

SELECT * FROM DBA_ROLE_PRIVS 
WHERE 	GRANTED_ROLE IN (
	SELECT 	R.ROLE
	FROM 	DBA_ROLES R
	,	DBA_ROLE_PRIVS T
	WHERE 	T.GRANTED_ROLE = ROLE
	AND	R.ROLE LIKE '%MAT%'
	AND	T.GRANTEE  != 'SYS'
	GROUP BY 
		R.ROLE
	HAVING	COUNT(1) <= 2)
AND	GRANTEE  != 'SYS'
/


--*********************************************

SELECT 	R.ROLE, COUNT(1) as "Total"
FROM 	DBA_ROLES R
,	DBA_ROLE_PRIVS T
WHERE 	T.GRANTED_ROLE = ROLE
AND	R.ROLE LIKE '%SELO%'
AND	T.GRANTEE  != 'SYS'
GROUP BY 
	R.ROLE
ORDER BY 1
/

SELECT ROLE
FROM DBA_ROLES
WHERE ROLE LIKE '%SELO%'
ORDER BY 1
/

SELECT * FROM DBA_ROLE_PRIVS
WHERE GRANTEE LIKE '%SELO%'
/

--*********************************************

SELECT * FROM DBA_ROLE_PRIVS 
WHERE GRANTED_ROLE = 'SRH_SPF_02'
/

