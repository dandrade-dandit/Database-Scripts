<html>
<head>
<title>trca_instructions</title>

<style type="text/css">
body {font:10pt Arial, Helvetica, Verdana, Geneva, sans-serif; color:Black; background:White;}
a {font-weight:bold; color:#663300;}
pre {font:8pt Monaco, "Courier New", Courier, monospace; margin:1em 8em 1.5em 4em; padding:1em 0 1em 4em; border:1px solid #336699; background-color:#fcfcf0; overflow:auto;}
code {font:10pt Monaco, "Courier New", Courier, monospace; font-weight:bold;}
h1 {color:#336699; font-weight:bold; font-size:16pt;}
h2 {color:#336699; font-weight:bold; font-size:14pt;}
h3 {color:#336699; font-weight:bold; font-size:12pt;}
h4 {color:#336699; font-weight:bold; font-size:10pt;}
table {font-size:8pt; color:Black; background:White;}
th {font-weight:bold; background:#cccc99; color:#336699; vertical-align:bottom; padding:0.25em 0.25em 0.25em 0.25em;}
td {text-align:center; background:#fcfcf0; vertical-align:top; padding:0.25em 0.25em 0.25em 0.25em;}
td.lw {text-align:left; background:white;}
li {color:#336699; font-weight:bold; font-size:10pt; padding:0.1em 0 0 0;}
</style>

</head>

<!--------------------------------------------------------------------------------------------------------------------->

<body>
<h1>224270.1 Trace Analyzer TRCANLZR (TRCA) 11.4.5.3 December 31, 2012<br>
Analyzing SQL Traces with Binds and/or Waits generated by EVENT 10046</h1>

<ul>
<li><a href="#overview"><code>TRCA</code> Overview</a></li>
<li><a href="#security">Security Model</a></li>
<li><a href="#install">Installing <code>TRCA</code></a></li>
<li><a href="#uninstall">Uninstalling <code>TRCA</code></a></li>
<li><a href="#use">Using <code>TRCA</code></a></li>
<li><a href="#faq">FAQ</a></li>
</ul>

<!--------------------------------------------------------------------------------------------------------------------->

<a name="overview"></a>
<hr size="3">
<h2><code>TRCA</code> Overview</h2>

<p>Trace Analyzer, also known as <code>TRCANLZR</code> or <code>TRCA</code>, is a tool provided by Oracle Software Support Center of Expertise CoE. <code>TRCA</code> inputs one or several SQL trace(s) generated by Event 10046 and outputs a diagnostics report in two formats (html and text). These reports are commonly used to diagnose processes performing poorly.</p>

<p><code>TRCA</code> identifies expensive SQL out of the provided trace(s), then it connects to the database and collects their explain plans, Cost-based Optimizer CBO statistics, metadata, configuration parameters, and similar elements that influence the performance of the process being analyzed.</p>

<p>For best output results <code>TRCA</code> must be installed and used in the same system and database where the trace is generated. But this is not a mandatory requirement. Understanding that installing <code>TRCA</code> in a production system is not always possible, <code>TRCA</code> is capable of analyzing a trace using a different system.</p>

<p>To use <code>TRCA</code>, simply <a href="#install">install</a> the tool first and proceed then to <a href="#use">use</a> it next.</p>

<!--------------------------------------------------------------------------------------------------------------------->

<a name="security"></a>
<hr size="3">
<h3>Security Model</h3>

<p>During the <a href="#install">installation</a> of this <code>TRCA</code> tool, 2 users and one role are created. These users and role have fixed names.</p>

<p>The <code>TRCA</code> repository is owned by user <code>TRCANLZR</code>. User <code>TRCANLZR</code> is granted the following system privileges:</p>

<ul>
<li>CREATE SESSION</li>
<li>TRCA_USER_ROLE</li>
</ul>

<p>The <code>TRCA</code> set of PL/SQL packages and Views is owned by user <code>TRCADMIN</code>. This <code>TRCADMIN</code> user is locked and identified by a random password. <code>TRCADMIN</code> is granted the following system privileges:</p>

<ul>
<li>ALTER SESSION</li>
<li>SELECT ANY DICTIONARY</li>
<li>SELECT_CATALOG_ROLE</li>
</ul>

<p>All <code>TRCA</code> users must be granted the <code>TRCA_USER_ROLE</code> before they can <a href="#use">use</a> <code>TRCA</code>. This <code>TRCA_USER_ROLE</code> role is not granted any system privileges</p>

<!--------------------------------------------------------------------------------------------------------------------->

<a name="install"></a>
<hr size="3">
<h2>Installing <code>TRCA</code></h2>

<p><code>TRCA</code> installs under its own schemas <code>TRCANLZR</code> and <code>TRCADMIN</code>. It does not install any objects into the application schema(s). You can install this version of <code>TRCA</code> in Oracle databases 9.2, 10.1, 10.2, 11.1, 11.2 and higher, on UNIX, Linux or Windows platforms.</p>

<p>Installation steps:</p>
<ol>
<li>Execute <code>trca/install/<a href="install/tacreate.sql" target="trca">tacreate.sql</a></code> connected as <code>SYS</code>.</li>
<pre>
# cd trca/install
# sqlplus / as sysdba
SQL> START tacreate.sql
</pre>
</ol>

<p>During the installation you will be asked these questions:</p>

<ol>

<li><code>TRCANLZR</code> password.</li>
<p>Case sensitive in some systems.</p>

<li><code>TRCANLZR</code> Default Tablespace.</li>
<p>Select from a list of available permanent tablespaces which one should be used by <code>TRCANLZR</code> for the <code>TRCA</code> repository. It must have more than 50MB of free space.</p>

<li><code>TRCANLZR</code> Temporary Tablespace.</li>
<p>Select from a list of available temporary tablespaces which one should be used by <code>TRCANLZR</code> for volatile operations and objects.</p>

<li>Optional Application User.</li>
<p>This is the user that will execute <code>TRCA</code>. Normally it is the same user that generated the Trace to be analyzed. For example, if this were an EBS system specify <code>APPS</code>, on Siebel you would specify <code>SIEBEL</code> and on People Soft <code>SYSADM</code>. You won't be asked to enter the password for this user. You can add additional <code>TRCA</code> users after the tool is installed, by granting them role <code>TRCA_USER_ROLE</code>.</p>

<li>Type of large objects in <code>TRCA</code> repository.</li>
<p>Choose between global temporary or permanent tables for large objects in the <code>TRCA</code> repository. Enter values "T" or "P". Temporary objects is the default and recommended value.</p>

</ol>

<!--------------------------------------------------------------------------------------------------------------------->

<a name="uninstall"></a>
<hr size="3">
<h2>Uninstalling <code>TRCA</code></h2>

<p>Uninstalling <code>TRCA</code> removes the <code>TRCA</code> repository and all <code>TRCANLZR</code>/<code>TRCADMIN</code> schema objects. <code>TRCANLZR</code> and <code>TRCADMIN</code> users also gets dropped. To uninstall <code>TRCA</code> simply execute <code>trca/install/<a href="install/tadrop.sql" target="trca">tadrop.sql</a></code> connected as <code>SYS</code>.</p>
<pre>
# cd trca/install
# sqlplus / as sysdba
SQL> START tadrop.sql
</pre>

<!--------------------------------------------------------------------------------------------------------------------->

<a name="use"></a>
<hr size="3">
<h2>Using <code>TRCA</code></h2>

<p>Before attempting using <code>TRCA</code>, be sure <code>TRCA</code> has been <a href="#install">installed</a> and that your <code>TRCA</code> user has been granted the <code>TRCA_USER_ROLE</code>.</p>

<p>With <code>TRCA</code> you can analyze one or more traces in the same system where they were generated. You can also analyze them on a different system. Several related parallel execution PX traces could be analyzed as one entity, or each trace could be analyzed by itself.</p>

<p>Particular steps to analyze one or several traces, within the same or different system follow.</p>

<h3>I. Analyzing one trace on the same system where it was generated.</h3>

<ol>
<li>Navigate to <code>trca/run</code> and connect as the application user that generated the trace to be analyzed.</li>
<li>Execute <code>trca/run/<a href="run/trcanlzr.sql" target="trca">trcanlzr.sql</a></code> passing the name of the trace to be analyzed (do not include the path). The trace file must exist in the INPUT1 directory. To locate INPUT1: <code>SELECT directory_path FROM dba_directories WHERE directory_name = 'TRCA$INPUT1';</code> INPUT1 is usually USER_DUMP_DEST.</li>
<pre>
# cd trca/run
# sqlplus qtune/qtune
SQL> START trcanlzr.sql v1024_ora_32523.trc
</pre>
</ol>

<h3>II. Analyzing a set of related traces (PX) on the same system where they were generated.</h3>

<ol>
<li>Create a text "control file" with the names of the traces to be analyzed (do not include the path). One trace filename per line within the text file.</li>
<li>Place your <code>control_file.txt</code> into INPUT1 directory. To locate INPUT1: <code>SELECT directory_path FROM dba_directories WHERE directory_name = 'TRCA$INPUT1';</code> INPUT1 is usually USER_DUMP_DEST.</li>
<li>Navigate to <code>trca/run</code> and connect as the application user that generated the (PX) traces to be analyzed.</li>
<li>Execute <code>trca/run/<a href="run/trcanlzr.sql" target="trca">trcanlzr.sql</a></code> passing the name of the control file which contains the names of the traces to be analyzed (do not include the path). Actual traces can be located in INPUT1 or INPUT2 directories. The latter is usually BACKGROUND_DUMP_DEST.</li>
<pre>
# cd trca/run
# sqlplus qtune/qtune
SQL> START trcanlzr.sql control_file.txt
</pre>
</ol>

<h3>III. Analyzing one trace on a different system (target) to the one where it was generated (source).</h3>

<ol>
<li>On source system connect as SYS and execute <code>trca/dict/<a href="dict/trcadictexp.sql" target="trca">trcadictexp.sql</a></code> This script generates a <code>TRCA_DICT.zip</code> file which contains a small subset of the source data dictionary. There is no need to install <code>TRCA</code> on source.</li>
<pre>
# sqlplus / as sysdba
SQL> START trcadictexp.sql
</pre>
<li>Copy into target INPUT1 directory the trace file generated in the source system. To locate INPUT1: <code>SELECT directory_path FROM dba_directories WHERE directory_name = 'TRCA$INPUT1';</code> INPUT1 is usually USER_DUMP_DEST.</li>
<li>Copy into target STAGE directory the <code>TRCA_DICT.zip</code> file generated in the source system. To locate STAGE: <code>SELECT directory_path FROM dba_directories WHERE directory_name = 'TRCA$STAGE';</code> STAGE is usually USER_DUMP_DEST.</li>
<li>Unzip <code>TRCA_DICT.zip</code> file within target STAGE directory. There would be then 11 <code>TRCA_*.txt</code> text files inside the target STAGE directory.</li>
<pre>
# cd [STAGE directory]
# unzip TRCA_DICT.zip
</pre>
<li>In target, navigate to <code>trca</code> and connect as <code>TRCANLZR</code>.</li>
<li>Execute <code>trca/dict/<a href="dict/trcadictimp.sql" target="trca">trcadictimp.sql</a></code> to import the <code>TRCA</code> repository generated in source. No parameters are passed.</li>
<li>Execute <code>trca/run/<a href="run/trcanlzr.sql" target="trca">trcanlzr.sql</a></code> passing the name of the trace to be analyzed (do not include the path). <code>TRCA</code> will look for the trace inside the INPUT1 directory.</li>
<pre>
# cd trca
# sqlplus trcanlzr/trcanlzr
SQL> START dict/trcadictimp.sql
SQL> START run/trcanlzr.sql V1117_ora_29896.trc
</pre>
</ol>

<h3>IV. Analyzing a set of related traces (PX) on a different system (target) to the one where they were generated (source).</h3>

<ol>
<li>On source system connect as SYS and execute <code>trca/dict/<a href="dict/trcadictexp.sql" target="trca">trcadictexp.sql</a></code> This script generates a <code>TRCA_DICT.zip</code> file which contains a small subset of the source data dictionary. There is no need to install <code>TRCA</code> on source.</li>
<pre>
# sqlplus / as sysdba
SQL> START trcadictexp.sql
</pre>
<li>Copy into target INPUT1 directory the trace files generated in the source system. To locate INPUT1: <code>SELECT directory_path FROM dba_directories WHERE directory_name = 'TRCA$INPUT1';</code> INPUT1 is usually USER_DUMP_DEST.</li>
<li>Copy into target STAGE directory the <code>TRCA_DICT.zip</code> file generated in the source system. To locate STAGE: <code>SELECT directory_path FROM dba_directories WHERE directory_name = 'TRCA$STAGE';</code> STAGE is usually USER_DUMP_DEST.</li>
<li>Unzip <code>TRCA_DICT.zip</code> file within target STAGE directory. There would be then 11 <code>TRCA_*.txt</code> text files inside the target STAGE directory.</li>
<pre>
# cd [STAGE directory]
# unzip TRCA_DICT.zip
</pre>
<li>Create a text "control file" with the names of the traces to be analyzed (do not include the path). One trace filename per line within the text file.</li>
<li>Place your <code>control_file.txt</code> into your target INPUT1 directory.</li>
<li>In target, navigate to <code>trca</code> and connect as <code>TRCANLZR</code>.</li>
<li>Execute <code>trca/dict/<a href="dict/trcadictimp.sql" target="trca">trcadictimp.sql</a></code> to import the <code>TRCA</code> repository generated in source. No parameters are passed.</li>
<li>Execute <code>trca/run/<a href="run/trcanlzr.sql" target="trca">trcanlzr.sql</a></code> passing the name of the control file which contains the names of the traces to be analyzed (do not include the path).</li>
<pre>
# cd trca
# sqlplus trcanlzr/trcanlzr
SQL> START dict/trcadictimp.sql
SQL> START run/trcanlzr.sql control_file.txt
</pre>
</ol>

<!--------------------------------------------------------------------------------------------------------------------->

<a name="faq"></a>
<hr size="3">
<h2>Frequently Asked Questions</h2>

<ol>

<li>What is new in this <code>TRCA</code> release?</li>

<p>A summary of recent <code>TRCA</code> changes can be found in file <code>trca/doc/<a href="doc/trca_changes.html" target="trca">trca_changes.html</a></code>.</p>

<li>Can I change the <code>TRCA</code> staging directory?</li>

<p>Yes, use <code>trca/utl/<a href="utl/tacdirs.sql" target="trca">tacdirs.sql</a></code> passing the full directory path. This path cannot contain the "?" or "*" symbols and it is case sensitive in most systems. This directory must exist in the server and <code>ORACLE</code> must have read/write access to it.</p>

<li>Can I change the <code>TRCA</code> input directories?</li>

<p>Yes, but this is not recommended. You can use <code>trca/utl/<a href="utl/tacdiri1.sql" target="trca">tacdiri1.sql</a></code> or <code>trca/utl/<a href="utl/tacdiri2.sql" target="trca">tacdiri2.sql</a></code> passing the full directory path. This path cannot contain the "?" or "*" symbols and it is case sensitive in most systems. This directory must exist in the server and <code>ORACLE</code> must have read access to it.</p>

<li>How can I expedite "Taking a snapshot of some Data Dictionary objects"?</li>

<p>A snapshot of some Data Dictionary objects takes between a couple of minutes and up to several hours, depending on the size of the data dictionary. This is the last step of the installation. If killed, it will be automatically executed when the tool is first used. </p>

<p>To expedite the snapshot time, and with some loss of functionality, you can disable the snaphot of extents by executing these commands connecting as <code>TRCANLZR</code>:
<br>
<code>
SET SERVEROUT ON;<br>
EXEC trca$g.set_param('capture_extents', 'N');<br>
EXEC trca$t.refresh_trca$_dict_from_this;
</code></p>

<p>If still "Taking a snapshot of some Data Dictionary objects" takes longer than several hours, it can be disabled altogether with significant loss of functionality, by executing these commands connecting as <code>TRCANLZR</code>:
<br>
<code>
SET SERVEROUT ON;<br>
EXEC trca$g.set_param('refresh_dict_repository', 'N');<br>
EXEC trca$t.refresh_trca$_dict_from_this;
</code></p>

<li>How do I provide feedback on this <code>TRCA</code> tool?</li>

<p>If you have an open ticket with Oracle Support where <code>TRCA</code> was requested, use that ticket, else you may want to <a href="mailto:carlos.sierra@oracle.com?subject=TRCA feedback">email</a> its author (Carlos Sierra).</p>

</ol>

<!--------------------------------------------------------------------------------------------------------------------->

<hr size="3">
</body>
</html>
