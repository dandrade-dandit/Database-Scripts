SET TERMOUT OFF
SET ECHO OFF
SET HEADING ON
SET FEEDBACK OFF
SET VERIFY OFF
SET TRIMSPOOL ON
SET LINESIZE 120
SET PAGESIZE 100
COLUMN "TBLSPC" FORMAT A35

COLUMN "ALLOC" 	FORMAT 999,999,999,999
COLUMN USED 	FORMAT 999,999,999,999
COLUMN UNUSED 	FORMAT 999,999,999,999
COLUMN USEDPCT 	FORMAT 999.99
SET TERMOUT ON
SELECT U.TBLSPC "TBLSPC", A.FBYTES/1024/1024 "ALLOC",U.EBYTES/1024/1024 USED,
(A.FBYTES-U.EBYTES)/1024/1024 UNUSED,(U.EBYTES/A.FBYTES)*100 USEDPCT
FROM 	(SELECT TABLESPACE_NAME TBLSPC,SUM(BYTES) EBYTES 
      	FROM SYS.DBA_EXTENTS 
      	GROUP BY TABLESPACE_NAME) U,
	(SELECT TABLESPACE_NAME TBLSPC,SUM(BYTES) FBYTES 
	FROM SYS.DBA_DATA_FILES 
        GROUP BY TABLESPACE_NAME) A
WHERE U.TBLSPC=A.TBLSPC
/