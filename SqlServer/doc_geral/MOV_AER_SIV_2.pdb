<?xml version="1.0" encoding="UTF-8"?>
<?PowerDesigner ID="{6958B219-8FBB-11D8-B6CA-00024416849C}" Name="PhysicalDataModel_2" Objects="361" Symbols="37" Type="{CDE44E21-9669-11D1-9914-006097355D9B}" signature="PDM_DATA_MODEL_XML" version="9.0.0.438 Evaluation"?>
<!-- please do not edit this file -->

<Model xmlns:a="attribute" xmlns:c="collection" xmlns:o="object">

<o:RootObject Id="o1">
<c:Children>
<o:Model Id="o2">
<a:ObjectID>6958B219-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>PhysicalDataModel_2</a:Name>
<a:Code>PHYSICALDATAMODEL_2</a:Code>
<a:CreationDate>1081543070</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1082144462</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:PackageOptionsText>
[FolderOptions]

[FolderOptions\Physical Objects]
GenerationCheckModel=Yes
GenerationPath=
RevPkey=Yes
RevFkey=Yes
RevAkey=Yes
RevCheck=Yes
RevIndx=Yes
RevOpts=Yes
RevViewAsTabl=No
RevSystAsTabl=Yes
RevSynmAsTabl=Yes
GenScriptName=crebas
GenScriptName0=
GenScriptName1=
GenScriptName2=
GenScriptName3=
GenScriptName4=
GenScriptName5=
GenScriptName6=
GenScriptName7=
GenScriptName8=
GenScriptName9=
GenPathName=
GenSingleFile=Yes
GenTrgScriptName=cretrg
GenTrgScriptName0=
GenTrgScriptName1=
GenTrgScriptName2=
GenTrgScriptName3=
GenTrgScriptName4=
GenTrgScriptName5=
GenTrgScriptName6=
GenTrgScriptName7=
GenTrgScriptName8=
GenTrgScriptName9=
GenTrgPathName=
GenTrgSingleFile=Yes
GenODBC=No
GenCheckModel=Yes
GenScriptPrev=Yes
GenArchiveModel=No
GenDataPathName=
GenDataSinglefile=Yes
GenDataScriptName=testdata
GenDataScriptName0=
GenDataScriptName1=
GenDataScriptName2=
GenDataScriptName3=
GenDataScriptName4=
GenDataScriptName5=
GenDataScriptName6=
GenDataScriptName7=
GenDataScriptName8=
GenDataScriptName9=
GenDataOdbc=No
GenDataDelOld=No
GenDataTitle=No
GenDataDefNumRows=20
GenDataCommit=0
GenDataPacket=0
GenDataCSV=No
GenDataOwner=No
GenDataProfNumb=
GenDataProfChar=
GenDataProfDate=
GenTspcCrea=Yes
GenTspcDrop=Yes
GenStorCrea=Yes
GenStorDrop=Yes
GenUddtCrea=Yes
GenUddtDval=Yes
GenUddtChck=Yes
GenUddtCmmt=Yes
GenUddtDrop=Yes
GenClssCrea=Yes
GenClssHead=Yes
GenClssFoot=Yes
GenClssCmmt=Yes
GenClssDrop=Yes
GenClssInst=Yes
GenClssSupp=Yes
GenDtbsCrea=Yes
GenDtbsOpts=Yes
GenDtbsHead=Yes
GenDtbsFoot=Yes
GenDtbsOpen=Yes
GenDtbsClose=Yes
GenDtbsDrop=Yes
GenUserCrea=Yes
GenUserGrant=Yes
GenUserDrop=Yes
GenTablCrea=Yes
GenTablChck=Yes
GenTablOpts=Yes
GenTablHead=Yes
GenTablFoot=Yes
GenTablCmmt=Yes
GenTablDrop=Yes
GenColnUddt=Yes
GenColnDval=Yes
GenColnChck=Yes
GenColnOpts=Yes
GenColnCmmt=Yes
GenPkeyCrea=Yes
GenPkeyOpts=Yes
GenPkeyDrop=Yes
GenAkeyCrea=Yes
GenAkeyOpts=Yes
GenAkeyDrop=Yes
GenRefrCrea=Yes
GenRefrIdcl=Yes
GenRefrIDUR=Yes
GenRefrIDUC=Yes
GenRefrIDUN=Yes
GenRefrIDUD=Yes
GenRefrIDDR=Yes
GenRefrIDDC=Yes
GenRefrIDDN=Yes
GenRefrIDDD=Yes
GenRefrDrop=Yes
GenIndxCrea=Yes
GenIndxPkey=Yes
GenIndxFkey=Yes
GenIndxAkey=Yes
GenIndxClus=Yes
GenIndxOthr=Yes
GenIndxOpts=Yes
GenIndxCmmt=Yes
GenIndxDrop=Yes
GenViewCrea=Yes
GenViewHead=Yes
GenViewFoot=Yes
GenViewCmmt=Yes
GenViewDrop=Yes
GenJidxCrea=Yes
GenJidxHead=Yes
GenJidxFoot=Yes
GenJidxDrop=Yes
GenSqncCrea=Yes
GenSqncDrop=Yes
GenTrgrCrea=Yes
GenTrgrDrop=Yes
GenTrgrFIns=Yes
GenTrgrFUpd=Yes
GenTrgrFDel=Yes
GenProcCrea=Yes
GenProcDrop=Yes
GenScriptTitle=Yes
GenScriptNamLabl=No
GenScriptQDtbs=Yes
GenScriptQOwnr=Yes
GenScriptCase=0
GenScriptCharset=0
GenScriptNAcct=No
GenScriptODBC=No
GenUseSync=No
GenSyncChoice=0
GenSyncArch=
GenTmpTablCrea=Yes
GenTmpTablDrop=Yes
GenTrgrStdMsg=Yes
GenTrgrMsgTab=
GenTrgrMsgNo=
GenTrgrMsgTxt=
GenRuleCrea=Yes
GenRuleDrop=Yes

[FolderOptions\Pdm]
IndxIQName=%COLUMN%_%INDEXTYPE%
IndxPK=Yes
IndxFK=Yes
IndxAK=Yes
IndxPKName=%TABLE%_PK
IndxFKName=%REFR%_FK
IndxAKName=%AKEY%_AK
IndxPreserve=No
IndxThreshold=0
RefrPreserve=No
JidxPreserve=No
RbldMultiFact=Yes
RbldMultiDim=Yes
RbldMultiJidx=Yes
CubePreserve=No
CubeScriptPath=
CubeScriptCase=0
CubeScriptCharset=0
CubeScriptNacct=No
CubeScriptHeader=No
CubeScriptExt=csv
CubeScriptExt0=txt
CubeScriptExt1=
CubeScriptExt2=
CubeScriptSep=,
CubeScriptDeli=&quot;
TrgrPreserve=No
TrgrIns=Yes
TrgrUpd=Yes
TrgrDel=Yes
TrgrC2Ins=Yes
TrgrC2Upd=Yes
TrgrC3=Yes
TrgrC4=Yes
TrgrC5=Yes
TrgrC6=Yes
TrgrC7=Yes
TrgrC8=Yes
TrgrC9=Yes
TrgrC10=Yes
TrgrC11=Yes
TrgrC1=Yes
TrgrC12Ins=Yes
TrgrC12Upd=Yes
TrgrC13=Yes
</a:PackageOptionsText>
<a:ModelOptionsText>
[ModelOptions]

[ModelOptions\Physical Objects]
DisplayName=Yes
DefaultDttp=&lt;Undefined&gt;
IgnoreOwner=No
RefrUnique=No
RefrAutoMigrate=Yes
RefrMigrateReuse=Yes
RefrMigrateDomain=Yes
RefrMigrateCheck=Yes
RefrMigrateRule=Yes
RefrMigrateExtd=No
RefrMigrDefaultLink=No
DomnForbDivg=No
DomnCopyDttp=Yes
DomnCopyChck=No
DomnCopyRule=No
DomnCopyMand=No
DomnCopyExtd=No
DomnCopyProf=No

[ModelOptions\Connection]

[ModelOptions\Pdm]

[ModelOptions\Generate]

[ModelOptions\Generate\Cdm]
CheckModel=1
SaveLinks=1
NameToCode=0
Notation=2

[ModelOptions\Generate\Oom]
CheckModel=1
SaveLinks=1
ORMapping=0
NameToCode=0
ClassPrefix=

[ModelOptions\ClssNamingOptions]

[ModelOptions\ClssNamingOptions\PDMPCKG]

[ModelOptions\ClssNamingOptions\PDMPCKG\Name]
Template=
MaxLen=254
Case=M
ValidChar=
InvldChar=&quot;+-*/\.,!:;&#39;&quot;
AllValid=1
NoAccent=0
DefaultChar=_
Script=.foreach_part(%Name%)[CRLF].convert_name(%CurrentPart%)[CRLF].next(&quot;_&quot;)
ConvTable=

[ModelOptions\ClssNamingOptions\PDMPCKG\Code]
Template=
MaxLen=254
Case=U
ValidChar=&#39;a&#39;-&#39;z&#39;,&#39;A&#39;-&#39;Z&#39;,&#39;0&#39;-&#39;9&#39;,&quot;_&quot;
InvldChar=
AllValid=0
NoAccent=1
DefaultChar=_
Script=.foreach_part(%Code%)[CRLF].convert_code(%CurrentPart%)[CRLF].next(&quot;_&quot;)
ConvTable=

[ModelOptions\ClssNamingOptions\PDMDOMN]

[ModelOptions\ClssNamingOptions\PDMDOMN\Name]
Template=
MaxLen=254
Case=M
ValidChar=
InvldChar=&quot;+-*/\.,!:;&#39;&quot;
AllValid=1
NoAccent=0
DefaultChar=_
Script=.foreach_part(%Name%)[CRLF].convert_name(%CurrentPart%)[CRLF].next(&quot;_&quot;)
ConvTable=

[ModelOptions\ClssNamingOptions\PDMDOMN\Code]
Template=
MaxLen=128
Case=U
ValidChar=&#39;a&#39;-&#39;z&#39;,&#39;A&#39;-&#39;Z&#39;,&#39;0&#39;-&#39;9&#39;,&quot;_&quot;
InvldChar=
AllValid=0
NoAccent=1
DefaultChar=_
Script=.foreach_part(%Code%)[CRLF].convert_code(%CurrentPart%)[CRLF].next(&quot;_&quot;)
ConvTable=

[ModelOptions\ClssNamingOptions\TABL]

[ModelOptions\ClssNamingOptions\TABL\Name]
Template=
MaxLen=254
Case=M
ValidChar=
InvldChar=&quot;+-*/\.,!:;&#39;&quot;
AllValid=1
NoAccent=0
DefaultChar=_
Script=.foreach_part(%Name%)[CRLF].convert_name(%CurrentPart%)[CRLF].next(&quot;_&quot;)
ConvTable=

[ModelOptions\ClssNamingOptions\TABL\Code]
Template=
MaxLen=128
Case=U
ValidChar=&#39;a&#39;-&#39;z&#39;,&#39;A&#39;-&#39;Z&#39;,&#39;0&#39;-&#39;9&#39;,&quot;_&quot;
InvldChar=
AllValid=0
NoAccent=1
DefaultChar=_
Script=.foreach_part(%Code%)[CRLF].convert_code(%CurrentPart%)[CRLF].next(&quot;_&quot;)
ConvTable=

[ModelOptions\ClssNamingOptions\COLN]

[ModelOptions\ClssNamingOptions\COLN\Name]
Template=
MaxLen=254
Case=M
ValidChar=
InvldChar=&quot;+-*/\.,!:;&#39;&quot;
AllValid=1
NoAccent=0
DefaultChar=_
Script=.foreach_part(%Name%)[CRLF].convert_name(%CurrentPart%)[CRLF].next(&quot;_&quot;)
ConvTable=

[ModelOptions\ClssNamingOptions\COLN\Code]
Template=
MaxLen=128
Case=U
ValidChar=&#39;a&#39;-&#39;z&#39;,&#39;A&#39;-&#39;Z&#39;,&#39;0&#39;-&#39;9&#39;,&quot;_&quot;
InvldChar=
AllValid=0
NoAccent=1
DefaultChar=_
Script=.foreach_part(%Code%)[CRLF].convert_code(%CurrentPart%)[CRLF].next(&quot;_&quot;)
ConvTable=

[ModelOptions\ClssNamingOptions\REFR]

[ModelOptions\ClssNamingOptions\REFR\Name]
Template=
MaxLen=254
Case=M
ValidChar=
InvldChar=&quot;+-*/\.,!:;&#39;&quot;
AllValid=1
NoAccent=0
DefaultChar=_
Script=.foreach_part(%Name%)[CRLF].convert_name(%CurrentPart%)[CRLF].next(&quot;_&quot;)
ConvTable=

[ModelOptions\ClssNamingOptions\REFR\Code]
Template=
MaxLen=254
Case=U
ValidChar=&#39;a&#39;-&#39;z&#39;,&#39;A&#39;-&#39;Z&#39;,&#39;0&#39;-&#39;9&#39;,&quot;_&quot;
InvldChar=
AllValid=0
NoAccent=1
DefaultChar=_
Script=.foreach_part(%Code%)[CRLF].convert_code(%CurrentPart%)[CRLF].next(&quot;_&quot;)
ConvTable=

[ModelOptions\ClssNamingOptions\VREF]

[ModelOptions\ClssNamingOptions\VREF\Name]
Template=
MaxLen=254
Case=M
ValidChar=
InvldChar=&quot;+-*/\.,!:;&#39;&quot;
AllValid=1
NoAccent=0
DefaultChar=_
Script=.foreach_part(%Name%)[CRLF].convert_name(%CurrentPart%)[CRLF].next(&quot;_&quot;)
ConvTable=

[ModelOptions\ClssNamingOptions\VREF\Code]
Template=
MaxLen=254
Case=U
ValidChar=&#39;a&#39;-&#39;z&#39;,&#39;A&#39;-&#39;Z&#39;,&#39;0&#39;-&#39;9&#39;,&quot;_&quot;
InvldChar=
AllValid=0
NoAccent=1
DefaultChar=_
Script=.foreach_part(%Code%)[CRLF].convert_code(%CurrentPart%)[CRLF].next(&quot;_&quot;)
ConvTable=

[ModelOptions\ClssNamingOptions\VIEW]

[ModelOptions\ClssNamingOptions\VIEW\Name]
Template=
MaxLen=254
Case=M
ValidChar=
InvldChar=&quot;+-*/\.,!:;&#39;&quot;
AllValid=1
NoAccent=0
DefaultChar=_
Script=.foreach_part(%Name%)[CRLF].convert_name(%CurrentPart%)[CRLF].next(&quot;_&quot;)
ConvTable=

[ModelOptions\ClssNamingOptions\VIEW\Code]
Template=
MaxLen=128
Case=U
ValidChar=&#39;a&#39;-&#39;z&#39;,&#39;A&#39;-&#39;Z&#39;,&#39;0&#39;-&#39;9&#39;,&quot;_&quot;
InvldChar=
AllValid=0
NoAccent=1
DefaultChar=_
Script=.foreach_part(%Code%)[CRLF].convert_code(%CurrentPart%)[CRLF].next(&quot;_&quot;)
ConvTable=

[ModelOptions\ClssNamingOptions\FACT]

[ModelOptions\ClssNamingOptions\FACT\Name]
Template=
MaxLen=254
Case=M
ValidChar=
InvldChar=&quot;+-*/\.,!:;&#39;&quot;
AllValid=1
NoAccent=0
DefaultChar=_
Script=.foreach_part(%Name%)[CRLF].convert_name(%CurrentPart%)[CRLF].next(&quot;_&quot;)
ConvTable=

[ModelOptions\ClssNamingOptions\FACT\Code]
Template=
MaxLen=254
Case=U
ValidChar=&#39;a&#39;-&#39;z&#39;,&#39;A&#39;-&#39;Z&#39;,&#39;0&#39;-&#39;9&#39;,&quot;_&quot;
InvldChar=
AllValid=0
NoAccent=1
DefaultChar=_
Script=.foreach_part(%Code%)[CRLF].convert_code(%CurrentPart%)[CRLF].next(&quot;_&quot;)
ConvTable=

[ModelOptions\ClssNamingOptions\DIMN]

[ModelOptions\ClssNamingOptions\DIMN\Name]
Template=
MaxLen=254
Case=M
ValidChar=
InvldChar=&quot;+-*/\.,!:;&#39;&quot;
AllValid=1
NoAccent=0
DefaultChar=_
Script=.foreach_part(%Name%)[CRLF].convert_name(%CurrentPart%)[CRLF].next(&quot;_&quot;)
ConvTable=

[ModelOptions\ClssNamingOptions\DIMN\Code]
Template=
MaxLen=254
Case=U
ValidChar=&#39;a&#39;-&#39;z&#39;,&#39;A&#39;-&#39;Z&#39;,&#39;0&#39;-&#39;9&#39;,&quot;_&quot;
InvldChar=
AllValid=0
NoAccent=1
DefaultChar=_
Script=.foreach_part(%Code%)[CRLF].convert_code(%CurrentPart%)[CRLF].next(&quot;_&quot;)
ConvTable=

[ModelOptions\ClssNamingOptions\CUBE]

[ModelOptions\ClssNamingOptions\CUBE\Name]
Template=
MaxLen=254
Case=M
ValidChar=
InvldChar=&quot;+-*/\.,!:;&#39;&quot;
AllValid=1
NoAccent=0
DefaultChar=_
Script=.foreach_part(%Name%)[CRLF].convert_name(%CurrentPart%)[CRLF].next(&quot;_&quot;)
ConvTable=

[ModelOptions\ClssNamingOptions\CUBE\Code]
Template=
MaxLen=254
Case=U
ValidChar=&#39;a&#39;-&#39;z&#39;,&#39;A&#39;-&#39;Z&#39;,&#39;0&#39;-&#39;9&#39;,&quot;_&quot;
InvldChar=
AllValid=0
NoAccent=1
DefaultChar=_
Script=.foreach_part(%Code%)[CRLF].convert_code(%CurrentPart%)[CRLF].next(&quot;_&quot;)
ConvTable=

[ModelOptions\ClssNamingOptions\MEAS]

[ModelOptions\ClssNamingOptions\MEAS\Name]
Template=
MaxLen=254
Case=M
ValidChar=
InvldChar=&quot;+-*/\.,!:;&#39;&quot;
AllValid=1
NoAccent=0
DefaultChar=_
Script=.foreach_part(%Name%)[CRLF].convert_name(%CurrentPart%)[CRLF].next(&quot;_&quot;)
ConvTable=

[ModelOptions\ClssNamingOptions\MEAS\Code]
Template=
MaxLen=254
Case=U
ValidChar=&#39;a&#39;-&#39;z&#39;,&#39;A&#39;-&#39;Z&#39;,&#39;0&#39;-&#39;9&#39;,&quot;_&quot;
InvldChar=
AllValid=0
NoAccent=1
DefaultChar=_
Script=.foreach_part(%Code%)[CRLF].convert_code(%CurrentPart%)[CRLF].next(&quot;_&quot;)
ConvTable=

[ModelOptions\ClssNamingOptions\DATTR]

[ModelOptions\ClssNamingOptions\DATTR\Name]
Template=
MaxLen=254
Case=M
ValidChar=
InvldChar=&quot;+-*/\.,!:;&#39;&quot;
AllValid=1
NoAccent=0
DefaultChar=_
Script=.foreach_part(%Name%)[CRLF].convert_name(%CurrentPart%)[CRLF].next(&quot;_&quot;)
ConvTable=

[ModelOptions\ClssNamingOptions\DATTR\Code]
Template=
MaxLen=254
Case=U
ValidChar=&#39;a&#39;-&#39;z&#39;,&#39;A&#39;-&#39;Z&#39;,&#39;0&#39;-&#39;9&#39;,&quot;_&quot;
InvldChar=
AllValid=0
NoAccent=1
DefaultChar=_
Script=.foreach_part(%Code%)[CRLF].convert_code(%CurrentPart%)[CRLF].next(&quot;_&quot;)
ConvTable=

[ModelOptions\ClssNamingOptions\FILO]

[ModelOptions\ClssNamingOptions\FILO\Name]
Template=
MaxLen=254
Case=M
ValidChar=
InvldChar=&quot;\/:*?&lt;&gt;|&quot;
AllValid=1
NoAccent=0
DefaultChar=_
Script=.foreach_part(%Name%)[CRLF].convert_name(%CurrentPart%)[CRLF].next(&quot;_&quot;)
ConvTable=

[ModelOptions\ClssNamingOptions\FILO\Code]
Template=
MaxLen=254
Case=U
ValidChar=&#39;a&#39;-&#39;z&#39;,&#39;A&#39;-&#39;Z&#39;,&#39;0&#39;-&#39;9&#39;,&quot;_.&quot;
InvldChar=
AllValid=0
NoAccent=1
DefaultChar=_
Script=.foreach_part(%Code%)[CRLF].convert_code(%CurrentPart%)[CRLF].next(&quot;_&quot;)
ConvTable=

[ModelOptions\ClssNamingOptions\DefaultClass]

[ModelOptions\ClssNamingOptions\DefaultClass\Name]
Template=
MaxLen=254
Case=M
ValidChar=
InvldChar=&quot;+-*/\.,!:;&#39;&quot;
AllValid=1
NoAccent=0
DefaultChar=_
Script=.foreach_part(%Name%)[CRLF].convert_name(%CurrentPart%)[CRLF].next(&quot;_&quot;)
ConvTable=

[ModelOptions\ClssNamingOptions\DefaultClass\Code]
Template=
MaxLen=254
Case=M
ValidChar=&#39;a&#39;-&#39;z&#39;,&#39;A&#39;-&#39;Z&#39;,&#39;0&#39;-&#39;9&#39;,&quot;_&quot;
InvldChar=
AllValid=0
NoAccent=1
DefaultChar=_
Script=.foreach_part(%Code%)[CRLF].convert_code(%CurrentPart%)[CRLF].next(&quot;_&quot;)
ConvTable=

[ModelOptions\NamingOptionsTemplates]

[ModelOptions\Default Opts]

[ModelOptions\Default Opts\TABL]
PhysOpts=

[ModelOptions\Default Opts\COLN]
PhysOpts=

[ModelOptions\Default Opts\INDX]
PhysOpts=

[ModelOptions\Default Opts\AKEY]
PhysOpts=

[ModelOptions\Default Opts\PKEY]
PhysOpts=

[ModelOptions\Default Opts\STOR]
PhysOpts=

[ModelOptions\Default Opts\TSPC]
PhysOpts=

[ModelOptions\Default Opts\SQNC]
PhysOpts=

[ModelOptions\Default Opts\DTBS]
PhysOpts=
</a:ModelOptionsText>
<c:DBMS>
<o:Shortcut Id="o3">
<a:ObjectID>6958B21E-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>Microsoft SQL Server 7.x</a:Name>
<a:Code>SQL SERVER 7</a:Code>
<a:CreationDate>1081543070</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543070</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:TargetID>986CB218-1936-4245-823C-883D7AF59B86</a:TargetID>
<a:TargetClassID>4BA9F647-DAB1-11D1-9944-006097355D9B</a:TargetClassID>
<a:TargetPackagePath/>
</o:Shortcut>
</c:DBMS>
<c:PhysicalDiagrams>
<o:PhysicalDiagram Id="o4">
<a:ObjectID>6958B21B-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>PhysicalDiagram_1</a:Name>
<a:Code>PHYSICALDIAGRAM_1</a:Code>
<a:CreationDate>1081543068</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1082144487</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DisplayPreferences>
[DisplayPreferences]

[DisplayPreferences\PDM]

[DisplayPreferences\General]
Adjust to text=Yes
Snap Grid=No
Display Grid=No
Show Page Delimiter=Yes
Grid size=800
Graphic unit=0
Window color=255 255 255

[DisplayPreferences\Object]
Mode=0
Trunc Length=80
Word Length=80
Word Text=!&quot;&quot;#$%&amp;&#39;()*+,-./:;&lt;=&gt;?@[\]^_`{|}~
Shortcut IntIcon=Yes
Shortcut IntLoct=No
Shortcut ExtIcon=Yes
Shortcut ExtLoct=No
File Location=No
TablColn=No
ColnMode=0
ColnMax=5
TablIndx=No
TablKey=No
TablTrgr=Yes
TablOwnr=No
ColnDttp=Yes
ColnDomn=No
ColnShowDomn=Yes
ColnKey=Yes
ColnIndx=Yes
ColnMand=Yes
ViewTabl=Yes
ViewColn=Yes
ViewOwnr=No
VColName=Yes
VColExpr=No
VColDttp=No
VColCMod=1
VColCMax=5
RefrName=No
RefrJoin=Yes
RefrCnam=No
RefrIntg=No
RefrImpl=No
RefrCard=No
RefrMode=2
VRefName=No
VRefJoin=No
VRefMode=0

[DisplayPreferences\Symbol]

[DisplayPreferences\Symbol\PDMPCKG]
DISPNAMEFont=arial,8,N
DISPNAMEFont color=0, 0, 0
AutoAdjustToText=Yes
Width=4800
Height=3600
Brush color=255 255 255
Fill Color=Yes
Pen=1 0 0, 0, 255
Shadow color=192 192 192
Shadow=No

[DisplayPreferences\Symbol\TABL]
DISPNAMEFont=arial,8,N
DISPNAMEFont color=0, 0, 0
TableColumnsFont=arial,8,N
TableColumnsFont color=0, 0, 0
TablePkColumnsFont=arial,8,N
TablePkColumnsFont color=0, 0, 0
TableIndexsFont=arial,8,N
TableIndexsFont color=0, 0, 0
TableKeysFont=arial,8,N
TableKeysFont color=0, 0, 0
TableTriggersFont=arial,8,N
TableTriggersFont color=0, 0, 0
AutoAdjustToText=Yes
Width=4800
Height=3600
Brush color=255 255 255
Fill Color=Yes
Pen=1 0 0, 0, 255
Shadow color=192 192 192
Shadow=No

[DisplayPreferences\Symbol\REFR]
DISPNAMEFont=arial,8,N
DISPNAMEFont color=0, 0, 0
CARDFont=arial,8,N
CARDFont color=0, 0, 0
Line style=0
Brush color=255 255 255
Fill Color=Yes
Pen=1 0 0, 0, 255
Shadow color=192 192 192
Shadow=No

[DisplayPreferences\Symbol\VREF]
DISPNAMEFont=arial,8,N
DISPNAMEFont color=0, 0, 0
Line style=0
Brush color=255 255 255
Fill Color=Yes
Pen=1 0 0, 0, 255
Shadow color=192 192 192
Shadow=No

[DisplayPreferences\Symbol\VIEW]
DISPNAMEFont=arial,8,N
DISPNAMEFont color=0, 0, 0
ViewColumnnFont=arial,8,N
ViewColumnnFont color=0, 0, 0
ViewTablesFont=arial,8,N
ViewTablesFont color=0, 0, 0
AutoAdjustToText=Yes
Width=4800
Height=3600
Brush color=255 255 255
Fill Color=Yes
Pen=1 0 0, 0, 255
Shadow color=192 192 192
Shadow=No

[DisplayPreferences\Symbol\FILO]
NAMEFont=arial,8,N
NAMEFont color=0, 0, 0
AutoAdjustToText=Yes
Width=2400
Height=2400
Brush color=255 255 255
Fill Color=No
Pen=1 0 0, 0, 255
Shadow color=192 192 192
Shadow=No

[DisplayPreferences\Symbol\USRDEPD]
OBJXSTRFont=arial,8,N
OBJXSTRFont color=0, 0, 0
Line style=0
Brush color=255 255 255
Fill Color=Yes
Pen=2 0 0 0 0
Shadow color=192 192 192
Shadow=No

[DisplayPreferences\Symbol\Free Symbol]
Free TextFont=arial,8,N
Free TextFont color=0, 0, 0
Line style=0
Brush color=255 255 255
Fill Color=Yes
Pen=1 0 0, 0, 255
Shadow color=192 192 192
Shadow=No
</a:DisplayPreferences>
<a:PaperSize>(8268, 11689)</a:PaperSize>
<a:PageMargins>((315,354), (433,354))</a:PageMargins>
<a:PageSize>9</a:PageSize>
<a:PaperSource>7</a:PaperSource>
<c:Symbols>
<o:ReferenceSymbol Id="o5">
<a:CenterTextOffset>(153, -750)</a:CenterTextOffset>
<a:Rect>((-726873,685850), (-719149,695850))</a:Rect>
<a:ListOfPoints>((-719594,695850),(-726720,685850))</a:ListOfPoints>
<a:ArrowStyle>4881</a:ArrowStyle>
<a:LineColor>8388736</a:LineColor>
<a:ShadowColor>12632256</a:ShadowColor>
<a:FontList>DISPNAME 0 arial,8,N</a:FontList>
<c:SourceSymbol>
<o:TableSymbol Id="o6">
<a:Rect>((-721961,693555), (-713945,698101))</a:Rect>
<a:LineColor>8388736</a:LineColor>
<a:FillColor>16777215</a:FillColor>
<a:ShadowColor>12632256</a:ShadowColor>
<a:FontList>DISPNAME 0 arial,8,N
TableColumns 0 arial,8,N
TablePkColumns 0 arial,8,N
TableKeys 0 arial,8,N
TableIndexs 0 arial,8,N
TableTriggers 0 arial,8,N</a:FontList>
<c:Object>
<o:Table Id="o7">
<a:ObjectID>6958B17E-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>T_HPA001</a:Name>
<a:Code>T_HPA001</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<c:Columns>
<o:Column Id="o8">
<a:ObjectID>6958B1F2-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>CD_HPA</a:Name>
<a:Code>CD_HPA</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL1    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL1 As
@valor &gt; 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o9">
<a:ObjectID>6958B1F4-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>NR_HPA_SEQ</a:Name>
<a:Code>NR_HPA_SEQ</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>int</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o10">
<a:ObjectID>6958B1F5-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>CD_AER</a:Name>
<a:Code>CD_AER</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL1    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL1 As
@valor &gt; 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
</o:Column>
<o:Column Id="o11">
<a:ObjectID>6958B1F7-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>CD_EQP</a:Name>
<a:Code>CD_EQP</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL1    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL1 As
@valor &gt; 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
</o:Column>
<o:Column Id="o12">
<a:ObjectID>6958B1F9-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>CD_AEN</a:Name>
<a:Code>CD_AEN</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL1    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL1 As
@valor &gt; 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
</o:Column>
<o:Column Id="o13">
<a:ObjectID>6958B1FB-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>CD_BOX</a:Name>
<a:Code>CD_BOX</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL1    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL1 As
@valor &gt; 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o14">
<a:ObjectID>6958B1FC-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>CD_CHG</a:Name>
<a:Code>CD_CHG</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL1    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL1 As
@valor &gt; 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
</o:Column>
<o:Column Id="o15">
<a:ObjectID>6958B1FD-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>DH_HPA_ENT</a:Name>
<a:Code>DH_HPA_ENT</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>smalldatetime</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o16">
<a:ObjectID>6958B1FE-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>CD_PAR</a:Name>
<a:Code>CD_PAR</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL1    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL1 As
@valor &gt; 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
</o:Column>
<o:Column Id="o17">
<a:ObjectID>6958B1FF-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>DH_HPA_SAI</a:Name>
<a:Code>DH_HPA_SAI</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>smalldatetime</a:DataType>
</o:Column>
<o:Column Id="o18">
<a:ObjectID>6958B200-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>FL_HPA_ENT</a:Name>
<a:Code>FL_HPA_ENT</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DefaultValue>/****** Object:  Default dbo.Zero    Script Date: 7/8/2000 12:14:36 ******/
Create Default        Zero As
0</a:DefaultValue>
<a:DataType>bit</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o19">
<a:ObjectID>6958B201-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>FL_HPA_SAI</a:Name>
<a:Code>FL_HPA_SAI</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DefaultValue>/****** Object:  Default dbo.Zero    Script Date: 7/8/2000 12:14:36 ******/
Create Default        Zero As
0</a:DefaultValue>
<a:DataType>bit</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o20">
<a:ObjectID>6958B202-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>FL_HPA_TOK</a:Name>
<a:Code>FL_HPA_TOK</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DefaultValue>/****** Object:  Default dbo.DF_VAL_001    Script Date: 7/8/2000 12:14:36 ******/
Create Default        DF_VAL_001 As
1</a:DefaultValue>
<a:DataType>bit</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o21">
<a:ObjectID>6958B203-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>CD_STA</a:Name>
<a:Code>CD_STA</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL1    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL1 As
@valor &gt; 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
</o:Column>
<o:Column Id="o22">
<a:ObjectID>6958B204-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>TIMESTAMP</a:Name>
<a:Code>TIMESTAMP</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>timestamp</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
</c:Columns>
<c:Keys>
<o:Key Id="o23">
<a:ObjectID>6958B212-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>Pk_T_HPA001</a:Name>
<a:Code>Pk_T_HPA001</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:PhysicalOptions>
clustered</a:PhysicalOptions>
<a:ConstraintName>Pk_T_HPA001</a:ConstraintName>
<c:Key.Columns>
<o:Column Ref="o8"/>
<o:Column Ref="o9"/>
</c:Key.Columns>
</o:Key>
</c:Keys>
<c:Indexes>
<o:Index Id="o24">
<a:ObjectID>6958B205-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>I_HPACHG</a:Name>
<a:Code>I_HPACHG</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<c:IndexColumns>
<o:IndexColumn Id="o25">
<a:ObjectID>6958B206-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:IndexColumn.Expression>&lt;Index Expression_0&gt;</a:IndexColumn.Expression>
<c:Column>
<o:Column Ref="o14"/>
</c:Column>
</o:IndexColumn>
</c:IndexColumns>
</o:Index>
<o:Index Id="o26">
<a:ObjectID>6958B207-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>I_HPAENT</a:Name>
<a:Code>I_HPAENT</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<c:IndexColumns>
<o:IndexColumn Id="o27">
<a:ObjectID>6958B208-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:IndexColumn.Expression>&lt;Index Expression_0&gt;</a:IndexColumn.Expression>
<c:Column>
<o:Column Ref="o15"/>
</c:Column>
</o:IndexColumn>
</c:IndexColumns>
</o:Index>
<o:Index Id="o28">
<a:ObjectID>6958B209-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>I_HPAPAR</a:Name>
<a:Code>I_HPAPAR</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<c:IndexColumns>
<o:IndexColumn Id="o29">
<a:ObjectID>6958B20A-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:IndexColumn.Expression>&lt;Index Expression_0&gt;</a:IndexColumn.Expression>
<c:Column>
<o:Column Ref="o16"/>
</c:Column>
</o:IndexColumn>
</c:IndexColumns>
</o:Index>
<o:Index Id="o30">
<a:ObjectID>6958B20B-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>I_HPASAI</a:Name>
<a:Code>I_HPASAI</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<c:IndexColumns>
<o:IndexColumn Id="o31">
<a:ObjectID>6958B20C-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:IndexColumn.Expression>&lt;Index Expression_0&gt;</a:IndexColumn.Expression>
<c:Column>
<o:Column Ref="o17"/>
</c:Column>
</o:IndexColumn>
</c:IndexColumns>
</o:Index>
<o:Index Id="o32">
<a:ObjectID>6958B20E-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>I_HPASTA</a:Name>
<a:Code>I_HPASTA</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<c:IndexColumns>
<o:IndexColumn Id="o33">
<a:ObjectID>6958B210-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:IndexColumn.Expression>&lt;Index Expression_0&gt;</a:IndexColumn.Expression>
<c:Column>
<o:Column Ref="o21"/>
</c:Column>
</o:IndexColumn>
</c:IndexColumns>
</o:Index>
</c:Indexes>
<c:Owner>
<o:User Id="o34">
<a:ObjectID>6958B223-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>dbo</a:Name>
<a:Code>dbo</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
</o:User>
</c:Owner>
<c:Triggers>
<o:Trigger Id="o35">
<a:ObjectID>6958B167-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>T_HPA001_TRD</a:Name>
<a:Code>T_HPA001_TRD</a:Code>
<a:Text>Create Trigger T_HPA001_TRD On T_HPA001
For Delete As
Begin
IF @@ROWCOUNT = 0 RETURN
SET NOCOUNT ON
/* Regra de negócio */
/* SE O VÔO NÃO EXISTIR MAIS, SAIR DA TRIGGER */
/* IF (SELECT COUNT(*) FROM T_CHG CHG, DELETED DEL	WHERE CHG.CD_CHG = DEL.CD_CHG) = 0 RETURN */

/* Não permitir excluir o primeiro HPA de um voo, se este voo existir na tabela de vôo e não for cancelado e tenha chegada  e não for codeshare ou duplicate leg*/
IF	(SELECT COUNT(*)
	FROM	DELETED DEL
	WHERE	DEL.NR_HPA_SEQ = 1 AND
		EXISTS (SELECT CD_CHG FROM T_CHG CHG WHERE CHG.CD_CHG = DEL.CD_CHG AND CHG.FL_CHG_CAN = 0 AND CHG.TP_CHG_CTG NOT IN (3,4))) &gt; 0 
BEGIN
	RAISERROR 20999 &#39;Operação não executada: Não de pode excluir a primeira movimentação de box de um vôo.&#39;
	ROLLBACK TRANSACTION
	RETURN
END

/* Milena (25/05/98) - Não permitir excluir o primeiro HPA de um determinado status (Não permitir excluir um HPA se o 
código do status antecessor do HPA que se deseja deletar for igual ao código do status do HPA anterior) */
IF	(SELECT COUNT(*)
	FROM	DELETED DEL, T_STA STA
	WHERE	STA.CD_STA = DEL.CD_STA AND
		STA.CD_STA_ANT = (	SELECT 	CD_STA 
				    	FROM	T_HPA001 HPA
				    	WHERE	HPA.CD_HPA = DEL.CD_HPA AND
						HPA.NR_HPA_SEQ = DEL.NR_HPA_SEQ - 1)) &gt; 0
BEGIN
	RAISERROR 20999 &#39;Operação não executada: Não se pode excluir o primeiro HPA de um determinado Status.&#39;
	ROLLBACK TRANSACTION
	RETURN
END

/* Não permitir que o último SEQ tenha status fechado e FL_HPA_SAI = 0 */
IF (SELECT COUNT(*) FROM T_HPA001 HPA, T_STA STA, DELETED DEL
	WHERE	HPA.CD_HPA = DEL.CD_HPA AND
		HPA.NR_HPA_SEQ = (SELECT MAX(NR_HPA_SEQ) FROM T_HPA001 HPA1 WHERE HPA1.CD_HPA = DEL.CD_HPA) AND
		HPA.FL_HPA_SAI = 0 AND
		STA.CD_STA = HPA.CD_STA AND
		STA.TP_STA = 2) &gt; 0
BEGIN
	RAISERROR 20999 &#39;Operação não executada: O último Histórico de Permanência de Aeronaves de um vôo que ainda não partiu não pode estar associado a um STATUS fechado.&#39;
	ROLLBACK TRANSACTION
	RETURN
END

/* Alterar a hora de saída do HPA anterior com a hora de saída do HPA que se foi deletado*/
UPDATE 	T_HPA001
SET	NR_HPA_SEQ = DEL.NR_HPA_SEQ  /* FORÇAR A EXECUÇÃO DA TRIGGER DE UPDATE */             /* ANTES: DH_HPA_SAI = DEL.DH_HPA_SAI */
FROM	T_HPA001 HPA,
	DELETED DEL
WHERE 	HPA.CD_HPA = DEL.CD_HPA AND
	HPA.NR_HPA_SEQ = DEL.NR_HPA_SEQ - 1

/* Atualizar TP_STA para Cancelado se o HPA tiver sido deletado e não existir nehum outro HPA associado a este STATUS */
UPDATE 	STA
SET 	TP_STA = 3,   /* Cancelado */
	DH_STA_FEC = NULL,
	MA_STA_FEC = NULL,
	CD_STA_ANT = NULL,
	FL_STA_AEN_ISE = NULL,
	FL_STA_COM_TAR_RED = NULL,
	QT_STA_PSI_ISE = NULL,
	QT_STA_PSI_TAR_RED = NULL
FROM 	T_STA STA, DELETED DEL
WHERE 	STA.CD_STA = DEL.CD_STA AND
	NOT EXISTS (SELECT CD_HPA FROM T_HPA001 WHERE CD_STA = DEL.CD_STA)

/* INCLUIR REGISTROS EM T_AHP */
INSERT	T_AHP (DH_AHP, CD_HPA)
SELECT GETDATE(), CD_HPA FROM DELETED

/* Se o HPA de último sequencial for excluído, incluir registros em T_APA */
INSERT	T_APA (CD_PAR, DH_APA)
Select 	DISTINCT DEL.CD_PAR, GETDATE()
From	DELETED DEL, T_HPA001 HPA, T_PAR PAR
Where	DEL.CD_HPA = HPA.CD_HPA AND
	DEL.CD_PAR IS NOT NULL AND
	PAR.CD_PAR = DEL.CD_PAR And
	PAR.TP_PAR_STA = 1 And
	PAR.CD_AER = (Select CD_AER From T_PSI) And
	DEL.NR_HPA_SEQ &gt; (	Select 	Max(NR_HPA_SEQ)
				From 	T_HPA001
				Where 	CD_HPA = DEL.CD_HPA)

End
go</a:Text>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Trigger.Type>D</a:Trigger.Type>
</o:Trigger>
<o:Trigger Id="o36">
<a:ObjectID>6958B16A-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>T_HPA001_TRI</a:Name>
<a:Code>T_HPA001_TRI</a:Code>
<a:Text>Create Trigger T_HPA001_TRI On T_HPA001
For Insert As
Begin
IF @@ROWCOUNT = 0 RETURN
SET NOCOUNT ON
/* Aeroporto»Histórico de Permanência de Aeronaves: Aeroporto do HPA */
If (Select Count(*) From T_AER, Inserted
Where T_AER.CD_AER = Inserted.CD_AER)
 &lt;&gt;(Select Count(CD_AER) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Aeroporto&gt; que se deseja incluir na tabela &lt;Histórico de Permanência de Aeronaves&gt; não está cadastrada&#39;
  Return
End
/* Aeronave»Histórico de Permanência de Aeronaves: Aeronave do HPA */
If (Select Count(*) From T_AEN, Inserted
Where T_AEN.CD_AEN = Inserted.CD_AEN)
 &lt;&gt;(Select Count(CD_AEN) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Aeronave&gt; que se deseja incluir na tabela &lt;Histórico de Permanência de Aeronaves&gt; não está cadastrada&#39;
  Return
End
/* Equipamento»Histórico de Permanência de Aeronaves: Equipamento do HPA */
If (Select Count(*) From T_EQP, Inserted
Where T_EQP.CD_EQP = Inserted.CD_EQP)
 &lt;&gt;(Select Count(CD_EQP) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Equipamento&gt; que se deseja incluir na tabela &lt;Histórico de Permanência de Aeronaves&gt; não está cadastrada&#39;
  Return
End
/* Box»Histórico de Permanência de Aeronaves: Box do HPA */
If (Select Count(*) From T_BOX, Inserted
Where T_BOX.CD_BOX = Inserted.CD_BOX)
 &lt;&gt;(Select Count(CD_BOX) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Box&gt; que se deseja incluir na tabela &lt;Histórico de Permanência de Aeronaves&gt; não está cadastrada&#39;
  Return
End
/* Chegadas»Histórico de Permanência de Aeronaves: Histórico de Permanência dos Vôos de Chegada */
If (Select Count(*) From T_CHG, Inserted
Where T_CHG.CD_CHG = Inserted.CD_CHG)
 &lt;&gt;(Select Count(CD_CHG) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Chegadas&gt; que se deseja incluir na tabela &lt;Histórico de Permanência de Aeronaves&gt; não está cadastrada&#39;
  Return
End
/* Partidas»Histórico de Permanência de Aeronaves: Histórico de Permanência dos Vôos de Partida */
If (Select Count(*) From T_PAR, Inserted
Where T_PAR.CD_PAR = Inserted.CD_PAR)
 &lt;&gt;(Select Count(CD_PAR) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Partidas&gt; que se deseja incluir na tabela &lt;Histórico de Permanência de Aeronaves&gt; não está cadastrada&#39;
  Return
End
/* Status de Aeronave»Histórico de Permanência de Aeronaves: Status de HPA */
If (Select Count(*) From T_STA, Inserted
Where T_STA.CD_STA = Inserted.CD_STA)
 &lt;&gt;(Select Count(CD_STA) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Status de Aeronave&gt; que se deseja incluir na tabela &lt;Histórico de Permanência de Aeronaves&gt; não está cadastrada&#39;
  Return
End
/* Regra de negócio */
/* NOVO */
/* Não permitir que para um mesmo HPA haja mais de um registro (NR_HPA_SEQ) com a mesma DH_HPA_ENT */
IF (	SELECT 	COUNT(*) FROM INSERTED INS, T_HPA001 HPA
	WHERE 	HPA.CD_HPA = INS.CD_HPA AND
		HPA.NR_HPA_SEQ &lt;&gt; INS.NR_HPA_SEQ AND
		HPA.DH_HPA_ENT = INS.DH_HPA_ENT) &gt; 0
BEGIN
	RAISERROR 20999 &#39;Operação não executada: Não pode haver mais de um Movimento de Aeronave com a mesma Hora de Entrada em um mesmo Status.&#39;
	ROLLBACK TRANSACTION
	RETURN
END

/* Forçar a execução da trigger de UPDATE atualizando alguns dados deste HPA com os dados do primeiro HPA */
UPDATE	HPA
SET	NR_HPA_SEQ = HPA.NR_HPA_SEQ,
	CD_AER = HPA1.CD_AER,
	CD_EQP = HPA1.CD_EQP,
	CD_AEN = HPA1.CD_AEN,
	CD_BOX = HPA.CD_BOX,
	CD_CHG = HPA1.CD_CHG,
	DH_HPA_ENT = HPA.DH_HPA_ENT,
	CD_PAR = HPA1.CD_PAR,
	DH_HPA_SAI = HPA.DH_HPA_SAI,
	FL_HPA_ENT = HPA1.FL_HPA_ENT,
	FL_HPA_SAI = HPA1.FL_HPA_SAI,
	FL_HPA_TOK = HPA1.FL_HPA_TOK,
	CD_STA = ISNULL(HPA.CD_STA, (SELECT CD_STA FROM T_HPA001 HPA2 WHERE HPA2.CD_HPA = INS.CD_HPA AND HPA2.DH_HPA_ENT = (SELECT MAX(DH_HPA_ENT) FROM T_HPA001 HPA3 WHERE HPA3.CD_HPA = INS.CD_HPA AND DH_HPA_ENT &lt; INS.DH_HPA_ENT)))
FROM	T_HPA001 HPA, INSERTED INS, T_HPA001 HPA1
WHERE 	HPA.CD_HPA = INS.CD_HPA AND
	HPA.NR_HPA_SEQ = INS.NR_HPA_SEQ AND
	HPA1.CD_HPA = INS.CD_HPA AND
	HPA1.NR_HPA_SEQ = 1

/* FIM NOVO */

/* ELIMINADO --------------------------------------------------------------------------------------------------
/* Verificar se a data da saída é maior que a data da entrada */
IF (SELECT COUNT(*) FROM INSERTED WHERE DH_HPA_ENT &gt; DH_HPA_SAI) &gt; 0
BEGIN
	RAISERROR 20999 &#39;Operação não executada: A data de saída do HPA não pode ser menor que a data de entrada&#39;
	ROLLBACK TRANSACTION
	RETURN
END

/* Alterar a hora de saída do HPA anterior com a hora de entrada do voo que se está alterando */
UPDATE 	T_HPA001
SET	DH_HPA_SAI = INS.DH_HPA_ENT
FROM	T_HPA001 HPA,
	INSERTED INS
WHERE 	HPA.CD_HPA = INS.CD_HPA AND
	HPA.NR_HPA_SEQ = INS.NR_HPA_SEQ - 1
------------------------------------------------------------------------------------------------------------------------ */


End
go</a:Text>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Trigger.Type>I</a:Trigger.Type>
</o:Trigger>
<o:Trigger Id="o37">
<a:ObjectID>6958B16D-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>T_HPA001_TRU</a:Name>
<a:Code>T_HPA001_TRU</a:Code>
<a:Text>Create Trigger T_HPA001_TRU On T_HPA001
For Update As
Begin
IF @@ROWCOUNT = 0 RETURN
SET NOCOUNT ON
If Update (CD_HPA)
Begin
  RollBack Transaction
  RaisError 20002 &#39;Operação não executada: A informação &lt;Código de Histórico de Permanência de Aeronaves&gt; da tabela &lt;Histórico de Permanência de Aeronaves&gt; não pode ser alterada.&#39;
  Return
End
If Update (CD_AER)
/* Aeroporto»Histórico de Permanência de Aeronaves: Aeroporto do HPA */
If (Select Count(*) From T_AER, Inserted
Where T_AER.CD_AER = Inserted.CD_AER)
 &lt;&gt;(Select Count(CD_AER) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Aeroporto&gt; que se deseja incluir na tabela &lt;Histórico de Permanência de Aeronaves&gt; não está cadastrada&#39;
  Return
End
If Update (CD_AEN)
/* Aeronave»Histórico de Permanência de Aeronaves: Aeronave do HPA */
If (Select Count(*) From T_AEN, Inserted
Where T_AEN.CD_AEN = Inserted.CD_AEN)
 &lt;&gt;(Select Count(CD_AEN) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Aeronave&gt; que se deseja incluir na tabela &lt;Histórico de Permanência de Aeronaves&gt; não está cadastrada&#39;
  Return
End
If Update (CD_EQP)
/* Equipamento»Histórico de Permanência de Aeronaves: Equipamento do HPA */
If (Select Count(*) From T_EQP, Inserted
Where T_EQP.CD_EQP = Inserted.CD_EQP)
 &lt;&gt;(Select Count(CD_EQP) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Equipamento&gt; que se deseja incluir na tabela &lt;Histórico de Permanência de Aeronaves&gt; não está cadastrada&#39;
  Return
End
If Update (CD_BOX)
/* Box»Histórico de Permanência de Aeronaves: Box do HPA */
If (Select Count(*) From T_BOX, Inserted
Where T_BOX.CD_BOX = Inserted.CD_BOX)
 &lt;&gt;(Select Count(CD_BOX) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Box&gt; que se deseja incluir na tabela &lt;Histórico de Permanência de Aeronaves&gt; não está cadastrada&#39;
  Return
End
If Update (CD_CHG)
/* Chegadas»Histórico de Permanência de Aeronaves: Histórico de Permanência dos Vôos de Chegada */
If (Select Count(*) From T_CHG, Inserted
Where T_CHG.CD_CHG = Inserted.CD_CHG)
 &lt;&gt;(Select Count(CD_CHG) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Chegadas&gt; que se deseja incluir na tabela &lt;Histórico de Permanência de Aeronaves&gt; não está cadastrada&#39;
  Return
End
If Update (CD_PAR)
/* Partidas»Histórico de Permanência de Aeronaves: Histórico de Permanência dos Vôos de Partida */
If (Select Count(*) From T_PAR, Inserted
Where T_PAR.CD_PAR = Inserted.CD_PAR)
 &lt;&gt;(Select Count(CD_PAR) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Partidas&gt; que se deseja incluir na tabela &lt;Histórico de Permanência de Aeronaves&gt; não está cadastrada&#39;
  Return
End
If Update (CD_STA)
/* Status de Aeronave»Histórico de Permanência de Aeronaves: Status de HPA */
If (Select Count(*) From T_STA, Inserted
Where T_STA.CD_STA = Inserted.CD_STA)
 &lt;&gt;(Select Count(CD_STA) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Status de Aeronave&gt; que se deseja incluir na tabela &lt;Histórico de Permanência de Aeronaves&gt; não está cadastrada&#39;
  Return
End
/* Regra de negócio */
/* INICIO NOVO */

/* Ordenar o atributo NR_HPA_SEQ com base na hora de entrada */
IF UPDATE(NR_HPA_SEQ)
UPDATE	HPA
SET	NR_HPA_SEQ = (SELECT COUNT(*) FROM T_HPA001 HPA1 WHERE HPA1.CD_HPA = HPA.CD_HPA AND HPA1.DH_HPA_ENT &lt;= HPA.DH_HPA_ENT)
FROM	T_HPA001 HPA, INSERTED INS
WHERE	HPA.CD_HPA = INS.CD_HPA

/* Atualizar a entrada do primeiro HPA com a data de entrada em estacionamento do vôo de chegada */
UPDATE	HPA
SET	DH_HPA_ENT = CHG.DH_CHG_EST
FROM	T_HPA001 HPA, T_CHG CHG, INSERTED INS
WHERE	HPA.CD_HPA = INS.CD_HPA AND
	HPA.NR_HPA_SEQ = 1 AND
	CHG.CD_CHG = HPA.CD_CHG

/* Atualizar a data da saída com a data da entrada do movimento subseqüente. O último deve ser atualizado com a data/hora
   do vôo de partida */
UPDATE	HPA
SET	DH_HPA_SAI = ISNULL((	SELECT 	DH_HPA_ENT
					FROM 	T_HPA001 HPA1
					WHERE	HPA1.CD_HPA = HPA.CD_HPA AND
						HPA1.NR_HPA_SEQ = HPA.NR_HPA_SEQ + 1), PAR.DH_PAR_EST)
FROM	T_HPA001 HPA, T_PAR PAR, INSERTED INS
WHERE	PAR.CD_PAR =* HPA.CD_PAR AND
	HPA.CD_HPA = INS.CD_HPA

/*
/* Verificar se existe algum HPA com hora de entrada maior que a hora de saída */
IF (	SELECT 	COUNT(*) FROM T_HPA001 HPA
	WHERE	DH_HPA_ENT &gt;= DH_HPA_SAI AND
		HPA.CD_HPA IN (SELECT DISTINCT CD_HPA FROM INSERTED)) &gt; 0
BEGIN
	RAISERROR 20999 &#39;Operação não executada: A Data e Hora de Entrada em uma posição de box tem de ser menor que a Data e Hora de Saída.&#39;
	ROLLBACK TRANSACTION
	RETURN
END
*/

/* FIM NOVO */

/* -----------------------
/* Verificar se há algum HPA com aeronaves diversas */
IF EXISTS (SELECT HPA.CD_HPA
	FROM	T_HPA001 HPA,
		INSERTED INS
	WHERE	HPA.CD_HPA = INS.CD_HPA
	GROUP BY HPA.CD_HPA
	HAVING	COUNT(DISTINCT HPA.CD_AEN) &gt; 1) 
BEGIN
	RAISERROR 20999 &#39;Operação não executada: Não pode haver vôos com mais de uma aeronave no Histórico de Permanência.&#39;
	ROLLBACK TRANSACTION
	RETURN
END
-------------------------- */

/* ATUALIZAÇÕES */

/* ---------------------------------------
IF	UPDATE (DH_HPA_SAI)
BEGIN          
	/* Alterar a hora de entrada do HPA seguinte com a hora de saída do voo que se está alterando */
	UPDATE 	T_HPA001
	SET	DH_HPA_ENT = INS.DH_HPA_SAI
	FROM	T_HPA001 HPA,
		INSERTED INS
	WHERE 	HPA.CD_HPA = INS.CD_HPA AND
		HPA.NR_HPA_SEQ = INS.NR_HPA_SEQ + 1 AND
		INS.DH_HPA_SAI &lt;&gt; NULL
END
-------------------------------------- */

IF	UPDATE (DH_HPA_ENT)
BEGIN          
	/* A hora de entrada do primeiro HPA tem de ser igual à hora de estacionamento do vôo de chegada */
	IF (SELECT COUNT(*) 
		FROM T_HPA001 HPA, T_CHG CHG, INSERTED INS
		WHERE 	HPA.CD_HPA = INS.CD_HPA AND
			INS.NR_HPA_SEQ = 1 AND
			CHG.CD_CHG = INS.CD_CHG AND
			INS.DH_HPA_ENT &lt;&gt; CHG.DH_CHG_EST) &gt; 0
	BEGIN
		RAISERROR 20999 &#39;Operação não executada: A hora de entrada da primeira movimentação de box tem de ser igual à hora de estacionamento do vôo de chegada.&#39;
		ROLLBACK TRANSACTION
		RETURN
	END

	/* Milena (25/05/98) - Não permitir a alteração do campo DH_HPA_ENT do primeiro HPA de um determinado status 
	(Não permitir alterar um HPA se o código do status antecessor do HPA que se deseja alterar for igual ao código do 
	status do HPA anterior) =&gt; Só testar se esse HPA não for o primeiro de todos (NR_HPA_SEQ &lt;&gt; 1) */
	IF (SELECT COUNT(*)
		FROM	INSERTED INS, DELETED DEL, T_STA STA
		WHERE	DEL.CD_HPA = INS.CD_HPA AND
			DEL.NR_HPA_SEQ = INS.NR_HPA_SEQ AND
			DEL.DH_HPA_ENT &lt;&gt; INS.DH_HPA_ENT AND
			STA.CD_STA = INS.CD_STA AND
			STA.CD_STA_ANT = (	SELECT 	CD_STA 
					    	FROM	T_HPA001 HPA
					    	WHERE	HPA.CD_HPA = INS.CD_HPA AND
							HPA.NR_HPA_SEQ = INS.NR_HPA_SEQ - 1)) &gt; 0
	BEGIN
		RAISERROR 20999 &#39;Operação não executada: Não se pode alterar a Data ou Hora do primeiro HPA de um determinado Status.&#39;
		ROLLBACK TRANSACTION
		RETURN
	END

	/* -----------------------------

	/* Alterar a hora de saída do HPA anterior com a hora de entrada do voo que se está alterando */
	UPDATE 	T_HPA001
	SET	DH_HPA_SAI = INS.DH_HPA_ENT
	FROM	T_HPA001 HPA,
		INSERTED INS

	WHERE 	HPA.CD_HPA = INS.CD_HPA AND
		HPA.NR_HPA_SEQ = INS.NR_HPA_SEQ - 1

	------------------------------ */

END

/* -----------------------------------
IF 	UPDATE(CD_PAR)
BEGIN

	/* Atribuir nulo à data de saída do último registro de HPA que tenha o vôo de saída nulo */
	UPDATE 	T_HPA001
	SET	DH_HPA_SAI = NULL
	FROM	T_HPA001 HPA,
		INSERTED INS
	WHERE 	HPA.CD_HPA = INS.CD_HPA AND
		HPA.NR_HPA_SEQ = (	SELECT 	MAX(NR_HPA_SEQ) 
					FROM 	T_HPA001 HPAMAX 
					WHERE 	HPAMAX.CD_HPA = HPA.CD_HPA) AND
		INS.CD_PAR IS NULL

	/* Atribuir a hora de estacionamento, ou a hora prevista caso a hora de estacionamento seja nula, do vôo de 
	    partida à data de saída do último registro de HPA */
	UPDATE 	T_HPA001
	SET	DH_HPA_SAI = PAR.DH_PAR_EST
	FROM	T_HPA001 HPA,
		T_PAR PAR,
		INSERTED INS
	WHERE 	HPA.CD_HPA = INS.CD_HPA AND
		HPA.NR_HPA_SEQ = (	SELECT 	MAX(NR_HPA_SEQ) 
					FROM 	T_HPA001 HPAMAX 
					WHERE 	HPAMAX.CD_HPA = HPA.CD_HPA) AND
		PAR.CD_PAR = HPA.CD_PAR

END

---------------------------- */

/* -------------------------------------------------------------------------------------------------------------------------------------

/* Verificar se os horários estão consistentes */

/* Declaração do cursor */
DECLARE HPA_OK CURSOR FOR
	SELECT 	DISTINCT 
		HPA.CD_HPA,
		HPA.NR_HPA_SEQ,
		HPA.DH_HPA_ENT,
		HPA.DH_HPA_SAI
	FROM	T_HPA001 HPA,
		INSERTED INS
	WHERE	HPA.CD_HPA = INS.CD_HPA 
	ORDER BY HPA.CD_HPA, HPA.NR_HPA_SEQ

/* Declaração das variáveis que receberão o cursor */
DECLARE @CD_HPA	INT,
	 @NR_HPA_SEQ	INT,
	 @DH_HPA_ENT	SMALLDATETIME,
	 @DH_HPA_SAI	SMALLDATETIME,
	 @CD_HPA_CORRENTE		INT,
	 @NR_HPA_SEQ_CORRENTE	INT,
	 @DH_HPA_SAI_CORRENTE	SMALLDATETIME

/* Abertura do cursor */
OPEN HPA_OK

/* Ir para o primeiro registro */
FETCH	HPA_OK 
INTO	@CD_HPA,
	@NR_HPA_SEQ,
	@DH_HPA_ENT,
	@DH_HPA_SAI


/* Processar todos os registros de HPA_OK */
WHILE @@FETCH_STATUS = 0
BEGIN

	SELECT	@CD_HPA_CORRENTE = @CD_HPA,
	 	@NR_HPA_SEQ_CORRENTE = @NR_HPA_SEQ,
		@DH_HPA_SAI_CORRENTE = @DH_HPA_SAI

	/* Ir para o próximo registro */
	FETCH NEXT FROM HPA_OK 
	INTO	@CD_HPA,

		@NR_HPA_SEQ,
		@DH_HPA_ENT,
		@DH_HPA_SAI

	/* Processar todos os itens deste HPA */
	WHILE @@FETCH_STATUS = 0 AND @CD_HPA = @CD_HPA_CORRENTE

	BEGIN

		/* Verificar se o novo sequencial é igual ao seguencial anterior mais 1 */
		IF @NR_HPA_SEQ &lt;&gt; @NR_HPA_SEQ_CORRENTE + 1
		BEGIN
			CLOSE HPA_OK
			DEALLOCATE HPA_OK
			RAISERROR 20999 &#39;Operação não executada: Os sequenciais das movimentações de box não podem ter falha de numeração.&#39;
			ROLLBACK TRANSACTION
			RETURN
		END

		/* Verificar se a hora de entrada corrente é igual à hora de saída anterior */
		IF @DH_HPA_ENT &lt;&gt; @DH_HPA_SAI_CORRENTE
		BEGIN
			CLOSE HPA_OK
			DEALLOCATE HPA_OK
			RAISERROR 20999 &#39;Operação não executada: A hora de entrada de uma movimentação de box tem de ser igual à hora de saída da movimentação anterior.&#39;
			ROLLBACK TRANSACTION
			RETURN
		END

		SELECT 	@NR_HPA_SEQ_CORRENTE = @NR_HPA_SEQ,
			@DH_HPA_SAI_CORRENTE = @DH_HPA_SAI

		/* Ir para o próximo registro */
		FETCH	NEXT FROM HPA_OK 
		INTO	@CD_HPA,
			@NR_HPA_SEQ,
			@DH_HPA_ENT,
			@DH_HPA_SAI

	END

END
CLOSE HPA_OK
DEALLOCATE HPA_OK

------------------------------------------------------------------------------------------------------------------- */


/* Atualizar os dados em Status referente a Partida */
/* Se o flag que indica se a saída do vôo está concluída ou não tiver sido alterado e se o campo NR_HPA_SEQ não tiver
sido alterado (somente na inclusão de HPA este campo é atualizado, o que indica que a operácão que está sendo efetuada
é realmente uma alteração) */
IF UPDATE(FL_HPA_SAI) AND NOT UPDATE(NR_HPA_SEQ)
BEGIN

	UPDATE 	STA
	SET 	DH_STA_FEC = NULL,
		MA_STA_FEC = NULL,
		TP_STA = 1   /* Em aberto */
	FROM 	INSERTED INS, T_STA STA
	WHERE 	STA.CD_STA = INS.CD_STA AND
		INS.NR_HPA_SEQ = (SELECT MAX(NR_HPA_SEQ) FROM T_HPA001 HPA WHERE HPA.CD_HPA = INS.CD_HPA) AND
		INS.FL_HPA_SAI = 0

	UPDATE 	STA
	SET 	DH_STA_FEC = PAR.DH_PAR_EFE, /*CONVERT(SMALLDATETIME, CONVERT(CHAR(2),DATEPART(MM, PAR.DH_PAR_EFE)) + &#39;/&#39; + CONVERT(CHAR(2), DATEPART(DD, PAR.DH_PAR_EFE)) + &#39;/&#39; + CONVERT(CHAR(4), DATEPART(YY, PAR.DH_PAR_EFE))), */
		/* Primeiro dia do mês da Data da Partida*/
		MA_STA_FEC = DATEADD(DD, 1 - DATEPART(DD, PAR.DH_PAR_EFE), DATEADD(HH, - DATEPART(HH, PAR.DH_PAR_EFE), DATEADD(MI, -DATEPART(MI, PAR.DH_PAR_EFE), PAR.DH_PAR_EFE))),
		/*
		MA_STA_FEC = DATEADD(DD, 1- DATEPART(DD, CONVERT(SMALLDATETIME, CONVERT(CHAR(2),DATEPART(MM, PAR.DH_PAR_EFE)) + &#39;/&#39; + CONVERT(CHAR(2), DATEPART(DD, PAR.DH_PAR_EFE)) + &#39;/&#39; + CONVERT(CHAR(4), DATEPART(YY, PAR.DH_PAR_EFE)))), CONVERT(SMALLDATETIME, CONVERT(CHAR(2),DATEPART(MM, PAR.DH_PAR_EFE)) + &#39;/&#39; + CONVERT(CHAR(2), DATEPART(DD, PAR.DH_PAR_EFE)) + &#39;/&#39; + CONVERT(CHAR(4), DATEPART(YY, PAR.DH_PAR_EFE)))), 
		*/
		TP_STA = 2   /* Fechado */
	FROM 	INSERTED INS, T_STA STA, T_PAR PAR
	WHERE 	STA.CD_STA = INS.CD_STA AND
		INS.NR_HPA_SEQ = (SELECT MAX(NR_HPA_SEQ) FROM T_HPA001 HPA WHERE HPA.CD_HPA = INS.CD_HPA) AND
		INS.FL_HPA_SAI = 1 AND
		PAR.CD_PAR = INS.CD_PAR
END

/* INCLUIR REGISTROS EM T_AHP */
INSERT	T_AHP (DH_AHP, CD_HPA)
SELECT GETDATE(), CD_HPA FROM INSERTED


/* RONALDO 12/11/98 ATUALIZAÇÃO DO EQUIPAMENTO COM BASE NA AERONAVE */
IF UPDATE(CD_AEN)
	UPDATE 	HPA
	SET	CD_EQP = EQP.CD_EQP
	FROM	T_HPA001 HPA,
		T_AEN AEN,
		T_EQP EQP,
		INSERTED INS
	WHERE	HPA.CD_HPA = INS.CD_HPA AND
		AEN.CD_AEN = HPA.CD_AEN AND
		EQP.CD_EQP = AEN.CD_EQP AND
		INS.CD_AEN IS NOT NULL

IF UPDATE(CD_BOX)
BEGIN
	/* Incluir Registros em T_ACH */
	INSERT	T_ACH (DH_ACH, CD_CHG)
	Select 	GETDATE(), INS.CD_CHG
	From 	T_CHG CHG, INSERTED INS
	Where 	CHG.CD_CHG = INS.CD_CHG AND
		INS.NR_HPA_SEQ = 1 AND
		CHG.TP_CHG_STA = 1 AND
		CHG.CD_AER = (Select CD_AER From T_PSI)

	/* Incluir Registros em T_APA */
	INSERT	T_APA (DH_APA, CD_PAR)
	Select 	GETDATE(), INS.CD_PAR
	From 	T_PAR PAR, INSERTED INS
	Where 	PAR.CD_PAR = INS.CD_PAR AND
		INS.NR_HPA_SEQ = (SELECT MAX(NR_HPA_SEQ) FROM T_HPA001 WHERE CD_HPA = INS.CD_HPA) AND
		PAR.TP_PAR_STA = 1 AND
		PAR.CD_AER = (Select CD_AER From T_PSI)
END

End
go</a:Text>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Trigger.Type>U</a:Trigger.Type>
</o:Trigger>
</c:Triggers>
<c:PrimaryKey>
<o:Key Ref="o23"/>
</c:PrimaryKey>
</o:Table>
</c:Object>
</o:TableSymbol>
</c:SourceSymbol>
<c:DestinationSymbol>
<o:TableSymbol Id="o38">
<a:Rect>((-730032,683576), (-723406,688122))</a:Rect>
<a:LineColor>8388736</a:LineColor>
<a:FillColor>16777215</a:FillColor>
<a:ShadowColor>12632256</a:ShadowColor>
<a:FontList>DISPNAME 0 arial,8,N
TableColumns 0 arial,8,N
TablePkColumns 0 arial,8,N
TableKeys 0 arial,8,N
TableIndexs 0 arial,8,N
TableTriggers 0 arial,8,N</a:FontList>
<c:Object>
<o:Table Id="o39">
<a:ObjectID>6958B264-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>T_AEN</a:Name>
<a:Code>T_AEN</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<c:Columns>
<o:Column Id="o40">
<a:ObjectID>6958B239-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>CD_AEN</a:Name>
<a:Code>CD_AEN</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL1    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL1 As
@valor &gt; 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o41">
<a:ObjectID>6958B23B-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>NR_AEN</a:Name>
<a:Code>NR_AEN</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>char(10)</a:DataType>
<a:Length>10</a:Length>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o42">
<a:ObjectID>6958B23D-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>NR_AEN_ASS_DIS</a:Name>
<a:Code>NR_AEN_ASS_DIS</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>int</a:DataType>
</o:Column>
<o:Column Id="o43">
<a:ObjectID>6958B23F-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>QT_AEN_CRG</a:Name>
<a:Code>QT_AEN_CRG</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>float(15)</a:DataType>
<a:Length>15</a:Length>
</o:Column>
<o:Column Id="o44">
<a:ObjectID>6958B241-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>CD_COM</a:Name>
<a:Code>CD_COM</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL1    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL1 As
@valor &gt; 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o45">
<a:ObjectID>6958B243-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>CD_EQP</a:Name>
<a:Code>CD_EQP</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL1    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL1 As
@valor &gt; 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o46">
<a:ObjectID>6958B245-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>NM_AEN_USR</a:Name>
<a:Code>NM_AEN_USR</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>char(30)</a:DataType>
<a:Length>30</a:Length>
</o:Column>
<o:Column Id="o47">
<a:ObjectID>6958B247-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>FL_AEN_ISE</a:Name>
<a:Code>FL_AEN_ISE</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>tinyint</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o48">
<a:ObjectID>6958B249-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>TIMESTAMP</a:Name>
<a:Code>TIMESTAMP</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>timestamp</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
</c:Columns>
<c:Keys>
<o:Key Id="o49">
<a:ObjectID>6958B255-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>Pk_T_AEN</a:Name>
<a:Code>Pk_T_AEN</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:PhysicalOptions>
clustered</a:PhysicalOptions>
<a:ConstraintName>Pk_T_AEN</a:ConstraintName>
<c:Key.Columns>
<o:Column Ref="o40"/>
</c:Key.Columns>
</o:Key>
</c:Keys>
<c:Indexes>
<o:Index Id="o50">
<a:ObjectID>6958B24D-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>I_AENAEN</a:Name>
<a:Code>I_AENAEN</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Unique>1</a:Unique>
<c:IndexColumns>
<o:IndexColumn Id="o51">
<a:ObjectID>6958B24F-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:IndexColumn.Expression>&lt;Index Expression_0&gt;</a:IndexColumn.Expression>
<c:Column>
<o:Column Ref="o41"/>
</c:Column>
</o:IndexColumn>
</c:IndexColumns>
</o:Index>
<o:Index Id="o52">
<a:ObjectID>6958B251-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>I_AENCOM</a:Name>
<a:Code>I_AENCOM</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<c:IndexColumns>
<o:IndexColumn Id="o53">
<a:ObjectID>6958B253-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:IndexColumn.Expression>&lt;Index Expression_0&gt;</a:IndexColumn.Expression>
<c:Column>
<o:Column Ref="o44"/>
</c:Column>
</o:IndexColumn>
</c:IndexColumns>
</o:Index>
</c:Indexes>
<c:Owner>
<o:User Ref="o34"/>
</c:Owner>
<c:Triggers>
<o:Trigger Id="o54">
<a:ObjectID>6958B1C1-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>T_AEN_TRD</a:Name>
<a:Code>T_AEN_TRD</a:Code>
<a:Text>Create Trigger T_AEN_TRD On T_AEN
For Delete As
Begin
IF @@ROWCOUNT = 0 RETURN
SET NOCOUNT ON
/* Aeronave»Chegadas - Mirror: Aeronave da Chegada (Restrict) */
If (Select Count(*) From T_CHG_MIR dep, Deleted pri
 Where dep.CD_AEN_CHG = pri.CD_AEN) &gt; 0
Begin
  RollBack Transaction
  RaisError 20003 &#39;Operação não executada: A informação que se deseja excluir da tabela &lt;Aeronave&gt; está sendo referenciada na tabela &lt;Chegadas - Mirror&gt;&#39;
  Return
End
/* Aeronave»Chegadas: Aeronave da Chegada (Restrict) */
If (Select Count(*) From T_CHG dep, Deleted pri
 Where dep.CD_AEN_CHG = pri.CD_AEN) &gt; 0
Begin
  RollBack Transaction
  RaisError 20003 &#39;Operação não executada: A informação que se deseja excluir da tabela &lt;Aeronave&gt; está sendo referenciada na tabela &lt;Chegadas&gt;&#39;
  Return
End
/* Aeronave»Histórico de Permanência de Aeronaves: Aeronave do HPA (Restrict) */
Declare @DBBDsc varchar(255)
Select @DBBDsc = &#39;(&#39;
Select @DBBDsc = @DBBDsc+RTrim(Convert(varchar(255),(Select NR_CHG_VOO from T_CHG where CD_CHG = dep.CD_CHG)))+&#39;, &#39; From T_HPA001 dep, Deleted pri
 Where dep.CD_AEN = pri.CD_AEN
If DataLength(@DBBDsc) &gt; 1
Begin
  RollBack Transaction
  If DataLength(@DBBDsc) &gt; 252
    Select @DBBDsc = Substring(@DBBDsc,1,252)+&#39;...&#39;
  Else
    Select @DBBDsc = Substring(@DBBDsc,1,DataLength(@DBBDsc)-2)
  Select @DBBDsc = &#39;Operação não executada: A informação que se deseja excluir da tabela &lt;Aeronave&gt; está sendo referenciada na tabela &lt;Histórico de Permanência de Aeronaves&gt; &#39;+@DBBDsc+&#39;)&#39;
  RaisError 20003 @DBBDsc
  Return
End
/* Aeronave»Histórico de Permanência de Aeronaves - Mirror: Aeronave do HPA (Restrict) */
Select @DBBDsc = &#39;(&#39;
Select @DBBDsc = @DBBDsc+RTrim(Convert(varchar(255),(Select NR_CHG_VOO From T_CHG Where CD_CHG = dep.CD_CHG)))+&#39;, &#39; From T_HPA001_MIR dep, Deleted pri
 Where dep.CD_AEN = pri.CD_AEN
If DataLength(@DBBDsc) &gt; 1
Begin
  RollBack Transaction
  If DataLength(@DBBDsc) &gt; 252
    Select @DBBDsc = Substring(@DBBDsc,1,252)+&#39;...&#39;
  Else
    Select @DBBDsc = Substring(@DBBDsc,1,DataLength(@DBBDsc)-2)
  Select @DBBDsc = &#39;Operação não executada: A informação que se deseja excluir da tabela &lt;Aeronave&gt; está sendo referenciada na tabela &lt;Histórico de Permanência de Aeronaves - Mirror&gt; &#39;+@DBBDsc+&#39;)&#39;
  RaisError 20003 @DBBDsc
  Return
End
End
go</a:Text>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Trigger.Type>D</a:Trigger.Type>
</o:Trigger>
<o:Trigger Id="o55">
<a:ObjectID>6958B1C3-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>T_AEN_TRI</a:Name>
<a:Code>T_AEN_TRI</a:Code>
<a:Text>Create Trigger T_AEN_TRI On T_AEN
For Insert As
Begin
IF @@ROWCOUNT = 0 RETURN
SET NOCOUNT ON
/* Companhia Aérea»Aeronave: Companh Aérea possui Aeronaves */
If (Select Count(*) From T_COM, Inserted
Where T_COM.CD_COM = Inserted.CD_COM)
 &lt;&gt;(Select Count(CD_COM) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Companhia Aérea&gt; que se deseja incluir na tabela &lt;Aeronave&gt; não está cadastrada&#39;
  Return
End
/* Equipamento»Aeronave: Equipamento */
If (Select Count(*) From T_EQP, Inserted
Where T_EQP.CD_EQP = Inserted.CD_EQP)
 &lt;&gt;(Select Count(CD_EQP) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Equipamento&gt; que se deseja incluir na tabela &lt;Aeronave&gt; não está cadastrada&#39;
  Return
End
/* Regra de negócio */
/* Nome do usuário que incluiu a aeronave */
Update	T_AEN
Set	NM_AEN_USR = (	select name from master..syslogins where suid in (
			select suid from master..sysprocesses where spid = @@spid))
From	Inserted INS, T_AEN AEN
Where	AEN.CD_AEN = INS.CD_AEN

End
go</a:Text>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Trigger.Type>I</a:Trigger.Type>
</o:Trigger>
<o:Trigger Id="o56">
<a:ObjectID>6958B1C5-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>T_AEN_TRU</a:Name>
<a:Code>T_AEN_TRU</a:Code>
<a:Text>Create Trigger T_AEN_TRU On T_AEN
For Update As
Begin
IF @@ROWCOUNT = 0 RETURN
SET NOCOUNT ON
If Update (CD_AEN)
Begin
  RollBack Transaction
  RaisError 20002 &#39;Operação não executada: A informação &lt;Código da Aeronave&gt; da tabela &lt;Aeronave&gt; não pode ser alterada.&#39;
  Return
End
If Update (CD_COM)
/* Companhia Aérea»Aeronave: Companh Aérea possui Aeronaves */
If (Select Count(*) From T_COM, Inserted
Where T_COM.CD_COM = Inserted.CD_COM)
 &lt;&gt;(Select Count(CD_COM) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Companhia Aérea&gt; que se deseja incluir na tabela &lt;Aeronave&gt; não está cadastrada&#39;
  Return
End
If Update (CD_EQP)
/* Equipamento»Aeronave: Equipamento */
If (Select Count(*) From T_EQP, Inserted
Where T_EQP.CD_EQP = Inserted.CD_EQP)
 &lt;&gt;(Select Count(CD_EQP) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Equipamento&gt; que se deseja incluir na tabela &lt;Aeronave&gt; não está cadastrada&#39;
  Return
End
/* Regra de negócio */
/* Nome do usuário que Alterou a aeronave */
Update	T_AEN
Set	NM_AEN_USR = (	select name from master..syslogins where suid in (
			select suid from master..sysprocesses where spid = @@spid))
From	Inserted INS, T_AEN AEN
Where	AEN.CD_AEN = INS.CD_AEN

IF UPDATE(NR_AEN) OR UPDATE(CD_EQP)
BEGIN
	/* Incluir Registros em T_ACH */
	INSERT	T_ACH (DH_ACH, CD_CHG)
	Select 	GETDATE(), CD_CHG
	From 	T_CHG CHG, INSERTED INS
	Where	CHG.TP_CHG_STA = 1 AND
		CHG.CD_AER = (Select CD_AER From T_PSI) AND
		CHG.CD_AEN_CHG = INS.CD_AEN

	/* Incluir Registros em T_APA */
	INSERT	T_APA (DH_APA, CD_PAR)
	Select 	GETDATE(), CD_PAR
	From 	T_PAR PAR, T_CHG CHG, INSERTED INS
	Where	PAR.TP_PAR_STA = 1 AND
		PAR.CD_AER = (Select CD_AER From T_PSI) AND
		CHG.CD_CHG = PAR.CD_CHG_AEN_ANT AND
		CHG.CD_AEN_CHG = INS.CD_AEN

	/* Incluir Registros em T_AHP */
	INSERT	T_AHP (CD_HPA, DH_AHP)
	Select	DISTINCT CD_HPA, GETDATE()
	From	T_HPA001 HPA, T_CHG CHG, T_SIT SIT, INSERTED INS
	Where	HPA.CD_CHG = CHG.CD_CHG AND
		SIT.CD_SIT = CHG.CD_SIT AND
		HPA.CD_AER = (Select CD_AER From T_PSI) AND
		(HPA.FL_HPA_ENT = 1 OR SIT.FL_SIT_AEN_PAT = 1) AND
		HPA.FL_HPA_SAI = 0 AND
		HPA.CD_AEN = INS.CD_AEN
END

End
go</a:Text>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Trigger.Type>U</a:Trigger.Type>
</o:Trigger>
</c:Triggers>
<c:PrimaryKey>
<o:Key Ref="o49"/>
</c:PrimaryKey>
</o:Table>
</c:Object>
</o:TableSymbol>
</c:DestinationSymbol>
<c:Object>
<o:Reference Id="o57">
<a:ObjectID>6958B298-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>Reference_1</a:Name>
<a:Code>REFERENCE_1</a:Code>
<a:CreationDate>1081543201</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543201</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Cardinality>0..*</a:Cardinality>
<a:UpdateConstraint>1</a:UpdateConstraint>
<a:DeleteConstraint>1</a:DeleteConstraint>
<c:Object1>
<o:Table Ref="o39"/>
</c:Object1>
<c:Object2>
<o:Table Ref="o7"/>
</c:Object2>
<c:ParentKey>
<o:Key Ref="o49"/>
</c:ParentKey>
<c:Joins>
<o:ReferenceJoin Id="o58">
<a:ObjectID>6958B29A-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543201</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543201</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<c:Object1>
<o:Column Ref="o40"/>
</c:Object1>
<c:Object2>
<o:Column Ref="o12"/>
</c:Object2>
</o:ReferenceJoin>
</c:Joins>
</o:Reference>
</c:Object>
</o:ReferenceSymbol>
<o:ReferenceSymbol Id="o59">
<a:Rect>((-717833,708324), (-709005,720224))</a:Rect>
<a:ListOfPoints>((-717833,720224),(-709005,708324))</a:ListOfPoints>
<a:ArrowStyle>4882</a:ArrowStyle>
<a:LineColor>8388736</a:LineColor>
<a:ShadowColor>12632256</a:ShadowColor>
<a:FontList>DISPNAME 0 arial,8,N</a:FontList>
<c:SourceSymbol>
<o:TableSymbol Id="o60">
<a:Rect>((-722667,718129), (-715963,722675))</a:Rect>
<a:LineColor>8388736</a:LineColor>
<a:FillColor>16777215</a:FillColor>
<a:ShadowColor>12632256</a:ShadowColor>
<a:FontList>DISPNAME 0 arial,8,N
TableColumns 0 arial,8,N
TablePkColumns 0 arial,8,N
TableKeys 0 arial,8,N
TableIndexs 0 arial,8,N
TableTriggers 0 arial,8,N</a:FontList>
<c:Object>
<o:Table Id="o61">
<a:ObjectID>6958B287-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>T_BOX</a:Name>
<a:Code>T_BOX</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<c:Columns>
<o:Column Id="o62">
<a:ObjectID>6958B157-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>CD_BOX</a:Name>
<a:Code>CD_BOX</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL1    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL1 As
@valor &gt; 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o63">
<a:ObjectID>6958B159-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>NR_BOX</a:Name>
<a:Code>NR_BOX</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>char(4)</a:DataType>
<a:Length>4</a:Length>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o64">
<a:ObjectID>6958B15B-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>TP_BOX</a:Name>
<a:Code>TP_BOX</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DefaultValue>/****** Object:  Default dbo.DF_VAL_001    Script Date: 7/8/2000 12:14:36 ******/
Create Default        DF_VAL_001 As
1</a:DefaultValue>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL1    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL1 As
@valor &gt; 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>tinyint</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o65">
<a:ObjectID>6958B15D-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>QT_BOX_PES</a:Name>
<a:Code>QT_BOX_PES</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DefaultValue>/****** Object:  Default dbo.DF_VAL_ZRO    Script Date: 7/8/2000 12:14:36 ******/
Create Default        DF_VAL_ZRO As
0</a:DefaultValue>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL0    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL0 As
@valor &gt;= 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o66">
<a:ObjectID>6958B15F-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>FL_BOX_CON</a:Name>
<a:Code>FL_BOX_CON</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DefaultValue>/****** Object:  Default dbo.DF_VAL_ZRO    Script Date: 7/8/2000 12:14:36 ******/
Create Default        DF_VAL_ZRO As
0</a:DefaultValue>
<a:DataType>bit</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o67">
<a:ObjectID>6958B161-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>FL_BOX_PAX</a:Name>
<a:Code>FL_BOX_PAX</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DefaultValue>/****** Object:  Default dbo.DF_VAL_001    Script Date: 7/8/2000 12:14:36 ******/
Create Default        DF_VAL_001 As
1</a:DefaultValue>
<a:DataType>bit</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o68">
<a:ObjectID>6958B162-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>FL_BOX_CRG</a:Name>
<a:Code>FL_BOX_CRG</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DefaultValue>/****** Object:  Default dbo.DF_VAL_001    Script Date: 7/8/2000 12:14:36 ******/
Create Default        DF_VAL_001 As
1</a:DefaultValue>
<a:DataType>bit</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o69">
<a:ObjectID>6958B163-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>FT_BOX_DOM</a:Name>
<a:Code>FT_BOX_DOM</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DefaultValue>/****** Object:  Default dbo.DF_VAL_001    Script Date: 7/8/2000 12:14:36 ******/
Create Default        DF_VAL_001 As
1</a:DefaultValue>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL0    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL0 As
@valor &gt;= 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o70">
<a:ObjectID>6958B165-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>FT_BOX_INT</a:Name>
<a:Code>FT_BOX_INT</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DefaultValue>/****** Object:  Default dbo.DF_VAL_001    Script Date: 7/8/2000 12:14:36 ******/
Create Default        DF_VAL_001 As
1</a:DefaultValue>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL0    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL0 As
@valor &gt;= 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o71">
<a:ObjectID>6958B168-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>FT_BOX_REG</a:Name>
<a:Code>FT_BOX_REG</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DefaultValue>/****** Object:  Default dbo.DF_VAL_001    Script Date: 7/8/2000 12:14:36 ******/
Create Default        DF_VAL_001 As
1</a:DefaultValue>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL0    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL0 As
@valor &gt;= 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o72">
<a:ObjectID>6958B16B-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>FT_BOX_PAX</a:Name>
<a:Code>FT_BOX_PAX</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DefaultValue>/****** Object:  Default dbo.DF_VAL_001    Script Date: 7/8/2000 12:14:36 ******/
Create Default        DF_VAL_001 As
1</a:DefaultValue>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL0    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL0 As
@valor &gt;= 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o73">
<a:ObjectID>6958B16E-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>FT_BOX_CRG</a:Name>
<a:Code>FT_BOX_CRG</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DefaultValue>/****** Object:  Default dbo.DF_VAL_001    Script Date: 7/8/2000 12:14:36 ******/
Create Default        DF_VAL_001 As
1</a:DefaultValue>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL0    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL0 As
@valor &gt;= 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o74">
<a:ObjectID>6958B170-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>FT_BOX_MIS</a:Name>
<a:Code>FT_BOX_MIS</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DefaultValue>/****** Object:  Default dbo.DF_VAL_001    Script Date: 7/8/2000 12:14:36 ******/
Create Default        DF_VAL_001 As
1</a:DefaultValue>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL0    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL0 As
@valor &gt;= 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o75">
<a:ObjectID>6958B172-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>FT_BOX_TSL</a:Name>
<a:Code>FT_BOX_TSL</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DefaultValue>/****** Object:  Default dbo.DF_VAL_001    Script Date: 7/8/2000 12:14:36 ******/
Create Default        DF_VAL_001 As
1</a:DefaultValue>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL0    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL0 As
@valor &gt;= 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o76">
<a:ObjectID>6958B174-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>FT_BOX_RGL</a:Name>
<a:Code>FT_BOX_RGL</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DefaultValue>/****** Object:  Default dbo.DF_VAL_001    Script Date: 7/8/2000 12:14:36 ******/
Create Default        DF_VAL_001 As
1</a:DefaultValue>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL0    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL0 As
@valor &gt;= 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o77">
<a:ObjectID>6958B176-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>FT_BOX_CHT</a:Name>
<a:Code>FT_BOX_CHT</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DefaultValue>/****** Object:  Default dbo.DF_VAL_001    Script Date: 7/8/2000 12:14:36 ******/
Create Default        DF_VAL_001 As
1</a:DefaultValue>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL0    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL0 As
@valor &gt;= 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o78">
<a:ObjectID>6958B177-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>FT_BOX_TEC</a:Name>
<a:Code>FT_BOX_TEC</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DefaultValue>/****** Object:  Default dbo.DF_VAL_001    Script Date: 7/8/2000 12:14:36 ******/
Create Default        DF_VAL_001 As
1</a:DefaultValue>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL0    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL0 As
@valor &gt;= 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o79">
<a:ObjectID>6958B178-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>FT_BOX_AVG</a:Name>
<a:Code>FT_BOX_AVG</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DefaultValue>/****** Object:  Default dbo.DF_VAL_001    Script Date: 7/8/2000 12:14:36 ******/
Create Default        DF_VAL_001 As
1</a:DefaultValue>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL0    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL0 As
@valor &gt;= 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o80">
<a:ObjectID>6958B179-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>FT_BOX_MLT</a:Name>
<a:Code>FT_BOX_MLT</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DefaultValue>/****** Object:  Default dbo.DF_VAL_001    Script Date: 7/8/2000 12:14:36 ******/
Create Default        DF_VAL_001 As
1</a:DefaultValue>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL0    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL0 As
@valor &gt;= 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o81">
<a:ObjectID>6958B17A-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>FT_BOX_NRG</a:Name>
<a:Code>FT_BOX_NRG</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DefaultValue>/****** Object:  Default dbo.DF_VAL_001    Script Date: 7/8/2000 12:14:36 ******/
Create Default        DF_VAL_001 As
1</a:DefaultValue>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL0    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL0 As
@valor &gt;= 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o82">
<a:ObjectID>6958B17B-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>FT_BOX_TXA</a:Name>
<a:Code>FT_BOX_TXA</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DefaultValue>/****** Object:  Default dbo.DF_VAL_001    Script Date: 7/8/2000 12:14:36 ******/
Create Default        DF_VAL_001 As
1</a:DefaultValue>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL0    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL0 As
@valor &gt;= 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o83">
<a:ObjectID>6958B17C-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>CD_AER</a:Name>
<a:Code>CD_AER</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL1    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL1 As
@valor &gt; 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o84">
<a:ObjectID>6958B17D-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>TIMESTAMP</a:Name>
<a:Code>TIMESTAMP</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>timestamp</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
</c:Columns>
<c:Keys>
<o:Key Id="o85">
<a:ObjectID>6958B186-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>Pk_T_BOX</a:Name>
<a:Code>Pk_T_BOX</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:PhysicalOptions>
clustered</a:PhysicalOptions>
<a:ConstraintName>Pk_T_BOX</a:ConstraintName>
<c:Key.Columns>
<o:Column Ref="o62"/>
</c:Key.Columns>
</o:Key>
</c:Keys>
<c:Indexes>
<o:Index Id="o86">
<a:ObjectID>6958B17F-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>I_BOX_AER</a:Name>
<a:Code>I_BOX_AER</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Unique>1</a:Unique>
<c:IndexColumns>
<o:IndexColumn Id="o87">
<a:ObjectID>6958B180-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:IndexColumn.Expression>&lt;Index Expression_0&gt;</a:IndexColumn.Expression>
<c:Column>
<o:Column Ref="o63"/>
</c:Column>
</o:IndexColumn>
<o:IndexColumn Id="o88">
<a:ObjectID>6958B181-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:IndexColumn.Expression>&lt;Index Expression_1&gt;</a:IndexColumn.Expression>
<c:Column>
<o:Column Ref="o83"/>
</c:Column>
</o:IndexColumn>
</c:IndexColumns>
</o:Index>
<o:Index Id="o89">
<a:ObjectID>6958B182-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>I_AER</a:Name>
<a:Code>I_AER</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<c:IndexColumns>
<o:IndexColumn Id="o90">
<a:ObjectID>6958B183-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:IndexColumn.Expression>&lt;Index Expression_0&gt;</a:IndexColumn.Expression>
<c:Column>
<o:Column Ref="o83"/>
</c:Column>
</o:IndexColumn>
</c:IndexColumns>
</o:Index>
<o:Index Id="o91">
<a:ObjectID>6958B184-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>I_BOX_TP</a:Name>
<a:Code>I_BOX_TP</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<c:IndexColumns>
<o:IndexColumn Id="o92">
<a:ObjectID>6958B185-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:IndexColumn.Expression>&lt;Index Expression_0&gt;</a:IndexColumn.Expression>
<c:Column>
<o:Column Ref="o64"/>
</c:Column>
</o:IndexColumn>
</c:IndexColumns>
</o:Index>
</c:Indexes>
<c:Owner>
<o:User Ref="o34"/>
</c:Owner>
<c:Triggers>
<o:Trigger Id="o93">
<a:ObjectID>6958B1EA-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>T_BOX_TRD</a:Name>
<a:Code>T_BOX_TRD</a:Code>
<a:Text>Create Trigger T_BOX_TRD On T_BOX
For Delete As
Begin
IF @@ROWCOUNT = 0 RETURN
SET NOCOUNT ON
/* Box»Chegadas - Mirror: Box da Chegada (Restrict) */
If (Select Count(*) From T_CHG_MIR dep, Deleted pri
 Where dep.CD_BOX = pri.CD_BOX) &gt; 0
Begin
  RollBack Transaction
  RaisError 20003 &#39;Operação não executada: A informação que se deseja excluir da tabela &lt;Box&gt; está sendo referenciada na tabela &lt;Chegadas - Mirror&gt;&#39;
  Return
End
/* Box»Chegadas: Box da Chegada (Restrict) */
If (Select Count(*) From T_CHG dep, Deleted pri
 Where dep.CD_BOX = pri.CD_BOX) &gt; 0
Begin
  RollBack Transaction
  RaisError 20003 &#39;Operação não executada: A informação que se deseja excluir da tabela &lt;Box&gt; está sendo referenciada na tabela &lt;Chegadas&gt;&#39;
  Return
End
/* Box»Hotran - Boxes: Box do Hotran (Restrict) */
If (Select Count(*) From T_HBX001 dep, Deleted pri
 Where dep.CD_BOX = pri.CD_BOX) &gt; 0
Begin
  RollBack Transaction
  RaisError 20003 &#39;Operação não executada: A informação que se deseja excluir da tabela &lt;Box&gt; está sendo referenciada na tabela &lt;Hotran - Boxes&gt;&#39;
  Return
End
/* Box»Histórico de Permanência de Aeronaves - Mirror: Box do HPA (Restrict) */
If (Select Count(*) From T_HPA001_MIR dep, Deleted pri
 Where dep.CD_BOX = pri.CD_BOX) &gt; 0
Begin
  RollBack Transaction
  RaisError 20003 &#39;Operação não executada: A informação que se deseja excluir da tabela &lt;Box&gt; está sendo referenciada na tabela &lt;Histórico de Permanência de Aeronaves - Mirror&gt;&#39;
  Return
End
/* Box»Histórico de Permanência de Aeronaves: Box do HPA (Restrict) */
If (Select Count(*) From T_HPA001 dep, Deleted pri
 Where dep.CD_BOX = pri.CD_BOX) &gt; 0
Begin
  RollBack Transaction
  RaisError 20003 &#39;Operação não executada: A informação que se deseja excluir da tabela &lt;Box&gt; está sendo referenciada na tabela &lt;Histórico de Permanência de Aeronaves&gt;&#39;
  Return
End
/* Box»Boxes da Companhia Aérea: Boxes da Companhia Aérea (Restrict) */
If (Select Count(*) From T_BCO dep, Deleted pri
 Where dep.CD_BOX = pri.CD_BOX) &gt; 0
Begin
  RollBack Transaction
  RaisError 20003 &#39;Operação não executada: A informação que se deseja excluir da tabela &lt;Box&gt; está sendo referenciada na tabela &lt;Boxes da Companhia Aérea&gt;&#39;
  Return
End
/* Box»Boxes do Equipamento: Boxes do Equipamento (Restrict) */
If (Select Count(*) From T_BEQ dep, Deleted pri
 Where dep.CD_BOX = pri.CD_BOX) &gt; 0
Begin
  RollBack Transaction
  RaisError 20003 &#39;Operação não executada: A informação que se deseja excluir da tabela &lt;Box&gt; está sendo referenciada na tabela &lt;Boxes do Equipamento&gt;&#39;
  Return
End
/* Box»Hotran - Frequência: É Box da Frequencia (Restrict) */
If (Select Count(*) From T_HFR dep, Deleted pri
 Where dep.CD_BOX = pri.CD_BOX) &gt; 0
Begin
  RollBack Transaction
  RaisError 20003 &#39;Operação não executada: A informação que se deseja excluir da tabela &lt;Box&gt; está sendo referenciada na tabela &lt;Hotran - Frequência&gt;&#39;
  Return
End
/* Box»Capacidades do Box: Box da Capacidade do Box (Cascade) */
Delete T_BCP From T_BCP dep, Deleted pri
 Where dep.CD_BOX = pri.CD_BOX
/* Box»Hotran - Box x Vôo: Boxes do BOX x VÔO (Cascade) */
Delete T_HBV From T_HBV dep, Deleted pri
 Where dep.CD_BOX = pri.CD_BOX
/* Box»Boxes Indisponíveis: Indisponibilidade de Box (Cascade) */
Delete T_BIN From T_BIN dep, Deleted pri
 Where dep.CD_BOX = pri.CD_BOX
End
go</a:Text>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Trigger.Type>D</a:Trigger.Type>
</o:Trigger>
<o:Trigger Id="o94">
<a:ObjectID>6958B1EB-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>T_BOX_TRI</a:Name>
<a:Code>T_BOX_TRI</a:Code>
<a:Text>Create Trigger T_BOX_TRI On T_BOX
For Insert As
Begin
IF @@ROWCOUNT = 0 RETURN
SET NOCOUNT ON
/* Aeroporto»Box: Aeroporto possui Boxes */
If (Select Count(*) From T_AER, Inserted
Where T_AER.CD_AER = Inserted.CD_AER)
 &lt;&gt;(Select Count(CD_AER) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Aeroporto&gt; que se deseja incluir na tabela &lt;Box&gt; não está cadastrada&#39;
  Return
End
/* Domínio de: Tipo de Box */
/* 1 - Estadia */
/* 2 - Isento */
/* 3 - Pátio */
/* 9 - Controle */
If (Select Count(*) From Inserted
    Where TP_BOX In (1,2,3,9))
 &lt;&gt;(Select Count(*) From Inserted)
Begin
  RollBack Transaction
  RaisError 20004 &#39;Operação não executada: A informação &lt;Tipo de Box&gt; que se deseja incluir na tabela &lt;Box&gt; não é uma opção válida&#39;
  Return
End
/* Regra de negócio */
/* Não pode existir mais de um box do tipo Controle (9) */
IF (	SELECT 	COUNT(*) 
	FROM 	T_BOX BOX,
		INSERTED INS
	WHERE 	BOX.CD_AER = INS.CD_AER AND
		INS.TP_BOX = 9 AND 
		BOX.TP_BOX = 9) &gt; 1
BEGIN
	RAISERROR 20310 &#39;Operação não executada: Só pode existir um único box do tipo &lt;Controle&gt;.&#39;
	ROLLBACK TRANSACTION
	RETURN
END

End
go</a:Text>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Trigger.Type>I</a:Trigger.Type>
</o:Trigger>
<o:Trigger Id="o95">
<a:ObjectID>6958B1ED-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>T_BOX_TRU</a:Name>
<a:Code>T_BOX_TRU</a:Code>
<a:Text>Create Trigger T_BOX_TRU On T_BOX
For Update As
Begin
IF @@ROWCOUNT = 0 RETURN
SET NOCOUNT ON
If Update (CD_BOX)
Begin
  RollBack Transaction
  RaisError 20002 &#39;Operação não executada: A informação &lt;Código do Box&gt; da tabela &lt;Box&gt; não pode ser alterada.&#39;
  Return
End
If Update (CD_AER)
/* Aeroporto»Box: Aeroporto possui Boxes */
If (Select Count(*) From T_AER, Inserted
Where T_AER.CD_AER = Inserted.CD_AER)
 &lt;&gt;(Select Count(CD_AER) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Aeroporto&gt; que se deseja incluir na tabela &lt;Box&gt; não está cadastrada&#39;
  Return
End
If Update (TP_BOX)
/* Domínio de: Tipo de Box */
/* 1 - Estadia */
/* 2 - Isento */
/* 3 - Pátio */
/* 9 - Controle */
If (Select Count(*) From Inserted
    Where TP_BOX In (1,2,3,9))
 &lt;&gt;(Select Count(*) From Inserted)
Begin
  RollBack Transaction
  RaisError 20004 &#39;Operação não executada: A informação &lt;Tipo de Box&gt; que se deseja incluir na tabela &lt;Box&gt; não é uma opção válida&#39;
  Return
End
/* Regra de negócio */
/* Não pode existir mais de um box do tipo Controle (9) */
IF (	SELECT 	COUNT(*) 
	FROM 	T_BOX BOX,
		INSERTED INS
	WHERE 	BOX.CD_AER = INS.CD_AER AND
		INS.TP_BOX = 9 AND 
		BOX.TP_BOX = 9) &gt; 1
BEGIN
	RAISERROR 20310 &#39;Operação não executada: Só pode existir um único box do tipo &lt;Controle&gt;.&#39;
	ROLLBACK TRANSACTION
	RETURN
END

IF UPDATE(NR_BOX)
BEGIN
	/* Incluir Registros em T_ACH */
	INSERT	T_ACH (DH_ACH, CD_CHG)
	Select 	GETDATE(), CHG.CD_CHG
	From 	T_CHG CHG, T_HPA001 HPA, INSERTED INS
	Where 	CHG.TP_CHG_STA = 1 AND
		CHG.CD_AER = (Select CD_AER From T_PSI) AND
		CHG.CD_CHG = HPA.CD_CHG AND
		HPA.NR_HPA_SEQ = 1 AND
		HPA.CD_BOX = INS.CD_BOX

	/* Incluir Registros em T_APA */
	INSERT	T_APA (DH_APA, CD_PAR)
	Select 	GETDATE(), PAR.CD_PAR
	From 	T_PAR PAR, T_HPA001 HPA, INSERTED INS
	Where 	PAR.TP_PAR_STA = 1 AND
		PAR.CD_AER = (Select CD_AER From T_PSI) AND
		PAR.CD_PAR = HPA.CD_PAR AND
		HPA.NR_HPA_SEQ = (SELECT MAX(NR_HPA_SEQ) FROM T_HPA001 WHERE CD_HPA = HPA.CD_HPA) AND
		HPA.CD_BOX = INS.CD_BOX

	/* Incluir Registros em T_AHO */
	INSERT	T_AHO (CD_HOT, DH_AHO)
	Select	DISTINCT CD_HOT, GETDATE()
	From	T_HFR HFR, INSERTED INS
	Where	HFR.CD_BOX = INS.CD_BOX
END

IF UPDATE(NR_BOX) OR UPDATE(TP_BOX)
BEGIN
	/* Incluir Registros em T_AHP */
	INSERT	T_AHP (CD_HPA, DH_AHP)
	Select	DISTINCT CD_HPA, GETDATE()
	From	T_HPA001 HPA, T_CHG CHG, T_SIT SIT, INSERTED INS
	Where	HPA.CD_CHG = CHG.CD_CHG AND
		SIT.CD_SIT = CHG.CD_SIT AND
		HPA.CD_AER = (Select CD_AER From T_PSI) AND
		(HPA.FL_HPA_ENT = 1 OR SIT.FL_SIT_AEN_PAT = 1) AND
		HPA.FL_HPA_SAI = 0 AND 
		HPA.CD_AEN IS NOT NULL AND
		HPA.CD_BOX = INS.CD_BOX
END

End
go</a:Text>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Trigger.Type>U</a:Trigger.Type>
</o:Trigger>
</c:Triggers>
<c:PrimaryKey>
<o:Key Ref="o85"/>
</c:PrimaryKey>
</o:Table>
</c:Object>
</o:TableSymbol>
</c:SourceSymbol>
<c:DestinationSymbol>
<o:TableSymbol Id="o96">
<a:Rect>((-713518,706051), (-706892,710597))</a:Rect>
<a:LineColor>8388736</a:LineColor>
<a:FillColor>16777215</a:FillColor>
<a:ShadowColor>12632256</a:ShadowColor>
<a:FontList>DISPNAME 0 arial,8,N
TableColumns 0 arial,8,N
TablePkColumns 0 arial,8,N
TableKeys 0 arial,8,N
TableIndexs 0 arial,8,N
TableTriggers 0 arial,8,N</a:FontList>
<c:Object>
<o:Table Id="o97">
<a:ObjectID>6958B268-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>T_AER</a:Name>
<a:Code>T_AER</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<c:Columns>
<o:Column Id="o98">
<a:ObjectID>6958B257-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>CD_AER</a:Name>
<a:Code>CD_AER</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL1    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL1 As
@valor &gt; 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o99">
<a:ObjectID>6958B25A-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>NM_AER</a:Name>
<a:Code>NM_AER</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>char(40)</a:DataType>
<a:Length>40</a:Length>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o100">
<a:ObjectID>6958B25C-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>SG_AER_ICA</a:Name>
<a:Code>SG_AER_ICA</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>char(4)</a:DataType>
<a:Length>4</a:Length>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o101">
<a:ObjectID>6958B25E-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>SG_AER_IAT</a:Name>
<a:Code>SG_AER_IAT</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>char(3)</a:DataType>
<a:Length>3</a:Length>
</o:Column>
<o:Column Id="o102">
<a:ObjectID>6958B260-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>NR_AER_TEL_CHG</a:Name>
<a:Code>NR_AER_TEL_CHG</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DefaultValue>/****** Object:  Default dbo.DF_VAL_001    Script Date: 7/8/2000 12:14:36 ******/
Create Default        DF_VAL_001 As
1</a:DefaultValue>
<a:DataType>int</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o103">
<a:ObjectID>6958B262-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>NR_AER_TEL_PAR</a:Name>
<a:Code>NR_AER_TEL_PAR</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DefaultValue>/****** Object:  Default dbo.DF_VAL_001    Script Date: 7/8/2000 12:14:36 ******/
Create Default        DF_VAL_001 As
1</a:DefaultValue>
<a:DataType>int</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o104">
<a:ObjectID>6958B265-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>TP_AER_CTG</a:Name>
<a:Code>TP_AER_CTG</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>tinyint</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o105">
<a:ObjectID>6958B269-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>CD_CID</a:Name>
<a:Code>CD_CID</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL1    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL1 As
@valor &gt; 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o106">
<a:ObjectID>6958B26B-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>TIMESTAMP</a:Name>
<a:Code>TIMESTAMP</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>timestamp</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
</c:Columns>
<c:Keys>
<o:Key Id="o107">
<a:ObjectID>6958B276-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>Pk_T_AER</a:Name>
<a:Code>Pk_T_AER</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:PhysicalOptions>
clustered</a:PhysicalOptions>
<a:ConstraintName>Pk_T_AER</a:ConstraintName>
<c:Key.Columns>
<o:Column Ref="o98"/>
</c:Key.Columns>
</o:Key>
</c:Keys>
<c:Indexes>
<o:Index Id="o108">
<a:ObjectID>6958B271-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>I_AER_ICA</a:Name>
<a:Code>I_AER_ICA</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Unique>1</a:Unique>
<c:IndexColumns>
<o:IndexColumn Id="o109">
<a:ObjectID>6958B273-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:IndexColumn.Expression>&lt;Index Expression_0&gt;</a:IndexColumn.Expression>
<c:Column>
<o:Column Ref="o100"/>
</c:Column>
</o:IndexColumn>
</c:IndexColumns>
</o:Index>
</c:Indexes>
<c:Owner>
<o:User Ref="o34"/>
</c:Owner>
<c:Triggers>
<o:Trigger Id="o110">
<a:ObjectID>6958B1C6-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>T_AER_TRD</a:Name>
<a:Code>T_AER_TRD</a:Code>
<a:Text>Create Trigger T_AER_TRD On T_AER
For Delete As
Begin
IF @@ROWCOUNT = 0 RETURN
SET NOCOUNT ON
/* Aeroporto»Chegadas - Mirror: Aeroporto da Chegada (Restrict) */
If (Select Count(*) From T_CHG_MIR dep, Deleted pri
 Where dep.CD_AER = pri.CD_AER) &gt; 0
Begin
  RollBack Transaction
  RaisError 20003 &#39;Operação não executada: A informação que se deseja excluir da tabela &lt;Aeroporto&gt; está sendo referenciada na tabela &lt;Chegadas - Mirror&gt;&#39;
  Return
End
/* Aeroporto»Chegadas: Aeroporto da Chegada (Restrict) */
If (Select Count(*) From T_CHG dep, Deleted pri
 Where dep.CD_AER = pri.CD_AER) &gt; 0
Begin
  RollBack Transaction
  RaisError 20003 &#39;Operação não executada: A informação que se deseja excluir da tabela &lt;Aeroporto&gt; está sendo referenciada na tabela &lt;Chegadas&gt;&#39;
  Return
End
/* Aeroporto»Escala da Chegada de Vôo - Mirror: Aeroporto da Escala de Partida (Restrict) */
If (Select Count(*) From T_ECC001_MIR dep, Deleted pri
 Where dep.CD_AER = pri.CD_AER) &gt; 0
Begin
  RollBack Transaction
  RaisError 20003 &#39;Operação não executada: A informação que se deseja excluir da tabela &lt;Aeroporto&gt; está sendo referenciada na tabela &lt;Escala da Chegada de Vôo - Mirror&gt;&#39;
  Return
End
/* Aeroporto»Escala da Partida de Vôo - Mirror: Aeroporto da Escala de Partida (Restrict) */
If (Select Count(*) From T_ECP001_MIR dep, Deleted pri
 Where dep.CD_AER = pri.CD_AER) &gt; 0
Begin
  RollBack Transaction
  RaisError 20003 &#39;Operação não executada: A informação que se deseja excluir da tabela &lt;Aeroporto&gt; está sendo referenciada na tabela &lt;Escala da Partida de Vôo - Mirror&gt;&#39;
  Return
End
/* Aeroporto»Partidas - Mirror: Aeroporto da Partida (Restrict) */
If (Select Count(*) From T_PAR_MIR dep, Deleted pri
 Where dep.CD_AER = pri.CD_AER) &gt; 0
Begin
  RollBack Transaction
  RaisError 20003 &#39;Operação não executada: A informação que se deseja excluir da tabela &lt;Aeroporto&gt; está sendo referenciada na tabela &lt;Partidas - Mirror&gt;&#39;
  Return
End
/* Aeroporto»Partidas: Aeroporto da Partida (Restrict) */
If (Select Count(*) From T_PAR dep, Deleted pri
 Where dep.CD_AER = pri.CD_AER) &gt; 0
Begin
  RollBack Transaction
  RaisError 20003 &#39;Operação não executada: A informação que se deseja excluir da tabela &lt;Aeroporto&gt; está sendo referenciada na tabela &lt;Partidas&gt;&#39;
  Return
End
/* Aeroporto»Tela: Aeroporto das Telas (Restrict) */
If (Select Count(*) From T_TEL dep, Deleted pri
 Where dep.CD_AER = pri.CD_AER) &gt; 0
Begin
  RollBack Transaction
  RaisError 20003 &#39;Operação não executada: A informação que se deseja excluir da tabela &lt;Aeroporto&gt; está sendo referenciada na tabela &lt;Tela&gt;&#39;
  Return
End
/* Aeroporto»Hotran - Etapa: Aeroporto Destino (Restrict) */
If (Select Count(*) From T_HET dep, Deleted pri
 Where dep.SG_AER_DES = pri.SG_AER_ICA) &gt; 0
Begin
  RollBack Transaction
  RaisError 20003 &#39;Operação não executada: A informação que se deseja excluir da tabela &lt;Aeroporto&gt; está sendo referenciada na tabela &lt;Hotran - Etapa&gt;&#39;
  Return
End
/* Aeroporto»Histórico de Permanência de Aeronaves - Mirror: Aeroporto do HPA (Restrict) */
If (Select Count(*) From T_HPA001_MIR dep, Deleted pri
 Where dep.CD_AER = pri.CD_AER) &gt; 0
Begin
  RollBack Transaction
  RaisError 20003 &#39;Operação não executada: A informação que se deseja excluir da tabela &lt;Aeroporto&gt; está sendo referenciada na tabela &lt;Histórico de Permanência de Aeronaves - Mirror&gt;&#39;
  Return
End
/* Aeroporto»Histórico de Permanência de Aeronaves: Aeroporto do HPA (Restrict) */
If (Select Count(*) From T_HPA001 dep, Deleted pri
 Where dep.CD_AER = pri.CD_AER) &gt; 0
Begin
  RollBack Transaction
  RaisError 20003 &#39;Operação não executada: A informação que se deseja excluir da tabela &lt;Aeroporto&gt; está sendo referenciada na tabela &lt;Histórico de Permanência de Aeronaves&gt;&#39;
  Return
End
/* Aeroporto»Dados Estatísticos de Partida - Mirror: Aeroporto está em (Restrict) */
If (Select Count(*) From T_DEP_MIR dep, Deleted pri
 Where dep.CD_AER = pri.CD_AER) &gt; 0
Begin
  RollBack Transaction
  RaisError 20003 &#39;Operação não executada: A informação que se deseja excluir da tabela &lt;Aeroporto&gt; está sendo referenciada na tabela &lt;Dados Estatísticos de Partida - Mirror&gt;&#39;
  Return
End
/* Aeroporto»Escala da Chegada de Vôo: Aeroporto integra ECC (Restrict) */
If (Select Count(*) From T_ECC001 dep, Deleted pri
 Where dep.CD_AER = pri.CD_AER) &gt; 0
Begin
  RollBack Transaction
  RaisError 20003 &#39;Operação não executada: A informação que se deseja excluir da tabela &lt;Aeroporto&gt; está sendo referenciada na tabela &lt;Escala da Chegada de Vôo&gt;&#39;
  Return
End
/* Aeroporto»Escala da Partida de Vôo: Aeroporto integra ECP (Restrict) */
If (Select Count(*) From T_ECP001 dep, Deleted pri
 Where dep.CD_AER = pri.CD_AER) &gt; 0
Begin
  RollBack Transaction
  RaisError 20003 &#39;Operação não executada: A informação que se deseja excluir da tabela &lt;Aeroporto&gt; está sendo referenciada na tabela &lt;Escala da Partida de Vôo&gt;&#39;
  Return
End
/* Aeroporto»Parâmetros do Sistema: Aeroporto Integra Par. Sistema (Restrict) */
If (Select Count(*) From T_PSI dep, Deleted pri
 Where dep.CD_AER = pri.CD_AER) &gt; 0
Begin
  RollBack Transaction
  RaisError 20003 &#39;Operação não executada: A informação que se deseja excluir da tabela &lt;Aeroporto&gt; está sendo referenciada na tabela &lt;Parâmetros do Sistema&gt;&#39;
  Return
End
/* Aeroporto»Hotran - Etapa: Aeroporto Origem (Restrict) */
If (Select Count(*) From T_HET dep, Deleted pri
 Where dep.SG_AER_ORI = pri.SG_AER_ICA) &gt; 0
Begin
  RollBack Transaction
  RaisError 20003 &#39;Operação não executada: A informação que se deseja excluir da tabela &lt;Aeroporto&gt; está sendo referenciada na tabela &lt;Hotran - Etapa&gt;&#39;
  Return
End
/* Aeroporto»Propaganda: Aeroporto Possui Propagandas (Restrict) */
If (Select Count(*) From T_PRG dep, Deleted pri
 Where dep.CD_AER = pri.CD_AER) &gt; 0
Begin
  RollBack Transaction
  RaisError 20003 &#39;Operação não executada: A informação que se deseja excluir da tabela &lt;Aeroporto&gt; está sendo referenciada na tabela &lt;Propaganda&gt;&#39;
  Return
End
/* Aeroporto»Dados Estatísticos de Partida: Está em (Restrict) */
If (Select Count(*) From T_DEP dep, Deleted pri
 Where dep.CD_AER = pri.CD_AER) &gt; 0
Begin
  RollBack Transaction
  RaisError 20003 &#39;Operação não executada: A informação que se deseja excluir da tabela &lt;Aeroporto&gt; está sendo referenciada na tabela &lt;Dados Estatísticos de Partida&gt;&#39;
  Return
End
/* Aeroporto»Horário Comercial: Aer. possui Horário Comercial (Cascade) */
Delete T_HRC From T_HRC dep, Deleted pri
 Where dep.CD_AER = pri.CD_AER
/* Aeroporto»Box: Aeroporto possui Boxes (Cascade) */
Delete T_BOX From T_BOX dep, Deleted pri
 Where dep.CD_AER = pri.CD_AER
/* Aeroporto»Checkin: Aeroporto possui Checkins (Cascade) */
Delete T_CHK From T_CHK dep, Deleted pri
 Where dep.CD_AER = pri.CD_AER
/* Aeroporto»Esteira: Aeroporto possui Esteiras (Cascade) */
Delete T_EST From T_EST dep, Deleted pri
 Where dep.CD_AER = pri.CD_AER
/* Aeroporto»Pistas de Decolagem: Aeroporto possui Pista (Cascade) */
Delete T_PIS From T_PIS dep, Deleted pri
 Where dep.CD_AER = pri.CD_AER
/* Aeroporto»Ponte de Embarque: Aeroporto possui Pista de Embarque (Cascade) */
Delete T_PON From T_PON dep, Deleted pri
 Where dep.CD_AER = pri.CD_AER
/* Aeroporto»Portão: Aeroporto possui Portões (Cascade) */
Delete T_POR From T_POR dep, Deleted pri
 Where dep.CD_AER = pri.CD_AER
/* Aeroporto»Sala de Desembarque: Aeroporto possui Sal.Desemb. (Cascade) */
Delete T_SAL From T_SAL dep, Deleted pri
 Where dep.CD_AER = pri.CD_AER
/* Aeroporto»Sala de Embarque: Aeroporto possui SalasEmbarque (Cascade) */
Delete T_EMB From T_EMB dep, Deleted pri
 Where dep.CD_AER = pri.CD_AER
End
go</a:Text>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Trigger.Type>D</a:Trigger.Type>
</o:Trigger>
<o:Trigger Id="o111">
<a:ObjectID>6958B1C7-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>T_AER_TRI</a:Name>
<a:Code>T_AER_TRI</a:Code>
<a:Text>Create Trigger T_AER_TRI On T_AER
For Insert As
Begin
IF @@ROWCOUNT = 0 RETURN
SET NOCOUNT ON
/* Cidade»Aeroporto: Cidade possui Aeroportos */
If (Select Count(*) From T_CID, Inserted
Where T_CID.CD_CID = Inserted.CD_CID)
 &lt;&gt;(Select Count(CD_CID) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Cidade&gt; que se deseja incluir na tabela &lt;Aeroporto&gt; não está cadastrada&#39;
  Return
End
/* Domínio de: Categoria do Aeroporto */
/* 1 - Não se aplica */
/* 2 - 1ª Categoria */
/* 3 - 2ª Categoria */
/* 4 - 3ª Categoria */
/* 5 - 4ª Categoria */
If (Select Count(*) From Inserted
    Where TP_AER_CTG In (1,2,3,4,5))
 &lt;&gt;(Select Count(*) From Inserted)
Begin
  RollBack Transaction
  RaisError 20004 &#39;Operação não executada: A informação &lt;Categoria do Aeroporto&gt; que se deseja incluir na tabela &lt;Aeroporto&gt; não é uma opção válida&#39;
  Return
End
/* Regra de negócio */
/* Verificar se já existe algum Aeroporto com a sigla IATA do Aeroporto que se está incluindo */
IF (	SELECT	COUNT(*)
	FROM	T_AER AER, 
		INSERTED INS
	WHERE	AER.CD_AER &lt;&gt; INS.CD_AER AND
		AER.SG_AER_IAT = INS.SG_AER_IAT AND
		INS.SG_AER_IAT IS NOT NULL) &gt; 0
BEGIN
	RAISERROR 20310 &#39;Operação não executada: Já existe um Aeroporto cadastrado com esta sigla IATA.&#39;
	ROLLBACK TRANSACTION
	RETURN
END

End
go</a:Text>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Trigger.Type>I</a:Trigger.Type>
</o:Trigger>
<o:Trigger Id="o112">
<a:ObjectID>6958B1C9-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>T_AER_TRU</a:Name>
<a:Code>T_AER_TRU</a:Code>
<a:Text>Create Trigger T_AER_TRU On T_AER
For Update As
Begin
IF @@ROWCOUNT = 0 RETURN
SET NOCOUNT ON
If Update (CD_AER)
Begin
  RollBack Transaction
  RaisError 20002 &#39;Operação não executada: A informação &lt;Código do Aeroporto&gt; da tabela &lt;Aeroporto&gt; não pode ser alterada.&#39;
  Return
End
If Update (CD_CID)
/* Cidade»Aeroporto: Cidade possui Aeroportos */
If (Select Count(*) From T_CID, Inserted
Where T_CID.CD_CID = Inserted.CD_CID)
 &lt;&gt;(Select Count(CD_CID) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Cidade&gt; que se deseja incluir na tabela &lt;Aeroporto&gt; não está cadastrada&#39;
  Return
End
If Update (TP_AER_CTG)
/* Domínio de: Categoria do Aeroporto */
/* 1 - Não se aplica */
/* 2 - 1ª Categoria */
/* 3 - 2ª Categoria */
/* 4 - 3ª Categoria */
/* 5 - 4ª Categoria */
If (Select Count(*) From Inserted
    Where TP_AER_CTG In (1,2,3,4,5))
 &lt;&gt;(Select Count(*) From Inserted)
Begin
  RollBack Transaction
  RaisError 20004 &#39;Operação não executada: A informação &lt;Categoria do Aeroporto&gt; que se deseja incluir na tabela &lt;Aeroporto&gt; não é uma opção válida&#39;
  Return
End
/* Regra de negócio */
/* Verificar se já existe algum Aeroporto cadastrado com a sigla IATA do Aeroporto que se está alterando */
IF (	SELECT	COUNT(*)
	FROM	T_AER AER, 
		INSERTED INS
	WHERE	AER.CD_AER &lt;&gt; INS.CD_AER AND
		AER.SG_AER_IAT = INS.SG_AER_IAT AND
		INS.SG_AER_IAT IS NOT NULL) &gt; 0
BEGIN
	RAISERROR 20310 &#39;Operação não executada: Já existe um Aeroporto cadastrado com esta sigla IATA.&#39;
	ROLLBACK TRANSACTION
	RETURN
END

/* Caso a sigla ICAO do aeroporto seja alterada, alterar os campos SG_AER_DES E SG_AER_ORI da tabela T_HET */
IF UPDATE(SG_AER_ICA)
BEGIN
	UPDATE	HET
	SET	SG_AER_DES = INS.SG_AER_ICA
	FROM	T_HET HET, INSERTED INS, DELETED DEL
	WHERE	INS.CD_AER = DEL.CD_AER AND
		HET.SG_AER_DES = DEL.SG_AER_ICA

	UPDATE	HET
	SET	SG_AER_ORI = INS.SG_AER_ICA
	FROM	T_HET HET, INSERTED INS, DELETED DEL
	WHERE	INS.CD_AER = DEL.CD_AER AND
		HET.SG_AER_ORI = DEL.SG_AER_ICA
END

IF UPDATE(SG_AER_ICA) OR UPDATE(SG_AER_IAT)
BEGIN
	/* Incluir registros em T_ACH */
	INSERT	T_ACH (DH_ACH, CD_CHG)
	Select	GETDATE(), ECC.CD_CHG
	From	T_ECC001 ECC, T_AER AER, INSERTED INS
	Where	ECC.CD_CHG IN (	Select 	CD_CHG
				From 	T_CHG CHG
				Where	CHG.TP_CHG_STA = 1 And
					CHG.CD_AER = (Select CD_AER From T_PSI)) AND
		AER.CD_AER = ECC.CD_AER AND
		AER.CD_AER = INS.CD_AER

	/* Incluir registros em T_APA */
	INSERT	T_APA (DH_APA, CD_PAR)
	Select	GETDATE(), ECP.CD_PAR
	From	T_ECP001 ECP, T_AER AER, INSERTED INS
	Where	ECP.CD_PAR IN (	Select 	CD_PAR
				From 	T_PAR PAR
				Where	PAR.TP_PAR_STA = 1 And
					PAR.CD_AER = (Select CD_AER From T_PSI)) AND
		AER.CD_AER = ECP.CD_AER AND
		AER.CD_AER = INS.CD_AER
END

IF UPDATE(SG_AER_IAT)
BEGIN
	/* Incluir registros em T_AHO */
	INSERT	T_AHO (CD_HOT, DH_AHO)
	Select	DISTINCT CD_HOT, GETDATE()
	From	T_HET HET, INSERTED INS
	Where	HET.SG_AER_ORI = INS.SG_AER_ICA OR
		HET.SG_AER_DES = INS.SG_AER_ICA

	-- Alexei alterou em 05/01/00
	-- Não permitir a alteração da sigla IATA para NULO se o aeroporto estiver em alguma etapa de hotran
	IF (	Select	Count(*)
		from	T_Het Het
		,	Inserted Ins
		where	(Het.SG_AER_ORI = Ins.SG_AER_ICA
		or	Het.SG_AER_DES = Ins.SG_AER_ICA)
		and	Ins.SG_AER_IAT is NULL) &gt; 0
	BEGIN
		RAISERROR 20999 &#39;Operação não executada: O aeroporto não pode ter sigla IATA nula pois está sendo utilizado em etapa de hotran.&#39;
		ROLLBACK TRANSACTION
		RETURN
	END
	-- Fim Alteração Alexei em 05/01/00

END
End
go</a:Text>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Trigger.Type>U</a:Trigger.Type>
</o:Trigger>
</c:Triggers>
<c:PrimaryKey>
<o:Key Ref="o107"/>
</c:PrimaryKey>
</o:Table>
</c:Object>
</o:TableSymbol>
</c:DestinationSymbol>
<c:Object>
<o:Reference Id="o113">
<a:ObjectID>6958B29D-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>Reference_2</a:Name>
<a:Code>REFERENCE_2</a:Code>
<a:CreationDate>1081543201</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543201</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Cardinality>0..*</a:Cardinality>
<a:UpdateConstraint>1</a:UpdateConstraint>
<a:DeleteConstraint>1</a:DeleteConstraint>
<c:Object1>
<o:Table Ref="o97"/>
</c:Object1>
<c:Object2>
<o:Table Ref="o61"/>
</c:Object2>
<c:ParentKey>
<o:Key Ref="o107"/>
</c:ParentKey>
<c:Joins>
<o:ReferenceJoin Id="o114">
<a:ObjectID>6958B29F-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543201</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543201</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<c:Object1>
<o:Column Ref="o98"/>
</c:Object1>
<c:Object2>
<o:Column Ref="o83"/>
</c:Object2>
</o:ReferenceJoin>
</c:Joins>
</o:Reference>
</c:Object>
</o:ReferenceSymbol>
<o:ReferenceSymbol Id="o115">
<a:CenterTextOffset>(3, 2)</a:CenterTextOffset>
<a:Rect>((-716432,696566), (-708708,707700))</a:Rect>
<a:ListOfPoints>((-716278,696566),(-708794,707700))</a:ListOfPoints>
<a:ArrowStyle>4881</a:ArrowStyle>
<a:LineColor>8388736</a:LineColor>
<a:ShadowColor>12632256</a:ShadowColor>
<a:FontList>DISPNAME 0 arial,8,N</a:FontList>
<c:SourceSymbol>
<o:TableSymbol Ref="o6"/>
</c:SourceSymbol>
<c:DestinationSymbol>
<o:TableSymbol Ref="o96"/>
</c:DestinationSymbol>
<c:Object>
<o:Reference Id="o116">
<a:ObjectID>6958B138-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>Reference_4</a:Name>
<a:Code>REFERENCE_4</a:Code>
<a:CreationDate>1081543201</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543201</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Cardinality>0..*</a:Cardinality>
<a:UpdateConstraint>1</a:UpdateConstraint>
<a:DeleteConstraint>1</a:DeleteConstraint>
<c:Object1>
<o:Table Ref="o97"/>
</c:Object1>
<c:Object2>
<o:Table Ref="o7"/>
</c:Object2>
<c:ParentKey>
<o:Key Ref="o107"/>
</c:ParentKey>
<c:Joins>
<o:ReferenceJoin Id="o117">
<a:ObjectID>6958B13A-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543201</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543201</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<c:Object1>
<o:Column Ref="o98"/>
</c:Object1>
<c:Object2>
<o:Column Ref="o10"/>
</c:Object2>
</o:ReferenceJoin>
</c:Joins>
</o:Reference>
</c:Object>
</o:ReferenceSymbol>
<o:ReferenceSymbol Id="o118">
<a:CenterTextOffset>(2, 0)</a:CenterTextOffset>
<a:Rect>((-700681,709072), (-692957,721398))</a:Rect>
<a:ListOfPoints>((-696894,709072),(-696726,721398))</a:ListOfPoints>
<a:ArrowStyle>4882</a:ArrowStyle>
<a:LineColor>8388736</a:LineColor>
<a:ShadowColor>12632256</a:ShadowColor>
<a:FontList>DISPNAME 0 arial,8,N</a:FontList>
<c:SourceSymbol>
<o:TableSymbol Id="o119">
<a:Rect>((-702039,706029), (-695491,710575))</a:Rect>
<a:LineColor>8388736</a:LineColor>
<a:FillColor>16777215</a:FillColor>
<a:ShadowColor>12632256</a:ShadowColor>
<a:FontList>DISPNAME 0 arial,8,N
TableColumns 0 arial,8,N
TablePkColumns 0 arial,8,N
TableKeys 0 arial,8,N
TableIndexs 0 arial,8,N
TableTriggers 0 arial,8,N</a:FontList>
<c:Object>
<o:Table Id="o120">
<a:ObjectID>6958B278-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>T_BCL</a:Name>
<a:Code>T_BCL</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<c:Columns>
<o:Column Id="o121">
<a:ObjectID>6958B279-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>CD_BCP</a:Name>
<a:Code>CD_BCP</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL1    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL1 As
@valor &gt; 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o122">
<a:ObjectID>6958B27D-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>CD_BCP_LIM</a:Name>
<a:Code>CD_BCP_LIM</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL1    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL1 As
@valor &gt; 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o123">
<a:ObjectID>6958B280-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>TIMESTAMP</a:Name>
<a:Code>TIMESTAMP</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>timestamp</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
</c:Columns>
<c:Keys>
<o:Key Id="o124">
<a:ObjectID>6958B288-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>Pk_T_BCL</a:Name>
<a:Code>Pk_T_BCL</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:PhysicalOptions>
clustered</a:PhysicalOptions>
<a:ConstraintName>Pk_T_BCL</a:ConstraintName>
<c:Key.Columns>
<o:Column Ref="o121"/>
<o:Column Ref="o122"/>
</c:Key.Columns>
</o:Key>
</c:Keys>
<c:Owner>
<o:User Ref="o34"/>
</c:Owner>
<c:Triggers>
<o:Trigger Id="o125">
<a:ObjectID>6958B1D3-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>T_BCL_TRD</a:Name>
<a:Code>T_BCL_TRD</a:Code>
<a:Text>Create Trigger T_BCL_TRD On T_BCL
For Delete As
Begin
IF @@ROWCOUNT = 0 RETURN
SET NOCOUNT ON
/* Regra de negócio */
/* Excluir da tabela de Capacidades de Boxes Limitantes o registro concomitante e inverso ao que está sendo excluído */
DELETE 	BCL
FROM	T_BCL BCL, DELETED DEL
WHERE	BCL.CD_BCP = DEL.CD_BCP_LIM AND
	BCL.CD_BCP_LIM = DEL.CD_BCP

End
go</a:Text>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Trigger.Type>D</a:Trigger.Type>
</o:Trigger>
<o:Trigger Id="o126">
<a:ObjectID>6958B1D5-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>T_BCL_TRI</a:Name>
<a:Code>T_BCL_TRI</a:Code>
<a:Text>Create Trigger T_BCL_TRI On T_BCL
For Insert As
Begin
IF @@ROWCOUNT = 0 RETURN
SET NOCOUNT ON
/* Capacidades do Box»Capacidades de Boxes Limitantes: Capacidades de Boxes Limitantes */
If (Select Count(*) From T_BCP, Inserted
Where T_BCP.CD_BCP = Inserted.CD_BCP)
 &lt;&gt;(Select Count(CD_BCP) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Capacidades do Box&gt; que se deseja incluir na tabela &lt;Capacidades de Boxes Limitantes&gt; não está cadastrada&#39;
  Return
End
/* Capacidades do Box»Capacidades de Boxes Limitantes: Capacidades de Boxes Limitantes */
If (Select Count(*) From T_BCP, Inserted
Where T_BCP.CD_BCP = Inserted.CD_BCP_LIM)
 &lt;&gt;(Select Count(CD_BCP_LIM) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Capacidades do Box&gt; que se deseja incluir na tabela &lt;Capacidades de Boxes Limitantes&gt; não está cadastrada&#39;
  Return
End
/* Regra de negócio */
/* Verificar se já existe um limitante do mesmo tipo e de valor menor */
IF (SELECT COUNT(*) FROM T_BCP BCP, T_BCP BCPLIM, T_BCL BCL, T_BCP BCPINS, T_BCP BCPLIMINS, INSERTED INS
		WHERE	BCPINS.CD_BCP = INS.CD_BCP AND
			BCPLIMINS.CD_BCP = INS.CD_BCP_LIM AND
			BCP.CD_BOX = BCPINS.CD_BOX AND
			BCP.TP_BCP = BCPINS.TP_BCP AND
			BCPLIM.CD_BOX = BCPLIMINS.CD_BOX AND
			BCPLIM.TP_BCP = BCPLIMINS.TP_BCP AND
			BCL.CD_BCP = BCP.CD_BCP AND
			BCL.CD_BCP_LIM = BCPLIM.CD_BCP AND
			BCPLIM.VL_BCP &lt; BCPLIMINS.VL_BCP) &gt; 0
BEGIN
	RAISERROR 20999 &#39;Operação não executada: Há limites inferiores ao que se deseja incluir&#39;
	ROLLBACK TRANSACTION
	RETURN
END

/* MESMA VERIFICAÇÃO NO SENTIDO INVERSO */
IF (SELECT COUNT(*) FROM T_BCP BCP, T_BCP BCPLIM, T_BCL BCL, T_BCP BCPINS, T_BCP BCPLIMINS, INSERTED INS
		WHERE	BCPINS.CD_BCP = INS.CD_BCP_LIM AND
			BCPLIMINS.CD_BCP = INS.CD_BCP AND
			BCP.CD_BOX = BCPINS.CD_BOX AND
			BCP.TP_BCP = BCPINS.TP_BCP AND
			BCPLIM.CD_BOX = BCPLIMINS.CD_BOX AND
			BCPLIM.TP_BCP = BCPLIMINS.TP_BCP AND
			BCL.CD_BCP = BCP.CD_BCP AND
			BCL.CD_BCP_LIM = BCPLIM.CD_BCP AND
			BCPLIM.VL_BCP &lt; BCPLIMINS.VL_BCP) &gt; 0
BEGIN
	RAISERROR 20999 &#39;Operação não executada: Há limites inferiores ao que se deseja incluir&#39;
	ROLLBACK TRANSACTION
	RETURN
END

/* Inserir na tabela de Capacidades dos Boxes Limitantes o registro comcomitante e inverso ao que está sendo inserido 
    desde que não exista ainda um valor inferior no inverso  e desde que ainda não exista */
INSERT INTO T_BCL (CD_BCP, CD_BCP_LIM)
SELECT CD_BCP_LIM, CD_BCP FROM INSERTED INS
WHERE NOT EXISTS (SELECT * FROM T_BCP BCP, T_BCP BCPLIM, T_BCL BCL, T_BCP BCPINS, T_BCP BCPLIMINS
		WHERE	BCPINS.CD_BCP = INS.CD_BCP_LIM AND
			BCPLIMINS.CD_BCP = INS.CD_BCP AND
			BCP.CD_BOX = BCPINS.CD_BOX AND
			BCP.TP_BCP = BCPINS.TP_BCP AND
			BCPLIM.CD_BOX = BCPLIMINS.CD_BOX AND
			BCPLIM.TP_BCP = BCPLIMINS.TP_BCP AND
			BCL.CD_BCP = BCP.CD_BCP AND
			BCL.CD_BCP_LIM = BCPLIM.CD_BCP AND
			BCPLIM.VL_BCP &lt; BCPLIMINS.VL_BCP) 
	AND
	NOT EXISTS (SELECT * FROM T_BCL BCL WHERE BCL.CD_BCP = INS.CD_BCP_LIM AND BCL.CD_BCP_LIM = INS.CD_BCP)

End
go</a:Text>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Trigger.Type>I</a:Trigger.Type>
</o:Trigger>
<o:Trigger Id="o127">
<a:ObjectID>6958B1D7-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>T_BCL_TRU</a:Name>
<a:Code>T_BCL_TRU</a:Code>
<a:Text>Create Trigger T_BCL_TRU On T_BCL
For Update As
Begin
IF @@ROWCOUNT = 0 RETURN
SET NOCOUNT ON
If Update (CD_BCP)
Begin
  RollBack Transaction
  RaisError 20002 &#39;Operação não executada: A informação &lt;Código da Capacidade do Box&gt; da tabela &lt;Capacidades de Boxes Limitantes&gt; não pode ser alterada.&#39;
  Return
End
If Update (CD_BCP_LIM)
Begin
  RollBack Transaction
  RaisError 20002 &#39;Operação não executada: A informação &lt;Código da Capacidade do Box&gt; da tabela &lt;Capacidades de Boxes Limitantes&gt; não pode ser alterada.&#39;
  Return
End
End
go</a:Text>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Trigger.Type>U</a:Trigger.Type>
</o:Trigger>
</c:Triggers>
<c:PrimaryKey>
<o:Key Ref="o124"/>
</c:PrimaryKey>
</o:Table>
</c:Object>
</o:TableSymbol>
</c:SourceSymbol>
<c:DestinationSymbol>
<o:TableSymbol Id="o128">
<a:Rect>((-702135,718085), (-695509,722631))</a:Rect>
<a:LineColor>8388736</a:LineColor>
<a:FillColor>16777215</a:FillColor>
<a:ShadowColor>12632256</a:ShadowColor>
<a:FontList>DISPNAME 0 arial,8,N
TableColumns 0 arial,8,N
TablePkColumns 0 arial,8,N
TableKeys 0 arial,8,N
TableIndexs 0 arial,8,N
TableTriggers 0 arial,8,N</a:FontList>
<c:Object>
<o:Table Id="o129">
<a:ObjectID>6958B27F-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>T_BCP</a:Name>
<a:Code>T_BCP</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<c:Columns>
<o:Column Id="o130">
<a:ObjectID>6958B297-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>CD_BCP</a:Name>
<a:Code>CD_BCP</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL1    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL1 As
@valor &gt; 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o131">
<a:ObjectID>6958B299-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>CD_BOX</a:Name>
<a:Code>CD_BOX</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL1    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL1 As
@valor &gt; 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o132">
<a:ObjectID>6958B29C-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>TP_BCP</a:Name>
<a:Code>TP_BCP</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL1    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL1 As
@valor &gt; 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>tinyint</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o133">
<a:ObjectID>6958B29E-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>VL_BCP</a:Name>
<a:Code>VL_BCP</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL0    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL0 As
@valor &gt;= 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>float(15)</a:DataType>
<a:Length>15</a:Length>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o134">
<a:ObjectID>6958B2A0-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>TIMESTAMP</a:Name>
<a:Code>TIMESTAMP</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>timestamp</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
</c:Columns>
<c:Keys>
<o:Key Id="o135">
<a:ObjectID>6958B13E-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>Pk_T_BCP</a:Name>
<a:Code>Pk_T_BCP</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:PhysicalOptions>
clustered</a:PhysicalOptions>
<a:ConstraintName>Pk_T_BCP</a:ConstraintName>
<c:Key.Columns>
<o:Column Ref="o130"/>
</c:Key.Columns>
</o:Key>
</c:Keys>
<c:Indexes>
<o:Index Id="o136">
<a:ObjectID>6958B139-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>I_BCP_BOX</a:Name>
<a:Code>I_BCP_BOX</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Unique>1</a:Unique>
<c:IndexColumns>
<o:IndexColumn Id="o137">
<a:ObjectID>6958B13B-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:IndexColumn.Expression>&lt;Index Expression_0&gt;</a:IndexColumn.Expression>
<c:Column>
<o:Column Ref="o131"/>
</c:Column>
</o:IndexColumn>
<o:IndexColumn Id="o138">
<a:ObjectID>6958B13C-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:IndexColumn.Expression>&lt;Index Expression_1&gt;</a:IndexColumn.Expression>
<c:Column>
<o:Column Ref="o132"/>
</c:Column>
</o:IndexColumn>
<o:IndexColumn Id="o139">
<a:ObjectID>6958B13D-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:IndexColumn.Expression>&lt;Index Expression_2&gt;</a:IndexColumn.Expression>
<c:Column>
<o:Column Ref="o133"/>
</c:Column>
</o:IndexColumn>
</c:IndexColumns>
</o:Index>
</c:Indexes>
<c:Owner>
<o:User Ref="o34"/>
</c:Owner>
<c:Triggers>
<o:Trigger Id="o140">
<a:ObjectID>6958B1DD-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>T_BCP_TRD</a:Name>
<a:Code>T_BCP_TRD</a:Code>
<a:Text>Create Trigger T_BCP_TRD On T_BCP
For Delete As
Begin
IF @@ROWCOUNT = 0 RETURN
SET NOCOUNT ON
/* Capacidades do Box»Capacidades de Boxes Limitantes: Capacidades de Boxes Limitantes (Cascade) */
Delete T_BCL From T_BCL dep, Deleted pri
 Where dep.CD_BCP = pri.CD_BCP
/* Capacidades do Box»Capacidades de Boxes Limitantes: Capacidades de Boxes Limitantes (Cascade) */
Delete T_BCL From T_BCL dep, Deleted pri
 Where dep.CD_BCP_LIM = pri.CD_BCP
End
go</a:Text>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Trigger.Type>D</a:Trigger.Type>
</o:Trigger>
<o:Trigger Id="o141">
<a:ObjectID>6958B1DF-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>T_BCP_TRI</a:Name>
<a:Code>T_BCP_TRI</a:Code>
<a:Text>Create Trigger T_BCP_TRI On T_BCP
For Insert As
Begin
IF @@ROWCOUNT = 0 RETURN
SET NOCOUNT ON
/* Box»Capacidades do Box: Box da Capacidade do Box */
If (Select Count(*) From T_BOX, Inserted
Where T_BOX.CD_BOX = Inserted.CD_BOX)
 &lt;&gt;(Select Count(CD_BOX) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Box&gt; que se deseja incluir na tabela &lt;Capacidades do Box&gt; não está cadastrada&#39;
  Return
End
/* Domínio de: Tipo da Capacidade do Box */
/* 1 - Envergadura */
/* 2 - Comprimento */
If (Select Count(*) From Inserted
    Where TP_BCP In (1,2))
 &lt;&gt;(Select Count(*) From Inserted)
Begin
  RollBack Transaction
  RaisError 20004 &#39;Operação não executada: A informação &lt;Tipo da Capacidade do Box&gt; que se deseja incluir na tabela &lt;Capacidades do Box&gt; não é uma opção válida&#39;
  Return
End
/* Regra de negócio */
DECLARE	@CD_BCP	INT,
		@CD_BCP_LIM	INT

/*----------------------------------------------------------------------------------------------------------------------
/* Processar todos os BCL que tenham o mesmo BOX limitante do BCP incluído, com o mesmo tipo e com valor menor */
SELECT  @CD_BCP = MIN(BCL.CD_BCP)
FROM	INSERTED INS,
	T_BCL BCL,
	T_BCP BCPLIM
WHERE	BCPLIM.CD_BOX = INS.CD_BOX AND
	BCPLIM.TP_BCP = INS.TP_BCP AND
	BCPLIM.VL_BCP &lt; INS.VL_BCP AND
	BCL.CD_BCP_LIM = BCPLIM.CD_BCP 

WHILE ISNULL(@CD_BCP, -1) &lt;&gt; -1
BEGIN

	SELECT  @CD_BCP_LIM = MIN(BCL.CD_BCP_LIM)
	FROM	INSERTED INS,
		T_BCL BCL,
		T_BCP BCPLIM
	WHERE	BCPLIM.CD_BOX = INS.CD_BOX AND
		BCPLIM.TP_BCP = INS.TP_BCP AND
		BCPLIM.VL_BCP &lt; INS.VL_BCP AND
		BCL.CD_BCP_LIM = BCPLIM.CD_BCP AND
		BCL.CD_BCP = @CD_BCP


	WHILE ISNULL(@CD_BCP_LIM, -1) &lt;&gt; -1
	BEGIN


		EXEC SP_BCL_INS @CD_BCP, @CD_BCP_LIM
		IF @@ERROR &lt;&gt; 0 
		BEGIN
			ROLLBACK TRANSACTION
			RETURN
		END

		SELECT  @CD_BCP_LIM = MIN(BCL.CD_BCP_LIM)
		FROM	INSERTED INS,
			T_BCL BCL,
			T_BCP BCPLIM
		WHERE	BCPLIM.CD_BOX = INS.CD_BOX AND
			BCPLIM.TP_BCP = INS.TP_BCP AND
			BCPLIM.VL_BCP &lt; INS.VL_BCP AND
			BCL.CD_BCP_LIM = BCPLIM.CD_BCP AND
			BCL.CD_BCP = @CD_BCP AND
			BCL.CD_BCP_LIM &gt; @CD_BCP_LIM

	END

	SELECT  @CD_BCP = MIN(BCL.CD_BCP)
	FROM	INSERTED INS,
		T_BCL BCL,
		T_BCP BCPLIM
	WHERE	BCPLIM.CD_BOX = INS.CD_BOX AND
		BCPLIM.TP_BCP = INS.TP_BCP AND
		BCPLIM.VL_BCP &lt; INS.VL_BCP AND
		BCL.CD_BCP_LIM = BCPLIM.CD_BCP AND
		BCL.CD_BCP &gt; @CD_BCP

END
----------------------------------------------------------------------------------------------------------------------*/


End
go</a:Text>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Trigger.Type>I</a:Trigger.Type>
</o:Trigger>
<o:Trigger Id="o142">
<a:ObjectID>6958B1E1-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>T_BCP_TRU</a:Name>
<a:Code>T_BCP_TRU</a:Code>
<a:Text>Create Trigger T_BCP_TRU On T_BCP
For Update As
Begin
IF @@ROWCOUNT = 0 RETURN
SET NOCOUNT ON
If Update (CD_BCP)
Begin
  RollBack Transaction
  RaisError 20002 &#39;Operação não executada: A informação &lt;Código da Capacidade do Box&gt; da tabela &lt;Capacidades do Box&gt; não pode ser alterada.&#39;
  Return
End
If Update (CD_BOX)
/* Box»Capacidades do Box: Box da Capacidade do Box */
If (Select Count(*) From T_BOX, Inserted
Where T_BOX.CD_BOX = Inserted.CD_BOX)
 &lt;&gt;(Select Count(CD_BOX) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Box&gt; que se deseja incluir na tabela &lt;Capacidades do Box&gt; não está cadastrada&#39;
  Return
End
If Update (TP_BCP)
/* Domínio de: Tipo da Capacidade do Box */
/* 1 - Envergadura */
/* 2 - Comprimento */
If (Select Count(*) From Inserted
    Where TP_BCP In (1,2))
 &lt;&gt;(Select Count(*) From Inserted)
Begin
  RollBack Transaction
  RaisError 20004 &#39;Operação não executada: A informação &lt;Tipo da Capacidade do Box&gt; que se deseja incluir na tabela &lt;Capacidades do Box&gt; não é uma opção válida&#39;
  Return
End
/* Regra de negócio */
DECLARE	@CD_BCP	INT,
		@CD_BCP_LIM	INT

/*************************************************
/* Processar todos os BCL que tenham o mesmo BOX limitante do BCP excluído, com o mesmo tipo e com valor maior */
SELECT  @CD_BCP = MIN(BCL.CD_BCP)
FROM	DELETED DEL,
	T_BCL BCL,
	T_BCP BCPLIM
WHERE	BCPLIM.CD_BOX = DEL.CD_BOX AND
	BCPLIM.TP_BCP = DEL.TP_BCP AND
	BCPLIM.VL_BCP &gt; DEL.VL_BCP AND
	BCL.CD_BCP_LIM = BCPLIM.CD_BCP 

WHILE ISNULL(@CD_BCP, -1) &lt;&gt; -1
BEGIN

	SELECT  @CD_BCP_LIM = MIN(BCL.CD_BCP_LIM)
	FROM	DELETED DEL,
		T_BCL BCL,
		T_BCP BCPLIM
	WHERE	BCPLIM.CD_BOX = DEL.CD_BOX AND
		BCPLIM.TP_BCP = DEL.TP_BCP AND
		BCPLIM.VL_BCP &gt; DEL.VL_BCP AND
		BCL.CD_BCP_LIM = BCPLIM.CD_BCP AND
		BCL.CD_BCP = @CD_BCP


	WHILE ISNULL(@CD_BCP_LIM, -1) &lt;&gt; -1
	BEGIN


		EXEC SP_BCL_DEL @CD_BCP, @CD_BCP_LIM
		IF @@ERROR &lt;&gt; 0 
		BEGIN
			ROLLBACK TRANSACTION
			RETURN
		END


		SELECT  @CD_BCP_LIM = MIN(BCL.CD_BCP_LIM)
		FROM	DELETED DEL,
			T_BCL BCL,
			T_BCP BCPLIM
		WHERE	BCPLIM.CD_BOX = DEL.CD_BOX AND
			BCPLIM.TP_BCP = DEL.TP_BCP AND
			BCPLIM.VL_BCP &gt; DEL.VL_BCP AND
			BCL.CD_BCP_LIM = BCPLIM.CD_BCP AND
			BCL.CD_BCP = @CD_BCP AND
			BCL.CD_BCP_LIM &gt; @CD_BCP_LIM

	END

	SELECT  @CD_BCP = MIN(BCL.CD_BCP)
	FROM	DELETED DEL,
		T_BCL BCL,
		T_BCP BCPLIM
	WHERE	BCPLIM.CD_BOX = DEL.CD_BOX AND
		BCPLIM.TP_BCP = DEL.TP_BCP AND
		BCPLIM.VL_BCP &gt; DEL.VL_BCP AND
		BCL.CD_BCP_LIM = BCPLIM.CD_BCP AND
		BCL.CD_BCP &gt; @CD_BCP

END


*****************************************************/
/*----------------------------------------------------------------------------------------------------------------------
/* Processar todos os BCL que tenham o mesmo BOX limitante do BCP incluído, com o mesmo tipo e com valor menor */
SELECT  @CD_BCP = MIN(BCL.CD_BCP)
FROM	INSERTED INS,
	T_BCL BCL,
	T_BCP BCPLIM
WHERE	BCPLIM.CD_BOX = INS.CD_BOX AND
	BCPLIM.TP_BCP = INS.TP_BCP AND
	BCPLIM.VL_BCP &lt; INS.VL_BCP AND
	BCL.CD_BCP_LIM = BCPLIM.CD_BCP 

WHILE ISNULL(@CD_BCP, -1) &lt;&gt; -1
BEGIN

	SELECT  @CD_BCP_LIM = MIN(BCL.CD_BCP_LIM)
	FROM	INSERTED INS,
		T_BCL BCL,
		T_BCP BCPLIM
	WHERE	BCPLIM.CD_BOX = INS.CD_BOX AND
		BCPLIM.TP_BCP = INS.TP_BCP AND
		BCPLIM.VL_BCP &lt; INS.VL_BCP AND
		BCL.CD_BCP_LIM = BCPLIM.CD_BCP AND
		BCL.CD_BCP = @CD_BCP


	WHILE ISNULL(@CD_BCP_LIM, -1) &lt;&gt; -1
	BEGIN


		EXEC SP_BCL_INS @CD_BCP, @CD_BCP_LIM
		IF @@ERROR &lt;&gt; 0 
		BEGIN
			ROLLBACK TRANSACTION
			RETURN
		END

		SELECT  @CD_BCP_LIM = MIN(BCL.CD_BCP_LIM)
		FROM	INSERTED INS,
			T_BCL BCL,
			T_BCP BCPLIM
		WHERE	BCPLIM.CD_BOX = INS.CD_BOX AND
			BCPLIM.TP_BCP = INS.TP_BCP AND
			BCPLIM.VL_BCP &lt; INS.VL_BCP AND
			BCL.CD_BCP_LIM = BCPLIM.CD_BCP AND
			BCL.CD_BCP = @CD_BCP AND
			BCL.CD_BCP_LIM &gt; @CD_BCP_LIM

	END

	SELECT  @CD_BCP = MIN(BCL.CD_BCP)
	FROM	INSERTED INS,
		T_BCL BCL,
		T_BCP BCPLIM
	WHERE	BCPLIM.CD_BOX = INS.CD_BOX AND
		BCPLIM.TP_BCP = INS.TP_BCP AND
		BCPLIM.VL_BCP &lt; INS.VL_BCP AND
		BCL.CD_BCP_LIM = BCPLIM.CD_BCP AND
		BCL.CD_BCP &gt; @CD_BCP

END

----------------------------------------------------------------------------------------------------------------------*/

End
go</a:Text>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Trigger.Type>U</a:Trigger.Type>
</o:Trigger>
</c:Triggers>
<c:PrimaryKey>
<o:Key Ref="o135"/>
</c:PrimaryKey>
</o:Table>
</c:Object>
</o:TableSymbol>
</c:DestinationSymbol>
<c:Object>
<o:Reference Id="o143">
<a:ObjectID>6958B142-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>Reference_7</a:Name>
<a:Code>REFERENCE_7</a:Code>
<a:CreationDate>1081543201</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543201</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Cardinality>0..*</a:Cardinality>
<a:UpdateConstraint>1</a:UpdateConstraint>
<a:DeleteConstraint>1</a:DeleteConstraint>
<c:Object1>
<o:Table Ref="o129"/>
</c:Object1>
<c:Object2>
<o:Table Ref="o120"/>
</c:Object2>
<c:ParentKey>
<o:Key Ref="o135"/>
</c:ParentKey>
<c:Joins>
<o:ReferenceJoin Id="o144">
<a:ObjectID>6958B144-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543201</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543201</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<c:Object1>
<o:Column Ref="o130"/>
</c:Object1>
<c:Object2>
<o:Column Ref="o121"/>
</c:Object2>
</o:ReferenceJoin>
</c:Joins>
</o:Reference>
</c:Object>
</o:ReferenceSymbol>
<o:ReferenceSymbol Id="o145">
<a:CenterTextOffset>(300, 450)</a:CenterTextOffset>
<a:Rect>((-726233,696000), (-718359,708750))</a:Rect>
<a:ListOfPoints>((-720693,696000),(-725343,708750))</a:ListOfPoints>
<a:ArrowStyle>4881</a:ArrowStyle>
<a:LineColor>8388736</a:LineColor>
<a:ShadowColor>12632256</a:ShadowColor>
<a:FontList>DISPNAME 0 arial,8,N</a:FontList>
<c:SourceSymbol>
<o:TableSymbol Ref="o6"/>
</c:SourceSymbol>
<c:DestinationSymbol>
<o:TableSymbol Id="o146">
<a:Rect>((-730034,706809), (-723330,710409))</a:Rect>
<a:LineColor>8388736</a:LineColor>
<a:FillColor>16777215</a:FillColor>
<a:ShadowColor>12632256</a:ShadowColor>
<a:FontList>DISPNAME 0 arial,8,N
TableColumns 0 arial,8,N
TablePkColumns 0 arial,8,N
TableKeys 0 arial,8,N
TableIndexs 0 arial,8,N
TableTriggers 0 arial,8,N</a:FontList>
<c:Object>
<o:Table Id="o147">
<a:ObjectID>6958B283-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>T_BEQ</a:Name>
<a:Code>T_BEQ</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<c:Columns>
<o:Column Id="o148">
<a:ObjectID>6958B140-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>CD_EQP</a:Name>
<a:Code>CD_EQP</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL1    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL1 As
@valor &gt; 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o149">
<a:ObjectID>6958B141-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>CD_BOX</a:Name>
<a:Code>CD_BOX</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL1    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL1 As
@valor &gt; 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o150">
<a:ObjectID>6958B143-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>TIMESTAMP</a:Name>
<a:Code>TIMESTAMP</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>timestamp</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
</c:Columns>
<c:Keys>
<o:Key Id="o151">
<a:ObjectID>6958B148-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>Pk_T_BEQ</a:Name>
<a:Code>Pk_T_BEQ</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:PhysicalOptions>
clustered</a:PhysicalOptions>
<a:ConstraintName>Pk_T_BEQ</a:ConstraintName>
<c:Key.Columns>
<o:Column Ref="o148"/>
<o:Column Ref="o149"/>
</c:Key.Columns>
</o:Key>
</c:Keys>
<c:Owner>
<o:User Ref="o34"/>
</c:Owner>
<c:Triggers>
<o:Trigger Id="o152">
<a:ObjectID>6958B1E3-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>T_BEQ_TRI</a:Name>
<a:Code>T_BEQ_TRI</a:Code>
<a:Text>Create Trigger T_BEQ_TRI On T_BEQ
For Insert As
Begin
IF @@ROWCOUNT = 0 RETURN
SET NOCOUNT ON
/* Equipamento»Boxes do Equipamento: Boxes do Equipamento */
If (Select Count(*) From T_EQP, Inserted
Where T_EQP.CD_EQP = Inserted.CD_EQP)
 &lt;&gt;(Select Count(CD_EQP) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Equipamento&gt; que se deseja incluir na tabela &lt;Boxes do Equipamento&gt; não está cadastrada&#39;
  Return
End
/* Box»Boxes do Equipamento: Boxes do Equipamento */
If (Select Count(*) From T_BOX, Inserted
Where T_BOX.CD_BOX = Inserted.CD_BOX)
 &lt;&gt;(Select Count(CD_BOX) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Box&gt; que se deseja incluir na tabela &lt;Boxes do Equipamento&gt; não está cadastrada&#39;
  Return
End
End
go</a:Text>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Trigger.Type>I</a:Trigger.Type>
</o:Trigger>
<o:Trigger Id="o153">
<a:ObjectID>6958B1E5-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>T_BEQ_TRU</a:Name>
<a:Code>T_BEQ_TRU</a:Code>
<a:Text>Create Trigger T_BEQ_TRU On T_BEQ
For Update As
Begin
IF @@ROWCOUNT = 0 RETURN
SET NOCOUNT ON
If Update (CD_EQP)
Begin
  RollBack Transaction
  RaisError 20002 &#39;Operação não executada: A informação &lt;Código do Equipamento&gt; da tabela &lt;Boxes do Equipamento&gt; não pode ser alterada.&#39;
  Return
End
If Update (CD_BOX)
/* Box»Boxes do Equipamento: Boxes do Equipamento */
If (Select Count(*) From T_BOX, Inserted
Where T_BOX.CD_BOX = Inserted.CD_BOX)
 &lt;&gt;(Select Count(CD_BOX) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Box&gt; que se deseja incluir na tabela &lt;Boxes do Equipamento&gt; não está cadastrada&#39;
  Return
End
End
go</a:Text>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Trigger.Type>U</a:Trigger.Type>
</o:Trigger>
</c:Triggers>
<c:PrimaryKey>
<o:Key Ref="o151"/>
</c:PrimaryKey>
</o:Table>
</c:Object>
</o:TableSymbol>
</c:DestinationSymbol>
<c:Object>
<o:Reference Id="o154">
<a:ObjectID>6958B145-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>Reference_8</a:Name>
<a:Code>REFERENCE_8</a:Code>
<a:CreationDate>1081543201</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543201</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Cardinality>0..*</a:Cardinality>
<a:UpdateConstraint>1</a:UpdateConstraint>
<a:DeleteConstraint>1</a:DeleteConstraint>
<c:Object1>
<o:Table Ref="o147"/>
</c:Object1>
<c:Object2>
<o:Table Ref="o7"/>
</c:Object2>
<c:ParentKey>
<o:Key Ref="o151"/>
</c:ParentKey>
<c:Joins>
<o:ReferenceJoin Id="o155">
<a:ObjectID>6958B146-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543201</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543201</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<c:Object1>
<o:Column Ref="o148"/>
</c:Object1>
<c:Object2>
<o:Column Ref="o11"/>
</c:Object2>
</o:ReferenceJoin>
<o:ReferenceJoin Id="o156">
<a:ObjectID>6958B147-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543201</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543201</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<c:Object1>
<o:Column Ref="o149"/>
</c:Object1>
<c:Object2>
<o:Column Ref="o13"/>
</c:Object2>
</o:ReferenceJoin>
</c:Joins>
</o:Reference>
</c:Object>
</o:ReferenceSymbol>
<o:ReferenceSymbol Id="o157">
<a:CenterTextOffset>(2, 0)</a:CenterTextOffset>
<a:Rect>((-739244,722095), (-719218,723341))</a:Rect>
<a:ListOfPoints>((-739244,722100),(-719218,722095))</a:ListOfPoints>
<a:ArrowStyle>4882</a:ArrowStyle>
<a:LineColor>8388736</a:LineColor>
<a:ShadowColor>12632256</a:ShadowColor>
<a:FontList>DISPNAME 0 arial,8,N</a:FontList>
<c:SourceSymbol>
<o:TableSymbol Id="o158">
<a:Rect>((-742867,719429), (-736163,723029))</a:Rect>
<a:LineColor>8388736</a:LineColor>
<a:FillColor>16777215</a:FillColor>
<a:ShadowColor>12632256</a:ShadowColor>
<a:FontList>DISPNAME 0 arial,8,N
TableColumns 0 arial,8,N
TablePkColumns 0 arial,8,N
TableKeys 0 arial,8,N
TableIndexs 0 arial,8,N
TableTriggers 0 arial,8,N</a:FontList>
<c:Object>
<o:Table Id="o159">
<a:ObjectID>6958B27C-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>T_BCO</a:Name>
<a:Code>T_BCO</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<c:Columns>
<o:Column Id="o160">
<a:ObjectID>6958B289-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>CD_COM</a:Name>
<a:Code>CD_COM</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL1    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL1 As
@valor &gt; 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o161">
<a:ObjectID>6958B28C-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>CD_BOX</a:Name>
<a:Code>CD_BOX</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL1    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL1 As
@valor &gt; 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o162">
<a:ObjectID>6958B28E-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>FT_BCO</a:Name>
<a:Code>FT_BCO</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DefaultValue>/****** Object:  Default dbo.DF_VAL_001    Script Date: 7/8/2000 12:14:36 ******/
Create Default        DF_VAL_001 As
1</a:DefaultValue>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL0    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL0 As
@valor &gt;= 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o163">
<a:ObjectID>6958B290-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>TIMESTAMP</a:Name>
<a:Code>TIMESTAMP</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>timestamp</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
</c:Columns>
<c:Keys>
<o:Key Id="o164">
<a:ObjectID>6958B295-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>Pk_T_BCO</a:Name>
<a:Code>Pk_T_BCO</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:PhysicalOptions>
clustered</a:PhysicalOptions>
<a:ConstraintName>Pk_T_BCO</a:ConstraintName>
<c:Key.Columns>
<o:Column Ref="o160"/>
<o:Column Ref="o161"/>
</c:Key.Columns>
</o:Key>
</c:Keys>
<c:Owner>
<o:User Ref="o34"/>
</c:Owner>
<c:Triggers>
<o:Trigger Id="o165">
<a:ObjectID>6958B1D9-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>T_BCO_TRI</a:Name>
<a:Code>T_BCO_TRI</a:Code>
<a:Text>Create Trigger T_BCO_TRI On T_BCO
For Insert As
Begin
IF @@ROWCOUNT = 0 RETURN
SET NOCOUNT ON
/* Companhia Aérea»Boxes da Companhia Aérea: Boxes da Companhia Aérea */
If (Select Count(*) From T_COM, Inserted
Where T_COM.CD_COM = Inserted.CD_COM)
 &lt;&gt;(Select Count(CD_COM) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Companhia Aérea&gt; que se deseja incluir na tabela &lt;Boxes da Companhia Aérea&gt; não está cadastrada&#39;
  Return
End
/* Box»Boxes da Companhia Aérea: Boxes da Companhia Aérea */
If (Select Count(*) From T_BOX, Inserted
Where T_BOX.CD_BOX = Inserted.CD_BOX)
 &lt;&gt;(Select Count(CD_BOX) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Box&gt; que se deseja incluir na tabela &lt;Boxes da Companhia Aérea&gt; não está cadastrada&#39;
  Return
End
End
go</a:Text>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Trigger.Type>I</a:Trigger.Type>
</o:Trigger>
<o:Trigger Id="o166">
<a:ObjectID>6958B1DB-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>T_BCO_TRU</a:Name>
<a:Code>T_BCO_TRU</a:Code>
<a:Text>Create Trigger T_BCO_TRU On T_BCO
For Update As
Begin
IF @@ROWCOUNT = 0 RETURN
SET NOCOUNT ON
If Update (CD_COM)
Begin
  RollBack Transaction
  RaisError 20002 &#39;Operação não executada: A informação &lt;Código da Companhia Aérea&gt; da tabela &lt;Boxes da Companhia Aérea&gt; não pode ser alterada.&#39;
  Return
End
If Update (CD_BOX)
Begin
  RollBack Transaction
  RaisError 20002 &#39;Operação não executada: A informação &lt;Código do Box&gt; da tabela &lt;Boxes da Companhia Aérea&gt; não pode ser alterada.&#39;
  Return
End
End
go</a:Text>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Trigger.Type>U</a:Trigger.Type>
</o:Trigger>
</c:Triggers>
<c:PrimaryKey>
<o:Key Ref="o164"/>
</c:PrimaryKey>
</o:Table>
</c:Object>
</o:TableSymbol>
</c:SourceSymbol>
<c:DestinationSymbol>
<o:TableSymbol Ref="o60"/>
</c:DestinationSymbol>
<c:Object>
<o:Reference Id="o167">
<a:ObjectID>6958B149-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>Reference_9</a:Name>
<a:Code>REFERENCE_9</a:Code>
<a:CreationDate>1081543201</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543201</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Cardinality>0..*</a:Cardinality>
<a:UpdateConstraint>1</a:UpdateConstraint>
<a:DeleteConstraint>1</a:DeleteConstraint>
<c:Object1>
<o:Table Ref="o61"/>
</c:Object1>
<c:Object2>
<o:Table Ref="o159"/>
</c:Object2>
<c:ParentKey>
<o:Key Ref="o85"/>
</c:ParentKey>
<c:Joins>
<o:ReferenceJoin Id="o168">
<a:ObjectID>6958B14B-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543201</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543201</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<c:Object1>
<o:Column Ref="o62"/>
</c:Object1>
<c:Object2>
<o:Column Ref="o161"/>
</c:Object2>
</o:ReferenceJoin>
</c:Joins>
</o:Reference>
</c:Object>
</o:ReferenceSymbol>
<o:ReferenceSymbol Id="o169">
<a:CenterTextOffset>(3, 0)</a:CenterTextOffset>
<a:Rect>((-719033,721827), (-698493,723096))</a:Rect>
<a:ListOfPoints>((-698493,721875),(-719033,721827))</a:ListOfPoints>
<a:ArrowStyle>4882</a:ArrowStyle>
<a:LineColor>8388736</a:LineColor>
<a:ShadowColor>12632256</a:ShadowColor>
<a:FontList>DISPNAME 0 arial,8,N</a:FontList>
<c:SourceSymbol>
<o:TableSymbol Ref="o128"/>
</c:SourceSymbol>
<c:DestinationSymbol>
<o:TableSymbol Ref="o60"/>
</c:DestinationSymbol>
<c:Object>
<o:Reference Id="o170">
<a:ObjectID>6958B14D-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>Reference_10</a:Name>
<a:Code>REFERENCE_10</a:Code>
<a:CreationDate>1081543201</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543201</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Cardinality>0..*</a:Cardinality>
<a:UpdateConstraint>1</a:UpdateConstraint>
<a:DeleteConstraint>1</a:DeleteConstraint>
<c:Object1>
<o:Table Ref="o61"/>
</c:Object1>
<c:Object2>
<o:Table Ref="o129"/>
</c:Object2>
<c:ParentKey>
<o:Key Ref="o85"/>
</c:ParentKey>
<c:Joins>
<o:ReferenceJoin Id="o171">
<a:ObjectID>6958B14F-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543201</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543201</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<c:Object1>
<o:Column Ref="o62"/>
</c:Object1>
<c:Object2>
<o:Column Ref="o131"/>
</c:Object2>
</o:ReferenceJoin>
</c:Joins>
</o:Reference>
</c:Object>
</o:ReferenceSymbol>
<o:ReferenceSymbol Id="o172">
<a:Rect>((-726958,708610), (-718687,720971))</a:Rect>
<a:ListOfPoints>((-726683,708610),(-718687,720971))</a:ListOfPoints>
<a:ArrowStyle>4882</a:ArrowStyle>
<a:LineColor>8388736</a:LineColor>
<a:ShadowColor>12632256</a:ShadowColor>
<a:FontList>DISPNAME 0 arial,8,N</a:FontList>
<c:SourceSymbol>
<o:TableSymbol Ref="o146"/>
</c:SourceSymbol>
<c:DestinationSymbol>
<o:TableSymbol Ref="o60"/>
</c:DestinationSymbol>
<c:Object>
<o:Reference Id="o173">
<a:ObjectID>6958B151-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>Reference_11</a:Name>
<a:Code>REFERENCE_11</a:Code>
<a:CreationDate>1081543201</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543201</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Cardinality>0..*</a:Cardinality>
<a:UpdateConstraint>1</a:UpdateConstraint>
<a:DeleteConstraint>1</a:DeleteConstraint>
<c:Object1>
<o:Table Ref="o61"/>
</c:Object1>
<c:Object2>
<o:Table Ref="o147"/>
</c:Object2>
<c:ParentKey>
<o:Key Ref="o85"/>
</c:ParentKey>
<c:Joins>
<o:ReferenceJoin Id="o174">
<a:ObjectID>6958B152-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543201</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543201</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<c:Object1>
<o:Column Ref="o62"/>
</c:Object1>
<c:Object2>
<o:Column Ref="o149"/>
</c:Object2>
</o:ReferenceJoin>
</c:Joins>
</o:Reference>
</c:Object>
</o:ReferenceSymbol>
<o:ReferenceSymbol Id="o175">
<a:Rect>((-734511,714098), (-718478,721161))</a:Rect>
<a:ListOfPoints>((-734511,714098),(-718478,721161))</a:ListOfPoints>
<a:ArrowStyle>4882</a:ArrowStyle>
<a:LineColor>8388736</a:LineColor>
<a:ShadowColor>12632256</a:ShadowColor>
<a:FontList>DISPNAME 0 arial,8,N</a:FontList>
<c:SourceSymbol>
<o:TableSymbol Id="o176">
<a:Rect>((-737668,712297), (-731352,715897))</a:Rect>
<a:LineColor>8388736</a:LineColor>
<a:FillColor>16777215</a:FillColor>
<a:ShadowColor>12632256</a:ShadowColor>
<a:FontList>DISPNAME 0 arial,8,N
TableColumns 0 arial,8,N
TablePkColumns 0 arial,8,N
TableKeys 0 arial,8,N
TableIndexs 0 arial,8,N
TableTriggers 0 arial,8,N</a:FontList>
<c:Object>
<o:Table Id="o177">
<a:ObjectID>6958B285-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>T_BIN</a:Name>
<a:Code>T_BIN</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<c:Columns>
<o:Column Id="o178">
<a:ObjectID>6958B14A-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>CD_BOX</a:Name>
<a:Code>CD_BOX</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL1    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL1 As
@valor &gt; 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o179">
<a:ObjectID>6958B14C-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>DH_BIN_INI</a:Name>
<a:Code>DH_BIN_INI</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>smalldatetime</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o180">
<a:ObjectID>6958B14E-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>DH_BIN_FIM</a:Name>
<a:Code>DH_BIN_FIM</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>smalldatetime</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o181">
<a:ObjectID>6958B150-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>DS_BIN</a:Name>
<a:Code>DS_BIN</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>varchar(50)</a:DataType>
<a:Length>50</a:Length>
<a:Mandatory>1</a:Mandatory>
</o:Column>
</c:Columns>
<c:Keys>
<o:Key Id="o182">
<a:ObjectID>6958B155-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>Pk_T_BIN</a:Name>
<a:Code>Pk_T_BIN</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:PhysicalOptions>
clustered</a:PhysicalOptions>
<a:ConstraintName>Pk_T_BIN</a:ConstraintName>
<c:Key.Columns>
<o:Column Ref="o178"/>
<o:Column Ref="o179"/>
</c:Key.Columns>
</o:Key>
</c:Keys>
<c:Owner>
<o:User Ref="o34"/>
</c:Owner>
<c:Triggers>
<o:Trigger Id="o183">
<a:ObjectID>6958B1E7-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>T_BIN_TRI</a:Name>
<a:Code>T_BIN_TRI</a:Code>
<a:Text>Create Trigger T_BIN_TRI On T_BIN
For Insert As
Begin
IF @@ROWCOUNT = 0 RETURN
SET NOCOUNT ON
/* Box»Boxes Indisponíveis: Indisponibilidade de Box */
If (Select Count(*) From T_BOX, Inserted
Where T_BOX.CD_BOX = Inserted.CD_BOX)
 &lt;&gt;(Select Count(CD_BOX) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Box&gt; que se deseja incluir na tabela &lt;Boxes Indisponíveis&gt; não está cadastrada&#39;
  Return
End
/* Regra de negócio */
/* A Data Inicial tem que ser menor que a Data Final */
IF (	SELECT 	COUNT(*) 
	FROM 	INSERTED INS
	WHERE 	DH_BIN_INI &gt; DH_BIN_FIM) &gt; 0
BEGIN
	RAISERROR 20999 &#39;Operação não executada: A Data e Hora de Início tem que ser menor que a Data e Hora de Término.&#39;
	ROLLBACK TRANSACTION
	RETURN
END

/* Não pode haver períodos coincidentes de indisponibilidade para um mesmo box */
IF (	SELECT 	COUNT(*) 
	FROM 	T_BIN BIN,
		INSERTED INS
	WHERE 	BIN.CD_BOX = INS.CD_BOX AND
		(BIN.DH_BIN_INI &gt; INS.DH_BIN_INI AND BIN.DH_BIN_INI &lt; INS.DH_BIN_FIM OR
		 INS.DH_BIN_INI &gt; BIN.DH_BIN_INI AND INS.DH_BIN_INI &lt; BIN.DH_BIN_FIM OR
		 BIN.DH_BIN_INI &lt; INS.DH_BIN_INI AND BIN.DH_BIN_FIM &gt; INS.DH_BIN_FIM OR
		 INS.DH_BIN_INI &lt; BIN.DH_BIN_INI AND INS.DH_BIN_FIM &gt; BIN.DH_BIN_FIM)) &gt; 0
BEGIN
	RAISERROR 20310 &#39;Operação não executada: Não pode haver períodos coincidentes de indisponibilidade para um mesmo box.&#39;
	ROLLBACK TRANSACTION
	RETURN
END

End
go</a:Text>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Trigger.Type>I</a:Trigger.Type>
</o:Trigger>
<o:Trigger Id="o184">
<a:ObjectID>6958B1E9-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>T_BIN_TRU</a:Name>
<a:Code>T_BIN_TRU</a:Code>
<a:Text>Create Trigger T_BIN_TRU On T_BIN
For Update As
Begin
IF @@ROWCOUNT = 0 RETURN
SET NOCOUNT ON
If Update (CD_BOX)
Begin
  RollBack Transaction
  RaisError 20002 &#39;Operação não executada: A informação &lt;Código do Box Indisponível&gt; da tabela &lt;Boxes Indisponíveis&gt; não pode ser alterada.&#39;
  Return
End
If Update (DH_BIN_INI)
Begin
  RollBack Transaction
  RaisError 20002 &#39;Operação não executada: A informação &lt;Data hora de início da indisponibilidade do Box&gt; da tabela &lt;Boxes Indisponíveis&gt; não pode ser alterada.&#39;
  Return
End
/* Regra de negócio */
/* A Data Inicial tem que ser menor que a Data Final */
IF (	SELECT 	COUNT(*) 
	FROM 	INSERTED INS
	WHERE 	DH_BIN_INI &gt; DH_BIN_FIM) &gt; 0
BEGIN
	RAISERROR 20999 &#39;Operação não executada: A Data e Hora de Início tem que ser menor que a Data e Hora de Término.&#39;
	ROLLBACK TRANSACTION
	RETURN
END

/* Não pode haver períodos coincidentes de indisponibilidade para um mesmo box */
IF (	SELECT 	COUNT(*) 
	FROM 	T_BIN BIN,
		INSERTED INS
	WHERE 	BIN.CD_BOX = INS.CD_BOX AND
		(BIN.DH_BIN_INI &gt; INS.DH_BIN_INI AND BIN.DH_BIN_INI &lt; INS.DH_BIN_FIM OR
		 INS.DH_BIN_INI &gt; BIN.DH_BIN_INI AND INS.DH_BIN_INI &lt; BIN.DH_BIN_FIM OR
		 BIN.DH_BIN_INI &lt; INS.DH_BIN_INI AND BIN.DH_BIN_FIM &gt; INS.DH_BIN_FIM OR
		 INS.DH_BIN_INI &lt; BIN.DH_BIN_INI AND INS.DH_BIN_FIM &gt; BIN.DH_BIN_FIM)) &gt; 0
BEGIN
	RAISERROR 20310 &#39;Operação não executada: Não pode haver períodos coincidentes de indisponibilidade para um mesmo box.&#39;
	ROLLBACK TRANSACTION
	RETURN
END

End
go</a:Text>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Trigger.Type>U</a:Trigger.Type>
</o:Trigger>
</c:Triggers>
<c:PrimaryKey>
<o:Key Ref="o182"/>
</c:PrimaryKey>
</o:Table>
</c:Object>
</o:TableSymbol>
</c:SourceSymbol>
<c:DestinationSymbol>
<o:TableSymbol Ref="o60"/>
</c:DestinationSymbol>
<c:Object>
<o:Reference Id="o185">
<a:ObjectID>6958B153-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>Reference_12</a:Name>
<a:Code>REFERENCE_12</a:Code>
<a:CreationDate>1081543201</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543201</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Cardinality>0..*</a:Cardinality>
<a:UpdateConstraint>1</a:UpdateConstraint>
<a:DeleteConstraint>1</a:DeleteConstraint>
<c:Object1>
<o:Table Ref="o61"/>
</c:Object1>
<c:Object2>
<o:Table Ref="o177"/>
</c:Object2>
<c:ParentKey>
<o:Key Ref="o85"/>
</c:ParentKey>
<c:Joins>
<o:ReferenceJoin Id="o186">
<a:ObjectID>6958B154-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543201</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543201</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<c:Object1>
<o:Column Ref="o62"/>
</c:Object1>
<c:Object2>
<o:Column Ref="o178"/>
</c:Object2>
</o:ReferenceJoin>
</c:Joins>
</o:Reference>
</c:Object>
</o:ReferenceSymbol>
<o:ReferenceSymbol Id="o187">
<a:CenterTextOffset>(3, 0)</a:CenterTextOffset>
<a:Rect>((-717202,695177), (-698793,696450))</a:Rect>
<a:ListOfPoints>((-717202,696397),(-698793,696450))</a:ListOfPoints>
<a:ArrowStyle>4881</a:ArrowStyle>
<a:LineColor>8388736</a:LineColor>
<a:ShadowColor>12632256</a:ShadowColor>
<a:FontList>DISPNAME 0 arial,8,N</a:FontList>
<c:SourceSymbol>
<o:TableSymbol Ref="o6"/>
</c:SourceSymbol>
<c:DestinationSymbol>
<o:TableSymbol Id="o188">
<a:Rect>((-702305,693904), (-695601,698450))</a:Rect>
<a:LineColor>8388736</a:LineColor>
<a:FillColor>16777215</a:FillColor>
<a:ShadowColor>12632256</a:ShadowColor>
<a:FontList>DISPNAME 0 arial,8,N
TableColumns 0 arial,8,N
TablePkColumns 0 arial,8,N
TableKeys 0 arial,8,N
TableIndexs 0 arial,8,N
TableTriggers 0 arial,8,N</a:FontList>
<c:Object>
<o:Table Id="o189">
<a:ObjectID>6958B28B-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>T_CHG</a:Name>
<a:Code>T_CHG</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081701161</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<c:Columns>
<o:Column Id="o190">
<a:ObjectID>6958B187-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>CD_CHG</a:Name>
<a:Code>CD_CHG</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL1    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL1 As
@valor &gt; 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o191">
<a:ObjectID>6958B188-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>DT_CHG</a:Name>
<a:Code>DT_CHG</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_DAT    Script Date: 7/8/2000 12:14:35 ******/
Create Rule        RU_DAT As
DATEPART(hh,@data) = 0 AND
DATEPART(mi,@data) = 0 AND
DATEPART(ss,@data) = 0 AND
DATEPART(ms,@data) = 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>smalldatetime</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o192">
<a:ObjectID>6958B189-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>NR_CHG_VOO</a:Name>
<a:Code>NR_CHG_VOO</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>char(10)</a:DataType>
<a:Length>10</a:Length>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o193">
<a:ObjectID>6958B18A-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>NR_CHG_HOT</a:Name>
<a:Code>NR_CHG_HOT</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>char(9)</a:DataType>
<a:Length>9</a:Length>
</o:Column>
<o:Column Id="o194">
<a:ObjectID>6958B18B-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>TP_CHG_GRU</a:Name>
<a:Code>TP_CHG_GRU</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DefaultValue>/****** Object:  Default dbo.DF_VAL_001    Script Date: 7/8/2000 12:14:36 ******/
Create Default        DF_VAL_001 As
1</a:DefaultValue>
<a:DataType>tinyint</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o195">
<a:ObjectID>6958B18C-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>TP_CHG</a:Name>
<a:Code>TP_CHG</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>tinyint</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o196">
<a:ObjectID>6958B18D-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>TP_CHG_NAT</a:Name>
<a:Code>TP_CHG_NAT</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>tinyint</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o197">
<a:ObjectID>6958B18E-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>TP_CHG_CTG</a:Name>
<a:Code>TP_CHG_CTG</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>tinyint</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o198">
<a:ObjectID>6958B18F-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>CD_CHG_VIN</a:Name>
<a:Code>CD_CHG_VIN</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL1    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL1 As
@valor &gt; 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
</o:Column>
<o:Column Id="o199">
<a:ObjectID>6958B190-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>FL_CHG_ANU</a:Name>
<a:Code>FL_CHG_ANU</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>bit</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o200">
<a:ObjectID>6958B191-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>FL_CHG_TEL</a:Name>
<a:Code>FL_CHG_TEL</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>bit</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o201">
<a:ObjectID>6958B192-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>CD_EQP_CHG</a:Name>
<a:Code>CD_EQP_CHG</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL1    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL1 As
@valor &gt; 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
</o:Column>
<o:Column Id="o202">
<a:ObjectID>6958B193-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>CD_AEN_CHG</a:Name>
<a:Code>CD_AEN_CHG</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL1    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL1 As
@valor &gt; 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
</o:Column>
<o:Column Id="o203">
<a:ObjectID>6958B194-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>QT_CHG_PER_MIN</a:Name>
<a:Code>QT_CHG_PER_MIN</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL1    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL1 As
@valor &gt; 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o204">
<a:ObjectID>6958B195-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>DH_CHG_NRM</a:Name>
<a:Code>DH_CHG_NRM</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>smalldatetime</a:DataType>
</o:Column>
<o:Column Id="o205">
<a:ObjectID>6958B196-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>DH_CHG_EFE</a:Name>
<a:Code>DH_CHG_EFE</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>smalldatetime</a:DataType>
</o:Column>
<o:Column Id="o206">
<a:ObjectID>6958B198-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>DH_CHG_EST</a:Name>
<a:Code>DH_CHG_EST</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>smalldatetime</a:DataType>
</o:Column>
<o:Column Id="o207">
<a:ObjectID>6958B199-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>CD_SIT</a:Name>
<a:Code>CD_SIT</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL1    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL1 As
@valor &gt; 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
</o:Column>
<o:Column Id="o208">
<a:ObjectID>6958B19A-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>NM_CHG_COM_SIT</a:Name>
<a:Code>NM_CHG_COM_SIT</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>varchar(30)</a:DataType>
<a:Length>30</a:Length>
</o:Column>
<o:Column Id="o209">
<a:ObjectID>6958B19B-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>DH_CHG_SIT</a:Name>
<a:Code>DH_CHG_SIT</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>smalldatetime</a:DataType>
</o:Column>
<o:Column Id="o210">
<a:ObjectID>6958B19C-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>FL_CHG_CAN</a:Name>
<a:Code>FL_CHG_CAN</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DefaultValue>/****** Object:  Default dbo.DF_VAL_ZRO    Script Date: 7/8/2000 12:14:36 ******/
Create Default        DF_VAL_ZRO As
0</a:DefaultValue>
<a:DataType>bit</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o211">
<a:ObjectID>6958B19D-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>TP_CHG_STA</a:Name>
<a:Code>TP_CHG_STA</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>tinyint</a:DataType>
</o:Column>
<o:Column Id="o212">
<a:ObjectID>6958B19E-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>CD_IFT</a:Name>
<a:Code>CD_IFT</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL1    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL1 As
@valor &gt; 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
</o:Column>
<o:Column Id="o213">
<a:ObjectID>6958B19F-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>CD_USR</a:Name>
<a:Code>CD_USR</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL1    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL1 As
@valor &gt; 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
</o:Column>
<o:Column Id="o214">
<a:ObjectID>6958B1A0-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>FL_CHG_PAR_ORI</a:Name>
<a:Code>FL_CHG_PAR_ORI</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DefaultValue>/****** Object:  Default dbo.DF_VAL_ZRO    Script Date: 7/8/2000 12:14:36 ******/
Create Default        DF_VAL_ZRO As
0</a:DefaultValue>
<a:DataType>bit</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o215">
<a:ObjectID>6958B1A1-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>TIMESTAMP</a:Name>
<a:Code>TIMESTAMP</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>timestamp</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
</c:Columns>
<c:Keys>
<o:Key Id="o216">
<a:ObjectID>6958B1B9-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>Pk_T_CHG</a:Name>
<a:Code>Pk_T_CHG</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:PhysicalOptions>
clustered</a:PhysicalOptions>
<a:ConstraintName>Pk_T_CHG</a:ConstraintName>
<c:Key.Columns>
<o:Column Ref="o190"/>
</c:Key.Columns>
</o:Key>
</c:Keys>
<c:Indexes>
<o:Index Id="o217">
<a:ObjectID>6958B1A2-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>I_CHG_EFE</a:Name>
<a:Code>I_CHG_EFE</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Unique>1</a:Unique>
<c:IndexColumns>
<o:IndexColumn Id="o218">
<a:ObjectID>6958B1A3-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:IndexColumn.Expression>&lt;Index Expression_0&gt;</a:IndexColumn.Expression>
<c:Column>
<o:Column Ref="o211"/>
</c:Column>
</o:IndexColumn>
<o:IndexColumn Id="o219">
<a:ObjectID>6958B1A4-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:IndexColumn.Expression>&lt;Index Expression_1&gt;</a:IndexColumn.Expression>
<c:Column>
<o:Column Ref="o205"/>
</c:Column>
</o:IndexColumn>
<o:IndexColumn Id="o220">
<a:ObjectID>6958B1A5-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:IndexColumn.Expression>&lt;Index Expression_2&gt;</a:IndexColumn.Expression>
<c:Column>
<o:Column Ref="o190"/>
</c:Column>
</o:IndexColumn>
</c:IndexColumns>
</o:Index>
<o:Index Id="o221">
<a:ObjectID>6958B1A6-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>I_CHG_GRU</a:Name>
<a:Code>I_CHG_GRU</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Unique>1</a:Unique>
<c:IndexColumns>
<o:IndexColumn Id="o222">
<a:ObjectID>6958B1A7-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:IndexColumn.Expression>&lt;Index Expression_0&gt;</a:IndexColumn.Expression>
<c:Column>
<o:Column Ref="o211"/>
</c:Column>
</o:IndexColumn>
<o:IndexColumn Id="o223">
<a:ObjectID>6958B1A8-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:IndexColumn.Expression>&lt;Index Expression_1&gt;</a:IndexColumn.Expression>
<c:Column>
<o:Column Ref="o194"/>
</c:Column>
</o:IndexColumn>
<o:IndexColumn Id="o224">
<a:ObjectID>6958B1A9-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:IndexColumn.Expression>&lt;Index Expression_2&gt;</a:IndexColumn.Expression>
<c:Column>
<o:Column Ref="o190"/>
</c:Column>
</o:IndexColumn>
</c:IndexColumns>
</o:Index>
<o:Index Id="o225">
<a:ObjectID>6958B1AC-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>I_CHG_STA</a:Name>
<a:Code>I_CHG_STA</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Unique>1</a:Unique>
<c:IndexColumns>
<o:IndexColumn Id="o226">
<a:ObjectID>6958B1AE-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:IndexColumn.Expression>&lt;Index Expression_0&gt;</a:IndexColumn.Expression>
<c:Column>
<o:Column Ref="o211"/>
</c:Column>
</o:IndexColumn>
<o:IndexColumn Id="o227">
<a:ObjectID>6958B1B0-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:IndexColumn.Expression>&lt;Index Expression_1&gt;</a:IndexColumn.Expression>
<c:Column>
<o:Column Ref="o190"/>
</c:Column>
</o:IndexColumn>
</c:IndexColumns>
</o:Index>
<o:Index Id="o228">
<a:ObjectID>6958B1B1-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>I_CHG_STA_DAT</a:Name>
<a:Code>I_CHG_STA_DAT</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Unique>1</a:Unique>
<c:IndexColumns>
<o:IndexColumn Id="o229">
<a:ObjectID>6958B1B2-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:IndexColumn.Expression>&lt;Index Expression_0&gt;</a:IndexColumn.Expression>
<c:Column>
<o:Column Ref="o211"/>
</c:Column>
</o:IndexColumn>
<o:IndexColumn Id="o230">
<a:ObjectID>6958B1B3-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:IndexColumn.Expression>&lt;Index Expression_1&gt;</a:IndexColumn.Expression>
<c:Column>
<o:Column Ref="o191"/>
</c:Column>
</o:IndexColumn>
<o:IndexColumn Id="o231">
<a:ObjectID>6958B1B4-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:IndexColumn.Expression>&lt;Index Expression_2&gt;</a:IndexColumn.Expression>
<c:Column>
<o:Column Ref="o190"/>
</c:Column>
</o:IndexColumn>
</c:IndexColumns>
</o:Index>
<o:Index Id="o232">
<a:ObjectID>6958B1B5-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>I_CHG_TP</a:Name>
<a:Code>I_CHG_TP</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<c:IndexColumns>
<o:IndexColumn Id="o233">
<a:ObjectID>6958B1B6-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:IndexColumn.Expression>&lt;Index Expression_0&gt;</a:IndexColumn.Expression>
<c:Column>
<o:Column Ref="o195"/>
</c:Column>
</o:IndexColumn>
</c:IndexColumns>
</o:Index>
<o:Index Id="o234">
<a:ObjectID>6958B1B7-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>I_CHG_VIN</a:Name>
<a:Code>I_CHG_VIN</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<c:IndexColumns>
<o:IndexColumn Id="o235">
<a:ObjectID>6958B1B8-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:IndexColumn.Expression>&lt;Index Expression_0&gt;</a:IndexColumn.Expression>
<c:Column>
<o:Column Ref="o198"/>
</c:Column>
</o:IndexColumn>
</c:IndexColumns>
</o:Index>
</c:Indexes>
<c:Owner>
<o:User Ref="o34"/>
</c:Owner>
<c:Triggers>
<o:Trigger Id="o236">
<a:ObjectID>6958B1F6-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>T_CHG_TRD</a:Name>
<a:Code>T_CHG_TRD</a:Code>
<a:Text>Create Trigger T_CHG_TRD On T_CHG
For Delete As
Begin
IF @@ROWCOUNT = 0 RETURN
SET NOCOUNT ON
/* Chegadas»Chegadas: Chegada Vinculada (Restrict) */
If (Select Count(*) From T_CHG dep, Deleted pri
 Where dep.CD_CHG_VIN = pri.CD_CHG) &gt; 0
Begin
  RollBack Transaction
  RaisError 20003 &#39;Operação não executada: A informação que se deseja excluir da tabela &lt;Chegadas&gt; está sendo referenciada na tabela &lt;Chegadas&gt;&#39;
  Return
End
/* Chegadas»Chamadas de Anuncio: Chamada da Chegada (Cascade) */
Delete T_CHA From T_CHA dep, Deleted pri
 Where dep.CD_CHG = pri.CD_CHG
/* Chegadas»Mensagem de Chegada: Chegada da Mensagem (Cascade) */
Delete T_MCH From T_MCH dep, Deleted pri
 Where dep.CD_CHG = pri.CD_CHG
/* Chegadas»Histórico de Situação de Vôo de Chegada: Chegada do HSC (Cascade) */
Delete T_HSC From T_HSC dep, Deleted pri
 Where dep.CD_CHG = pri.CD_CHG
/* Chegadas»Log da Programação de Anúncios: Chegadas do Log de Programação (Cascade) */
Delete T_PRALOG From T_PRALOG dep, Deleted pri
 Where dep.CD_CHG = pri.CD_CHG
/* Chegadas»Dados Estatísticos de Chegada: Dados Estatísticos da Chegada (Cascade) */
Delete T_DEC From T_DEC dep, Deleted pri
 Where dep.CD_CHG = pri.CD_CHG
/* Chegadas»Escala da Chegada de Vôo: Escalas de Chegada (Cascade) */
Delete T_ECC001 From T_ECC001 dep, Deleted pri
 Where dep.CD_CHG = pri.CD_CHG
/* Chegadas»Esteira da Chegada de Vôo: Esteiras de Chegada (Cascade) */
Delete T_ESV001 From T_ESV001 dep, Deleted pri
 Where dep.CD_CHG = pri.CD_CHG
/* Chegadas»Histórico de Permanência de Aeronaves: Histórico de Permanência dos Vôos de Chegada (Cascade) */
Delete T_HPA001 From T_HPA001 dep, Deleted pri
 Where dep.CD_CHG = pri.CD_CHG
/* Chegadas»Chegadas Candidatas a Vôo Antecessor: Vôo de Chegada candidato a antecessor (Cascade) */
Delete T_CHGANT From T_CHGANT dep, Deleted pri
 Where dep.CD_CHG = pri.CD_CHG
/* Chegadas»Partidas: Chegada Antecessora (Set Null) */
Update T_PAR Set CD_CHG_ANT = Null
 From T_PAR dep, Deleted pri
 Where dep.CD_CHG_ANT = pri.CD_CHG
/* Chegadas»Partidas: Chegada da Aeronave Sucessora (Set Null) */
Update T_PAR Set CD_CHG_AEN_ANT = Null
 From T_PAR dep, Deleted pri
 Where dep.CD_CHG_AEN_ANT = pri.CD_CHG
/* Regra de negócio */
/* INCLUIR REGISTROS EM T_ACH */
INSERT	T_ACH (DH_ACH, CD_CHG)
SELECT GETDATE(), CD_CHG FROM DELETED

End
go</a:Text>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Trigger.Type>D</a:Trigger.Type>
</o:Trigger>
<o:Trigger Id="o237">
<a:ObjectID>6958B1F8-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>T_CHG_TRI</a:Name>
<a:Code>T_CHG_TRI</a:Code>
<a:Text>Create Trigger T_CHG_TRI On T_CHG
For Insert As
Begin
IF @@ROWCOUNT = 0 RETURN
SET NOCOUNT ON
/* Aeroporto»Chegadas: Aeroporto da Chegada */
If (Select Count(*) From T_AER, Inserted
Where T_AER.CD_AER = Inserted.CD_AER)
 &lt;&gt;(Select Count(CD_AER) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Aeroporto&gt; que se deseja incluir na tabela &lt;Chegadas&gt; não está cadastrada&#39;
  Return
End
/* Aeronave»Chegadas: Aeronave da Chegada */
If (Select Count(*) From T_AEN, Inserted
Where T_AEN.CD_AEN = Inserted.CD_AEN_CHG)
 &lt;&gt;(Select Count(CD_AEN_CHG) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Aeronave&gt; que se deseja incluir na tabela &lt;Chegadas&gt; não está cadastrada&#39;
  Return
End
/* Companhia Aérea»Chegadas: Comapanhia Aérea da Chegada */
If (Select Count(*) From T_COM, Inserted
Where T_COM.CD_COM = Inserted.CD_COM)
 &lt;&gt;(Select Count(CD_COM) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Companhia Aérea&gt; que se deseja incluir na tabela &lt;Chegadas&gt; não está cadastrada&#39;
  Return
End
/* Equipamento»Chegadas: Equipamento da Chegada */
If (Select Count(*) From T_EQP, Inserted
Where T_EQP.CD_EQP = Inserted.CD_EQP_CHG)
 &lt;&gt;(Select Count(CD_EQP_CHG) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Equipamento&gt; que se deseja incluir na tabela &lt;Chegadas&gt; não está cadastrada&#39;
  Return
End
/* Box»Chegadas: Box da Chegada */
If (Select Count(*) From T_BOX, Inserted
Where T_BOX.CD_BOX = Inserted.CD_BOX)
 &lt;&gt;(Select Count(CD_BOX) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Box&gt; que se deseja incluir na tabela &lt;Chegadas&gt; não está cadastrada&#39;
  Return
End
/* Situação»Chegadas: Situação da Chegada */
If (Select Count(*) From T_SIT, Inserted
Where T_SIT.CD_SIT = Inserted.CD_SIT)
 &lt;&gt;(Select Count(CD_SIT) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Situação&gt; que se deseja incluir na tabela &lt;Chegadas&gt; não está cadastrada&#39;
  Return
End
/* Informante da Situação de Vôo»Chegadas: Informante da Situação de Chegada */
If (Select Count(*) From T_IFT, Inserted
Where T_IFT.CD_IFT = Inserted.CD_IFT)
 &lt;&gt;(Select Count(CD_IFT) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Informante da Situação de Vôo&gt; que se deseja incluir na tabela &lt;Chegadas&gt; não está cadastrada&#39;
  Return
End
/* Chegadas»Chegadas: Chegada Vinculada */
If (Select Count(*) From T_CHG, Inserted
Where T_CHG.CD_CHG = Inserted.CD_CHG_VIN)
 &lt;&gt;(Select Count(CD_CHG_VIN) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Chegadas&gt; que se deseja incluir na tabela &lt;Chegadas&gt; não está cadastrada&#39;
  Return
End
/* Usuários»Chegadas: Usuário logado */
If (Select Count(*) From T_USR, Inserted
Where T_USR.CD_USR = Inserted.CD_USR)
 &lt;&gt;(Select Count(CD_USR) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Usuários&gt; que se deseja incluir na tabela &lt;Chegadas&gt; não está cadastrada&#39;
  Return
End
/* Domínio de: Grupo do Vôo */
/* 1 - Grupo 1 */
/* 2 - Grupo 2 */
If (Select Count(*) From Inserted
    Where TP_CHG_GRU In (1,2))
 &lt;&gt;(Select Count(*) From Inserted)
Begin
  RollBack Transaction
  RaisError 20004 &#39;Operação não executada: A informação &lt;Grupo do Vôo&gt; que se deseja incluir na tabela &lt;Chegadas&gt; não é uma opção válida&#39;
  Return
End
/* Domínio de: Tipo do Vôo de Chegada */
/* 1 - DOM-Doméstico */
/* 2 - INT-Internacional */
/* 3 - REG-Regional */
If (Select Count(*) From Inserted
    Where TP_CHG In (1,2,3))
 &lt;&gt;(Select Count(*) From Inserted)
Begin
  RollBack Transaction
  RaisError 20004 &#39;Operação não executada: A informação &lt;Tipo do Vôo de Chegada&gt; quese deseja incluir na tabela &lt;Chegadas&gt; não é uma opção válida&#39;
  Return
End
/* Domínio de: Natureza do Vôo de Chegada */
/* 1 - PAX-Passageiro */
/* 2 - CRG-Carga */
/* 3 - MIS-Misto */
/* 4 - TSL-Translado */
If (Select Count(*) From Inserted
    Where TP_CHG_NAT In (1,2,3,4))
 &lt;&gt;(Select Count(*) From Inserted)
Begin
  RollBack Transaction
  RaisError 20004 &#39;Operação não executada: A informação &lt;Natureza do Vôo de Chegada&gt; que se deseja incluir na tabela &lt;Chegadas&gt; não é uma opção válida&#39;
  Return
End
/* Domínio de: Categoria do Vôo de Chegada */
/* 1 - RGL-Regular */
/* 2 - CHT-Charter */
/* 3 - CSH-Codeshare */
/* 4 - DPL-Duplicate Leg */
/* 5 - TEC-Pouso Técnico */
/* 6 - TSL-Translado */
/* 7 - AVG-Aviação Geral */
/* 8 - MLT-Militar */
/* 9 - NRG-Não Regular */
/* 10 - TXA-Táxi Aéreo */
If (Select Count(*) From Inserted
    Where TP_CHG_CTG In (1,2,3,4,5,6,7,8,9,10))
 &lt;&gt;(Select Count(*) From Inserted)
Begin
  RollBack Transaction
  RaisError 20004 &#39;Operação não executada: A informação &lt;Categoria do Vôo de Chegada&gt; que se deseja incluir na tabela &lt;Chegadas&gt; não é uma opção válida&#39;
  Return
End
/* Domínio de: Status de Chegada do Vôo */
/* 1 - Em Aberto */
/* 2 - Concluído */
If (Select Count(*) From Inserted
    Where TP_CHG_STA In (1,2))
 &lt;&gt;(Select Count(*) From Inserted
    Where TP_CHG_STA Is Not Null)
Begin
  RollBack Transaction
  RaisError 20004 &#39;Operação não executada: A informação &lt;Status de Chegada do Vôo&gt; que se deseja incluir na tabela &lt;Chegadas&gt; não é uma opção válida&#39;
  Return
End
/* Regra de negócio */
/* RESTRIÇÕES */
/*********************************** RETIRADO PELO RONALDO EM 11/3/98 ***********************************************************
/* A data do vôo sendo incluído não pode ser maior do que a data posterior à da última geração nem anterior a data de hoje */
IF (	SELECT 	COUNT(*) 
	FROM 	INSERTED INS
	WHERE	(DATEDIFF(MI, Dateadd(HH, -Datepart(HH, GETDATE()), Dateadd(mi, -datepart(mi, GETDATE()), GETDATE())), INS.DT_CHG) &lt; 0 OR   /* (DATEDIFF(MI, CONVERT(DATETIME, (CONVERT(VARCHAR, DATEPART(MM, GETDATE())) + &#39;/&#39; + CONVERT(VARCHAR, DATEPART(DD, GETDATE()))  + &#39;/&#39; + CONVERT(VARCHAR, DATEPART(YY, GETDATE())) +  &#39; 00:00&#39;)), INS.DT_CHG) &lt; 0 OR */
		DATEADD(DD, -1, INS.DT_CHG) &gt; (SELECT MAX(DT_CHG) FROM T_CHG WHERE CD_CHG &lt;&gt; INS.CD_CHG) ) AND INS.NR_CHG_HOT IS NOT NULL) &gt; 0
BEGIN
	RAISERROR 20999 &#39;Operação não executada: Não é permitida a geração de vôos de datas anteriores à data de hoje ou posteriores à data da última geração mais um dia.&#39;
	ROLLBACK TRANSACTION
	RETURN
END
**********************************************************************************************************************************************/

/* Um vôo não pode ser incluído CANCELADO */
IF (	SELECT 	COUNT(*)
	FROM	INSERTED INS, 
		T_SIT SIT
	WHERE	SIT.CD_SIT = INS.CD_SIT AND
		FL_SIT_CAN_VOO &lt;&gt; 0) &gt; 0
BEGIN
	RAISERROR 20999 &#39;Operação não executada: Não é permitida a inclusão de vôos com situação de chegada cancelada&#39;
	ROLLBACK TRANSACTION
	RETURN
END

/* Incluir HPA dos registros de Chegada a incluir */
/* Declaração do cursor */
DECLARE INSCHG CURSOR FOR
	SELECT 	CHG.CD_AER,
		CHG.CD_EQP_CHG,
		CHG.CD_AEN_CHG,
		CHG.CD_BOX,
		CHG.CD_CHG,
		CHG.DH_CHG_NRM
	FROM	T_CHG CHG,
		INSERTED INS
	WHERE	CHG.CD_CHG = INS.CD_CHG AND
		CHG.TP_CHG_CTG NOT IN (3, 4)
	ORDER BY CHG.CD_CHG

/* Declaração das variáveis que receberão o cursor */
DECLARE @CD_AER	INT,
	 @CD_EQP_CHG 	INT,
	 @CD_AEN_CHG	INT,
	 @CD_BOX	INT,
	 @CD_CHG	INT,
	 @DH_CHG_NRM	SMALLDATETIME

/* Abertura do cursor */
OPEN INSCHG

/* Ir para o primeiro registro */
FETCH	INSCHG
INTO	@CD_AER,
	 @CD_EQP_CHG,
	 @CD_AEN_CHG,
	 @CD_BOX,
	 @CD_CHG,
	 @DH_CHG_NRM

/* Processar todos os registros de INSCHG*/
WHILE @@FETCH_STATUS = 0
BEGIN

	/* Lançar Histórico de Permanência de Aeronaves */
	INSERT T_HPA001 (
		CD_HPA,
		NR_HPA_SEQ,
		CD_AER,
		CD_EQP,
		CD_AEN,
		CD_BOX,
		CD_CHG,
		DH_HPA_ENT)
	SELECT	ISNULL(MAX(CD_HPA), 0) +1,
		1, 
		@CD_AER,
		@CD_EQP_CHG,
		@CD_AEN_CHG,
		@CD_BOX,
		@CD_CHG,
		@DH_CHG_NRM
	FROM	T_HPA001 HPA

	/* Ir para o próximo registro */
	FETCH NEXT FROM INSCHG
	INTO	@CD_AER,
		@CD_EQP_CHG,
		@CD_AEN_CHG,
		@CD_BOX,
		@CD_CHG,
		@DH_CHG_NRM

END
CLOSE INSCHG
DEALLOCATE INSCHG


/* Milena 14/01/98 - Inserir vôo que está sendo incluído na tabela de Vôos candidatos a vôo Antecessor se 
o vôo não for Codeshare ou Duplicate Leg */
INSERT T_CHGANT (
	CD_CHG)
SELECT	CD_CHG
FROM	INSERTED INS
WHERE	INS.TP_CHG_CTG NOT IN (3,4)

/* PROVOCAR A EXECUÇÃO DA TRIGGER DE UPDATE PARA A COMPLEMENTAÇÃO DAS VERIFICAÇÕES
    E PROCESSAR OUTRAS ATUALIZAÇÕES */
UPDATE	T_CHG
SET	CD_SIT = CHG.CD_SIT,
	DH_CHG_SIT = CHG.DH_CHG_NRM
FROM	T_CHG CHG,
	INSERTED INS

WHERE	CHG.CD_CHG = INS.CD_CHG
End
go</a:Text>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Trigger.Type>I</a:Trigger.Type>
</o:Trigger>
<o:Trigger Id="o238">
<a:ObjectID>6958B1FA-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>T_CHG_TRU</a:Name>
<a:Code>T_CHG_TRU</a:Code>
<a:Text>CREATE Trigger T_CHG_TRU On T_CHG
For Update As
Begin
IF @@ROWCOUNT = 0 RETURN
SET NOCOUNT ON
If Update (CD_CHG)
Begin
  RollBack Transaction
  RaisError 20002 &#39;Operação não executada: A informação &lt;Código do Vôo de Chegada&gt; da tabela &lt;Chegadas&gt; não pode ser alterada.&#39;
  Return
End
If Update (CD_AER)
/* Aeroporto Chegadas: Aeroporto da Chegada */
If (Select Count(*) From T_AER, Inserted
Where T_AER.CD_AER = Inserted.CD_AER)
 &lt;&gt;(Select Count(CD_AER) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Aeroporto&gt; que se deseja incluir na tabela &lt;Chegadas&gt; não está cadastrada&#39;
  Return
End
If Update (CD_AEN_CHG)
/* Aeronave»Chegadas: Aeronave da Chegada */
If (Select Count(*) From T_AEN, Inserted
Where T_AEN.CD_AEN = Inserted.CD_AEN_CHG)
 &lt;&gt;(Select Count(CD_AEN_CHG) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Aeronave&gt; que se deseja incluir na tabela &lt;Chegadas&gt; não está cadastrada&#39;
  Return
End
If Update (CD_COM)
/* Companhia Aérea»Chegadas: Comapanhia Aérea da Chegada */
If (Select Count(*) From T_COM, Inserted
Where T_COM.CD_COM = Inserted.CD_COM)
 &lt;&gt;(Select Count(CD_COM) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Companhia Aérea&gt; que se deseja incluir na tabela &lt;Chegadas&gt; não está cadastrada&#39;
  Return
End
If Update (CD_EQP_CHG)
/* Equipamento»Chegadas: Equipamento da Chegada */
If (Select Count(*) From T_EQP, Inserted
Where T_EQP.CD_EQP = Inserted.CD_EQP_CHG)
 &lt;&gt;(Select Count(CD_EQP_CHG) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Equipamento&gt; que se deseja incluir na tabela &lt;Chegadas&gt; não está cadastrada&#39;
  Return
End
If Update (CD_BOX)
/* Box»Chegadas: Box da Chegada */
If (Select Count(*) From T_BOX, Inserted
Where T_BOX.CD_BOX = Inserted.CD_BOX)
 &lt;&gt;(Select Count(CD_BOX) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Box&gt; que se deseja incluir na tabela &lt;Chegadas&gt; não está cadastrada&#39;
  Return
End
If Update (CD_SIT)
/* Situação»Chegadas: Situação da Chegada */
If (Select Count(*) From T_SIT, Inserted
Where T_SIT.CD_SIT = Inserted.CD_SIT)
 &lt;&gt;(Select Count(CD_SIT) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Situação&gt; que se deseja incluir na tabela &lt;Chegadas&gt; não está cadastrada&#39;
  Return
End
If Update (CD_IFT)
/* Informante da Situação de Vôo»Chegadas: Informante da Situação de Chegada */
If (Select Count(*) From T_IFT, Inserted
Where T_IFT.CD_IFT = Inserted.CD_IFT)
 &lt;&gt;(Select Count(CD_IFT) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Informante da Situação de Vôo&gt; que se deseja incluir na tabela &lt;Chegadas&gt; não está cadastrada&#39;
  Return
End
If Update (CD_CHG_VIN)
/* Chegadas»Chegadas: Chegada Vinculada */
If (Select Count(*) From T_CHG, Inserted
Where T_CHG.CD_CHG = Inserted.CD_CHG_VIN)
 &lt;&gt;(Select Count(CD_CHG_VIN) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Chegadas&gt; que se deseja incluir na tabela &lt;Chegadas&gt; não está cadastrada&#39;
  Return
End
If Update (CD_USR)
/* Usuários»Chegadas: Usuário logado */
If (Select Count(*) From T_USR, Inserted
Where T_USR.CD_USR = Inserted.CD_USR)
 &lt;&gt;(Select Count(CD_USR) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Usuários&gt; que se deseja incluir na tabela &lt;Chegadas&gt; não está cadastrada&#39;
  Return
End
If Update (TP_CHG_GRU)
Or Update (TP_CHG)
Or Update (TP_CHG_NAT)
Or Update (TP_CHG_CTG)
Or Update (TP_CHG_STA)
/* Domínio de: Grupo do Vôo */
/* 1 - Grupo 1 */
/* 2 - Grupo 2 */
If (Select Count(*) From Inserted
    Where TP_CHG_GRU In (1,2))
 &lt;&gt;(Select Count(*) From Inserted)
Begin
  RollBackTransaction
  RaisError 20004 &#39;Operação não executada: A informação &lt;Grupo do Vôo&gt; que se deseja incluir na tabela &lt;Chegadas&gt; não é uma opção válida&#39;
  Return
End
/* Domínio de: Tipo do Vôo de Chegada */
/* 1 - DOM-Doméstico */
/* 2 - INT-Internacional */
/* 3 - REG-Regional */
If (Select Count(*) From Inserted
    Where TP_CHG In (1,2,3))
 &lt;&gt;(Select Count(*) From Inserted)
Begin
  RollBack Transaction
  RaisError 20004 &#39;Operação não executada: A informação &lt;Tipo do Vôo de Chegada&gt; que se deseja incluir na tabela &lt;Chegadas&gt; não é uma opção válida&#39;
  Return
End
/* Domínio de: Natureza do Vôo de Chegada */
/* 1 - PAX-Passageiro */
/* 2 - CRG-Carga */
/* 3 - MIS-Misto */
/* 4 - TSL-Translado */
If (Select Count(*) From Inserted
    Where TP_CHG_NAT In (1,2,3,4))
 &lt;&gt;(Select Count(*) From Inserted)
Begin
  RollBack Transaction
  RaisError 20004 &#39;Operação não executada: A informação &lt;Natureza do Vôo de Chegada&gt; que se deseja incluir na tabela &lt;Chegadas&gt; não é uma opção válida&#39;
  Return
End
/* Domínio de: Categoria do Vôo de Chegada */
/* 1 - RGL-Regular */
/* 2 - CHT-Charter */
/* 3 - CSH-Codeshare */
/* 4 - DPL-Duplicate Leg */
/* 5 - TEC-Pouso Técnico */
/* 6 - TSL-Translado */
/* 7 - AVG-Aviação Geral */
/* 8 - MLT-Militar */
/* 9 - NRG-Não Regular */
/* 10 - TXA-Táxi Aéreo */
If (Select Count(*) From Inserted
    Where TP_CHG_CTG In (1,2,3,4,5,6,7,8,9,10))
 &lt;&gt;(Select Count(*) From Inserted)
Begin
  RollBack Transaction
  RaisError 20004 &#39;Operação não executada: A informação &lt;Categoria do Vôo de Chegada&gt; que se deseja incluir na tabela &lt;Chegadas&gt; não é uma opção válida&#39;
  Return
End
/* Domínio de: Status de Chegada do Vôo */
/* 1 - Em Aberto */
/* 2 - Concluído */
If (Select Count(*) From Inserted
    Where TP_CHG_STA In (1,2))
 &lt;&gt;(Select Count(*) From Inserted
    Where TP_CHG_STA Is Not Null)
Begin
  RollBack Transaction
  RaisError 20004 &#39;Operação não executada: A informação &lt;Status de Chegada do Vôo&gt; que se deseja incluir na tabela &lt;Chegadas&gt; não é uma opção válida&#39;
  Return
End
/* Regra de negócio */
--CSH OU DPL
IF UPDATE(TP_CHG_CTG) OR UPDATE(CD_CHG_VIN)
	--Um vôo do tipo normal ou charter não pode ter vôo vinculado e um vôo do tipo CSH ou DPL tem de ter vôo vinculado
	IF (	SELECT 	COUNT(*) FROM INSERTED
		WHERE	(TP_CHG_CTG NOT IN (3,4) AND CD_CHG_VIN IS NOT NULL) OR (TP_CHG_CTG IN (3,4) AND CD_CHG_VIN IS NULL)) &gt; 0
	BEGIN
		RAISERROR 20999 &#39;Operação não executada: Um vôo do tipo Normal ou Charter não pode ter vôo vinculado, e um vôo do tipo Codeshare ou Duplicate Leg tem de ter vôo vinculado.&#39;
		ROLLBACK TRANSACTION
		RETURN
	END
IF UPDATE(TP_CHG_CTG)
	--Um vôo do tipo CSH ou DPL não pode ter vôo de PAR associado
	IF (	SELECT 	COUNT(*) FROM	INSERTED INS
		WHERE	TP_CHG_CTG IN (3,4) AND 
			EXISTS (SELECT * FROM T_PAR PAR WHERE PAR.CD_CHG_AEN_ANT = INS.CD_CHG)) &gt; 0
	BEGIN
		RAISERROR 20999 &#39;Operação não executada: Um vôo do tipo Codeshare ou Duplicate Leg não pode ter vôo de partida associado.&#39;
		ROLLBACK TRANSACTION
		RETURN
	END
--Não permitir que um vôo de CHG que tenha sido alterado para concluído, sem estar Cancelado e sem ser CSH ou DPL, possua o campo de aeronave nulo
IF (	SELECT 	COUNT(*) FROM 	INSERTED INS, T_SIT SIT
	WHERE	SIT.CD_SIT = INS.CD_SIT AND SIT.FL_SIT_CON_VOO = 1 AND INS.FL_CHG_CAN = 0 AND INS.TP_CHG_CTG NOT IN (3, 4) AND INS.CD_AEN_CHG IS NULL) &gt; 0
BEGIN
	RAISERROR 20999 &#39;Operação não executada: &lt;Hora de Entrada de Estacionamento&gt; ou &lt;Aeronave&gt; não informados.&#39;
	ROLLBACK TRANSACTION
	RETURN
END
IF UPDATE(CD_SIT)
BEGIN
	--Verificar se a situação informada é uma situação de CHG
	IF (SELECT COUNT(*) FROM	INSERTED INS, T_SIT SIT WHERE SIT.CD_SIT = INS.CD_SIT AND SIT.FL_SIT_CHG &lt;&gt; 1) &gt; 0
	BEGIN
		RAISERROR 20999 &#39;Operação não executada: A situação informada não é uma situação de chegada.&#39;
		ROLLBACK TRANSACTION
		RETURN
	END
END
--Atualizar o complemento de chegada
IF UPDATE(CD_SIT) OR UPDATE(DH_CHG_EFE)
BEGIN
	--Hora
	UPDATE	T_CHG SET NM_CHG_COM_SIT = CONVERT(CHAR(5), CHG.DH_CHG_EFE, 8)
	FROM	T_CHG CHG, INSERTED INS, T_SIT SIT
	WHERE	CHG.CD_CHG = INS.CD_CHG AND SIT.CD_SIT = CHG.CD_SIT AND SIT.TP_SIT_COM = 1
	--Nenhum
	UPDATE	T_CHG SET NM_CHG_COM_SIT = NULL
	FROM	T_CHG CHG, INSERTED INS, T_SIT SIT
	WHERE	CHG.CD_CHG = INS.CD_CHG AND SIT.CD_SIT = CHG.CD_SIT AND SIT.TP_SIT_COM = 3
	--Caso a Data e Hora da Situação não já tenha sido alerada
	IF NOT UPDATE(DH_CHG_SIT)
	BEGIN
		--Atualizar hora da alteração da situação do vôo de CHG
		UPDATE	T_CHG SET DH_CHG_SIT = GETDATE()
		FROM	T_CHG CHG, INSERTED INS
		WHERE	CHG.CD_CHG = INS.CD_CHG
	END
END
IF UPDATE(CD_SIT)
BEGIN
	--Um vôo de PAR não pode ser cancelado se existir algum registro em T_DEC para este vôo ou para um dos seus vôos vinculados
	IF (	SELECT	COUNT(*) FROM INSERTED INS, T_SIT SIT
		WHERE	SIT.CD_SIT = INS.CD_SIT AND SIT.FL_SIT_CAN_VOO = 1 AND
			(EXISTS (SELECT CD_CHG FROM T_DEC WHERE CD_CHG = INS.CD_CHG) OR
			EXISTS (SELECT DEC.CD_CHG FROM T_DEC DEC, T_CHG CHG WHERE CHG.CD_CHG_VIN = INS.CD_CHG AND DEC.CD_CHG = CHG.CD_CHG))) &gt; 0
	BEGIN
		RAISERROR 20999 &#39;Operação não executada: O vôo de Chegada não pode ser cancelado pois existe registro de &lt;Dados Estatísticos de Chegada&gt; para este vôo ou para algum de seus vôos vinculados.&#39;
		ROLLBACK TRANSACTION
		RETURN
	END
	--A alteração da situação de vôo de CHG de Etapa Concluída para outra qualquer não pode ser efetuada se o HPA do vôo estiver associado a mais de um Status
	IF (	SELECT 	COUNT(*)
		FROM 	T_STA STA, T_HPA001 HPA, INSERTED INS, DELETED DEL, T_SIT SITDEL, T_SIT SITINS
		WHERE 	STA.CD_STA = HPA.CD_STA AND HPA.CD_CHG = INS.CD_CHG AND
			DEL.CD_CHG = INS.CD_CHG AND SITDEL.CD_SIT = DEL.CD_SIT AND
			SITDEL.FL_SIT_CON_VOO = 1 AND SITINS.CD_SIT = INS.CD_SIT AND
			SITINS.FL_SIT_CON_VOO = 0) &gt; 1
	BEGIN
		RAISERROR 20999 &#39;Operação não executada: A situação do vôo não pode ser alterada de Etapa Concluída para outra qualquer se este vôo estiver associado a mais de um Status de Aeronave.&#39;
		ROLLBACK TRANSACTION
		RETURN
	END
	--Atualizar Flag de CHG Cancelada em vôo
	UPDATE 	T_CHG SET FL_CHG_CAN = SIT.FL_SIT_CAN_VOO
	FROM 	T_CHG CHG, INSERTED INS, T_SIT SIT
	WHERE 	CHG.CD_CHG = INS.CD_CHG AND SIT.CD_SIT = INS.CD_SIT AND (SIT.FL_SIT_CAN_VOO = 1 OR SIT.FL_SIT_CON_VOO = 0)
	--Setar CD_CHG_ANT do vôo sucessor para nulo caso a CHG seja cancelada
	IF (	SELECT 	COUNT(*) FROM T_PAR PAR, INSERTED INS, T_SIT SIT
		WHERE 	PAR.CD_CHG_ANT = INS.CD_CHG AND SIT.CD_SIT = INS.CD_SIT AND SIT.FL_SIT_CAN_VOO = 1) &gt; 0
	BEGIN
		UPDATE 	T_PAR SET CD_CHG_ANT = NULL
		FROM 	T_PAR PAR, INSERTED INS, T_SIT SIT
		WHERE 	PAR.CD_CHG_ANT = INS.CD_CHG AND SIT.CD_SIT = INS.CD_SIT AND SIT.FL_SIT_CAN_VOO = 1
	END
	--Setar CD_CHG_AEN_ANT do vôo da aeronave sucessora para nulo caso a CHG seja cancelada
	IF (	SELECT 	COUNT(*) FROM T_PAR PAR, INSERTED INS, T_SIT SIT
		WHERE 	PAR.CD_CHG_AEN_ANT = INS.CD_CHG AND SIT.CD_SIT = INS.CD_SIT AND SIT.FL_SIT_CAN_VOO = 1) &gt;0
	BEGIN
		UPDATE 	T_PAR SET CD_CHG_AEN_ANT = NULL
		FROM 	T_PAR PAR, INSERTED INS, T_SIT SIT
		WHERE 	PAR.CD_CHG_AEN_ANT = INS.CD_CHG AND SIT.CD_SIT = INS.CD_SIT AND SIT.FL_SIT_CAN_VOO = 1
	END
	--Atualizar o Código da Aeronave para Null caso a CHG tenha sido cancelado
	IF (	SELECT COUNT(*) 	FROM T_CHG CHG, INSERTED INS, T_SIT SIT
		WHERE  	CHG.CD_CHG = INS.CD_CHG AND SIT.CD_SIT = INS.CD_SIT AND SIT.FL_SIT_CAN_VOO = 1) &gt; 0
	BEGIN
		UPDATE 	T_CHG SET CD_AEN_CHG = NULL
		FROM 	T_CHG CHG, INSERTED INS, T_SIT SIT
		WHERE  	CHG.CD_CHG = INS.CD_CHG AND SIT.CD_SIT = INS.CD_SIT AND SIT.FL_SIT_CAN_VOO = 1
	END
	--Apagar os HPA&#39;s de CHG caso a CHG tenha sido cancelada
	IF (	SELECT	COUNT(*) FROM T_HPA001 HPA, T_SIT SIT, INSERTED INS
		WHERE  	HPA.CD_CHG = INS.CD_CHG AND SIT.CD_SIT = INS.CD_SIT AND SIT.FL_SIT_CAN_VOO = 1) &gt; 0
	BEGIN
		DELETE 	T_HPA001
		FROM 	T_HPA001 HPA, T_SIT SIT, INSERTED INS
		WHERE  	HPA.CD_CHG = INS.CD_CHG AND SIT.CD_SIT = INS.CD_SIT AND SIT.FL_SIT_CAN_VOO = 1
	END
	--Excluir vôo da tabela de vôos candidatos a vôos Antecessores se a CHG tiver sido cancelada
	IF (	SELECT 	COUNT(*) FROM T_CHGANT CHGANT, T_SIT SIT, INSERTED INS
		WHERE	CHGANT.CD_CHG = INS.CD_CHG AND SIT.CD_SIT = INS.CD_SIT AND SIT.FL_SIT_CAN_VOO = 1) &gt; 0
	BEGIN
		DELETE	T_CHGANT
		FROM	T_CHGANT CHGANT, T_SIT SIT, INSERTED INS
		WHERE	CHGANT.CD_CHG = INS.CD_CHG AND SIT.CD_SIT = INS.CD_SIT AND SIT.FL_SIT_CAN_VOO = 1
	END
	--Incluir vôo na tabela de vôos candidatos a vôos Antecessores se a CHG estiver cancelada e for alterada para uma situação diferente de Etapa Concluída  e Cancelado
	IF (	SELECT 	COUNT(*) FROM T_CHG CHG, T_SIT SIT, INSERTED INS, DELETED DEL
		WHERE	CHG.CD_CHG = INS.CD_CHG AND INS.CD_CHG = DEL.CD_CHG AND
			DEL.FL_CHG_CAN = 1 AND SIT.CD_SIT = INS.CD_SIT AND
			SIT.FL_SIT_CON_VOO = 0 AND SIT.FL_SIT_CAN_VOO = 0) &gt; 0
	BEGIN
		INSERT	T_CHGANT (CD_CHG)
		SELECT	CHG.CD_CHG FROM T_CHG CHG, T_SIT SIT, INSERTED INS, DELETED DEL
		WHERE	CHG.CD_CHG = INS.CD_CHG AND INS.CD_CHG = DEL.CD_CHG AND
			DEL.FL_CHG_CAN = 1 AND SIT.CD_SIT = INS.CD_SIT AND
			SIT.FL_SIT_CON_VOO = 0 AND SIT.FL_SIT_CAN_VOO = 0
	END
	--Deletar da tabela T_REP todos os registros que tiverem os campos companhia e número do vôo iguais aos do registro atualizado e o aeroporto destino igual ao aeroporto usuário, caso a situação	do vôo tenha sido alterada para &quot;Etapa Concluída&quot;
	DELETE	T_REP001 FROM INSERTED INS, T_REP001 REP, T_COM COM, T_SIT SIT
	WHERE	SIT.CD_SIT = INS.CD_SIT AND
		SIT.FL_SIT_CON_VOO = 1 AND	--Etapa Concluída
		COM.CD_COM = INS.CD_COM AND
		RTRIM(REP.SG_COM_IAT_003) = RTRIM(COM.SG_COM_IAT_003) AND
		RTRIM(REP.NR_VOO) = RTRIM(INS.NR_CHG_VOO) AND
		REP.SG_AER_ICA_DES = (SELECT SG_AER_ICA FROM T_AER WHERE CD_AER = (SELECT CD_AER FROM T_PSI))
	--Setar flag de vôo não concluído ou concluído
	UPDATE 	T_CHG SET TP_CHG_STA = SIT.FL_SIT_CON_VOO + 1   --2=Concluída
	FROM 	T_CHG CHG, T_SIT SIT, INSERTED INS
	WHERE 	CHG.CD_CHG = INS.CD_CHG AND SIT.CD_SIT = INS.CD_SIT
	--Atualizar Flag de entrada concluída em T_HPA
	UPDATE 	T_HPA001 SET FL_HPA_ENT = SIT.FL_SIT_CON_VOO 
	FROM 	T_HPA001 HPA, T_SIT SIT, INSERTED INS
	WHERE  	HPA.CD_CHG = INS.CD_CHG AND SIT.CD_SIT = INS.CD_SIT 
	--INCLUSÃO DE STATUS DA AERONAVE
	DECLARE INSSTA CURSOR FOR
		SELECT 	INS.CD_CHG, INS.CD_SIT, INS.DH_CHG_EFE, AEN.FL_AEN_ISE, 
			COM.FL_COM_TAR_RED, PSI.QT_PSI_ISE, PSI.QT_PSI_TAR_RED
		FROM	INSERTED INS,  T_AEN AEN, T_COM COM, T_PSI PSI
		WHERE	TP_CHG_CTG NOT IN (3, 4) 	AND AEN.CD_AEN = INS.CD_AEN_CHG AND COM.CD_COM = INS.CD_COM
		ORDER BY CD_CHG
	--Declaração das variáveis
	DECLARE	@CD_CHG INT, @CD_SIT INT, @DH_CHG_EFE SMALLDATETIME, @CD_STA INT,
			@FL_AEN_ISE TINYINT, @FL_COM_TAR_RED TINYINT, 	@QT_PSI_ISE INT, @QT_PSI_TAR_RED INT
	--Abre o curso e posiciona no primeiro registro
	OPEN INSSTA
	FETCH	INSSTA INTO @CD_CHG, @CD_SIT, @DH_CHG_EFE, @FL_AEN_ISE, @FL_COM_TAR_RED, @QT_PSI_ISE, @QT_PSI_TAR_RED
	--Processar todos os registros de INSSTA
	WHILE @@FETCH_STATUS = 0
	BEGIN
		SELECT @CD_STA = (SELECT ISNULL(MAX(CD_STA), 0) +1 FROM T_STA)
		--Inserir o Status caso a situação seja Etapa Concluída e o vôo não esteja Cancelado
		INSERT 	INTO T_STA (
			CD_STA, DH_STA_ABE, MA_STA_ABE, NR_STA,
			DH_STA_FEC, MA_STA_FEC, CD_STA_ANT,
			TP_STA, 	FL_STA_AEN_ISE, FL_STA_COM_TAR_RED, 
			QT_STA_PSI_ISE, 	QT_STA_PSI_TAR_RED)
		SELECT	@CD_STA,
			@DH_CHG_EFE, 
			DATEADD(DD, 1- DATEPART(DD, Dateadd(HH, -Datepart(HH, @DH_CHG_EFE), Dateadd(mi, -datepart(mi, @DH_CHG_EFE), @DH_CHG_EFE))), Dateadd(HH, -Datepart(HH, @DH_CHG_EFE), Dateadd(mi, -datepart(mi, @DH_CHG_EFE), @DH_CHG_EFE))), --Primeiro dia do mês da Data da CHG
			(SELECT ISNULL(MAX(NR_STA), 0) + 1 FROM T_STA STA WHERE STA.MA_STA_ABE = DATEADD(DD, 1- DATEPART(DD, Dateadd(HH, -Datepart(HH, @DH_CHG_EFE), Dateadd(mi, -datepart(mi, @DH_CHG_EFE), @DH_CHG_EFE))), Dateadd(HH, -Datepart(HH, @DH_CHG_EFE), Dateadd(mi, -datepart(mi, @DH_CHG_EFE), @DH_CHG_EFE)))),
			NULL, NULL, NULL, 1, --Em Aberto
			@FL_AEN_ISE, @FL_COM_TAR_RED, @QT_PSI_ISE, @QT_PSI_TAR_RED
		FROM	T_CHG CHG, T_SIT SIT
		WHERE	SIT.CD_SIT = CHG.CD_SIT AND CHG.CD_CHG = @CD_CHG AND

			CHG.FL_CHG_CAN = 0 AND 		--CHG não Cancelada
			SIT.FL_SIT_CON_VOO = 1		--Situação Etapa Concluída
		IF @@ROWCOUNT &lt;&gt; 0 
		BEGIN
			--Atualizar CD_STA em T_HPA caso a situação seja Etapa Concluída e o vôo não esteja Cancelado
			UPDATE 	HPA SET CD_STA = @CD_STA
			FROM	T_CHG CHG, T_SIT SIT, T_HPA001 HPA
			WHERE	HPA.CD_CHG = CHG.CD_CHG AND
				SIT.CD_SIT = CHG.CD_SIT AND CHG.CD_CHG = @CD_CHG AND
				CHG.FL_CHG_CAN = 0 AND 		--CHG não Cancelada
				SIT.FL_SIT_CON_VOO = 1		--Situação Etapa Concluída
		END
		--Próximo registro
		FETCH NEXT FROM INSSTA
		INTO	@CD_CHG, @CD_SIT, @DH_CHG_EFE, @FL_AEN_ISE, @FL_COM_TAR_RED, @QT_PSI_ISE, @QT_PSI_TAR_RED
	END
	CLOSE INSSTA
	DEALLOCATE INSSTA
	--Cancelar o Status caso a CHG esteja concluída e a situação seja alterada para outra qualquer
	IF (	SELECT COUNT(*) 	FROM T_STA STA, INSERTED INS, DELETED DEL, T_SIT SITDEL, T_SIT SITINS, T_HPA001 HPA
		WHERE 	STA.CD_STA = HPA.CD_STA AND HPA.CD_CHG = INS.CD_CHG AND
			DEL.CD_CHG = INS.CD_CHG AND SITDEL.CD_SIT = DEL.CD_SIT AND
			SITDEL.FL_SIT_CON_VOO = 1 AND SITINS.CD_SIT = INS.CD_SIT AND
			SITINS.FL_SIT_CON_VOO = 0) &gt; 0
	BEGIN
		UPDATE 	STA
		SET 	TP_STA = 3,  --Cancelado
			DH_STA_FEC = NULL, MA_STA_FEC = NULL,
			CD_STA_ANT = NULL, FL_STA_AEN_ISE = NULL,
			FL_STA_COM_TAR_RED = NULL, QT_STA_PSI_ISE = NULL,
			QT_STA_PSI_TAR_RED = NULL
		FROM 	T_STA STA, INSERTED INS, DELETED DEL, T_SIT SITDEL, T_SIT SITINS, T_HPA001 HPA
		WHERE 	STA.CD_STA = HPA.CD_STA AND HPA.CD_CHG = INS.CD_CHG AND
			DEL.CD_CHG = INS.CD_CHG AND SITDEL.CD_SIT = DEL.CD_SIT AND
			SITDEL.FL_SIT_CON_VOO = 1 AND SITINS.CD_SIT = INS.CD_SIT AND
			SITINS.FL_SIT_CON_VOO = 0
	END
	--Alterar CD_STA de HPA para NULL caso a CHG esteja concluída e a situação seja alterada para outra qualquer
	IF (	SELECT COUNT(*) 	FROM T_HPA001 HPA, INSERTED INS, DELETED DEL, T_SIT SITDEL, T_SIT SITINS
		WHERE 	HPA.CD_CHG = INS.CD_CHG AND DEL.CD_CHG = INS.CD_CHG AND
			SITDEL.CD_SIT = DEL.CD_SIT AND SITDEL.FL_SIT_CON_VOO = 1 AND
			SITINS.CD_SIT = INS.CD_SIT AND SITINS.FL_SIT_CON_VOO = 0) &gt; 0
	BEGIN
		UPDATE 	HPA SET CD_STA = NULL
		FROM 	T_HPA001 HPA, INSERTED INS, DELETED DEL, T_SIT SITDEL, T_SIT SITINS
		WHERE 	HPA.CD_CHG = INS.CD_CHG AND DEL.CD_CHG = INS.CD_CHG AND
			SITDEL.CD_SIT = DEL.CD_SIT AND SITDEL.FL_SIT_CON_VOO = 1 AND
			SITINS.CD_SIT = INS.CD_SIT AND SITINS.FL_SIT_CON_VOO = 0
	END
END
IF UPDATE(NR_CHG_VOO)
BEGIN
	--Atualizar o prefixo da aeronave dos vôos do grupo 2 caso o número do vôo tenha sido alterado
	UPDATE	CHG
	SET	CD_AEN_CHG = (	SELECT 	CD_AEN 
					FROM 	T_AEN AEN WHERE RTRIM(AEN.NR_AEN) = RTRIM(INS.NR_CHG_VOO))
	FROM	T_CHG CHG, INSERTED INS
	WHERE	CHG.CD_CHG = INS.CD_CHG AND INS.TP_CHG_GRU = 2
	--Atualizar o número do vôo de PAR associado caso este voo seja do Grupo 2
	IF (	SELECT COUNT(*) 	FROM T_PAR PAR, INSERTED INS
		WHERE	PAR.CD_CHG_AEN_ANT = INS.CD_CHG AND
			INS.TP_CHG_GRU = 2 AND PAR.TP_PAR_GRU = 2) &gt; 0
	BEGIN
		UPDATE	PAR SET NR_PAR_VOO = INS.NR_CHG_VOO
		FROM	T_PAR PAR, INSERTED INS
		WHERE	PAR.CD_CHG_AEN_ANT = INS.CD_CHG AND
			INS.TP_CHG_GRU = 2 AND PAR.TP_PAR_GRU = 2
	END
	--Atualizar em HPA o prefixo da aeronave dos vôos do grupo 2 caso o número do vôo tenha sido alterado
	IF (	SELECT 	COUNT(*) FROM T_HPA001 HPA, INSERTED INS
		WHERE	HPA.CD_CHG = INS.CD_CHG AND INS.TP_CHG_GRU = 2) &gt; 0
	BEGIN
		UPDATE	T_HPA001
		SET	CD_AEN = (	SELECT 	CD_AEN 
					FROM 	T_AEN AEN WHERE RTRIM(AEN.NR_AEN) = RTRIM(INS.NR_CHG_VOO))
		FROM	T_HPA001 HPA, INSERTED INS
		WHERE	HPA.CD_CHG = INS.CD_CHG AND INS.TP_CHG_GRU = 2 
	END
END
IF UPDATE(TP_CHG_CTG)
BEGIN
	--Apagar os hpa dos vôos de CHG que passaram a ser CSH ou DPL
	DELETE	T_HPA001 FROM T_HPA001 HPA, INSERTED INS
	WHERE	HPA.CD_CHG = INS.CD_CHG AND INS.TP_CHG_CTG IN (3,4)
	--Anular o tipo de equipamento, o box e a aeronave dos vôos que passaram a ser CSH ou DPL
	UPDATE	T_CHG
	SET	CD_EQP_CHG = NULL, CD_AEN_CHG = NULL, CD_BOX = NULL
	FROM	T_CHG CHG, INSERTED INS
	WHERE	CHG.CD_CHG = INS.CD_CHG AND INS.TP_CHG_CTG IN (3,4)
	--Incluir vôo na tabela de vôos candidatos a vôos Antecessores se TP_CHG_CTG mudar de 3 ou 4 para uma categoria que seja diferente de 3 ou 4
	INSERT	T_CHGANT(CD_CHG)
	SELECT	INS.CD_CHG FROM INSERTED INS, DELETED DEL
	WHERE	INS.CD_CHG = DEL.CD_CHG AND DEL.TP_CHG_CTG IN (3,4) AND INS.TP_CHG_CTG NOT IN (3,4)
	--Excluir vôo da tabela de vôos candidatos a vôos Antecessores se TP_CHG_CTG mudar para 3 ou 4
	DELETE	T_CHGANT FROM T_CHGANT CHGANT, INSERTED INS
	WHERE	CHGANT.CD_CHG = INS.CD_CHG AND INS.TP_CHG_CTG IN (3,4)
END
IF UPDATE(DH_CHG_EFE)
BEGIN
	--Atualizar a hora do vôo de PAR caso a diferença entre a hora da PAR e a hora da CHG seja menor que o tempo mínimo de permanência do vôo.
	IF (	SELECT COUNT(*) 	FROM T_PAR PAR, INSERTED INS
		WHERE	PAR.CD_CHG_AEN_ANT = INS.CD_CHG AND 
			(DATEDIFF(MI, INS.DH_CHG_EFE, PAR.DH_PAR_EFE) &lt; INS.QT_CHG_PER_MIN OR PAR.DH_PAR_EFE &gt; PAR.DH_PAR_NRM)) &gt;0
	BEGIN
		UPDATE 	T_PAR
		SET 	DH_PAR_SIT = GETDATE(),
			DH_PAR_EFE  =  DATEADD( MI, INS.QT_CHG_PER_MIN, INS.DH_CHG_EFE),
			DH_PAR_EST  =  DATEADD( MI, INS.QT_CHG_PER_MIN, INS.DH_CHG_EFE)
		FROM 	T_PAR PAR, INSERTED INS
		WHERE	PAR.CD_CHG_AEN_ANT = INS.CD_CHG AND (DATEDIFF(MI, INS.DH_CHG_EFE, PAR.DH_PAR_EFE) &lt; INS.QT_CHG_PER_MIN OR PAR.DH_PAR_EFE &gt; PAR.DH_PAR_NRM)
	END
	--Atualizar a hora prevista e de estacionamento dos vôos que ficaram com estas horas menores que a hora normal
	IF (	SELECT	COUNT(*) FROM T_PAR PAR, INSERTED INS
		WHERE	PAR.CD_CHG_AEN_ANT = INS.CD_CHG AND PAR.DH_PAR_EFE &lt; PAR.DH_PAR_NRM) &gt; 0
	BEGIN
		UPDATE 	T_PAR
		SET	DH_PAR_EFE = PAR.DH_PAR_NRM, DH_PAR_EST = PAR.DH_PAR_NRM
		FROM 	T_PAR PAR, INSERTED INS
		WHERE	PAR.CD_CHG_AEN_ANT = INS.CD_CHG AND PAR.DH_PAR_EFE &lt; PAR.DH_PAR_NRM
	END
	--Atualizar os campos DH_STA_ABE e MA_STA_ABE do Status de Aeronave associado ao primeiro HPA do vôo alterado, se houver alteração na Data/Hora Efetiva do Vôo de CHG, e o Status associado ao primeiro HPA desse vôo, estiver aberto
	UPDATE	STA
	SET	DH_STA_ABE = INS.DH_CHG_EFE,
		MA_STA_ABE = DATEADD(DD, 1- DATEPART(DD, Dateadd(HH, -Datepart(HH, INS.DH_CHG_EFE), Dateadd(mi, -datepart(mi, INS.DH_CHG_EFE), INS.DH_CHG_EFE))), Dateadd(HH, -Datepart(HH, INS.DH_CHG_EFE), Dateadd(mi, -datepart(mi, INS.DH_CHG_EFE), INS.DH_CHG_EFE))) --Primeiro dia do mês da Data da CHG
	FROM	T_STA STA, T_CHG CHG, INSERTED INS, T_HPA001 HPA
	WHERE	CHG.CD_CHG = INS.CD_CHG AND HPA.CD_CHG = INS.CD_CHG AND
		HPA.NR_HPA_SEQ = 1 AND 	STA.CD_STA = HPA.CD_STA AND STA.TP_STA = 1
END
--Se o vôo possuir CHG e atualizarmos a aeronave de CHG do vôo, temos que atualizá-la também em HPA
IF UPDATE(CD_AEN_CHG)
BEGIN
	IF (	SELECT 	COUNT(*) FROM INSERTED INS, T_CHG CHG
		WHERE	CHG.CD_CHG = INS.CD_CHG AND CHG.FL_CHG_CAN = 1 AND INS.CD_AEN_CHG IS NOT NULL) &gt; 0
	BEGIN
		RAISERROR 20999 &#39;Operação não executada: Não é permitido definir aeronave para vôos cancelados.&#39;
		ROLLBACK TRANSACTION
		RETURN
	END
	--Não permitir que o prefixo da aeronave seja nulo para vôos do grupo 2
	IF (	SELECT 	COUNT(*) FROM INSERTED INS
		WHERE	INS.TP_CHG_GRU = 2 AND INS.CD_AEN_CHG IS NULL) &gt; 0
	BEGIN
		RAISERROR 20999 &#39;Operação não executada: O &lt;Prefixo da Aeronave&gt; para vôos da Aviação Geral não deve ser nulo, e sim igual ao &lt;Número do Vôo&gt;.&#39;
		ROLLBACK TRANSACTION
		RETURN
	END
	--Atualizar o número do vôo de CHG para vôos do grupo 2 caso o prefixo da aeronave tenha sido alterado
	UPDATE	CHG
	SET	NR_CHG_VOO = (SELECT NR_AEN FROM T_AEN AEN WHERE AEN.CD_AEN = INS.CD_AEN_CHG)
	FROM	T_CHG CHG, INSERTED INS
	WHERE	CHG.CD_CHG = INS.CD_CHG AND INS.TP_CHG_GRU = 2

	--Atualizar o número do vôo de PAR para vôos do grupo 2 caso o prefixo da aeronave tenha sido alterado
	IF (	SELECT	COUNT(*) FROM T_PAR PAR, INSERTED INS
		WHERE	PAR.CD_CHG_AEN_ANT = INS.CD_CHG AND
			INS.TP_CHG_GRU = 2 AND PAR.TP_PAR_GRU = 2) &gt;0
	BEGIN
		UPDATE	PAR
		SET	NR_PAR_VOO = (SELECT NR_AEN FROM T_AEN AEN WHERE AEN.CD_AEN = INS.CD_AEN_CHG)
		FROM	T_PAR PAR, INSERTED INS
		WHERE	PAR.CD_CHG_AEN_ANT = INS.CD_CHG AND
			INS.TP_CHG_GRU = 2 AND 	PAR.TP_PAR_GRU = 2
	END
	--Atualizar aeronave em HPA
	UPDATE 	T_HPA001 SET CD_AEN = INS.CD_AEN_CHG
	FROM 	T_HPA001 HPA, T_CHG CHG, INSERTED INS
	WHERE  	HPA.CD_CHG = INS.CD_CHG AND CHG.CD_CHG = INS.CD_CHG
END
--Se atualizarmos a aeronave de CHG do vôo para outra que não seja Null e a situação do vôo for etapa concluída, temos que atualizar as informações referentes à aeronave em STA
IF UPDATE(CD_AEN_CHG) 
BEGIN
	UPDATE 	T_STA SET FL_STA_AEN_ISE = AEN.FL_AEN_ISE
	FROM 	T_STA STA, T_CHG CHG, T_HPA001 HPA, T_AEN AEN, T_SIT SIT, INSERTED INS
	WHERE  STA.CD_STA = HPA.CD_STA AND HPA.CD_CHG = INS.CD_CHG AND
		CHG.CD_CHG = INS.CD_CHG AND AEN.CD_AEN = INS.CD_AEN_CHG AND
		INS.CD_AEN_CHG is not Null AND SIT.CD_SIT = INS.CD_SIT AND SIT.FL_SIT_CON_VOO = 1
END
--Se atualizarmos a companhia aérea do vôo de CHG e a situação do vôo for etapa concluída, temos que atualizar as informações referentes à companhia aérea em STA
IF UPDATE(CD_COM) 
BEGIN
	UPDATE 	T_STA SET FL_STA_COM_TAR_RED = COM.FL_COM_TAR_RED
	FROM 	T_STA STA, T_CHG CHG, T_HPA001 HPA, T_COM COM, T_SIT SIT, INSERTED INS
	WHERE  STA.CD_STA = HPA.CD_STA AND HPA.CD_CHG = INS.CD_CHG AND
		CHG.CD_CHG = INS.CD_CHG AND COM.CD_COM = INS.CD_COM AND
		SIT.CD_SIT = INS.CD_SIT AND SIT.FL_SIT_CON_VOO = 1 
END
IF UPDATE(DH_CHG_EST)
BEGIN
	--Não permitir alteração na Data ou Hora de Estacionamento de um Vôo de CHG, se o Status de Aeronave associado ao primeiro HPA desse vôo, estiver Fechado
	IF (	SELECT	COUNT(*)
		FROM 	T_CHG CHG, INSERTED INS, T_HPA001 HPA, T_STA STA
		WHERE	CHG.CD_CHG = INS.CD_CHG AND HPA.CD_CHG = INS.CD_CHG AND
			HPA.NR_HPA_SEQ = 1 AND STA.CD_STA = HPA.CD_STA AND STA.TP_STA = 2) &gt; 0
	BEGIN
		RAISERROR 20999 &#39;Operação não executada: A &lt;Data ou Hora de Estacionamento&gt; do vôo de Chegada não pode ser alterada, se o Status de Aeronave associado ao primeiro HPA desse vôo, estiver Fechado.&#39;
		ROLLBACK TRANSACTION
		RETURN
	END
	--Atualizamos Hora de Entrada em HPA como Hora de Estacionamento de CHG, no registro que possue o Vôo sendo atualizado como Vôo de CHG
	UPDATE 	T_HPA001 SET DH_HPA_ENT = CHG.DH_CHG_EST
	FROM	T_HPA001 HPA, T_CHG CHG, INSERTED INS
	WHERE 	CHG.CD_CHG = INS.CD_CHG AND HPA.CD_CHG = INS.CD_CHG AND HPA.NR_HPA_SEQ = 1
END
--CONSISTÊNCIAS A SEREM FEITAS APÓS AS ATUALIZAÇÕES
--Verificar se há horas de CHG maiores que as horas de PAR
IF   (	SELECT COUNT(*) FROM T_CHG CHG, T_PAR PAR, INSERTED INS
	WHERE 	CHG.CD_CHG = INS.CD_CHG AND PAR.CD_CHG_AEN_ANT = CHG.CD_CHG AND
		( (CHG.DH_CHG_EFE &gt;= PAR.DH_PAR_EFE) OR (CHG.DH_CHG_EST &gt;= PAR.DH_PAR_EST))) &gt; 0
BEGIN
	RAISERROR 20999 &#39;Operação não executada: A hora de chegada não pode ser maior nem igual à hora de partida.&#39;
	ROLLBACK TRANSACTION
	RETURN
END
--Alexei 18/06/01
IF UPDATE(FL_CHG_TEL)
BEGIN
	--Se desmarcar da tela desmarcar do anunciador automático
	Update	T_CHG
	set	FL_CHG_ANU = 0
	FROM	T_CHG CHG
	JOIN	INSERTED INS ON INS.CD_CHG = CHG.CD_CHG
	WHERE	INS.FL_CHG_TEL = 0
END

--Verificar se são satisfeitas as condições para a nova situação de CHG
--Alexei 18/06/01
IF UPDATE(CD_SIT) OR UPDATE(DH_CHG_EFE)
BEGIN
	--Lançar Histórico de Situação de Vôo
	INSERT T_HSC (DH_HSC, CD_CHG, CD_IFT, CD_SIT, DH_HSC_CHG, CD_USR) SELECT GETDATE(), INS.CD_CHG, INS.CD_IFT, INS.CD_SIT, INS.DH_CHG_EFE, INS.CD_USR FROM INSERTED INS

	--Deleta todos os registros da programação não anunciados e que estejam vinculados a este vôo
	DELETE T_PRALOG FROM T_PRALOG JOIN INSERTED INS ON INS.CD_CHG = T_PRALOG.CD_CHG WHERE T_PRALOG.FL_LOG = 0

	--Inserir programação de Log
	--Antes da Hora Prevista
	INSERT INTO T_PRALOG (CD_PRA, CD_CHG, CD_PAR, DH_LOG, FL_LOG)
	SELECT 	CD_PRA, INS.CD_CHG, NULL, DATEADD(MI, -PRA.QT_PRA_TMP, INS.DH_CHG_EFE), 0
	FROM	T_PRA PRA JOIN INSERTED INS ON INS.CD_SIT = PRA.CD_SIT AND INS.FL_CHG_TEL = 1 AND INS.FL_CHG_ANU = 1
	JOIN	T_TPA TPA ON TPA.CD_TPA = PRA.CD_TPA AND TPA.TP_TPA = 1 JOIN T_SIT SIT ON SIT.CD_SIT = INS.CD_SIT AND FL_SIT_CON_VOO = 0
	WHERE	PRA.TP_PRA = 1 AND NOT EXISTS (SELECT * FROM T_PRALOG WHERE CD_PRA = PRA.CD_PRA AND CD_CHG = INS.CD_CHG) 

	 --Após a Alteração da Situação
	INSERT INTO T_PRALOG (CD_PRA, CD_CHG, CD_PAR, DH_LOG, FL_LOG)
	SELECT 	CD_PRA, INS.CD_CHG, NULL, DATEADD(MI, PRA.QT_PRA_TMP, GETDATE()), 0
	FROM	T_PRA PRA JOIN INSERTED INS ON INS.CD_SIT = PRA.CD_SIT AND INS.FL_CHG_TEL = 1 AND INS.FL_CHG_ANU = 1
	JOIN	T_TPA TPA ON TPA.CD_TPA = PRA.CD_TPA AND TPA.TP_TPA = 1 JOIN T_SIT SIT ON SIT.CD_SIT = INS.CD_SIT AND FL_SIT_CON_VOO = 0
	WHERE	PRA.TP_PRA = 2 AND NOT EXISTS (SELECT * FROM T_PRALOG WHERE CD_PRA = PRA.CD_PRA AND CD_CHG = INS.CD_CHG)
END
IF UPDATE(CD_SIT)
BEGIN
	IF (	SELECT	COUNT(*) FROM INSERTED INS, T_PAR AEN, T_SIT SITAEN
		WHERE	AEN.CD_CHG_AEN_ANT = INS.CD_CHG AND 
			SITAEN.CD_SIT = AEN.CD_SIT AND SITAEN.FL_SIT_TOD = 1 AND 
			EXISTS (SELECT * FROM T_SCA SCA WHERE SCA.CD_SIT = AEN.CD_SIT) AND 
			INS.CD_SIT NOT IN (SELECT CD_SIT_ANT FROM T_SCA SCA WHERE SCA.CD_SIT = AEN.CD_SIT)) &gt; 0
	BEGIN
		RAISERROR 20999 &#39;Operação não executada: A nova situação do vôo de chegada é incompatível com as situações dos vôos sucessores.&#39;
		ROLLBACK TRANSACTION
		RETURN
	END

	--Antes da Hora Prevista
	INSERT INTO T_PRALOG (CD_PRA, CD_CHG, CD_PAR, DH_LOG, FL_LOG)
	SELECT 	CD_PRA, NULL, NULL, DATEADD(MI, -PRA.QT_PRA_TMP, INS.DH_CHG_EFE), 0
	FROM	T_PRA PRA JOIN INSERTED INS ON INS.CD_SIT = PRA.CD_SIT AND INS.FL_CHG_TEL = 1 AND INS.FL_CHG_ANU = 1
	JOIN	T_TPA TPA ON TPA.CD_TPA = PRA.CD_TPA AND TPA.TP_TPA = 3 JOIN T_SIT SIT ON SIT.CD_SIT = INS.CD_SIT AND FL_SIT_CON_VOO = 0
	WHERE	PRA.TP_PRA = 1 AND NOT EXISTS (SELECT * FROM T_PRALOG WHERE CD_PRA = PRA.CD_PRA AND CD_CHG = INS.CD_CHG) AND TP_PRA_TPA = 1

	--Após a Alteração da Situação
	INSERT INTO T_PRALOG (CD_PRA, CD_CHG, CD_PAR, DH_LOG, FL_LOG)
	SELECT 	CD_PRA, NULL, NULL, DATEADD(MI, PRA.QT_PRA_TMP, GETDATE()), 0
	FROM	T_PRA PRA JOIN INSERTED INS ON INS.CD_SIT = PRA.CD_SIT AND INS.FL_CHG_TEL = 1 AND INS.FL_CHG_ANU = 1
	JOIN	T_TPA TPA ON TPA.CD_TPA = PRA.CD_TPA AND TPA.TP_TPA = 3 JOIN T_SIT SIT ON SIT.CD_SIT = INS.CD_SIT AND FL_SIT_CON_VOO = 0
	WHERE	PRA.TP_PRA = 2 AND NOT EXISTS (SELECT * FROM T_PRALOG WHERE CD_PRA = PRA.CD_PRA AND CD_CHG = INS.CD_CHG) AND TP_PRA_TPA = 1
END
--JOGAR os dados dos vôos do tipo Normal, nos vôos do tipo Codeshare
IF (	SELECT 	COUNT(*)  FROM T_CHG CHG, T_CHG CHGVIN, INSERTED INS
	WHERE	CHG.CD_CHG_VIN = INS.CD_CHG AND CHGVIN.CD_CHG = INS.CD_CHG) &gt;0
BEGIN
	UPDATE	CHG
	SET	CD_EQP_CHG = CHGVIN.CD_EQP_CHG, CD_BOX = CHGVIN.CD_BOX,
		QT_CHG_PER_MIN = CHGVIN.QT_CHG_PER_MIN, DH_CHG_NRM = CHGVIN.DH_CHG_NRM,
		DH_CHG_EFE = CHGVIN.DH_CHG_EFE, DH_CHG_EST = CHGVIN.DH_CHG_EST,
		NM_CHG_COM_SIT = CHGVIN.NM_CHG_COM_SIT, DH_CHG_SIT  = CHGVIN.DH_CHG_SIT,
		FL_CHG_CAN = CHGVIN.FL_CHG_CAN, CD_SIT = CHGVIN.CD_SIT,
		TP_CHG_STA = CHGVIN.TP_CHG_STA, CD_USR = CHGVIN.CD_USR
	FROM	T_CHG CHG, T_CHG CHGVIN, INSERTED INS
	WHERE	CHG.CD_CHG_VIN = INS.CD_CHG AND CHGVIN.CD_CHG = INS.CD_CHG
END
--PUXAR os dados dos vôos do tipo Normal, nos vôos do tipo Codeshare
IF (	SELECT 	COUNT(*) FROM T_CHG CHG, T_CHG CHGVIN, INSERTED INS
	WHERE	CHG.CD_CHG = INS.CD_CHG AND CHGVIN.CD_CHG = INS.CD_CHG_VIN) &gt; 0
BEGIN
	UPDATE	CHG
	SET	CD_EQP_CHG = CHGVIN.CD_EQP_CHG, CD_BOX = CHGVIN.CD_BOX,
		QT_CHG_PER_MIN = CHGVIN.QT_CHG_PER_MIN, DH_CHG_NRM = CHGVIN.DH_CHG_NRM,
		DH_CHG_EFE = CHGVIN.DH_CHG_EFE, DH_CHG_EST = CHGVIN.DH_CHG_EST,
		NM_CHG_COM_SIT = CHGVIN.NM_CHG_COM_SIT, DH_CHG_SIT  = CHGVIN.DH_CHG_SIT,
		FL_CHG_CAN = CHGVIN.FL_CHG_CAN, CD_SIT = CHGVIN.CD_SIT,
		TP_CHG_STA = CHGVIN.TP_CHG_STA, CD_USR = CHGVIN.CD_USR
	FROM	T_CHG CHG, T_CHG CHGVIN, INSERTED INS
	WHERE	CHG.CD_CHG = INS.CD_CHG AND CHGVIN.CD_CHG = INS.CD_CHG_VIN
END
--Lançar registro para Replicação na tabela T_REP001
IF UPDATE(CD_SIT) OR UPDATE(CD_AEN_CHG)
BEGIN
	DECLARE @HR_REP_ZUL INT
	DECLARE @HR_HOR_NRM INT
	DECLARE @HR_HOR_VER INT

	--Verifica Defazagem em relação ao horário Zulu
	SELECT 	@HR_HOR_NRM = HR_HOR_NRM, @HR_HOR_VER = HR_HOR_VER
	FROM 	T_HOR HOR, T_AER AER, T_CID CID, T_PSI PSI
	WHERE 	CID.CD_CID = AER.CD_CID And HOR.CD_HOR = CID.CD_HOR And AER.CD_AER = PSI.CD_AER
   
	--Verifica se o Aeroporto está no Horário de Verão
	IF (SELECT COUNT(*) FROM T_HRV WHERE GETDATE() BETWEEN DT_HRV_INI AND DT_HRV_FIM) &gt; 0
		SELECT @HR_REP_ZUL = @HR_HOR_VER
	ELSE
		SELECT @HR_REP_ZUL = @HR_HOR_NRM
END
IF UPDATE(CD_SIT)
BEGIN
	--Vôos de CHG cujas situações estão sendo atualizadas para &quot;Etapa Concluída&quot; e cuja primeira escala posterior do vôo de PAR associado é um dos aeroportos ativos existentes na tabela T_RED
	DECLARE REP1 CURSOR FOR
	SELECT 	PAR.CD_PAR, SG_COM_IAT_003, NR_VOO = PAR.NR_PAR_VOO, 
		DH_VOO_EFE = INS.DH_CHG_EFE, QT_VOO_DIF = DATEDIFF(MI, INS.DH_CHG_NRM, INS.DH_CHG_EFE)
	FROM 	INSERTED INS, T_CHG CHG, T_SIT SIT, T_PAR PAR, T_COM COM
	WHERE	INS.CD_CHG = CHG.CD_CHG AND SIT.CD_SIT = INS.CD_SIT AND
		SIT.FL_SIT_CON_VOO = 1 AND CHG.FL_CHG_CAN = 0 AND
		PAR.CD_CHG_AEN_ANT = INS.CD_CHG AND
		PAR.CD_PAR IN (	SELECT	CD_PAR FROM T_ECP001 ECP
				WHERE	ECP.CD_PAR = PAR.CD_PAR AND
					ECP.CD_ECP = (SELECT MIN(CD_ECP) FROM T_ECP001 ECP1 WHERE ECP1.CD_PAR = ECP.CD_PAR) AND
					ECP.CD_AER IN (SELECT CD_AER FROM T_AER WHERE SG_AER_ICA IN (SELECT SG_AER_ICA FROM T_RED WHERE FL_RED_ATI = 1))) AND
		COM.CD_COM = PAR.CD_COM
	--Declaração das variáveis
	DECLARE @CD_PAR INT, @SG_COM_IAT_003 CHAR(3), 	@NR_VOO CHAR(10), @DH_VOO_EFE SMALLDATETIME, @QT_VOO_DIF INT
	--Abre cursor e posiciona no primeiro registro
	OPEN REP1
	FETCH REP1 INTO	@CD_PAR, @SG_COM_IAT_003, @NR_VOO, @DH_VOO_EFE, @QT_VOO_DIF
	--Processar todos os registros de REP1
	WHILE @@FETCH_STATUS = 0
	BEGIN
		--Inserir registro na tabela T_REP001
		INSERT INTO T_REP001 (
			SG_AER_ICA_ORI, SG_AER_ICA_DES, SG_COM_IAT_003, NR_VOO, 
			DH_VOO_EFE, QT_VOO_DIF, NM_SIT, NR_AEN,
			FL_CHG_CON, FL_PAR_CON, FL_AEN, DH_REP, DH_REP_ORI, HR_REP_ZUL)
		SELECT 	(SELECT SG_AER_ICA FROM T_AER WHERE CD_AER = (SELECT CD_AER FROM T_PSI)),
			(SELECT SG_AER_ICA FROM T_ECP001 ECP, T_AER AER WHERE ECP.CD_PAR = @CD_PAR AND ECP.CD_ECP = (SELECT MIN(CD_ECP) FROM T_ECP001 WHERE CD_PAR = @CD_PAR) AND ECP.CD_AER = AER.CD_AER),
			@SG_COM_IAT_003, @NR_VOO,
			@DH_VOO_EFE, @QT_VOO_DIF,
			NULL, NULL, 1, 0, 0, GETDATE(), GETDATE(), @HR_REP_ZUL
		--Ir para o próximo registro
		FETCH NEXT FROM REP1
		INTO	@CD_PAR, @SG_COM_IAT_003, @NR_VOO, @DH_VOO_EFE, @QT_VOO_DIF
	END
	CLOSE REP1
	DEALLOCATE REP1
END
IF UPDATE(CD_AEN_CHG)
BEGIN
	--Vôos de CHG cujas prefixos das aeronaves estão sendo atualizadas e cuja primeira escala posterior do vôo de PAR associado é um dos aeroportos ativos existentes na tabela T_RED
	DECLARE REP2 CURSOR FOR
	SELECT 	PAR.CD_PAR, SG_COM_IAT_003, NR_VOO = PAR.NR_PAR_VOO, NR_AEN
	FROM 	INSERTED INS, T_PAR PAR, T_COM COM, T_AEN AEN
	WHERE	PAR.CD_CHG_AEN_ANT = INS.CD_CHG AND
		PAR.CD_PAR IN (	SELECT	CD_PAR 	FROM T_ECP001 ECP
				WHERE	ECP.CD_PAR = PAR.CD_PAR AND
					ECP.CD_ECP = (SELECT MIN(CD_ECP) FROM T_ECP001 ECP1 WHERE ECP1.CD_PAR = ECP.CD_PAR) AND
					ECP.CD_AER IN (SELECT CD_AER FROM T_AER WHERE SG_AER_ICA IN (SELECT SG_AER_ICA FROM T_RED WHERE FL_RED_ATI = 1))) AND
		COM.CD_COM = PAR.CD_COM AND AEN.CD_AEN =* INS.CD_AEN_CHG
	--Declaração das variáveis
	DECLARE @NR_AEN CHAR(10)
	--Abre curso e posiciona no primeiro registro
	OPEN REP2
	FETCH REP2 INTO @CD_PAR, @SG_COM_IAT_003, @NR_VOO, @NR_AEN
	--Processar todos os registros de REP2
	WHILE @@FETCH_STATUS = 0
	BEGIN
		--Inserir registro na tabela T_REP001
		INSERT INTO T_REP001 (
			SG_AER_ICA_ORI, SG_AER_ICA_DES, SG_COM_IAT_003, NR_VOO, 
			DH_VOO_EFE, QT_VOO_DIF, NM_SIT, NR_AEN,
			FL_CHG_CON, FL_PAR_CON, FL_AEN, DH_REP, DH_REP_ORI, HR_REP_ZUL)
		SELECT 	(SELECT SG_AER_ICA FROM T_AER WHERE CD_AER = (SELECT CD_AER FROM T_PSI)),
			(SELECT SG_AER_ICA FROM T_ECP001 ECP, T_AER AER WHERE ECP.CD_PAR = @CD_PAR AND ECP.CD_ECP = (SELECT MIN(CD_ECP) FROM T_ECP001 WHERE CD_PAR = @CD_PAR) AND ECP.CD_AER = AER.CD_AER),
			@SG_COM_IAT_003, @NR_VOO,
			NULL, NULL, NULL, @NR_AEN, 0, 0, 1, GETDATE(), GETDATE(), @HR_REP_ZUL

		--Ir para o próximo registro
		FETCH NEXT FROM REP2 INTO @CD_PAR, @SG_COM_IAT_003, @NR_VOO, @NR_AEN
	END
	CLOSE REP2
	DEALLOCATE REP2
END
--INCLUIR REGISTROS EM T_ACH
INSERT	T_ACH (DH_ACH, CD_CHG)
SELECT GETDATE(), CD_CHG FROM INSERTED

IF 	UPDATE(NR_CHG_VOO) OR UPDATE(TP_CHG_GRU) OR UPDATE(TP_CHG) OR 
	UPDATE(TP_CHG_NAT) OR UPDATE(TP_CHG_CTG) OR UPDATE(CD_COM)
BEGIN
	--Incluir registros em T_AHP
	INSERT	T_AHP (CD_HPA, DH_AHP)
	Select 	DISTINCT CD_HPA, GETDATE()
	From 	T_HPA001 HPA, T_CHG CHG, T_SIT SIT, INSERTED INS
	Where	HPA.CD_CHG = CHG.CD_CHG AND SIT.CD_SIT = CHG.CD_SIT AND
		HPA.CD_AER = (Select CD_AER From T_PSI) AND
		(HPA.FL_HPA_ENT = 1 OR SIT.FL_SIT_AEN_PAT = 1) AND HPA.FL_HPA_SAI = 0 AND
		HPA.CD_AEN IS NOT NULL AND CHG.CD_CHG = INS.CD_CHG
END
IF 	UPDATE(CD_AEN_CHG)
BEGIN
	--Incluir registros em T_APA
	INSERT	T_APA (CD_PAR, DH_APA)
	Select 	DISTINCT CD_PAR, GETDATE()
	From 	T_PAR PAR, INSERTED INS
	Where	PAR.CD_CHG_AEN_ANT = INS.CD_CHG AND
		PAR.TP_PAR_STA = 1 AND
		PAR.CD_AER = (Select CD_AER From T_PSI)

END
End
go</a:Text>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Trigger.Type>U</a:Trigger.Type>
</o:Trigger>
</c:Triggers>
<c:PrimaryKey>
<o:Key Ref="o216"/>
</c:PrimaryKey>
</o:Table>
</c:Object>
</o:TableSymbol>
</c:DestinationSymbol>
<c:Object>
<o:Reference Id="o239">
<a:ObjectID>6958B156-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>Reference_13</a:Name>
<a:Code>REFERENCE_13</a:Code>
<a:CreationDate>1081543201</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543201</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Cardinality>0..*</a:Cardinality>
<a:UpdateConstraint>1</a:UpdateConstraint>
<a:DeleteConstraint>1</a:DeleteConstraint>
<c:Object1>
<o:Table Ref="o189"/>
</c:Object1>
<c:Object2>
<o:Table Ref="o7"/>
</c:Object2>
<c:ParentKey>
<o:Key Ref="o216"/>
</c:ParentKey>
<c:Joins>
<o:ReferenceJoin Id="o240">
<a:ObjectID>6958B158-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543201</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543201</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<c:Object1>
<o:Column Ref="o190"/>
</c:Object1>
<c:Object2>
<o:Column Ref="o14"/>
</c:Object2>
</o:ReferenceJoin>
</c:Joins>
</o:Reference>
</c:Object>
</o:ReferenceSymbol>
<o:ReferenceSymbol Id="o241">
<a:Rect>((-738431,674250), (-727094,684675))</a:Rect>
<a:ListOfPoints>((-727094,684675),(-738431,674250))</a:ListOfPoints>
<a:ArrowStyle>4882</a:ArrowStyle>
<a:LineColor>8388736</a:LineColor>
<a:ShadowColor>12632256</a:ShadowColor>
<a:FontList>DISPNAME 0 arial,8,N</a:FontList>
<c:SourceSymbol>
<o:TableSymbol Ref="o38"/>
</c:SourceSymbol>
<c:DestinationSymbol>
<o:TableSymbol Id="o242">
<a:Rect>((-741989,672951), (-735131,677497))</a:Rect>
<a:LineColor>8388736</a:LineColor>
<a:FillColor>16777215</a:FillColor>
<a:ShadowColor>12632256</a:ShadowColor>
<a:FontList>DISPNAME 0 arial,8,N
TableColumns 0 arial,8,N
TablePkColumns 0 arial,8,N
TableKeys 0 arial,8,N
TableIndexs 0 arial,8,N
TableTriggers 0 arial,8,N</a:FontList>
<c:Object>
<o:Table Id="o243">
<a:ObjectID>6958B29B-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>T_COM</a:Name>
<a:Code>T_COM</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<c:Columns>
<o:Column Id="o244">
<a:ObjectID>6958B1BA-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>CD_COM</a:Name>
<a:Code>CD_COM</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL1    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL1 As
@valor &gt; 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o245">
<a:ObjectID>6958B1BB-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>NM_COM</a:Name>
<a:Code>NM_COM</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>char(30)</a:DataType>
<a:Length>30</a:Length>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o246">
<a:ObjectID>6958B1BC-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>SG_COM_IAT_003</a:Name>
<a:Code>SG_COM_IAT_003</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>char(3)</a:DataType>
<a:Length>3</a:Length>
</o:Column>
<o:Column Id="o247">
<a:ObjectID>6958B1BD-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>SG_COM_IAT_002</a:Name>
<a:Code>SG_COM_IAT_002</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>char(2)</a:DataType>
<a:Length>2</a:Length>
</o:Column>
<o:Column Id="o248">
<a:ObjectID>6958B1BE-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>FL_COM_GR1</a:Name>
<a:Code>FL_COM_GR1</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>tinyint</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o249">
<a:ObjectID>6958B1BF-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>FL_COM_GR2</a:Name>
<a:Code>FL_COM_GR2</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>tinyint</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o250">
<a:ObjectID>6958B1C0-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>FL_COM_TAR_RED</a:Name>
<a:Code>FL_COM_TAR_RED</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>tinyint</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o251">
<a:ObjectID>6958B1C2-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>CD_COM_MAT</a:Name>
<a:Code>CD_COM_MAT</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL1    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL1 As
@valor &gt; 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o252">
<a:ObjectID>6958B1C4-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>TIMESTAMP</a:Name>
<a:Code>TIMESTAMP</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>timestamp</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
</c:Columns>
<c:Keys>
<o:Key Id="o253">
<a:ObjectID>6958B1D1-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>Pk_T_COM</a:Name>
<a:Code>Pk_T_COM</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:PhysicalOptions>
clustered</a:PhysicalOptions>
<a:ConstraintName>Pk_T_COM</a:ConstraintName>
<c:Key.Columns>
<o:Column Ref="o244"/>
</c:Key.Columns>
</o:Key>
</c:Keys>
<c:Indexes>
<o:Index Id="o254">
<a:ObjectID>6958B1C8-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>I_COM_GR1</a:Name>
<a:Code>I_COM_GR1</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<c:IndexColumns>
<o:IndexColumn Id="o255">
<a:ObjectID>6958B1CA-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:IndexColumn.Expression>&lt;Index Expression_0&gt;</a:IndexColumn.Expression>
<c:Column>
<o:Column Ref="o248"/>
</c:Column>
</o:IndexColumn>
</c:IndexColumns>
</o:Index>
<o:Index Id="o256">
<a:ObjectID>6958B1CB-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>I_COM_GR2</a:Name>
<a:Code>I_COM_GR2</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<c:IndexColumns>
<o:IndexColumn Id="o257">
<a:ObjectID>6958B1CC-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:IndexColumn.Expression>&lt;Index Expression_0&gt;</a:IndexColumn.Expression>
<c:Column>
<o:Column Ref="o249"/>
</c:Column>
</o:IndexColumn>
</c:IndexColumns>
</o:Index>
<o:Index Id="o258">
<a:ObjectID>6958B1CD-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>I_COM_IAT_002</a:Name>
<a:Code>I_COM_IAT_002</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<c:IndexColumns>
<o:IndexColumn Id="o259">
<a:ObjectID>6958B1CE-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:IndexColumn.Expression>&lt;Index Expression_0&gt;</a:IndexColumn.Expression>
<c:Column>
<o:Column Ref="o247"/>
</c:Column>
</o:IndexColumn>
</c:IndexColumns>
</o:Index>
<o:Index Id="o260">
<a:ObjectID>6958B1CF-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>I_COM_IAT_003</a:Name>
<a:Code>I_COM_IAT_003</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<c:IndexColumns>
<o:IndexColumn Id="o261">
<a:ObjectID>6958B1D0-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:IndexColumn.Expression>&lt;Index Expression_0&gt;</a:IndexColumn.Expression>
<c:Column>
<o:Column Ref="o246"/>
</c:Column>
</o:IndexColumn>
</c:IndexColumns>
</o:Index>
</c:Indexes>
<c:Owner>
<o:User Ref="o34"/>
</c:Owner>
<c:Triggers>
<o:Trigger Id="o262">
<a:ObjectID>6958B20D-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>T_COM_TRD</a:Name>
<a:Code>T_COM_TRD</a:Code>
<a:Text>Create Trigger T_COM_TRD On T_COM
For Delete As
Begin
IF @@ROWCOUNT = 0 RETURN
SET NOCOUNT ON
/* Companhia Aérea»Chegadas: Comapanhia Aérea da Chegada (Restrict) */
If (Select Count(*) From T_CHG dep, Deleted pri
 Where dep.CD_COM = pri.CD_COM) &gt; 0
Begin
  RollBack Transaction
  RaisError 20003 &#39;Operação não executada: A informação que se deseja excluir da tabela &lt;Companhia Aérea&gt; está sendo referenciada na tabela &lt;Chegadas&gt;&#39;
  Return
End
/* Companhia Aérea»Chegadas - Mirror: Companhia Aérea da Chegada (Restrict) */
If (Select Count(*) From T_CHG_MIR dep, Deleted pri
 Where dep.CD_COM = pri.CD_COM) &gt; 0
Begin
  RollBack Transaction
  RaisError 20003 &#39;Operação não executada: A informação que se deseja excluir da tabela &lt;Companhia Aérea&gt; está sendo referenciada na tabela &lt;Chegadas - Mirror&gt;&#39;
  Return
End
/* Companhia Aérea»Partidas - Mirror: Companhia Aérea da Partida (Restrict) */
If (Select Count(*) From T_PAR_MIR dep, Deleted pri
 Where dep.CD_COM = pri.CD_COM) &gt; 0
Begin
  RollBack Transaction
  RaisError 20003 &#39;Operação não executada: A informação que se deseja excluir da tabela &lt;Companhia Aérea&gt; está sendo referenciada na tabela &lt;Partidas - Mirror&gt;&#39;
  Return
End
/* Companhia Aérea»Partidas: Companhia Aérea da Partida (Restrict) */
If (Select Count(*) From T_PAR dep, Deleted pri
 Where dep.CD_COM = pri.CD_COM) &gt; 0
Begin
  RollBack Transaction
  RaisError 20003 &#39;Operação não executada: A informação que se deseja excluir da tabela &lt;Companhia Aérea&gt; está sendo referenciada na tabela &lt;Partidas&gt;&#39;
  Return
End
/* Companhia Aérea»FIDS - IST Companhia: Companhia do ISC (Restrict) */
If (Select Count(*) From T_FIDS_ISC dep, Deleted pri
 Where dep.CD_COM = pri.CD_COM) &gt; 0
Begin
  RollBack Transaction
  RaisError 20003 &#39;Operação não executada: A informação que se deseja excluir da tabela &lt;Companhia Aérea&gt; está sendo referenciada na tabela &lt;FIDS - IST Companhia&gt;&#39;
  Return
End
/* Companhia Aérea»FIDS - Usuário do Grupo de Displays: DGT-COM:R (Restrict) */
If (Select Count(*) From T_FIDS_DGU dep, Deleted pri
 Where dep.CD_COM = pri.CD_COM) &gt; 0
Begin
  RollBack Transaction
  RaisError 20003 &#39;Operação não executada: A informação que se deseja excluir da tabela &lt;Companhia Aérea&gt; está sendo referenciada na tabela &lt;FIDS - Usuário do Grupo de Displays&gt;&#39;
  Return
End
/* Companhia Aérea»Hotran: É Companhia do Hotran (Restrict) */
If (Select Count(*) From T_HOT001 dep, Deleted pri
 Where dep.SG_COM = pri.SG_COM_IAT_003) &gt; 0
Begin
  RollBack Transaction
  RaisError 20003 &#39;Operação não executada: A informação que se deseja excluir da tabela &lt;Companhia Aérea&gt; está sendo referenciada na tabela &lt;Hotran&gt;&#39;
  Return
End
/* Companhia Aérea»Companhia Aérea: É Matriz de (Restrict) */
If (Select Count(*) From T_COM dep, Deleted pri
 Where dep.CD_COM_MAT = pri.CD_COM) &gt; 0
Begin
  RollBack Transaction
  RaisError 20003 &#39;Operação não executada: A informação que se deseja excluir da tabela &lt;Companhia Aérea&gt; está sendo referenciada na tabela &lt;Companhia Aérea&gt;&#39;
  Return
End
/* Companhia Aérea»Informante da Situação de Vôo: possui (Restrict) */
If (Select Count(*) From T_IFT dep, Deleted pri
 Where dep.CD_COM = pri.CD_COM) &gt; 0
Begin
  RollBack Transaction
  RaisError 20003 &#39;Operação não executada: A informação que se deseja excluir da tabela &lt;Companhia Aérea&gt; está sendo referenciada na tabela &lt;Informante da Situação de Vôo&gt;&#39;
  Return
End
/* Companhia Aérea»Tarifas Pagas no Bilhete: Se Relaciona (Restrict) */
If (Select Count(*) From T_TFB001 dep, Deleted pri
 Where dep.CD_COM = pri.CD_COM) &gt; 0
Begin
  RollBack Transaction
  RaisError 20003 &#39;Operação não executada: A informação que se deseja excluir da tabela &lt;Companhia Aérea&gt; está sendo referenciada na tabela &lt;Tarifas Pagas no Bilhete&gt;&#39;
  Return
End
/* Companhia Aérea»Tarifas Pagas no Bilhete - Mirror: Se relaciona (Restrict) */
If (Select Count(*) From T_TFB001_MIR dep, Deleted pri
 Where dep.CD_COM = pri.CD_COM) &gt; 0
Begin
  RollBack Transaction
  RaisError 20003 &#39;Operação não executada: A informação que se deseja excluir da tabela &lt;Companhia Aérea&gt; está sendo referenciada na tabela &lt;Tarifas Pagas no Bilhete - Mirror&gt;&#39;
  Return
End
/* Companhia Aérea»Boxes da Companhia Aérea: Boxes da Companhia Aérea (Cascade) */
Delete T_BCO From T_BCO dep, Deleted pri
 Where dep.CD_COM = pri.CD_COM
/* Companhia Aérea»Aeronave: Companh Aérea possui Aeronaves (Cascade) */
Delete T_AEN From T_AEN dep, Deleted pri
 Where dep.CD_COM = pri.CD_COM
/* Companhia Aérea»Checkin: Companhia Aér. possui Checkins (Cascade) */
Delete T_CHK From T_CHK dep, Deleted pri
 Where dep.CD_COM = pri.CD_COM
End
go</a:Text>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Trigger.Type>D</a:Trigger.Type>
</o:Trigger>
<o:Trigger Id="o263">
<a:ObjectID>6958B20F-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>T_COM_TRI</a:Name>
<a:Code>T_COM_TRI</a:Code>
<a:Text>Create Trigger T_COM_TRI On T_COM
For Insert As
Begin
IF @@ROWCOUNT = 0 RETURN
SET NOCOUNT ON
/* Companhia Aérea»Companhia Aérea: É Matriz de */
If (Select Count(*) From T_COM, Inserted
Where T_COM.CD_COM = Inserted.CD_COM_MAT)
 &lt;&gt;(Select Count(CD_COM_MAT) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Companhia Aérea&gt; que se deseja incluir na tabela &lt;Companhia Aérea&gt; não está cadastrada&#39;
  Return
End
/* Regra de negócio */
/* Verificar se há alguma situação que não seja do Grupo 1 nem do Grupo 2 */
IF (	SELECT	COUNT(*)
	FROM	INSERTED INS,
		T_COM COM
	WHERE	COM.CD_COM = INS.CD_COM AND
		INS.FL_COM_GR1 = 0 AND 
		INS.FL_COM_GR2 = 0) &gt; 0
BEGIN
	RAISERROR 20310 &#39;Operação não executada: Uma Companhia Aérea deve pertencer a pelo menos um Grupo .&#39;
	ROLLBACK TRANSACTION
	RETURN
END

/* Verificar se quando a companhia for do Grupo 1, existe sigla IATA-3 */
IF (	SELECT	COUNT(*)
	FROM	INSERTED INS,
		T_COM COM
	WHERE	COM.CD_COM = INS.CD_COM AND
		INS.FL_COM_GR1 = 1 AND 
		INS.SG_COM_IAT_003 = &#39;&#39;) &gt; 0
BEGIN
	RAISERROR 20310 &#39;Operação não executada: Uma Companhia Aérea do Grupo 1 deve possuir sigla IATA-3.&#39;
	ROLLBACK TRANSACTION
	RETURN
END

/* Verificar se quando a companhia for do Grupo 1, existe sigla IATA-2 */
IF (	SELECT	COUNT(*)
	FROM	INSERTED INS,
		T_COM COM
	WHERE	COM.CD_COM = INS.CD_COM AND
		INS.FL_COM_GR1 = 1 AND 
		INS.SG_COM_IAT_002 = &#39;&#39;) &gt; 0
BEGIN
	RAISERROR 20310 &#39;Operação não executada: Uma Companhia Aérea do Grupo 1 deve possuir sigla IATA-2.&#39;
	ROLLBACK TRANSACTION
	RETURN
END

/* Verificar se já existe alguma companhia cadastrada com a sigla IATA-3 da companhia que se está incluindo */
IF (	SELECT	COUNT(*)
	FROM	T_COM COM, 
		INSERTED INS
	WHERE	COM.CD_COM &lt;&gt; INS.CD_COM AND
		COM.SG_COM_IAT_003 = INS.SG_COM_IAT_003 AND
		INS.SG_COM_IAT_003 &lt;&gt; &#39;&#39;) &gt; 0
BEGIN
	RAISERROR 20310 &#39;Operação não executada: Já existe uma Companhia Áerea cadastrada com esta sigla IATA-3.&#39;
	ROLLBACK TRANSACTION
	RETURN
END


/* Verificar se já existe alguma companhia cadastrada com a sigla IATA-2 da companhia que se está incluindo */
IF (	SELECT	COUNT(*)
	FROM	T_COM COM, 
		INSERTED INS
	WHERE	COM.CD_COM &lt;&gt; INS.CD_COM AND
		COM.SG_COM_IAT_002 = INS.SG_COM_IAT_002 AND
		INS.SG_COM_IAT_002 &lt;&gt; &#39;&#39;) &gt; 0
BEGIN 
	RAISERROR 20310 &#39;Operação não executada: Já existe uma Companhia Áerea cadastrada com esta sigla IATA-2.&#39;
	ROLLBACK TRANSACTION
	RETURN
END

End
go</a:Text>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Trigger.Type>I</a:Trigger.Type>
</o:Trigger>
<o:Trigger Id="o264">
<a:ObjectID>6958B211-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>T_COM_TRU</a:Name>
<a:Code>T_COM_TRU</a:Code>
<a:Text>Create Trigger T_COM_TRU On T_COM
For Update As
Begin
IF @@ROWCOUNT = 0 RETURN
SET NOCOUNT ON
If Update (CD_COM)
Begin
  RollBack Transaction
  RaisError 20002 &#39;Operação não executada: A informação &lt;Código da Companhia Aérea&gt; da tabela &lt;Companhia Aérea&gt; não pode ser alterada.&#39;
  Return
End
If Update (CD_COM_MAT)
/* Companhia Aérea»Companhia Aérea: É Matriz de */
If (Select Count(*) From T_COM, Inserted
Where T_COM.CD_COM = Inserted.CD_COM_MAT)
 &lt;&gt;(Select Count(CD_COM_MAT) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Companhia Aérea&gt; que se deseja incluir na tabela &lt;Companhia Aérea&gt; não está cadastrada&#39;
  Return
End
/* Regra de negócio */
/* Verificar se há alguma Companhia que não seja do Grupo 1 nem do Grupo 2 */
IF (	SELECT	COUNT(*)
	FROM	INSERTED
	WHERE	FL_COM_GR1 = 0 AND FL_COM_GR2 = 0) &gt; 0
BEGIN
	RAISERROR 20310 &#39;Operação não executada: Uma Companhia Aérea deve pertencer a pelo menos um Grupo.&#39;
	ROLLBACK TRANSACTION
	RETURN
END

/* Verificar se quando a companhia for do Grupo 1, existe sigla IATA-3 */
IF (	SELECT	COUNT(*)
	FROM	INSERTED INS,
		T_COM COM
	WHERE	COM.CD_COM = INS.CD_COM AND
		INS.FL_COM_GR1 = 1 AND 
		INS.SG_COM_IAT_003 = &#39;&#39;) &gt; 0
BEGIN
	RAISERROR 20310 &#39;Operação não executada: Uma Companhia Aérea do Grupo 1 deve possuir sigla IATA-3.&#39;
	ROLLBACK TRANSACTION
	RETURN
END

/* Verificar se quando a companhia for do Grupo 1, existe sigla IATA-2 */
IF (	SELECT	COUNT(*)
	FROM	INSERTED INS,
		T_COM COM
	WHERE	COM.CD_COM = INS.CD_COM AND
		INS.FL_COM_GR1 = 1 AND 
		INS.SG_COM_IAT_002 = &#39;&#39;) &gt; 0
BEGIN
	RAISERROR 20310 &#39;Operação não executada: Uma Companhia Aérea do Grupo 1 deve possuir sigla IATA-2.&#39;
	ROLLBACK TRANSACTION
	RETURN
END

/* Não permitir que o campo SG_COM_IAT_003 seja alterado se existir alguma referência a esta sigla na tabela T_HOT001 */
IF UPDATE(SG_COM_IAT_003)
BEGIN
	IF (	SELECT	COUNT(*)
		FROM	DELETED DEL, T_HOT001 HOT
		WHERE	HOT.SG_COM = DEL.SG_COM_IAT_003) &gt; 0
	BEGIN 
		RAISERROR 20310 &#39;Operação não executada: A sigla IATA-3 dessa Companhia Aérea não pode ser alterada pois está sendo referenciada em pelo menos um Hotran.&#39;
		ROLLBACK TRANSACTION
		RETURN
	END
END

/* Verificar se já existe alguma companhia cadastrada com a sigla IATA-3 da companhia que se está alterando */
IF (	SELECT	COUNT(*)
	FROM	T_COM COM, 
		INSERTED INS
	WHERE	COM.CD_COM &lt;&gt; INS.CD_COM AND
		COM.SG_COM_IAT_003 = INS.SG_COM_IAT_003 AND
		INS.SG_COM_IAT_003 &lt;&gt; &#39;&#39;) &gt; 0
BEGIN
	RAISERROR 20310 &#39;Operação não executada: Já existe uma Companhia Áerea cadastrada com esta sigla IATA-3.&#39;
	ROLLBACK TRANSACTION
	RETURN
END

/* Verificar se já existe alguma companhia cadastrada com a sigla IATA-2 da companhia que se está alterando */
IF (	SELECT	COUNT(*)
	FROM	T_COM COM, 
		INSERTED INS
	WHERE	COM.CD_COM &lt;&gt; INS.CD_COM AND
		COM.SG_COM_IAT_002 = INS.SG_COM_IAT_002 AND
		INS.SG_COM_IAT_002 &lt;&gt; &#39;&#39;) &gt; 0
BEGIN 
	RAISERROR 20310 &#39;Operação não executada: Já existe uma Companhia Áerea cadastrada com esta sigla IATA-2.&#39;
	ROLLBACK TRANSACTION
	RETURN
END

IF UPDATE(SG_COM_IAT_003)
BEGIN
	/* Incluir Registros em T_ACH */
	INSERT	T_ACH (DH_ACH, CD_CHG)
	Select 	GETDATE(), CD_CHG
	From 	T_CHG CHG, INSERTED INS
	Where	CHG.TP_CHG_STA = 1 AND
		CHG.CD_AER = (Select CD_AER From T_PSI) AND
		CHG.CD_COM = INS.CD_COM

	/* Incluir Registros em T_APA */
	INSERT	T_APA (DH_APA, CD_PAR)
	Select 	GETDATE(), CD_PAR
	From 	T_PAR PAR, INSERTED INS
	Where	PAR.TP_PAR_STA = 1 AND
		PAR.CD_AER = (Select CD_AER From T_PSI) AND
		PAR.CD_COM = INS.CD_COM

	/* Incluir Registros em T_AHP - Chegadas */
	INSERT	T_AHP (CD_HPA, DH_AHP)
	Select 	DISTINCT CD_HPA, GETDATE()
	From 	T_HPA001 HPA, T_CHG CHG, T_SIT SIT, INSERTED INS
	Where	HPA.CD_CHG = CHG.CD_CHG AND
		SIT.CD_SIT = CHG.CD_SIT AND
		HPA.CD_AER = (Select CD_AER From T_PSI) AND
		(HPA.FL_HPA_ENT = 1 OR SIT.FL_SIT_AEN_PAT = 1) AND
		HPA.FL_HPA_SAI = 0 AND
		HPA.CD_AEN IS NOT NULL AND
		CHG.CD_COM = INS.CD_COM

	/* Incluir Registros em T_AHP - Partidas */
	INSERT	T_AHP (CD_HPA, DH_AHP)
	Select 	DISTINCT CD_HPA, GETDATE()
	From 	T_HPA001 HPA, T_CHG CHG, T_SIT SIT, T_PAR PAR, INSERTED INS
	Where	HPA.CD_CHG = CHG.CD_CHG AND
		SIT.CD_SIT = CHG.CD_SIT AND
		HPA.CD_AER = (Select CD_AER From T_PSI) AND
		(HPA.FL_HPA_ENT = 1 OR SIT.FL_SIT_AEN_PAT = 1) AND
		HPA.FL_HPA_SAI = 0 AND
		HPA.CD_AEN IS NOT NULL AND
		PAR.CD_CHG_AEN_ANT = HPA.CD_CHG AND
		PAR.CD_COM = INS.CD_COM

END
End
go</a:Text>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Trigger.Type>U</a:Trigger.Type>
</o:Trigger>
</c:Triggers>
<c:PrimaryKey>
<o:Key Ref="o253"/>
</c:PrimaryKey>
</o:Table>
</c:Object>
</o:TableSymbol>
</c:DestinationSymbol>
<c:Object>
<o:Reference Id="o265">
<a:ObjectID>6958B15A-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>Reference_14</a:Name>
<a:Code>REFERENCE_14</a:Code>
<a:CreationDate>1081543201</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543201</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Cardinality>0..*</a:Cardinality>
<a:UpdateConstraint>1</a:UpdateConstraint>
<a:DeleteConstraint>1</a:DeleteConstraint>
<c:Object1>
<o:Table Ref="o243"/>
</c:Object1>
<c:Object2>
<o:Table Ref="o39"/>
</c:Object2>
<c:ParentKey>
<o:Key Ref="o253"/>
</c:ParentKey>
<c:Joins>
<o:ReferenceJoin Id="o266">
<a:ObjectID>6958B15C-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543201</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543201</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<c:Object1>
<o:Column Ref="o244"/>
</c:Object1>
<c:Object2>
<o:Column Ref="o44"/>
</c:Object2>
</o:ReferenceJoin>
</c:Joins>
</o:Reference>
</c:Object>
</o:ReferenceSymbol>
<o:ReferenceSymbol Id="o267">
<a:CenterTextOffset>(1353, 450)</a:CenterTextOffset>
<a:Rect>((-743478,675150), (-735304,721200))</a:Rect>
<a:ListOfPoints>((-740744,721200),(-740744,675150))</a:ListOfPoints>
<a:ArrowStyle>4882</a:ArrowStyle>
<a:LineColor>8388736</a:LineColor>
<a:ShadowColor>12632256</a:ShadowColor>
<a:FontList>DISPNAME 0 arial,8,N</a:FontList>
<c:SourceSymbol>
<o:TableSymbol Ref="o158"/>
</c:SourceSymbol>
<c:DestinationSymbol>
<o:TableSymbol Ref="o242"/>
</c:DestinationSymbol>
<c:Object>
<o:Reference Id="o268">
<a:ObjectID>6958B15E-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>Reference_15</a:Name>
<a:Code>REFERENCE_15</a:Code>
<a:CreationDate>1081543201</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543201</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Cardinality>0..*</a:Cardinality>
<a:UpdateConstraint>1</a:UpdateConstraint>
<a:DeleteConstraint>1</a:DeleteConstraint>
<c:Object1>
<o:Table Ref="o243"/>
</c:Object1>
<c:Object2>
<o:Table Ref="o159"/>
</c:Object2>
<c:ParentKey>
<o:Key Ref="o253"/>
</c:ParentKey>
<c:Joins>
<o:ReferenceJoin Id="o269">
<a:ObjectID>6958B160-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543201</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543201</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<c:Object1>
<o:Column Ref="o244"/>
</c:Object1>
<c:Object2>
<o:Column Ref="o160"/>
</c:Object2>
</o:ReferenceJoin>
</c:Joins>
</o:Reference>
</c:Object>
</o:ReferenceSymbol>
<o:ReferenceSymbol Id="o270">
<a:CenterTextOffset>(3, 0)</a:CenterTextOffset>
<a:Rect>((-733667,685425), (-725793,695250))</a:Rect>
<a:ListOfPoints>((-726944,685425),(-731744,695250))</a:ListOfPoints>
<a:ArrowStyle>4882</a:ArrowStyle>
<a:LineColor>8388736</a:LineColor>
<a:ShadowColor>12632256</a:ShadowColor>
<a:FontList>DISPNAME 0 arial,8,N</a:FontList>
<c:SourceSymbol>
<o:TableSymbol Ref="o38"/>
</c:SourceSymbol>
<c:DestinationSymbol>
<o:TableSymbol Id="o271">
<a:Rect>((-735581,694148), (-728877,697748))</a:Rect>
<a:LineColor>8388736</a:LineColor>
<a:FillColor>16777215</a:FillColor>
<a:ShadowColor>12632256</a:ShadowColor>
<a:FontList>DISPNAME 0 arial,8,N
TableColumns 0 arial,8,N
TablePkColumns 0 arial,8,N
TableKeys 0 arial,8,N
TableIndexs 0 arial,8,N
TableTriggers 0 arial,8,N</a:FontList>
<c:Object>
<o:Table Id="o272">
<a:ObjectID>6958B13F-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>T_EQP</a:Name>
<a:Code>T_EQP</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<c:Columns>
<o:Column Id="o273">
<a:ObjectID>6958B1D2-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>CD_EQP</a:Name>
<a:Code>CD_EQP</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL1    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL1 As
@valor &gt; 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o274">
<a:ObjectID>6958B1D4-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>NM_EQP</a:Name>
<a:Code>NM_EQP</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>char(20)</a:DataType>
<a:Length>20</a:Length>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o275">
<a:ObjectID>6958B1D6-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>SG_EQP</a:Name>
<a:Code>SG_EQP</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>char(10)</a:DataType>
<a:Length>10</a:Length>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o276">
<a:ObjectID>6958B1D8-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>NR_EQP_ASS_MIN</a:Name>
<a:Code>NR_EQP_ASS_MIN</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>int</a:DataType>
</o:Column>
<o:Column Id="o277">
<a:ObjectID>6958B1DA-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>NR_EQP_ASS_MAX</a:Name>
<a:Code>NR_EQP_ASS_MAX</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>int</a:DataType>
</o:Column>
<o:Column Id="o278">
<a:ObjectID>6958B1DC-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>QT_EQP_CRG_MIN</a:Name>
<a:Code>QT_EQP_CRG_MIN</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>float(15)</a:DataType>
<a:Length>15</a:Length>
</o:Column>
<o:Column Id="o279">
<a:ObjectID>6958B1DE-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>QT_EQP_CRG_MAX</a:Name>
<a:Code>QT_EQP_CRG_MAX</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>float(15)</a:DataType>
<a:Length>15</a:Length>
</o:Column>
<o:Column Id="o280">
<a:ObjectID>6958B1E0-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>QT_EQP_PMD</a:Name>
<a:Code>QT_EQP_PMD</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>float(15)</a:DataType>
<a:Length>15</a:Length>
</o:Column>
<o:Column Id="o281">
<a:ObjectID>6958B1E2-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>QT_EQP_ENV</a:Name>
<a:Code>QT_EQP_ENV</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>float(15)</a:DataType>
<a:Length>15</a:Length>
</o:Column>
<o:Column Id="o282">
<a:ObjectID>6958B1E4-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>QT_EQP_COM</a:Name>
<a:Code>QT_EQP_COM</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>float(15)</a:DataType>
<a:Length>15</a:Length>
</o:Column>
<o:Column Id="o283">
<a:ObjectID>6958B1E6-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>FL_EQP_HLC</a:Name>
<a:Code>FL_EQP_HLC</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>tinyint</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o284">
<a:ObjectID>6958B1E8-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>TIMESTAMP</a:Name>
<a:Code>TIMESTAMP</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>timestamp</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
</c:Columns>
<c:Keys>
<o:Key Id="o285">
<a:ObjectID>6958B1F0-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>Pk_T_EQP</a:Name>
<a:Code>Pk_T_EQP</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:PhysicalOptions>
clustered</a:PhysicalOptions>
<a:ConstraintName>Pk_T_EQP</a:ConstraintName>
<c:Key.Columns>
<o:Column Ref="o273"/>
</c:Key.Columns>
</o:Key>
</c:Keys>
<c:Indexes>
<o:Index Id="o286">
<a:ObjectID>6958B1EC-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>I_EQP_SGL</a:Name>
<a:Code>I_EQP_SGL</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Unique>1</a:Unique>
<c:IndexColumns>
<o:IndexColumn Id="o287">
<a:ObjectID>6958B1EE-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:IndexColumn.Expression>&lt;Index Expression_0&gt;</a:IndexColumn.Expression>
<c:Column>
<o:Column Ref="o275"/>
</c:Column>
</o:IndexColumn>
</c:IndexColumns>
</o:Index>
</c:Indexes>
<c:Owner>
<o:User Ref="o34"/>
</c:Owner>
<c:Triggers>
<o:Trigger Id="o288">
<a:ObjectID>6958B22E-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>T_EQP_TRD</a:Name>
<a:Code>T_EQP_TRD</a:Code>
<a:Text>Create Trigger T_EQP_TRD On T_EQP
For Delete As
Begin
IF @@ROWCOUNT = 0 RETURN
SET NOCOUNT ON
/* Equipamento»Hotran - Etapa: É Equipamento da Etapa (Restrict) */
If (Select Count(*) From T_HET dep, Deleted pri
 Where dep.SG_EQP = pri.SG_EQP) &gt; 0
Begin
  RollBack Transaction
  RaisError 20003 &#39;Operação não executada: A informação que se deseja excluir da tabela &lt;Equipamento&gt; está sendo referenciada na tabela &lt;Hotran - Etapa&gt;&#39;
  Return
End
/* Equipamento»Aeronave: Equipamento (Restrict) */
If (Select Count(*) From T_AEN dep, Deleted pri
 Where dep.CD_EQP = pri.CD_EQP) &gt; 0
Begin
  RollBack Transaction
  RaisError 20003 &#39;Operação não executada: A informação que se deseja excluir da tabela &lt;Equipamento&gt; está sendo referenciada na tabela &lt;Aeronave&gt;&#39;
  Return
End
/* Equipamento»Chegadas - Mirror: Equipamento da Chegada (Restrict) */
If (Select Count(*) From T_CHG_MIR dep, Deleted pri
 Where dep.CD_EQP_CHG = pri.CD_EQP) &gt; 0
Begin
  RollBack Transaction
  RaisError 20003 &#39;Operação não executada: A informação que se deseja excluir da tabela &lt;Equipamento&gt; está sendo referenciada na tabela &lt;Chegadas - Mirror&gt;&#39;
  Return
End
/* Equipamento»Chegadas: Equipamento da Chegada (Restrict) */
If (Select Count(*) From T_CHG dep, Deleted pri
 Where dep.CD_EQP_CHG = pri.CD_EQP) &gt; 0
Begin
  RollBack Transaction
  RaisError 20003 &#39;Operação não executada: A informação que se deseja excluir da tabela &lt;Equipamento&gt; está sendo referenciada na tabela &lt;Chegadas&gt;&#39;
  Return
End
/* Equipamento»Hotran - Boxes: Equipamento do HBX (Restrict) */
If (Select Count(*) From T_HBX001 dep, Deleted pri
 Where dep.SG_EQP = pri.SG_EQP) &gt; 0
Begin
  RollBack Transaction
  RaisError 20003 &#39;Operação não executada: A informação que se deseja excluir da tabela &lt;Equipamento&gt; está sendo referenciada na tabela &lt;Hotran - Boxes&gt;&#39;
  Return
End
/* Equipamento»Histórico de Permanência de Aeronaves - Mirror: Equipamento do HPA (Restrict) */
If (Select Count(*) From T_HPA001_MIR dep, Deleted pri
 Where dep.CD_EQP = pri.CD_EQP) &gt; 0
Begin
  RollBack Transaction
  RaisError 20003 &#39;Operação não executada: A informação que se deseja excluir da tabela &lt;Equipamento&gt; está sendo referenciada na tabela &lt;Histórico de Permanência de Aeronaves - Mirror&gt;&#39;
  Return
End
/* Equipamento»Histórico de Permanência de Aeronaves: Equipamento do HPA (Restrict) */
If (Select Count(*) From T_HPA001 dep, Deleted pri
 Where dep.CD_EQP = pri.CD_EQP) &gt; 0
Begin
  RollBack Transaction
  RaisError 20003 &#39;Operação não executada: A informação que se deseja excluir da tabela &lt;Equipamento&gt; está sendo referenciada na tabela &lt;Histórico de Permanência de Aeronaves&gt;&#39;
  Return
End
/* Equipamento»Boxes do Equipamento: Boxes do Equipamento (Cascade) */
Delete T_BEQ From T_BEQ dep, Deleted pri
 Where dep.CD_EQP = pri.CD_EQP
End
go</a:Text>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Trigger.Type>D</a:Trigger.Type>
</o:Trigger>
<o:Trigger Id="o289">
<a:ObjectID>6958B230-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>T_EQP_TRU</a:Name>
<a:Code>T_EQP_TRU</a:Code>
<a:Text>Create Trigger T_EQP_TRU On T_EQP
For Update As
Begin
IF @@ROWCOUNT = 0 RETURN
SET NOCOUNT ON
If Update (CD_EQP)
Begin
  RollBack Transaction
  RaisError 20002 &#39;Operação não executada: A informação &lt;Código do Equipamento&gt; da tabela &lt;Equipamento&gt; não pode ser alterada.&#39;
  Return
End
/* Regra de negócio */
/* Caso a sigla do equipamento seja alterada, alterar os campos correspondente nas tabelas T_HBX001 e T_HET */
IF UPDATE(SG_EQP)
BEGIN
	UPDATE	HBX
	SET	SG_EQP = INS.SG_EQP
	FROM	T_HBX001 HBX, INSERTED INS, DELETED DEL
	WHERE	INS.CD_EQP = DEL.CD_EQP AND
		HBX.SG_EQP = DEL.SG_EQP

	UPDATE	HET
	SET	SG_EQP = INS.SG_EQP
	FROM	T_HET HET, INSERTED INS, DELETED DEL
	WHERE	INS.CD_EQP = DEL.CD_EQP AND
		HET.SG_EQP = DEL.SG_EQP
END

IF UPDATE(SG_EQP)
BEGIN
	/* Incluir Registros em T_ACH */
	INSERT	T_ACH (DH_ACH, CD_CHG)
	Select 	GETDATE(), CD_CHG
	From 	T_CHG CHG, T_EQP EQP, T_AEN AEN, INSERTED INS
	Where	CHG.TP_CHG_STA = 1 AND
		CHG.CD_AER = (Select CD_AER From T_PSI) AND
		AEN.CD_AEN = CHG.CD_AEN_CHG AND
		EQP.CD_EQP = AEN.CD_EQP AND
		EQP.CD_EQP = INS.CD_EQP

	/* Incluir Registros em T_APA */
	INSERT	T_APA (DH_APA, CD_PAR)
	Select 	GETDATE(), CD_PAR
	From 	T_PAR PAR, T_CHG CHG, T_EQP EQP, T_AEN AEN, INSERTED INS
	Where	PAR.TP_PAR_STA = 1 AND
		PAR.CD_AER = (Select CD_AER From T_PSI) AND
		CHG.CD_CHG = PAR.CD_CHG_AEN_ANT AND
		AEN.CD_AEN = CHG.CD_AEN_CHG AND
		EQP.CD_EQP = AEN.CD_EQP AND
		EQP.CD_EQP = INS.CD_EQP

	/* Incluir Registros em T_AHP */
	INSERT	T_AHP (CD_HPA, DH_AHP)
	Select	DISTINCT CD_HPA, GETDATE()
	From	T_HPA001 HPA, T_CHG CHG, T_SIT SIT, T_AEN AEN, T_EQP EQP, INSERTED INS
	Where	HPA.CD_CHG = CHG.CD_CHG AND
		SIT.CD_SIT = CHG.CD_SIT AND
		HPA.CD_AER = (Select CD_AER From T_PSI) AND
		(HPA.FL_HPA_ENT = 1 OR SIT.FL_SIT_AEN_PAT = 1) AND
		HPA.FL_HPA_SAI = 0 AND
		AEN.CD_AEN = HPA.CD_AEN AND
		EQP.CD_EQP = AEN.CD_EQP AND
		EQP.CD_EQP = INS.CD_EQP
END

End
go</a:Text>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Trigger.Type>U</a:Trigger.Type>
</o:Trigger>
</c:Triggers>
<c:PrimaryKey>
<o:Key Ref="o285"/>
</c:PrimaryKey>
</o:Table>
</c:Object>
</o:TableSymbol>
</c:DestinationSymbol>
<c:Object>
<o:Reference Id="o290">
<a:ObjectID>6958B164-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>Reference_17</a:Name>
<a:Code>REFERENCE_17</a:Code>
<a:CreationDate>1081543201</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543201</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Cardinality>0..*</a:Cardinality>
<a:UpdateConstraint>1</a:UpdateConstraint>
<a:DeleteConstraint>1</a:DeleteConstraint>
<c:Object1>
<o:Table Ref="o272"/>
</c:Object1>
<c:Object2>
<o:Table Ref="o39"/>
</c:Object2>
<c:ParentKey>
<o:Key Ref="o285"/>
</c:ParentKey>
<c:Joins>
<o:ReferenceJoin Id="o291">
<a:ObjectID>6958B166-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543201</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543201</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<c:Object1>
<o:Column Ref="o273"/>
</c:Object1>
<c:Object2>
<o:Column Ref="o45"/>
</c:Object2>
</o:ReferenceJoin>
</c:Joins>
</o:Reference>
</c:Object>
</o:ReferenceSymbol>
<o:ReferenceSymbol Id="o292">
<a:Rect>((-734605,695874), (-726731,708534))</a:Rect>
<a:ListOfPoints>((-727957,708534),(-733445,695874))</a:ListOfPoints>
<a:ArrowStyle>4882</a:ArrowStyle>
<a:LineColor>8388736</a:LineColor>
<a:ShadowColor>12632256</a:ShadowColor>
<a:FontList>DISPNAME 0 arial,8,N</a:FontList>
<c:SourceSymbol>
<o:TableSymbol Ref="o146"/>
</c:SourceSymbol>
<c:DestinationSymbol>
<o:TableSymbol Ref="o271"/>
</c:DestinationSymbol>
<c:Object>
<o:Reference Id="o293">
<a:ObjectID>6958B169-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>Reference_18</a:Name>
<a:Code>REFERENCE_18</a:Code>
<a:CreationDate>1081543201</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543201</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Cardinality>0..*</a:Cardinality>
<a:UpdateConstraint>1</a:UpdateConstraint>
<a:DeleteConstraint>1</a:DeleteConstraint>
<c:Object1>
<o:Table Ref="o272"/>
</c:Object1>
<c:Object2>
<o:Table Ref="o147"/>
</c:Object2>
<c:ParentKey>
<o:Key Ref="o285"/>
</c:ParentKey>
<c:Joins>
<o:ReferenceJoin Id="o294">
<a:ObjectID>6958B16C-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543201</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543201</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<c:Object1>
<o:Column Ref="o273"/>
</c:Object1>
<c:Object2>
<o:Column Ref="o148"/>
</c:Object2>
</o:ReferenceJoin>
</c:Joins>
</o:Reference>
</c:Object>
</o:ReferenceSymbol>
<o:ReferenceSymbol Id="o295">
<a:CenterTextOffset>(3, 0)</a:CenterTextOffset>
<a:Rect>((-721780,674149), (-714056,695876))</a:Rect>
<a:ListOfPoints>((-717826,695876),(-718023,674149))</a:ListOfPoints>
<a:ArrowStyle>4881</a:ArrowStyle>
<a:LineColor>8388736</a:LineColor>
<a:ShadowColor>12632256</a:ShadowColor>
<a:FontList>DISPNAME 0 arial,8,N</a:FontList>
<c:SourceSymbol>
<o:TableSymbol Ref="o6"/>
</c:SourceSymbol>
<c:DestinationSymbol>
<o:TableSymbol Id="o296">
<a:Rect>((-720085,672498), (-713459,677044))</a:Rect>
<a:LineColor>8388736</a:LineColor>
<a:FillColor>16777215</a:FillColor>
<a:ShadowColor>12632256</a:ShadowColor>
<a:FontList>DISPNAME 0 arial,8,N
TableColumns 0 arial,8,N
TablePkColumns 0 arial,8,N
TableKeys 0 arial,8,N
TableIndexs 0 arial,8,N
TableTriggers 0 arial,8,N</a:FontList>
<c:Object>
<o:Table Id="o297">
<a:ObjectID>6958B1AA-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>T_STA</a:Name>
<a:Code>T_STA</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<c:Columns>
<o:Column Id="o298">
<a:ObjectID>6958B266-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>CD_STA</a:Name>
<a:Code>CD_STA</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL1    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL1 As
@valor &gt; 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o299">
<a:ObjectID>6958B26A-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>DH_STA_ABE</a:Name>
<a:Code>DH_STA_ABE</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>smalldatetime</a:DataType>
</o:Column>
<o:Column Id="o300">
<a:ObjectID>6958B26C-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>MA_STA_ABE</a:Name>
<a:Code>MA_STA_ABE</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>smalldatetime</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o301">
<a:ObjectID>6958B26E-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>NR_STA</a:Name>
<a:Code>NR_STA</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL1    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL1 As
@valor &gt; 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
</o:Column>
<o:Column Id="o302">
<a:ObjectID>6958B26F-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>DH_STA_FEC</a:Name>
<a:Code>DH_STA_FEC</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>smalldatetime</a:DataType>
</o:Column>
<o:Column Id="o303">
<a:ObjectID>6958B272-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>MA_STA_FEC</a:Name>
<a:Code>MA_STA_FEC</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>smalldatetime</a:DataType>
</o:Column>
<o:Column Id="o304">
<a:ObjectID>6958B274-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>CD_STA_ANT</a:Name>
<a:Code>CD_STA_ANT</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL1    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL1 As
@valor &gt; 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
</o:Column>
<o:Column Id="o305">
<a:ObjectID>6958B277-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>TP_STA</a:Name>
<a:Code>TP_STA</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>tinyint</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o306">
<a:ObjectID>6958B27A-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>FL_STA_AEN_ISE</a:Name>
<a:Code>FL_STA_AEN_ISE</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>tinyint</a:DataType>
</o:Column>
<o:Column Id="o307">
<a:ObjectID>6958B27E-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>FL_STA_COM_TAR_RED</a:Name>
<a:Code>FL_STA_COM_TAR_RED</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>tinyint</a:DataType>
</o:Column>
<o:Column Id="o308">
<a:ObjectID>6958B281-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>QT_STA_PSI_ISE</a:Name>
<a:Code>QT_STA_PSI_ISE</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL1    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL1 As
@valor &gt; 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
</o:Column>
<o:Column Id="o309">
<a:ObjectID>6958B284-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>QT_STA_PSI_TAR_RED</a:Name>
<a:Code>QT_STA_PSI_TAR_RED</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL1    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL1 As
@valor &gt; 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
</o:Column>
<o:Column Id="o310">
<a:ObjectID>6958B286-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>TIMESTAMP</a:Name>
<a:Code>TIMESTAMP</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>timestamp</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
</c:Columns>
<c:Keys>
<o:Key Id="o311">
<a:ObjectID>6958B296-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>Pk_T_STA</a:Name>
<a:Code>Pk_T_STA</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:PhysicalOptions>
clustered</a:PhysicalOptions>
<a:ConstraintName>Pk_T_STA</a:ConstraintName>
<c:Key.Columns>
<o:Column Ref="o298"/>
</c:Key.Columns>
</o:Key>
</c:Keys>
<c:Indexes>
<o:Index Id="o312">
<a:ObjectID>6958B28A-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>I_STAABEDAT</a:Name>
<a:Code>I_STAABEDAT</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<c:IndexColumns>
<o:IndexColumn Id="o313">
<a:ObjectID>6958B28D-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:IndexColumn.Expression>&lt;Index Expression_0&gt;</a:IndexColumn.Expression>
<c:Column>
<o:Column Ref="o299"/>
</c:Column>
</o:IndexColumn>
</c:IndexColumns>
</o:Index>
<o:Index Id="o314">
<a:ObjectID>6958B28F-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>I_STAABEMES</a:Name>
<a:Code>I_STAABEMES</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<c:IndexColumns>
<o:IndexColumn Id="o315">
<a:ObjectID>6958B291-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:IndexColumn.Expression>&lt;Index Expression_0&gt;</a:IndexColumn.Expression>
<c:Column>
<o:Column Ref="o300"/>
</c:Column>
</o:IndexColumn>
<o:IndexColumn Id="o316">
<a:ObjectID>6958B292-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:IndexColumn.Expression>&lt;Index Expression_1&gt;</a:IndexColumn.Expression>
<c:Column>
<o:Column Ref="o301"/>
</c:Column>
</o:IndexColumn>
</c:IndexColumns>
</o:Index>
<o:Index Id="o317">
<a:ObjectID>6958B293-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>I_STAFECDAT</a:Name>
<a:Code>I_STAFECDAT</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<c:IndexColumns>
<o:IndexColumn Id="o318">
<a:ObjectID>6958B294-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:IndexColumn.Expression>&lt;Index Expression_0&gt;</a:IndexColumn.Expression>
<c:Column>
<o:Column Ref="o302"/>
</c:Column>
</o:IndexColumn>
</c:IndexColumns>
</o:Index>
</c:Indexes>
<c:Owner>
<o:User Ref="o34"/>
</c:Owner>
<c:Triggers>
<o:Trigger Id="o319">
<a:ObjectID>6958B1EF-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>T_STA_TRD</a:Name>
<a:Code>T_STA_TRD</a:Code>
<a:Text>Create Trigger T_STA_TRD On T_STA
For Delete As
Begin
IF @@ROWCOUNT = 0 RETURN
SET NOCOUNT ON
/* Status de Aeronave»Histórico de Permanência de Aeronaves: Status de HPA (Restrict) */
If (Select Count(*) From T_HPA001 dep, Deleted pri
 Where dep.CD_STA = pri.CD_STA) &gt; 0
Begin
  RollBack Transaction
  RaisError 20003 &#39;Operação não executada: A informação que se deseja excluir da tabela &lt;Status de Aeronave&gt; está sendo referenciada na tabela &lt;Histórico de Permanência de Aeronaves&gt;&#39;
  Return
End
/* Regra de negócio */
 
End
go</a:Text>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Trigger.Type>D</a:Trigger.Type>
</o:Trigger>
<o:Trigger Id="o320">
<a:ObjectID>6958B1F1-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>T_STA_TRI</a:Name>
<a:Code>T_STA_TRI</a:Code>
<a:Text>Create Trigger T_STA_TRI On T_STA
For Insert As
Begin
IF @@ROWCOUNT = 0 RETURN
SET NOCOUNT ON
/* Domínio de: Tipo de Status */
/* 1 - Em aberto */
/* 2 - Fechado */
/* 3 - Cancelado */
If (Select Count(*) From Inserted
    Where TP_STA In (1,2,3))
 &lt;&gt;(Select Count(*) From Inserted)
Begin
  RollBack Transaction
  RaisError 20004 &#39;Operação não executada: A informação &lt;Tipo de Status&gt; que se deseja incluir na tabela &lt;Status de Aeronave&gt; não é uma opção válida&#39;
  Return
End
/* Regra de negócio */
 
End
go</a:Text>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Trigger.Type>I</a:Trigger.Type>
</o:Trigger>
<o:Trigger Id="o321">
<a:ObjectID>6958B1F3-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>T_STA_TRU</a:Name>
<a:Code>T_STA_TRU</a:Code>
<a:Text>Create Trigger T_STA_TRU On T_STA
For Update As
Begin
IF @@ROWCOUNT = 0 RETURN
SET NOCOUNT ON
If Update (CD_STA)
Begin
  RollBack Transaction
  RaisError 20002 &#39;Operação não executada: A informação &lt;Código do Status&gt; da tabela &lt;Status de Aeronave&gt; não pode ser alterada.&#39;
  Return
End
If Update (TP_STA)
/* Domínio de: Tipo de Status */
/* 1 - Em aberto */
/* 2 - Fechado */
/* 3 - Cancelado */
If (Select Count(*) From Inserted
    Where TP_STA In (1,2,3))
 &lt;&gt;(Select Count(*) From Inserted)
Begin
  RollBack Transaction
  RaisError 20004 &#39;Operação não executada: A informação &lt;Tipo de Status&gt; que se deseja incluir na tabela &lt;Status de Aeronave&gt; não é uma opção válida&#39;
  Return
End
/* Regra de negócio */
/* Milena (26/05/98) - Só permitir alteração nos dados de um Status Fechado se for o último Status */
IF UPDATE (DH_STA_ABE) OR UPDATE(MA_STA_ABE) OR UPDATE(NR_STA) OR UPDATE(DH_STA_FEC) OR 
	UPDATE(MA_STA_FEC) OR UPDATE(CD_STA_ANT) OR UPDATE(TP_STA)
BEGIN
	IF (	SELECT 	COUNT(*)
		FROM	INSERTED INS, DELETED DEL
		WHERE	INS.CD_STA = DEL.CD_STA AND
			DEL.TP_STA = 2 AND
			INS.CD_STA &lt;&gt; (	SELECT	CD_STA
					FROM	T_HPA001 HPA
					WHERE 	HPA.CD_HPA = (SELECT DISTINCT CD_HPA FROM T_HPA001 WHERE CD_STA = INS.CD_STA) AND
						HPA.NR_HPA_SEQ = (SELECT MAX(NR_HPA_SEQ) FROM T_HPA001 WHERE CD_HPA = HPA.CD_HPA))) &gt; 0
	BEGIN
		RAISERROR 20999 &#39;Operação não executada: Os dados de um Status Fechado só podem ser alterados se esse Status for o último.&#39;
		ROLLBACK TRANSACTION
		RETURN
	END
END

/* RONALDO - Fechamento do STATUS */
IF UPDATE(TP_STA)
BEGIN
	/* Verificar se há algum status que tenha sido passado para Aberto ou Fechado e que, antes, estava Cancelado */
	IF (SELECT COUNT(*) FROM INSERTED INS, DELETED DEL
		WHERE 	DEL.CD_STA = INS.CD_STA AND
			DEL.TP_STA = 3 AND
			INS.TP_STA IN (1, 2)) &gt; 0
	BEGIN
		RAISERROR 20999 &#39;Operação não executada: Um STATUS cancelado não pode passar para Aberto ou Fechado&#39;
		ROLLBACK TRANSACTION
		RETURN
	END

	/* Verificar se há algum status que tenha sido fechado sem a conclusão da partida, antes da data máxima de fechamento */
	IF (SELECT COUNT(*) FROM	INSERTED INS, DELETED DEL, T_HPA001 HPA
		WHERE	HPA.CD_STA = INS.CD_STA AND
			HPA.NR_HPA_SEQ = (SELECT MAX(NR_HPA_SEQ) FROM T_HPA001 HPA1 WHERE HPA1.CD_HPA = HPA.CD_HPA) AND
			DEL.CD_STA = INS.CD_STA AND
			INS.TP_STA = 2 AND
			DEL.TP_STA = 1 AND
			HPA.FL_HPA_SAI = 0 AND
			DATEADD(SS,  - DATEPART(SS, DATEADD(MM, 1, INS.DH_STA_ABE)) - 60*DATEPART(MI, DATEADD(MM, 1, INS.DH_STA_ABE)) - 60*60*DATEPART(HH, DATEADD(MM, 1, INS.DH_STA_ABE)), DATEADD(MM, 1, INS.DH_STA_ABE)) &gt; GETDATE() ) &gt; 0
	BEGIN
		RAISERROR 20999 &#39;Operação não executada: Um STATUS só pode ser fechado sem a conclusão do vôo, numa data igual ou posterior à data máxima de fechamento.&#39;
		ROLLBACK TRANSACTION
		RETURN
	END

	/* Criar um cursor com todos os STATUS que tenham sido fechados e que, antes, estavam abertos */
	DECLARE FECHAR_STATUS CURSOR FOR
		SELECT	INS.CD_STA,
			INS.DH_STA_ABE,
			INS.FL_STA_AEN_ISE,
			INS.FL_STA_COM_TAR_RED,
			INS.QT_STA_PSI_ISE,
			INS.QT_STA_PSI_TAR_RED,
			HPA.CD_HPA,
			HPA.NR_HPA_SEQ,
			HPA.CD_AER,
			HPA.CD_EQP,
			HPA.CD_AEN,
			HPA.CD_BOX,
			HPA.CD_CHG,
			HPA.CD_PAR,
			HPA.DH_HPA_SAI,
			HPA.FL_HPA_ENT
		FROM	INSERTED INS,
			DELETED DEL,
			T_HPA001 HPA
		WHERE	HPA.CD_STA = INS.CD_STA AND
			HPA.NR_HPA_SEQ = (SELECT MAX(NR_HPA_SEQ) FROM T_HPA001 HPA1 WHERE HPA1.CD_HPA = HPA.CD_HPA) AND
			DEL.CD_STA = INS.CD_STA AND
			INS.TP_STA = 2 AND
			DEL.TP_STA = 1 AND
			HPA.FL_HPA_SAI = 0

	/* Declaração de variáveis */
	DECLARE	@CD_STA 	INT,
			@DH_STA_ABE	SMALLDATETIME,
			@FL_STA_AEN_ISE             TINYINT,
			@FL_STA_COM_TAR_RED	TINYINT,
			@QT_STA_PSI_ISE	INT,
			@QT_STA_PSI_TAR_RED 	INT,
			@CD_HPA	INT,
			@NR_HPA_SEQ	INT,
			@CD_AER	INT,
			@CD_EQP	INT,
			@CD_AEN	INT,
			@CD_BOX	INT,
			@CD_CHG	INT,
			@CD_PAR	INT,
			@DH_HPA_SAI	SMALLDATETIME,
			@FL_HPA_ENT	BIT,
			@CD_STA_POS	INT,
			@DH_STA_FEC	SMALLDATETIME,
			@MA_STA_FEC	SMALLDATETIME

	/* Abrir cursor */
	OPEN FECHAR_STATUS

	/* Ir para o primeiro registro */
	FETCH	FECHAR_STATUS
	INTO	@CD_STA,
		@DH_STA_ABE,
		@FL_STA_AEN_ISE,
		@FL_STA_COM_TAR_RED,
		@QT_STA_PSI_ISE,
		@QT_STA_PSI_TAR_RED,
		@CD_HPA,
		@NR_HPA_SEQ,
		@CD_AER,
		@CD_EQP,
		@CD_AEN,
		@CD_BOX,
		@CD_CHG,
		@CD_PAR,
		@DH_HPA_SAI,
		@FL_HPA_ENT

	/* Processar todos os registros de FECHAR_CURSOR */
	WHILE @@FETCH_STATUS = 0
	BEGIN

		/* Determinar a data e o mês de fechamento */
		SELECT  @DH_STA_FEC = DATEADD(MM, 1, @DH_STA_ABE)
		SELECT  @MA_STA_FEC = DATEADD(SS, -DATEPART(SS, @DH_STA_FEC) - 60*DATEPART(MI, @DH_STA_FEC) - 60*60*DATEPART(HH, @DH_STA_FEC) - 24*60*60*DATEPART(DD, @DH_STA_FEC) + 24*60*60, @DH_STA_FEC)

		/* Atualizar o STATUS fechado */

		UPDATE	T_STA
		SET	DH_STA_FEC = @DH_STA_FEC,
			MA_STA_FEC = @MA_STA_FEC
		WHERE	CD_STA = @CD_STA

		/* Identificar o próximo número de STATUS disponível */
		SELECT @CD_STA_POS = (SELECT MAX(CD_STA) + 1 FROM T_STA)

		/* Incluir um novo status */
		INSERT	INTO T_STA (
			CD_STA,
			DH_STA_ABE,
			MA_STA_ABE,
			NR_STA,
			CD_STA_ANT,
			TP_STA,
			FL_STA_AEN_ISE,
			FL_STA_COM_TAR_RED,
			QT_STA_PSI_ISE,
			QT_STA_PSI_TAR_RED)
		SELECT 	@CD_STA_POS,
			@DH_STA_FEC,
			@MA_STA_FEC,
			(SELECT ISNULL(MAX(NR_STA), 0) + 1 FROM T_STA WHERE MA_STA_ABE = @MA_STA_FEC),
			@CD_STA,
			1,
			@FL_STA_AEN_ISE,
			@FL_STA_COM_TAR_RED,
			@QT_STA_PSI_ISE,
			@QT_STA_PSI_TAR_RED
		/* Incluir um novo registro em HPA */
		INSERT	T_HPA001 (
			CD_HPA,
			NR_HPA_SEQ,
			CD_AER,
			CD_EQP,
			CD_AEN,
			CD_BOX,
			CD_CHG,
			DH_HPA_ENT,
			CD_PAR,
			DH_HPA_SAI,
			FL_HPA_ENT,
			CD_STA)
		VALUES	(
			@CD_HPA,
			@NR_HPA_SEQ + 1,
			@CD_AER,
			@CD_EQP,
			@CD_AEN,
			@CD_BOX,
			@CD_CHG,
			@DH_STA_FEC,
			@CD_PAR,
			@DH_HPA_SAI,
			1,
			@CD_STA_POS)

		/* Ir para o próximo registro */
		FETCH	NEXT FROM FECHAR_STATUS
		INTO	@CD_STA,
			@DH_STA_ABE,
			@FL_STA_AEN_ISE,
			@FL_STA_COM_TAR_RED,
			@QT_STA_PSI_ISE,
			@QT_STA_PSI_TAR_RED,
			@CD_HPA,
			@NR_HPA_SEQ,
			@CD_AER,
			@CD_EQP,
			@CD_AEN,
			@CD_BOX,
			@CD_CHG,
			@CD_PAR,
			@DH_HPA_SAI,
			@FL_HPA_ENT

	END
	CLOSE FECHAR_STATUS
	DEALLOCATE FECHAR_STATUS

END
End
go</a:Text>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Trigger.Type>U</a:Trigger.Type>
</o:Trigger>
</c:Triggers>
<c:PrimaryKey>
<o:Key Ref="o311"/>
</c:PrimaryKey>
</o:Table>
</c:Object>
</o:TableSymbol>
</c:DestinationSymbol>
<c:Object>
<o:Reference Id="o322">
<a:ObjectID>6958B173-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>Reference_20</a:Name>
<a:Code>REFERENCE_20</a:Code>
<a:CreationDate>1081543201</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543201</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Cardinality>0..*</a:Cardinality>
<a:UpdateConstraint>1</a:UpdateConstraint>
<a:DeleteConstraint>1</a:DeleteConstraint>
<c:Object1>
<o:Table Ref="o297"/>
</c:Object1>
<c:Object2>
<o:Table Ref="o7"/>
</c:Object2>
<c:ParentKey>
<o:Key Ref="o311"/>
</c:ParentKey>
<c:Joins>
<o:ReferenceJoin Id="o323">
<a:ObjectID>6958B175-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543201</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543201</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<c:Object1>
<o:Column Ref="o298"/>
</c:Object1>
<c:Object2>
<o:Column Ref="o21"/>
</c:Object2>
</o:ReferenceJoin>
</c:Joins>
</o:Reference>
</c:Object>
</o:ReferenceSymbol>
<o:ReferenceSymbol Id="o324">
<a:CenterTextOffset>(-298, -1350)</a:CenterTextOffset>
<a:Rect>((-705065,706673), (-695541,719073))</a:Rect>
<a:ListOfPoints>((-699977,706673),(-700025,719073))</a:ListOfPoints>
<a:ArrowStyle>4882</a:ArrowStyle>
<a:LineColor>8388736</a:LineColor>
<a:ShadowColor>12632256</a:ShadowColor>
<a:FontList>DISPNAME 0 arial,8,N</a:FontList>
<c:SourceSymbol>
<o:TableSymbol Ref="o119"/>
</c:SourceSymbol>
<c:DestinationSymbol>
<o:TableSymbol Ref="o128"/>
</c:DestinationSymbol>
<c:Object>
<o:Reference Id="o325">
<a:ObjectID>6958B259-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>Reference_20</a:Name>
<a:Code>REFERENCE_20</a:Code>
<a:CreationDate>1081700855</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081700867</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Cardinality>0..*</a:Cardinality>
<a:UpdateConstraint>1</a:UpdateConstraint>
<a:DeleteConstraint>1</a:DeleteConstraint>
<c:Object1>
<o:Table Ref="o129"/>
</c:Object1>
<c:Object2>
<o:Table Ref="o120"/>
</c:Object2>
<c:Joins>
<o:ReferenceJoin Id="o326">
<a:ObjectID>6958B25D-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081700867</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081700867</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<c:Object1>
<o:Column Ref="o130"/>
</c:Object1>
<c:Object2>
<o:Column Ref="o122"/>
</c:Object2>
</o:ReferenceJoin>
</c:Joins>
</o:Reference>
</c:Object>
</o:ReferenceSymbol>
<o:ReferenceSymbol Id="o327">
<a:CenterTextOffset>(7, 0)</a:CenterTextOffset>
<a:Rect>((-717243,685961), (-699125,695400))</a:Rect>
<a:ListOfPoints>((-717243,695400),(-699125,685961))</a:ListOfPoints>
<a:ArrowStyle>4881</a:ArrowStyle>
<a:LineColor>8388736</a:LineColor>
<a:ShadowColor>12632256</a:ShadowColor>
<a:FontList>DISPNAME 0 arial,8,N</a:FontList>
<c:SourceSymbol>
<o:TableSymbol Ref="o6"/>
</c:SourceSymbol>
<c:DestinationSymbol>
<o:TableSymbol Id="o328">
<a:Rect>((-702438,683688), (-695812,688234))</a:Rect>
<a:LineColor>8388736</a:LineColor>
<a:FillColor>16777215</a:FillColor>
<a:ShadowColor>12632256</a:ShadowColor>
<a:FontList>DISPNAME 0 arial,8,N
TableColumns 0 arial,8,N
TablePkColumns 0 arial,8,N
TableKeys 0 arial,8,N
TableIndexs 0 arial,8,N
TableTriggers 0 arial,8,N</a:FontList>
<c:Object>
<o:Table Id="o329">
<a:ObjectID>6958B197-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>T_PAR</a:Name>
<a:Code>T_PAR</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081701141</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<c:Columns>
<o:Column Id="o330">
<a:ObjectID>6958B213-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>CD_PAR</a:Name>
<a:Code>CD_PAR</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL1    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL1 As
@valor &gt; 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o331">
<a:ObjectID>6958B214-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>DT_PAR</a:Name>
<a:Code>DT_PAR</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_DAT    Script Date: 7/8/2000 12:14:35 ******/
Create Rule        RU_DAT As
DATEPART(hh,@data) = 0 AND
DATEPART(mi,@data) = 0 AND
DATEPART(ss,@data) = 0 AND
DATEPART(ms,@data) = 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>smalldatetime</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o332">
<a:ObjectID>6958B215-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>NR_PAR_VOO</a:Name>
<a:Code>NR_PAR_VOO</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>char(10)</a:DataType>
<a:Length>10</a:Length>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o333">
<a:ObjectID>6958B216-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>NR_PAR_HOT</a:Name>
<a:Code>NR_PAR_HOT</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>char(9)</a:DataType>
<a:Length>9</a:Length>
</o:Column>
<o:Column Id="o334">
<a:ObjectID>6958B217-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>TP_PAR_GRU</a:Name>
<a:Code>TP_PAR_GRU</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DefaultValue>/****** Object:  Default dbo.DF_VAL_001    Script Date: 7/8/2000 12:14:36 ******/
Create Default        DF_VAL_001 As
1</a:DefaultValue>
<a:DataType>tinyint</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o335">
<a:ObjectID>6958B218-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>TP_PAR</a:Name>
<a:Code>TP_PAR</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>tinyint</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o336">
<a:ObjectID>6958B21A-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>TP_PAR_NAT</a:Name>
<a:Code>TP_PAR_NAT</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>tinyint</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o337">
<a:ObjectID>6958B21C-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>TP_PAR_CTG</a:Name>
<a:Code>TP_PAR_CTG</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>tinyint</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o338">
<a:ObjectID>6958B21F-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>CD_CHG_ANT</a:Name>
<a:Code>CD_CHG_ANT</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL1    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL1 As
@valor &gt; 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
</o:Column>
<o:Column Id="o339">
<a:ObjectID>6958B220-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>CD_CHG_AEN_ANT</a:Name>
<a:Code>CD_CHG_AEN_ANT</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL1    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL1 As
@valor &gt; 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
</o:Column>
<o:Column Id="o340">
<a:ObjectID>6958B222-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>CD_PAR_VIN</a:Name>
<a:Code>CD_PAR_VIN</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL1    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL1 As
@valor &gt; 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
</o:Column>
<o:Column Id="o341">
<a:ObjectID>6958B224-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>FL_PAR_ANU</a:Name>
<a:Code>FL_PAR_ANU</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>bit</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o342">
<a:ObjectID>6958B225-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>FL_PAR_TEL</a:Name>
<a:Code>FL_PAR_TEL</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>bit</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o343">
<a:ObjectID>6958B226-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>DH_PAR_NRM</a:Name>
<a:Code>DH_PAR_NRM</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>smalldatetime</a:DataType>
</o:Column>
<o:Column Id="o344">
<a:ObjectID>6958B227-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>DH_PAR_EFE</a:Name>
<a:Code>DH_PAR_EFE</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>smalldatetime</a:DataType>
</o:Column>
<o:Column Id="o345">
<a:ObjectID>6958B228-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>DH_PAR_EST</a:Name>
<a:Code>DH_PAR_EST</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>smalldatetime</a:DataType>
</o:Column>
<o:Column Id="o346">
<a:ObjectID>6958B229-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>CD_SIT</a:Name>
<a:Code>CD_SIT</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL1    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL1 As
@valor &gt; 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
</o:Column>
<o:Column Id="o347">
<a:ObjectID>6958B22A-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>NM_PAR_COM_SIT</a:Name>
<a:Code>NM_PAR_COM_SIT</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>varchar(30)</a:DataType>
<a:Length>30</a:Length>
</o:Column>
<o:Column Id="o348">
<a:ObjectID>6958B22B-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>DH_PAR_SIT</a:Name>
<a:Code>DH_PAR_SIT</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>smalldatetime</a:DataType>
</o:Column>
<o:Column Id="o349">
<a:ObjectID>6958B22C-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>CD_POR</a:Name>
<a:Code>CD_POR</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL1    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL1 As
@valor &gt; 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
</o:Column>
<o:Column Id="o350">
<a:ObjectID>6958B22D-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>FL_PAR_CAN</a:Name>
<a:Code>FL_PAR_CAN</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DefaultValue>/****** Object:  Default dbo.DF_VAL_ZRO    Script Date: 7/8/2000 12:14:36 ******/
Create Default        DF_VAL_ZRO As
0</a:DefaultValue>
<a:DataType>bit</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
<o:Column Id="o351">
<a:ObjectID>6958B22F-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>TP_PAR_STA</a:Name>
<a:Code>TP_PAR_STA</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>tinyint</a:DataType>
</o:Column>
<o:Column Id="o352">
<a:ObjectID>6958B231-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>CD_IFT</a:Name>
<a:Code>CD_IFT</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL1    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL1 As
@valor &gt; 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
</o:Column>
<o:Column Id="o353">
<a:ObjectID>6958B232-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>CD_USR</a:Name>
<a:Code>CD_USR</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:ServerCheckExpression>/****** Object:  Rule dbo.RU_VL1    Script Date: 7/8/2000 12:14:36 ******/
Create Rule        RU_VL1 As
@valor &gt; 0 and %MINMAX% and %LISTVAL% and %RULES%</a:ServerCheckExpression>
<a:DataType>int</a:DataType>
</o:Column>
<o:Column Id="o354">
<a:ObjectID>6958B233-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>TIMESTAMP</a:Name>
<a:Code>TIMESTAMP</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:DataType>timestamp</a:DataType>
<a:Mandatory>1</a:Mandatory>
</o:Column>
</c:Columns>
<c:Keys>
<o:Key Id="o355">
<a:ObjectID>6958B263-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>Pk_T_PAR</a:Name>
<a:Code>Pk_T_PAR</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:PhysicalOptions>
clustered</a:PhysicalOptions>
<a:ConstraintName>Pk_T_PAR</a:ConstraintName>
<c:Key.Columns>
<o:Column Ref="o330"/>
</c:Key.Columns>
</o:Key>
</c:Keys>
<c:Indexes>
<o:Index Id="o356">
<a:ObjectID>6958B234-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>I_PAR_EFE</a:Name>
<a:Code>I_PAR_EFE</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Unique>1</a:Unique>
<c:IndexColumns>
<o:IndexColumn Id="o357">
<a:ObjectID>6958B235-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:IndexColumn.Expression>&lt;Index Expression_0&gt;</a:IndexColumn.Expression>
<c:Column>
<o:Column Ref="o351"/>
</c:Column>
</o:IndexColumn>
<o:IndexColumn Id="o358">
<a:ObjectID>6958B236-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:IndexColumn.Expression>&lt;Index Expression_1&gt;</a:IndexColumn.Expression>
<c:Column>
<o:Column Ref="o344"/>
</c:Column>
</o:IndexColumn>
<o:IndexColumn Id="o359">
<a:ObjectID>6958B237-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:IndexColumn.Expression>&lt;Index Expression_2&gt;</a:IndexColumn.Expression>
<c:Column>
<o:Column Ref="o330"/>
</c:Column>
</o:IndexColumn>
</c:IndexColumns>
</o:Index>
<o:Index Id="o360">
<a:ObjectID>6958B238-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>I_PAR_GRU</a:Name>
<a:Code>I_PAR_GRU</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Unique>1</a:Unique>
<c:IndexColumns>
<o:IndexColumn Id="o361">
<a:ObjectID>6958B23A-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:IndexColumn.Expression>&lt;Index Expression_0&gt;</a:IndexColumn.Expression>
<c:Column>
<o:Column Ref="o351"/>
</c:Column>
</o:IndexColumn>
<o:IndexColumn Id="o362">
<a:ObjectID>6958B23C-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:IndexColumn.Expression>&lt;Index Expression_1&gt;</a:IndexColumn.Expression>
<c:Column>
<o:Column Ref="o334"/>
</c:Column>
</o:IndexColumn>
<o:IndexColumn Id="o363">
<a:ObjectID>6958B23E-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:IndexColumn.Expression>&lt;Index Expression_2&gt;</a:IndexColumn.Expression>
<c:Column>
<o:Column Ref="o330"/>
</c:Column>
</o:IndexColumn>
</c:IndexColumns>
</o:Index>
<o:Index Id="o364">
<a:ObjectID>6958B240-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>I_PAR_POR</a:Name>
<a:Code>I_PAR_POR</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Unique>1</a:Unique>
<c:IndexColumns>
<o:IndexColumn Id="o365">
<a:ObjectID>6958B242-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:IndexColumn.Expression>&lt;Index Expression_0&gt;</a:IndexColumn.Expression>
<c:Column>
<o:Column Ref="o351"/>
</c:Column>
</o:IndexColumn>
<o:IndexColumn Id="o366">
<a:ObjectID>6958B244-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:IndexColumn.Expression>&lt;Index Expression_1&gt;</a:IndexColumn.Expression>
<c:Column>
<o:Column Ref="o349"/>
</c:Column>
</o:IndexColumn>
<o:IndexColumn Id="o367">
<a:ObjectID>6958B246-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:IndexColumn.Expression>&lt;Index Expression_2&gt;</a:IndexColumn.Expression>
<c:Column>
<o:Column Ref="o330"/>
</c:Column>
</o:IndexColumn>
</c:IndexColumns>
</o:Index>
<o:Index Id="o368">
<a:ObjectID>6958B248-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>I_PAR_STA</a:Name>
<a:Code>I_PAR_STA</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Unique>1</a:Unique>
<c:IndexColumns>
<o:IndexColumn Id="o369">
<a:ObjectID>6958B24A-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:IndexColumn.Expression>&lt;Index Expression_0&gt;</a:IndexColumn.Expression>
<c:Column>
<o:Column Ref="o351"/>
</c:Column>
</o:IndexColumn>
<o:IndexColumn Id="o370">
<a:ObjectID>6958B24B-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:IndexColumn.Expression>&lt;Index Expression_1&gt;</a:IndexColumn.Expression>
<c:Column>
<o:Column Ref="o330"/>
</c:Column>
</o:IndexColumn>
</c:IndexColumns>
</o:Index>
<o:Index Id="o371">
<a:ObjectID>6958B24C-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>I_PAR_STA_DAT</a:Name>
<a:Code>I_PAR_STA_DAT</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Unique>1</a:Unique>
<c:IndexColumns>
<o:IndexColumn Id="o372">
<a:ObjectID>6958B24E-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:IndexColumn.Expression>&lt;Index Expression_0&gt;</a:IndexColumn.Expression>
<c:Column>
<o:Column Ref="o351"/>
</c:Column>
</o:IndexColumn>
<o:IndexColumn Id="o373">
<a:ObjectID>6958B250-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:IndexColumn.Expression>&lt;Index Expression_1&gt;</a:IndexColumn.Expression>
<c:Column>
<o:Column Ref="o331"/>
</c:Column>
</o:IndexColumn>
<o:IndexColumn Id="o374">
<a:ObjectID>6958B252-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:IndexColumn.Expression>&lt;Index Expression_2&gt;</a:IndexColumn.Expression>
<c:Column>
<o:Column Ref="o330"/>
</c:Column>
</o:IndexColumn>
</c:IndexColumns>
</o:Index>
<o:Index Id="o375">
<a:ObjectID>6958B254-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>I_PAR_AEN_ANT</a:Name>
<a:Code>I_PAR_AEN_ANT</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<c:IndexColumns>
<o:IndexColumn Id="o376">
<a:ObjectID>6958B256-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:IndexColumn.Expression>&lt;Index Expression_0&gt;</a:IndexColumn.Expression>
<c:Column>
<o:Column Ref="o339"/>
</c:Column>
</o:IndexColumn>
</c:IndexColumns>
</o:Index>
<o:Index Id="o377">
<a:ObjectID>6958B258-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>I_PAR_DAT_COM</a:Name>
<a:Code>I_PAR_DAT_COM</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081700983</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<c:IndexColumns>
<o:IndexColumn Id="o378">
<a:ObjectID>6958B25B-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:IndexColumn.Expression>&lt;Index Expression_0&gt;</a:IndexColumn.Expression>
<c:Column>
<o:Column Ref="o331"/>
</c:Column>
</o:IndexColumn>
</c:IndexColumns>
</o:Index>
<o:Index Id="o379">
<a:ObjectID>6958B25F-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>I_PAR_TP</a:Name>
<a:Code>I_PAR_TP</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<c:IndexColumns>
<o:IndexColumn Id="o380">
<a:ObjectID>6958B261-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:IndexColumn.Expression>&lt;Index Expression_0&gt;</a:IndexColumn.Expression>
<c:Column>
<o:Column Ref="o335"/>
</c:Column>
</o:IndexColumn>
</c:IndexColumns>
</o:Index>
</c:Indexes>
<c:Owner>
<o:User Ref="o34"/>
</c:Owner>
<c:Triggers>
<o:Trigger Id="o381">
<a:ObjectID>6958B1AB-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>T_PAR_TRD</a:Name>
<a:Code>T_PAR_TRD</a:Code>
<a:Text>Create Trigger T_PAR_TRD On T_PAR
For Delete As
Begin
IF @@ROWCOUNT = 0 RETURN
SET NOCOUNT ON
/* Partidas»Partidas: Partida Vinculada (Restrict) */
If (Select Count(*) From T_PAR dep, Deleted pri
 Where dep.CD_PAR_VIN = pri.CD_PAR) &gt; 0
Begin
  RollBack Transaction
  RaisError 20003 &#39;Operação não executada: A informação que se deseja excluir da tabela &lt;Partidas&gt; está sendo referenciada na tabela &lt;Partidas&gt;&#39;
  Return
End
/* Partidas»Chamadas de Anuncio: Chamadas da Partida (Cascade) */
Delete T_CHA From T_CHA dep, Deleted pri
 Where dep.CD_PAR = pri.CD_PAR
/* Partidas»Checkin da Partida de Vôo: Checkins de Partida (Cascade) */
Delete T_CKV001 From T_CKV001 dep, Deleted pri
 Where dep.CD_PAR = pri.CD_PAR
/* Partidas»Dados Estatísticos de Partida: Dados Estatísticos de Partida (Cascade) */
Delete T_DEP From T_DEP dep, Deleted pri
 Where dep.CD_PAR = pri.CD_PAR
/* Partidas»Escala da Partida de Vôo: Escalas de Partida (Cascade) */
Delete T_ECP001 From T_ECP001 dep, Deleted pri
 Where dep.CD_PAR = pri.CD_PAR
/* Partidas»Mensagem de Partida: Partida da Mensagem (Cascade) */
Delete T_MPA From T_MPA dep, Deleted pri
 Where dep.CD_PAR = pri.CD_PAR
/* Partidas»Histórico de Situação de Vôo de Partida: Partida do HSP (Cascade) */
Delete T_HSP From T_HSP dep, Deleted pri
 Where dep.CD_PAR = pri.CD_PAR
/* Partidas»Log da Programação de Anúncios: Partidas do Log de Programação (Cascade) */
Delete T_PRALOG From T_PRALOG dep, Deleted pri
 Where dep.CD_PAR = pri.CD_PAR
/* Partidas»Histórico de Permanência de Aeronaves: Histórico de Permanência dos Vôos de Partida (Set Null) */
Update T_HPA001 Set CD_PAR = Null
 From T_HPA001 dep, Deleted pri
 Where dep.CD_PAR = pri.CD_PAR
/* Regra de negócio */
/* Milena 14/01/98 - Se o Vôo de partida for excluído e o vôo de chegada antecessor vinculado a ele não for nulo, 
este deve ser incluído na tabela de vôos de chegada candidatos a antecessor */
INSERT	T_CHGANT(
	CD_CHG)
SELECT	DEL.CD_CHG_AEN_ANT
FROM	DELETED DEL
WHERE	DEL.CD_CHG_AEN_ANT IS NOT NULL

/* INCLUIR REGISTROS EM T_APA */
INSERT	T_APA (DH_APA, CD_PAR)
SELECT GETDATE(), CD_PAR FROM DELETED

End
go</a:Text>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Trigger.Type>D</a:Trigger.Type>
</o:Trigger>
<o:Trigger Id="o382">
<a:ObjectID>6958B1AD-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>T_PAR_TRI</a:Name>
<a:Code>T_PAR_TRI</a:Code>
<a:Text>Create Trigger T_PAR_TRI On T_PAR
For Insert As
Begin
IF @@ROWCOUNT = 0 RETURN
SET NOCOUNT ON
/* Aeroporto»Partidas: Aeroporto da Partida */
If (Select Count(*) From T_AER, Inserted
Where T_AER.CD_AER = Inserted.CD_AER)
 &lt;&gt;(Select Count(CD_AER) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Aeroporto&gt; que se deseja incluir na tabela &lt;Partidas&gt; não está cadastrada&#39;
  Return
End
/* Companhia Aérea»Partidas: Companhia Aérea da Partida */
If (Select Count(*) From T_COM, Inserted
Where T_COM.CD_COM = Inserted.CD_COM)
 &lt;&gt;(Select Count(CD_COM) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Companhia Aérea&gt; que se deseja incluir na tabela &lt;Partidas&gt; não está cadastrada&#39;
  Return
End
/* Portão»Partidas: Portão da Partida */
If (Select Count(*) From T_POR, Inserted
Where T_POR.CD_POR = Inserted.CD_POR)
 &lt;&gt;(Select Count(CD_POR) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Portão&gt; que se deseja incluir na tabela &lt;Partidas&gt; não está cadastrada&#39;
  Return
End
/* Situação»Partidas: Situação da Partida */
If (Select Count(*) From T_SIT, Inserted
Where T_SIT.CD_SIT = Inserted.CD_SIT)
 &lt;&gt;(Select Count(CD_SIT) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Situação&gt; que se deseja incluir na tabela &lt;Partidas&gt; não está cadastrada&#39;
  Return
End
/* Informante da Situação de Vôo»Partidas: Informante da Situação de Partida */
If (Select Count(*) From T_IFT, Inserted
Where T_IFT.CD_IFT = Inserted.CD_IFT)
 &lt;&gt;(Select Count(CD_IFT) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Informante da Situação de Vôo&gt; que se deseja incluir na tabela &lt;Partidas&gt; não está cadastrada&#39;
  Return
End
/* Chegadas»Partidas: Chegada Antecessora */
If (Select Count(*) From T_CHG, Inserted
Where T_CHG.CD_CHG = Inserted.CD_CHG_ANT)
 &lt;&gt;(Select Count(CD_CHG_ANT) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Chegadas&gt; que se deseja incluir na tabela &lt;Partidas&gt; não está cadastrada&#39;
  Return
End
/* Chegadas»Partidas: Chegada da Aeronave Sucessora */
If (Select Count(*) From T_CHG, Inserted
Where T_CHG.CD_CHG = Inserted.CD_CHG_AEN_ANT)
 &lt;&gt;(Select Count(CD_CHG_AEN_ANT) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Chegadas&gt; que se deseja incluir na tabela &lt;Partidas&gt; não está cadastrada&#39;
  Return
End
/* Partidas»Partidas: Partida Vinculada */
If (Select Count(*) From T_PAR, Inserted
Where T_PAR.CD_PAR = Inserted.CD_PAR_VIN)
 &lt;&gt;(Select Count(CD_PAR_VIN) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Partidas&gt; que se deseja incluir na tabela &lt;Partidas&gt; não está cadastrada&#39;
  Return
End
/* Usuários»Partidas: Usuário logado */
If (Select Count(*) From T_USR, Inserted
Where T_USR.CD_USR = Inserted.CD_USR)
 &lt;&gt;(Select Count(CD_USR) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Usuários&gt; que se deseja incluir na tabela &lt;Partidas&gt; não está cadastrada&#39;
  Return
End
/* Domínio de: Grupo do Vôo */
/* 1 - Grupo 1 */
/* 2 - Grupo 2 */
If (Select Count(*) From Inserted
    Where TP_PAR_GRU In (1,2))
 &lt;&gt;(Select Count(*) From Inserted)
Begin
  RollBack Transaction
  RaisError 20004 &#39;Operação não executada: A informação &lt;Grupo do Vôo&gt; que se deseja incluir na tabela &lt;Partidas&gt; não é uma opção válida&#39;
  Return
End
/* Domínio de: Tipo do Vôo de Partida */
/* 1 - DOM-Doméstico */
/* 2 - INT-Internacional */
/* 3 - REG-Regional */
If (Select Count(*) From Inserted
    Where TP_PAR In (1,2,3))
 &lt;&gt;(Select Count(*) From Inserted)
Begin
  RollBack Transaction
  RaisError 20004 &#39;Operação não executada: A informação &lt;Tipo do Vôo de Partida&gt; que se deseja incluir na tabela &lt;Partidas&gt; não é uma opção válida&#39;
  Return
End
/* Domínio de: Natureza do Vôo de Partida */
/* 1 - PAX-Passageiro */
/* 2 - CRG-Carga */
/* 3 - MIS-Misto */
/* 4 - TSL-Translado */
If (Select Count(*) From Inserted
    Where TP_PAR_NAT In (1,2,3,4))
 &lt;&gt;(Select Count(*) From Inserted)
Begin
  RollBack Transaction
  RaisError 20004 &#39;Operação não executada: A informação &lt;Natureza do Vôo de Partida&gt; que se deseja incluir na tabela &lt;Partidas&gt; não é uma opção válida&#39;
  Return
End
/* Domínio de: Categoria do Vôo de Partida */
/* 1 - RGL-Regular */
/* 2 - CHT-Charter */
/* 3 - CSH-Codeshare */
/* 4 - DPL-Duplicate Leg */
/* 5 - TEC-Pouso Técnico */
/* 6 - TSL-Translado */
/* 7 - AVG-Aviação Geral */
/* 8 - MLT-Militar */
/* 9 - NRG-Não Regular */
/* 10 - TXA-Táxi Aéreo */
If (Select Count(*) From Inserted
    Where TP_PAR_CTG In (1,2,3,4,5,6,7,8,9,10))
 &lt;&gt;(Select Count(*) From Inserted)
Begin
  RollBack Transaction
  RaisError 20004 &#39;Operação não executada: A informação &lt;Categoria do Vôo de Partida&gt; que se deseja incluir na tabela &lt;Partidas&gt; não é uma opção válida&#39;
  Return
End
/* Domínio de: Tipo do Status de Partida do Vôo */
/* 1 - Em Aberto */
/* 2 - Concluído */
If (Select Count(*) From Inserted
    Where TP_PAR_STA In (1,2))
 &lt;&gt;(Select Count(*) From Inserted
    Where TP_PAR_STA Is Not Null)
Begin
  RollBack Transaction
  RaisError 20004 &#39;Operação não executada: A informação &lt;Tipo do Status de Partida do Vôo&gt; que se deseja incluir na tabela &lt;Partidas&gt; não é uma opção válida&#39;
  Return
End
/* Regra de negócio */
/* RESTRIÇÕES */
/*********************************** RETIRADO PELO RONALDO EM 11/3/98 ***********************************************************
/* A data do vôo sendo incluído não pode ser maior do que a data posterior à da última geração nem anterior a data de hoje */
IF (	SELECT 	COUNT(*) 
	FROM 	INSERTED INS
	WHERE	(DATEDIFF(MI, Dateadd(HH, -Datepart(HH, GETDATE()), Dateadd(mi, -datepart(mi, GETDATE()), GETDATE())), INS.DT_PAR) &lt; 0 OR
		/* (DATEDIFF(MI, CONVERT(DATETIME, (CONVERT(VARCHAR, DATEPART(MM, GETDATE())) + &#39;/&#39; + CONVERT(VARCHAR, DATEPART(DD, GETDATE()))  + &#39;/&#39; + CONVERT(VARCHAR, DATEPART(YY, GETDATE())) +  &#39; 00:00&#39;)), INS.DT_PAR) &lt; 0 OR */
		DATEADD(DD, -1, INS.DT_PAR) &gt; (SELECT MAX(DT_PAR) FROM T_PAR WHERE CD_PAR &lt;&gt; INS.CD_PAR) ) AND INS.NR_PAR_HOT IS NOT NULL) &gt; 0
BEGIN
	RAISERROR 20999 &#39;Operação não executada: Não é permitida a geração de vôos de datas anteriores à data de hoje ou posteriores à data da última geração mais um dia.&#39;
	ROLLBACK TRANSACTION
	RETURN
END
**********************************************************************************************************************************************/
/* Um vôo não pode ser incluído CANCELADO */
IF (	SELECT 	COUNT(*)
	FROM	INSERTED INS, 
		T_SIT SIT
	WHERE	SIT.CD_SIT = INS.CD_SIT AND
		FL_SIT_CAN_VOO &lt;&gt; 0) &gt; 0
BEGIN
	RAISERROR 20999 &#39;Operação não executada: Não é permitida a inclusão de vôos com situação de partida cancelada&#39;
	ROLLBACK TRANSACTION
	RETURN
END

/* PROVOCAR A EXECUÇÃO DA TRIGGER DE UPDATE PARA A COMPLEMENTAÇÃO DAS VERIFICAÇÕES
    E PROCESSAR OUTRAS ATUALIZAÇÕES */
UPDATE	T_PAR
SET	CD_SIT = PAR.CD_SIT,
	DH_PAR_SIT = PAR.DH_PAR_NRM,
	CD_CHG_AEN_ANT = PAR.CD_CHG_AEN_ANT
FROM	T_PAR PAR,
	INSERTED INS

WHERE	PAR.CD_PAR = INS.CD_PAR
End
go</a:Text>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Trigger.Type>I</a:Trigger.Type>
</o:Trigger>
<o:Trigger Id="o383">
<a:ObjectID>6958B1AF-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>T_PAR_TRU</a:Name>
<a:Code>T_PAR_TRU</a:Code>
<a:Text>CREATE Trigger T_PAR_TRU On T_PAR
For Update As
Begin
IF @@ROWCOUNT = 0 RETURN
SET NOCOUNT ON
If Update (CD_PAR)
Begin
  RollBack Transaction
  RaisError 20002 &#39;Operação não executada: A informação &lt;Código do Vôo de Partida&gt; da tabela &lt;Partidas&gt; não pode ser alterada.&#39;
  Return
End
If Update (CD_AER)
/* Aeroporto»Partidas: Aeroporto da Partida */
If (Select Count(*) From T_AER, Inserted
Where T_AER.CD_AER = Inserted.CD_AER)
 &lt;&gt;(Select Count(CD_AER) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Aeroporto&gt; que se deseja incluir na tabela &lt;Partidas&gt; não está cadastrada&#39;
  Return
End
If Update (CD_COM)
/* Companhia Aérea»Partidas: Companhia Aérea da Partida */
If (Select Count(*) From T_COM, Inserted
Where T_COM.CD_COM = Inserted.CD_COM)
 &lt;&gt;(Select Count(CD_COM) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Companhia Aérea&gt; que se deseja incluir na tabela &lt;Partidas&gt; não está cadastrada&#39;
  Return
End
If Update (CD_POR)
/* Portão»Partidas: Portão da Partida */
If (Select Count(*) From T_POR, Inserted
Where T_POR.CD_POR = Inserted.CD_POR)
 &lt;&gt;(Select Count(CD_POR) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Portão&gt; que se deseja incluir na tabela &lt;Partidas&gt; não está cadastrada&#39;
  Return
End
If Update (CD_SIT)
/* Situação»Partidas: Situação da Partida */
If (Select Count(*) From T_SIT, Inserted
Where T_SIT.CD_SIT = Inserted.CD_SIT)
 &lt;&gt;(Select Count(CD_SIT) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Situação&gt; que se deseja incluir na tabela &lt;Partidas&gt; não está cadastrada&#39;
  Return
End
If Update (CD_IFT)
/* Informante da Situação de Vôo»Partidas: Informante da Situação de Partida */
If (Select Count(*) From T_IFT, Inserted
Where T_IFT.CD_IFT = Inserted.CD_IFT)
 &lt;&gt;(Select Count(CD_IFT) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Informante da Situação de Vôo&gt; que se deseja incluir na tabela &lt;Partidas&gt; não está cadastrada&#39;
  Return
End
If Update (CD_CHG_ANT)
/* Chegadas»Partidas: Chegada Antecessora */
If (Select Count(*) From T_CHG, Inserted
Where T_CHG.CD_CHG = Inserted.CD_CHG_ANT)
 &lt;&gt;(Select Count(CD_CHG_ANT) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Chegadas&gt; que se deseja incluir na tabela &lt;Partidas&gt; não está cadastrada&#39;
  Return
End
If Update (CD_CHG_AEN_ANT)
/* Chegadas»Partidas: Chegada da Aeronave Sucessora */
If (Select Count(*) From T_CHG, Inserted
Where T_CHG.CD_CHG = Inserted.CD_CHG_AEN_ANT)
 &lt;&gt;(Select Count(CD_CHG_AEN_ANT) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Chegadas&gt; que se deseja incluir na tabela &lt;Partidas&gt; não está cadastrada&#39;
  Return
End
If Update (CD_PAR_VIN)
/* Partidas»Partidas: Partida Vinculada */
If (Select Count(*) From T_PAR, Inserted
Where T_PAR.CD_PAR = Inserted.CD_PAR_VIN)
 &lt;&gt;(Select Count(CD_PAR_VIN) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Partidas&gt; que se deseja incluir na tabela &lt;Partidas&gt; não está cadastrada&#39;
  Return
End
If Update (CD_USR)
/* Usuários»Partidas: Usuário logado */
If (Select Count(*) From T_USR, Inserted
Where T_USR.CD_USR = Inserted.CD_USR)
 &lt;&gt;(Select Count(CD_USR) From Inserted)
Begin
  RollBack Transaction
  RaisError 20001 &#39;Operação não executada: A informação &lt;Usuários&gt; que se deseja incluir na tabela &lt;Partidas&gt; não está cadastrada&#39;
  Return
End
If Update (TP_PAR_GRU)
Or Update (TP_PAR)
Or Update (TP_PAR_NAT)
Or Update (TP_PAR_CTG)
Or Update (TP_PAR_STA)
/* Domínio de: Grupo do Vôo */
/* 1 - Grupo 1 */
/* 2 - Grupo 2 */
If (Select Count(*) From Inserted
    Where TP_PAR_GRU In (1,2))
 &lt;&gt;(Select Count(*) From Inserted)
Begin
  RollBack Transaction
  RaisError 20004 &#39;Operação não executada: A informação &lt;Grupo do Vôo&gt; que se deseja incluir na tabela &lt;Partidas&gt; não é uma opção válida&#39;
  Return
End
/* Domínio de: Tipo do Vôo de Partida */
/* 1 - DOM-Doméstico */
/* 2 - INT-Internacional */
/* 3 - REG-Regional */
If (Select Count(*) From Inserted
    Where TP_PAR In (1,2,3))
 &lt;&gt;(Select Count(*) From Inserted)
Begin
  RollBack Transaction
  RaisError 20004 &#39;Operação não executada: A informação &lt;Tipo do Vôo de Partida&gt; que se deseja incluir na tabela &lt;Partidas&gt; não é uma opção válida&#39;
  Return
End
/* Domínio de: Natureza do Vôo de Partida */
/* 1 - PAX-Passageiro */
/* 2 - CRG-Carga */
/* 3 - MIS-Misto */
/* 4 - TSL-Translado */
If (Select Count(*) From Inserted
    Where TP_PAR_NAT In (1,2,3,4))
 &lt;&gt;(Select Count(*) From Inserted)
Begin
  RollBack Transaction
  RaisError 20004 &#39;Operação não executada: A informação &lt;Natureza do Vôo de Partida&gt; que se deseja incluir na tabela &lt;Partidas&gt; não é uma opção válida&#39;
  Return
End
/* Domínio de: Categoria do Vôo de Partida */
/* 1 - RGL-Regular */
/* 2 - CHT-Charter */
/* 3 - CSH-Codeshare */
/* 4 - DPL-Duplicate Leg */
/* 5 - TEC-Pouso Técnico */
/* 6 - TSL-Translado */
/* 7 - AVG-Aviação Geral */
/* 8 - MLT-Militar */
/* 9 - NRG-Não Regular */
/* 10 - TXA-Táxi Aéreo */
If (Select Count(*) From Inserted
    Where TP_PAR_CTG In (1,2,3,4,5,6,7,8,9,10))
 &lt;&gt;(Select Count(*) From Inserted)
Begin
  RollBack Transaction
  RaisError 20004 &#39;Operação não executada: A informação &lt;Categoria do Vôo de Partida&gt; que se deseja incluir na tabela &lt;Partidas&gt; não é uma opção válida&#39;
  Return
End
/* Domínio de: Tipo do Status de Partida do Vôo */
/* 1 - Em Aberto */
/* 2 - Concluído */
If (Select Count(*) From Inserted
    Where TP_PAR_STA In (1,2))
 &lt;&gt;(Select Count(*) From Inserted
    Where TP_PAR_STA Is Not Null)
Begin
  RollBack Transaction
  RaisError 20004 &#39;Operação não executada: A informação &lt;Tipo do Status de Partida do Vôo&gt; que se deseja incluir na tabela &lt;Partidas&gt; não é uma opção válida&#39;
  Return
End
/* Regra de negócio */
/* CODESHARE OU DUPLICATE LEG */
IF UPDATE(TP_PAR_CTG) OR UPDATE(CD_PAR_VIN)
	/* Um vôo do tipo normal ou charter não pode ter vôo vinculado e um vôo do tipo codeshare ou duplicate leg tem de ter vôo vinculado */
	IF (	SELECT 	COUNT(*) FROM	INSERTED
		WHERE	(TP_PAR_CTG NOT IN (3,4) AND CD_PAR_VIN IS NOT NULL) OR (TP_PAR_CTG IN (3,4) AND CD_PAR_VIN IS NULL)) &gt; 0
	BEGIN
		RAISERROR 20999 &#39;Operação não executada: Um vôo do tipo Normal ou Charter não pode ter vôo vinculado, e um vôo do tipo Codeshare ou Duplicate Leg tem de ter vôo vinculado.&#39;
		ROLLBACK TRANSACTION
		RETURN
	END
/* ETAPA CONCLUÍDA */
/* Verificar se a partida foi concluída (sem estar cancelada) sem que o vôo da aeronave antecessora tenha sido informado */
IF UPDATE(CD_SIT)
	IF (	SELECT	COUNT(*) FROM	INSERTED INS, T_SIT SIT
		WHERE	SIT.CD_SIT = INS.CD_SIT AND SIT.FL_SIT_CON_VOO = 1 AND INS.FL_PAR_CAN = 0 AND INS.CD_CHG_AEN_ANT IS NULL) &gt; 0
	BEGIN
		RAISERROR 20999 &#39;Operação não executada: O vôo de partida não pode ser concluído sem que seja informado o vôo da aeronave antecessora.&#39;
		ROLLBACK TRANSACTION
		RETURN
	END
/* VÔO ANTECESSOR */
/* Verificar se o vôo antecessor está se relacionando a outro vôo de Partida */
IF UPDATE(CD_CHG_ANT)
	IF(	SELECT 	COUNT(*) FROM 	T_PAR PAR, INSERTED INS
		WHERE	PAR.CD_CHG_ANT = INS.CD_CHG_ANT AND PAR.CD_PAR &lt;&gt; INS.CD_PAR) &gt; 0
	BEGIN
		RAISERROR 20999 &#39;Operação não executada: O Vôo antecessor já está sendo referenciado por outro vôo.&#39;
		ROLLBACK TRANSACTION
		RETURN
	END
/* VÔO DA AERONAVE ANTECESSORA */
IF UPDATE(CD_CHG_AEN_ANT)
BEGIN
	/* Verificar se o vôo da aeronave antecessor está se relacionando a outro vôo de Partida */
	IF(	SELECT 	COUNT(*) FROM 	T_PAR PAR, INSERTED INS
		WHERE	PAR.CD_CHG_AEN_ANT = INS.CD_CHG_AEN_ANT AND PAR.CD_PAR &lt;&gt; INS.CD_PAR) &gt; 0
	BEGIN
		RAISERROR 20999 &#39;Operação não executada: O vôo do qual se pretende utilizar a aeronave já está sendo referenciado em outro vôo.&#39;
		ROLLBACK TRANSACTION
		RETURN
	END

	/* Verificar se a partida foi concluída (sem estar cancelada) sem que o vôo da aeronave antecessora 
	tenha sido informado */
	IF (	SELECT	COUNT(*) FROM	INSERTED INS, T_SIT SIT
		WHERE	SIT.CD_SIT = INS.CD_SIT AND SIT.FL_SIT_CON_VOO = 1 AND INS.FL_PAR_CAN = 0 AND INS.CD_CHG_AEN_ANT IS NULL) &gt; 0
	BEGIN
		RAISERROR 20999 &#39;Operação não executada: O vôo de partida não pode ser concluído sem que seja informado o vôo da aeronave antecessora.&#39;
		ROLLBACK TRANSACTION
		RETURN
	END

	/* Para um vôo ter (par) ou ser (chg) vôo antecessor não pode ser da categoria 3 e 4 (codeshare ou duplicate leg) */
	IF (	SELECT COUNT(*) FROM 	INSERTED INS, T_CHG CHG
		WHERE	CHG.CD_CHG = INS.CD_CHG_AEN_ANT AND (CHG.TP_CHG_CTG IN (3, 4) OR INS.TP_PAR_CTG IN (3, 4))) &gt; 0
	BEGIN
		RAISERROR 20999 &#39;Operação não executada: Para um vôo ter ou ser vôo antecessor não pode ser codeshare nem duplicate leg.&#39;
		ROLLBACK TRANSACTION
		RETURN
	END

END

/* Se atualizarmos a hora de estacionamento de partida */
IF UPDATE(DH_PAR_EST)
BEGIN
	/* Não permitir alteração na Data ou Hora de Estacionamento de um Vôo de Partida, 
	se o Status de Aeronave associado ao último  HPA desse vôo,  estiver  Fechado e a 
	situação do vôo tanto em PAR quanto em INS for Etapa Concluída */
	IF (	SELECT	COUNT(*)
		FROM 	T_PAR PAR, INSERTED INS, T_HPA001 HPA, T_STA STA, T_SIT SITINS, T_SIT SITPAR
		WHERE	PAR.CD_PAR = INS.CD_PAR AND
			HPA.CD_PAR = INS.CD_PAR AND
			HPA.NR_HPA_SEQ = (	SELECT 	MAX(NR_HPA_SEQ) 
						FROM 	T_HPA001 HPAMAX 
						WHERE 	HPAMAX.CD_HPA = HPA.CD_HPA) AND
			STA.CD_STA = HPA.CD_STA AND
			STA.TP_STA = 2 AND
			SITPAR.CD_SIT = PAR.CD_SIT AND
			SITPAR.FL_SIT_CON_VOO = 1 AND
			SITINS.CD_SIT = INS.CD_SIT AND
			SITINS.FL_SIT_CON_VOO = 1) &gt; 0
	BEGIN
		RAISERROR 20999 &#39;Operação não executada: A &lt;Data ou Hora de Estacionamento&gt; do vôo de Partida não pode ser alterada, se o Status de Aeronave associado ao último HPA desse vôo, estiver Fechado.&#39;
		ROLLBACK TRANSACTION
		RETURN
	END
END

/* SITUAÇÃO */
/* Verificar as novas situações são válidas */
IF UPDATE(CD_SIT)
BEGIN
	IF (	SELECT	COUNT(*) FROM	INSERTED INS, T_SIT SIT
		WHERE	SIT.CD_SIT = INS.CD_SIT AND SIT.FL_SIT_PAR &lt;&gt; 1) &gt; 0
	BEGIN
		RAISERROR 20999 &#39;Operação não executada: A situação informada não é uma situação de partida.&#39;
		ROLLBACK TRANSACTION
		RETURN
	END

	/* Verificar se a nova situação de partida é compatível com a situação de partida do vôo da aeronave antecessora */
	IF (	SELECT	COUNT(*) FROM	INSERTED INS, T_CHG CHGAENANT, T_SIT SIT
		WHERE	CHGAENANT.CD_CHG = INS.CD_CHG_AEN_ANT AND 
			SIT.CD_SIT = INS.CD_SIT AND EXISTS (SELECT * FROM T_SCA SCA WHERE SCA.CD_SIT = INS.CD_SIT) AND
			CHGAENANT.CD_SIT NOT IN (SELECT CD_SIT_ANT FROM T_SCA SCA WHERE SCA.CD_SIT = INS.CD_SIT)) &gt; 0
	BEGIN
		RAISERROR 20999 &#39;Operação não executada: A situação do vôo antecessor não permite a nova situação do vôo de partida.&#39;
		ROLLBACK TRANSACTION
		RETURN
	END
END

/* Atualizar o complemento de partida */
IF UPDATE(CD_SIT) OR UPDATE(DH_PAR_EFE)
BEGIN
	UPDATE	T_PAR
	SET	NM_PAR_COM_SIT = CONVERT(CHAR(5), PAR.DH_PAR_EFE, 8)
	FROM	T_PAR PAR, INSERTED INS, T_SIT SIT
	WHERE	PAR.CD_PAR = INS.CD_PAR AND SIT.CD_SIT = PAR.CD_SIT AND SIT.TP_SIT_COM = 1	/* hora */

	UPDATE	T_PAR
	SET	NM_PAR_COM_SIT = NULL
	FROM	T_PAR PAR, INSERTED INS, T_SIT SIT
	WHERE	PAR.CD_PAR = INS.CD_PAR AND SIT.CD_SIT = PAR.CD_SIT AND SIT.TP_SIT_COM = 3	/* Nenhum */

	/* Se a Data e Hora da Situação não já tiver sido alterada */
	IF NOT UPDATE(DH_PAR_SIT)
	BEGIN
		/* Atualizar hora da alteração da situação do vôo de partida */
		UPDATE	T_PAR
		SET	DH_PAR_SIT = GETDATE()
		FROM	T_PAR PAR, INSERTED INS
		WHERE	PAR.CD_PAR = INS.CD_PAR
	END

END

/* Se alterarmos a situação de partida de vôo */
IF UPDATE(CD_SIT)
BEGIN

	/* Um vôo de partida não pode ser cancelado se existir algum registro em T_DEP para este vôo ou para um dos seus vôos vinculados */
	IF (	SELECT	COUNT(*)
		FROM	INSERTED INS, T_SIT SIT
		WHERE	SIT.CD_SIT = INS.CD_SIT AND SIT.FL_SIT_CAN_VOO = 1 AND
			(EXISTS (SELECT CD_PAR FROM T_DEP WHERE CD_PAR = INS.CD_PAR) OR
			EXISTS (SELECT DEP.CD_PAR FROM T_DEP DEP, T_PAR PAR WHERE PAR.CD_PAR_VIN = INS.CD_PAR AND DEP.CD_PAR = PAR.CD_PAR))) &gt; 0
	BEGIN
		RAISERROR 20999 &#39;Operação não executada: O vôo de Partida não pode ser cancelado pois existe registro de &lt;Dados Estatísticos de Partida&gt; para este vôo ou para algum de seus vôos vinculados.&#39;
		ROLLBACK TRANSACTION
		RETURN
	END

	/* Atualizar Flag de partida Cancelada em vôo */
	UPDATE 	T_PAR
	SET 	FL_PAR_CAN = SIT.FL_SIT_CAN_VOO
	FROM 	T_PAR PAR, INSERTED INS,  T_SIT SIT
	WHERE 	PAR.CD_PAR = INS.CD_PAR AND SIT.CD_SIT =  INS.CD_SIT AND (SIT.FL_SIT_CAN_VOO = 1 OR SIT.FL_SIT_CON_VOO = 0)

	/* Setar CD_VOO_ANT e CD_VOO_AEN_ANT para nulo caso a Partida seja cancelado */
	IF (	SELECT	COUNT(*)
		FROM 	T_PAR PAR, INSERTED INS, T_SIT SIT
		WHERE 	PAR.CD_PAR = INS.CD_PAR AND SIT.CD_SIT = INS.CD_SIT AND SIT.FL_SIT_CAN_VOO = 1) &gt; 0
	BEGIN
		UPDATE 	T_PAR
		SET 	CD_CHG_ANT = NULL,
			CD_CHG_AEN_ANT = NULL
		FROM 	T_PAR PAR, INSERTED INS, T_SIT SIT
		WHERE 	PAR.CD_PAR = INS.CD_PAR AND SIT.CD_SIT = INS.CD_SIT AND SIT.FL_SIT_CAN_VOO = 1
	END

	/* Incluir na tabela de vôos candidatos a vôos Antecessores, o vôo antecessor 
	associado a um vôo de partida caso este vôo de partida seja cancelado */
	IF (	SELECT 	COUNT(*)
		FROM	INSERTED INS, DELETED DEL, T_SIT SIT
		WHERE	INS.CD_PAR = DEL.CD_PAR AND SIT.CD_SIT = INS.CD_SIT AND 
			SIT.FL_SIT_CAN_VOO = 1 AND DEL.CD_CHG_AEN_ANT IS NOT NULL) &gt; 0
	BEGIN
		INSERT	T_CHGANT(
			CD_CHG)
		SELECT	DEL.CD_CHG_AEN_ANT
		FROM	INSERTED INS, DELETED DEL, T_SIT SIT
		WHERE	INS.CD_PAR = DEL.CD_PAR AND SIT.CD_SIT = INS.CD_SIT AND 
			SIT.FL_SIT_CAN_VOO = 1 AND DEL.CD_CHG_AEN_ANT IS NOT NULL
	END

	/* Setar flag de vôo não concluído ou concluído */
	UPDATE 	T_PAR
	SET 	TP_PAR_STA = SIT.FL_SIT_CON_VOO + 1   /* 2=Concluída */
	FROM 	T_PAR PAR, T_SIT SIT, INSERTED INS
	WHERE 	PAR.CD_PAR = INS.CD_PAR AND SIT.CD_SIT = INS.CD_SIT
	 
	/* Atualizar Flag de saída concluída em T_HPA para etapas concluídas e não canceladas */
	UPDATE 	T_HPA001
	SET 	FL_HPA_SAI = SIT.FL_SIT_CON_VOO
	FROM 	T_HPA001 HPA, INSERTED INS, T_SIT SIT
	WHERE  	HPA.CD_PAR = INS.CD_PAR AND SIT.CD_SIT = INS.CD_SIT

	/* Tornar nulo o vôo de partida de HPA e FL_HPA_SAI = 0 em todos os registros relativos ao vôo cancelado */
	IF (	SELECT 	COUNT(*)
		FROM	T_HPA001 HPA, INSERTED INS, T_SIT SIT
		WHERE	HPA.CD_PAR = INS.CD_PAR AND SIT.CD_SIT = INS.CD_SIT AND SIT.FL_SIT_CAN_VOO = 1) &gt; 0
	BEGIN
		UPDATE	T_HPA001
		SET	CD_PAR = NULL,
			FL_HPA_SAI = 0
		FROM	T_HPA001 HPA, INSERTED INS, T_SIT SIT
		WHERE	HPA.CD_PAR = INS.CD_PAR AND SIT.CD_SIT = INS.CD_SIT AND SIT.FL_SIT_CAN_VOO = 1
	END
END

IF UPDATE(TP_PAR_CTG)
BEGIN
	/* Anular os vôos de partida dos hpa dos vôos de partida que passaram a ser codeshare ou duplicate leg */
	UPDATE	T_HPA001
	SET	CD_PAR = NULL
	FROM	T_HPA001 HPA, INSERTED INS
	WHERE	HPA.CD_PAR = INS.CD_PAR AND INS.TP_PAR_CTG IN (3,4)

	/* Anular vôo antecessor e vôo da aeronave antecessora dos vôos de partida que passaram a ser codeshare ou duplicate leg */
	UPDATE	T_PAR
	SET	CD_CHG_ANT = NULL,
		CD_CHG_AEN_ANT = NULL
	FROM	T_PAR PAR, INSERTED INS
	WHERE	PAR.CD_PAR = INS.CD_PAR AND INS.TP_PAR_CTG IN (3,4)

	/* Incluir na tabela de vôos candidatos a vôos Antecessores, o vôo antecessor associado 
	a um vôo de partida caso este vôo de partida passe a ser Codeshare ou Duplicate Leg */
	INSERT	T_CHGANT(
		CD_CHG)
	SELECT	DEL.CD_CHG_AEN_ANT
	FROM	INSERTED INS, DELETED DEL
	WHERE	INS.CD_PAR = DEL.CD_PAR AND INS.TP_PAR_CTG IN (3,4) AND DEL.CD_CHG_AEN_ANT IS NOT NULL
END

/* Se houve alteração no voo ANTECESSOR de um vôo de partida */
IF UPDATE(CD_CHG_ANT)
BEGIN
	/* O Vôo antecessor não pode estar cancelado */
	IF (	SELECT 	COUNT(*) 
		FROM 	INSERTED INS,
			T_PAR PAR,
			T_CHG CHG
		WHERE	PAR.CD_PAR = INS.CD_PAR AND CHG.CD_CHG = PAR.CD_CHG_ANT AND CHG.FL_CHG_CAN = 1) &gt; 0
	BEGIN
		RAISERROR 20999 &#39;Operação não executada: O vôo de partida não pode estar ligado a um vôo antecessor cancelado.&#39;
		ROLLBACK TRANSACTION
		RETURN
	END

END
/* Se houve alteração no Vôo DA AERONAVE antecessora de um vôo de partida */
IF UPDATE(CD_CHG_AEN_ANT)
BEGIN
	/* Tornar nulo o Vôo de partida  dos  registros de HPA que tinham este vôo como vôo de partida */
	UPDATE	T_HPA001
	SET 	CD_PAR = NULL
	FROM	T_HPA001 HPA, INSERTED INS
	WHERE	HPA.CD_PAR = INS.CD_PAR

	/* Atualizar os registros de HPA relativos ao novo vôo antecessor, fazendo o vôo de partida igual a este vôo */
	/* Atualizar Flag de saída concluída em T_HPA para etapas concluídas e não  canceladas */
	UPDATE	T_HPA001
	SET	CD_PAR = INS.CD_PAR,
		FL_HPA_SAI = SIT.FL_SIT_CON_VOO
	FROM	T_HPA001 HPA, INSERTED INS, T_SIT SIT
	WHERE	HPA.CD_CHG = INS.CD_CHG_AEN_ANT AND SIT.CD_SIT = INS.CD_SIT 

	/* O Vôo da aeronave antecessora não pode estar cancelado */
	IF (	SELECT 	COUNT(*) 
		FROM 	INSERTED INS,
			T_PAR PAR,
			T_CHG CHG
		WHERE	PAR.CD_PAR = INS.CD_PAR AND 
			CHG.CD_CHG = PAR.CD_CHG_AEN_ANT AND
			CHG.FL_CHG_CAN = 1) &gt; 0
	BEGIN
		RAISERROR 20999 &#39;Operação não executada: O vôo de chegada cuja aeronave será utilizada na partida não pode estar cancelado.&#39;
		ROLLBACK TRANSACTION
		RETURN
	END

	/* O Vôo de Partida ao qual está se querendo vincular um vôo antecessor não pode estar cancelado */
	IF (	SELECT 	COUNT(*)
		FROM 	INSERTED INS,
			T_PAR PAR
		WHERE	PAR.CD_PAR = INS.CD_PAR AND
			PAR.FL_PAR_CAN = 1 AND
			PAR.CD_CHG_AEN_ANT IS NOT NULL) &gt; 0
	BEGIN
		RAISERROR 20999 &#39;Operação não executada: O vôo de partida ao qual se está querendo vincular um vôo antecessor não pode estar cancelado.&#39;
		ROLLBACK TRANSACTION
		RETURN
	END

	/* Incluir vôo na tabela de vôos candidatos a vôos Antecessores se 
	este vôo ainda existir na tabela de Chegada e não existir ainda na tabela de vôos candidatos a vôos Antecessores */
	INSERT	T_CHGANT(
		CD_CHG)
	SELECT	DEL.CD_CHG_AEN_ANT
	FROM	DELETED DEL
	WHERE	DEL.CD_CHG_AEN_ANT IS NOT NULL AND
		DEL.CD_CHG_AEN_ANT IN (		SELECT 	CD_CHG 
						FROM 	T_CHG CHG 
						WHERE 	CHG.CD_CHG = DEL.CD_CHG_AEN_ANT) AND
		DEL.CD_CHG_AEN_ANT NOT IN (	SELECT 	CD_CHG 
						FROM 	T_CHGANT CHGANT
						WHERE 	CHGANT.CD_CHG = DEL.CD_CHG_AEN_ANT)

	/* Excluir vôo da tabela de vôos candidatos a vôos Antecessores se o Vôo Antecessor tiver sido alterado */
	DELETE 	CHGANT
	FROM	T_CHGANT CHGANT, INSERTED INS
	WHERE	CHGANT.CD_CHG = INS.CD_CHG_AEN_ANT

END

/* Se atualizarmos a hora de estacionamento de partida */
IF UPDATE(DH_PAR_EST)
BEGIN
	/* Atualizamos Hora de Saída em HPA como Hora de Estacionamento de partida */
	UPDATE 	T_HPA001
	SET 	DH_HPA_SAI = PAR.DH_PAR_EST
	FROM	T_HPA001 HPA,
		T_PAR PAR,
		INSERTED INS
	WHERE 	PAR.CD_PAR = INS.CD_PAR AND
		HPA.CD_PAR = INS.CD_PAR AND
		HPA.NR_HPA_SEQ = (	SELECT 	MAX(NR_HPA_SEQ) 
					FROM 	T_HPA001 HPAMAX 
					WHERE 	HPAMAX.CD_HPA = HPA.CD_HPA)
END

/* CONSISTÊNCIAS QUE SÓ DEVEM SER FEITAS APÓS AS ATUALIZAÇÕES */

IF UPDATE(CD_SIT) OR UPDATE(CD_CHG_ANT)
BEGIN
	/* Um vôo de partida não pode ser concluído se o seu vôo de chegada estiver em aberto */
	IF (	SELECT	COUNT(*)
		FROM	T_PAR PAR,
			T_CHG CHG,
			INSERTED INS
		WHERE	PAR.CD_PAR = INS.CD_PAR AND
			CHG.CD_CHG = PAR.CD_CHG_ANT AND
			PAR.TP_PAR_STA = 2 AND 
			CHG.TP_CHG_STA = 1) &gt; 0
	BEGIN
		RAISERROR 20999 &#39;Operação não executada: O vôo de partida não pode ser concluído se o seu vôo de chegada ainda estiver em aberto.&#39;
		ROLLBACK TRANSACTION
		RETURN
	END
END

IF UPDATE(CD_SIT) OR UPDATE(CD_CHG_AEN_ANT) OR UPDATE(TP_PAR_CTG)
BEGIN
	/* Um vôo de partida não pode ser concluído se o vôo de chegada que utiliza a mesma aeronave estiver em aberto */
	IF (	SELECT	COUNT(*)
		FROM	T_PAR PAR,
			T_CHG CHG,
			INSERTED INS
		WHERE	PAR.CD_PAR = INS.CD_PAR AND
			CHG.CD_CHG = PAR.CD_CHG_AEN_ANT AND
			PAR.TP_PAR_STA = 2 AND 
			CHG.TP_CHG_STA = 1) &gt; 0
	BEGIN
		RAISERROR 20999 &#39;Operação não executada: O vôo de partida não pode ser concluído se o vôo de chegada que utiliza a mesma aeronave ainda estiver em aberto.&#39;
		ROLLBACK TRANSACTION
		RETURN
	END

END

IF UPDATE(DH_PAR_NRM) OR 
    UPDATE(DH_PAR_EFE) OR 
    UPDATE(DH_PAR_EST) OR
    UPDATE(CD_CHG_ANT) OR
    UPDATE(CD_CHG_AEN_ANT)
BEGIN
	/* Verificar se há horas de chegada maiores que as horas de partida */
	IF (	SELECT COUNT(*)
		FROM 	T_PAR PAR,
			T_CHG CHG,
			INSERTED INS
		WHERE 	PAR.CD_PAR = INS.CD_PAR AND
			CHG.CD_CHG = PAR.CD_CHG_AEN_ANT AND
			((CHG.DH_CHG_EFE &gt;= PAR.DH_PAR_EFE) OR 
			(CHG.DH_CHG_EST &gt;= PAR.DH_PAR_EST))) &gt; 0
	BEGIN
		RAISERROR 20999 &#39;Operação não executada: A hora de partida não pode ser menor nem igual à hora de chegada.&#39;
		ROLLBACK TRANSACTION
		RETURN
	END
END

/* JOGAR os dados dos vôos do tipo Normal, nos vôos do tipo Codeshare */
IF (	SELECT 	COUNT(*)
	FROM	T_PAR PAR,
		T_PAR PARVIN,
		INSERTED INS
	WHERE	PAR.CD_PAR_VIN = INS.CD_PAR AND
		PARVIN.CD_PAR = INS.CD_PAR) &gt; 0
BEGIN
	UPDATE	PAR
	SET	CD_POR = PARVIN.CD_POR,
		DH_PAR_NRM = PARVIN.DH_PAR_NRM,
		DH_PAR_EFE = PARVIN.DH_PAR_EFE,
		DH_PAR_EST = PARVIN.DH_PAR_EST,
		DH_PAR_SIT  = PARVIN.DH_PAR_SIT,
		NM_PAR_COM_SIT = PARVIN.NM_PAR_COM_SIT,
		FL_PAR_CAN = PARVIN.FL_PAR_CAN,
		CD_SIT = PARVIN.CD_SIT,
		TP_PAR_STA = PARVIN.TP_PAR_STA,
		CD_USR = PARVIN.CD_USR
	FROM	T_PAR PAR,
		T_PAR PARVIN,
		INSERTED INS
	WHERE	PAR.CD_PAR_VIN = INS.CD_PAR AND
		PARVIN.CD_PAR = INS.CD_PAR
END

/* PUXAR os dados dos vôos do tipo Normal, nos vôos do tipo Codeshare */
IF (	SELECT 	COUNT(*)
	FROM	T_PAR PAR,
		T_PAR PARVIN,
		INSERTED INS
	WHERE	PAR.CD_PAR = INS.CD_PAR AND
		PARVIN.CD_PAR = INS.CD_PAR_VIN) &gt; 0
BEGIN
	UPDATE	PAR
	SET	CD_POR = PARVIN.CD_POR,
		DH_PAR_NRM = PARVIN.DH_PAR_NRM,
		DH_PAR_EFE = PARVIN.DH_PAR_EFE,
		DH_PAR_EST = PARVIN.DH_PAR_EST,
		DH_PAR_SIT  = PARVIN.DH_PAR_SIT,
		NM_PAR_COM_SIT = PARVIN.NM_PAR_COM_SIT,
		FL_PAR_CAN = PARVIN.FL_PAR_CAN,
		CD_SIT = PARVIN.CD_SIT,
		TP_PAR_STA = PARVIN.TP_PAR_STA,
		CD_USR = PARVIN.CD_USR
	FROM	T_PAR PAR,
		T_PAR PARVIN,
		INSERTED INS
	WHERE	PAR.CD_PAR = INS.CD_PAR AND
		PARVIN.CD_PAR = INS.CD_PAR_VIN
END


IF UPDATE(FL_PAR_TEL)
BEGIN
	--Se desmarcar da tela desmarcar do anunciador automático
	Update	T_PAR
	set	FL_PAR_ANU = 0
	FROM	T_PAR PAR
	JOIN	INSERTED INS ON INS.CD_PAR = PAR.CD_PAR
	WHERE	INS.FL_PAR_TEL = 0
END

IF UPDATE(CD_POR)
BEGIN
	--Deleta todos os registros da programação cujo flag &quot;Reanunciar na alteração de Portão&quot; seja VERDADEIRO ou cujo flag &quot;Somente quando for alteração de Portão&quot; seja VERDADEIRO e que estejam vinculados a este vôo
	DELETE T_PRALOG FROM T_PRALOG LOG JOIN INSERTED INS ON INS.CD_PAR = LOG.CD_PAR
	JOIN T_PRA PRA ON PRA.CD_PRA = LOG.CD_PRA AND (PRA.FL_PRA = 1 OR PRA.FL_PRA_POR = 1)

	--Incluir somente aqueles registros da &quot;Programação de Anúncio&quot;, cujo &quot;Código da Programação&quot; não já exista no Log de Programação deste vôo, e que esteja vinculado à nova situação do vôo, e cujo Tipo de Anúncio seja de Partida e cujo vôo apareça na tela e cujo flag &quot;Somente quando for alteração de Portão&quot; seja VERDADEIRO ou o falg &quot;Reanunciar na alteração de Portão&quot;seja VERDADEIRO
	--Antes da Hora Prevista
	INSERT INTO T_PRALOG (CD_PRA, CD_CHG, CD_PAR, DH_LOG, FL_LOG)
	SELECT 	CD_PRA, NULL, INS.CD_PAR, DATEADD(MI, -PRA.QT_PRA_TMP, INS.DH_PAR_EFE), 0
	FROM	T_PRA PRA JOIN INSERTED INS ON INS.CD_SIT = PRA.CD_SIT AND INS.FL_PAR_TEL = 1 AND INS.FL_PAR_ANU = 1
	JOIN	T_TPA TPA ON TPA.CD_TPA = PRA.CD_TPA AND TPA.TP_TPA = 2 JOIN T_SIT SIT ON SIT.CD_SIT = INS.CD_SIT AND FL_SIT_CON_VOO = 0
	WHERE	PRA.TP_PRA = 1 AND NOT EXISTS (SELECT * FROM T_PRALOG WHERE CD_PRA = PRA.CD_PRA AND CD_PAR = INS.CD_PAR) AND (PRA.FL_PRA = 1 OR PRA.FL_PRA_POR = 1)

	 --Após a Alteração da Situação
	INSERT INTO T_PRALOG (CD_PRA, CD_CHG, CD_PAR, DH_LOG, FL_LOG)
	SELECT 	CD_PRA, NULL, INS.CD_PAR, DATEADD(MI, PRA.QT_PRA_TMP, GETDATE()), 0
	FROM	T_PRA PRA JOIN INSERTED INS ON INS.CD_SIT = PRA.CD_SIT AND INS.FL_PAR_TEL = 1 AND INS.FL_PAR_ANU = 1
	JOIN	T_TPA TPA ON TPA.CD_TPA = PRA.CD_TPA AND TPA.TP_TPA = 2 JOIN T_SIT SIT ON SIT.CD_SIT = INS.CD_SIT AND FL_SIT_CON_VOO = 0
	WHERE	PRA.TP_PRA = 2 AND NOT EXISTS (SELECT * FROM T_PRALOG WHERE CD_PRA = PRA.CD_PRA AND CD_PAR = INS.CD_PAR) AND (PRA.FL_PRA = 1 OR PRA.FL_PRA_POR = 1)
END
--Alexei 18/06/01
IF UPDATE(CD_SIT)  OR UPDATE(DH_PAR_EFE) 
BEGIN
	--Lançar Histórico de Situação de Vôo
	INSERT T_HSP (DH_HSP, CD_PAR, CD_IFT, CD_SIT, DH_HSP_PAR, CD_USR) SELECT GETDATE(), INS.CD_PAR, INS.CD_IFT, INS.CD_SIT, INS.DH_PAR_EFE, INS.CD_USR FROM INSERTED INS

	--Deleta todos os registros da programação não anunciados e que estejam vinculados a este vôo
	DELETE T_PRALOG FROM T_PRALOG LOG JOIN INSERTED INS ON INS.CD_PAR = LOG.CD_PAR WHERE LOG.FL_LOG = 0

	--Inserir programação de Log
	--Antes da Hora Prevista
	INSERT INTO T_PRALOG (CD_PRA, CD_CHG, CD_PAR, DH_LOG, FL_LOG)
	SELECT 	CD_PRA, NULL, INS.CD_PAR, DATEADD(MI, -PRA.QT_PRA_TMP, INS.DH_PAR_EFE), 0
	FROM	T_PRA PRA JOIN INSERTED INS ON INS.CD_SIT = PRA.CD_SIT AND INS.FL_PAR_TEL = 1 AND INS.FL_PAR_ANU = 1 
	JOIN	T_TPA TPA ON TPA.CD_TPA = PRA.CD_TPA AND TPA.TP_TPA = 2 JOIN T_SIT SIT ON SIT.CD_SIT = INS.CD_SIT AND FL_SIT_CON_VOO = 0
 	WHERE	PRA.TP_PRA = 1 AND NOT EXISTS (SELECT * FROM T_PRALOG WHERE CD_PRA = PRA.CD_PRA AND CD_PAR = INS.CD_PAR)  AND PRA.FL_PRA_POR = 0

	 --Após a Alteração da Situação
	INSERT INTO T_PRALOG (CD_PRA, CD_CHG, CD_PAR, DH_LOG, FL_LOG)
	SELECT 	CD_PRA, NULL, INS.CD_PAR, DATEADD(MI, PRA.QT_PRA_TMP, GETDATE()), 0
	FROM	T_PRA PRA JOIN INSERTED INS ON INS.CD_SIT = PRA.CD_SIT AND INS.FL_PAR_TEL = 1 AND INS.FL_PAR_ANU = 1
	JOIN	T_TPA TPA ON TPA.CD_TPA = PRA.CD_TPA AND TPA.TP_TPA = 2 JOIN T_SIT SIT ON SIT.CD_SIT = INS.CD_SIT AND FL_SIT_CON_VOO = 0
	WHERE	PRA.TP_PRA = 2 AND NOT EXISTS (SELECT * FROM T_PRALOG WHERE CD_PRA = PRA.CD_PRA AND CD_PAR = INS.CD_PAR)  AND PRA.FL_PRA_POR = 0

	IF UPDATE(CD_SIT)
	BEGIN
		--Antes da Hora Prevista
		INSERT INTO T_PRALOG (CD_PRA, CD_CHG, CD_PAR, DH_LOG, FL_LOG)
		SELECT 	CD_PRA, NULL, NULL, DATEADD(MI, -PRA.QT_PRA_TMP, INS.DH_PAR_EFE), 0
		FROM	T_PRA PRA JOIN INSERTED INS ON INS.CD_SIT = PRA.CD_SIT AND INS.FL_PAR_TEL = 1 AND INS.FL_PAR_ANU = 1
		JOIN	T_TPA TPA ON TPA.CD_TPA = PRA.CD_TPA AND TPA.TP_TPA = 3 JOIN T_SIT SIT ON SIT.CD_SIT = INS.CD_SIT AND FL_SIT_CON_VOO = 0
		WHERE	PRA.TP_PRA = 1 AND NOT EXISTS (SELECT * FROM T_PRALOG WHERE CD_PRA = PRA.CD_PRA AND CD_PAR = INS.CD_PAR) AND PRA.FL_PRA_POR = 0 AND TP_PRA_TPA = 2

		 --Após a Alteração da Situação
		INSERT INTO T_PRALOG (CD_PRA, CD_CHG, CD_PAR, DH_LOG, FL_LOG)
		SELECT 	CD_PRA, NULL, NULL, DATEADD(MI, PRA.QT_PRA_TMP, GETDATE()), 0
		FROM	T_PRA PRA JOIN INSERTED INS ON INS.CD_SIT = PRA.CD_SIT AND INS.FL_PAR_TEL = 1 AND INS.FL_PAR_ANU = 1
		JOIN	T_TPA TPA ON TPA.CD_TPA = PRA.CD_TPA AND TPA.TP_TPA = 3 JOIN T_SIT SIT ON SIT.CD_SIT = INS.CD_SIT AND FL_SIT_CON_VOO = 0
		WHERE	PRA.TP_PRA = 2 AND NOT EXISTS (SELECT * FROM T_PRALOG WHERE CD_PRA = PRA.CD_PRA AND CD_PAR = INS.CD_PAR) AND PRA.FL_PRA_POR = 0 AND TP_PRA_TPA = 2
	END
END

-- Alexei 12/12/00
-- Milena - 30/06/98 */ /* Alexei - 27/07/98 - Inclusão dos campos DH_REP_ORI e HR_REP_ZUL
-- -------------------------------------------------- Lançar registro para Replicação na tabela T_REP001 -----------
IF	UPDATE(CD_SIT) OR UPDATE(DH_PAR_EFE) OR UPDATE(CD_CHG_AEN_ANT)
BEGIN
	DECLARE @HR_REP_ZUL 	INT
	DECLARE @HR_HOR_NRM 	INT
	DECLARE @HR_HOR_VER 	INT
	DECLARE @CD_PAR 	INT
	DECLARE @SG_COM_IAT_003	CHAR(3)
	DECLARE @NR_VOO		CHAR(10)

	-- Verifica Defazagem em relação ao horário Zulu
	SELECT 	@HR_HOR_NRM = HR_HOR_NRM,
		@HR_HOR_VER = HR_HOR_VER
	FROM 	T_HOR HOR, T_AER AER, T_CID CID, T_PSI PSI
	WHERE 	CID.CD_CID = AER.CD_CID And
		HOR.CD_HOR = CID.CD_HOR And
		AER.CD_AER = PSI.CD_AER
   
	-- Verifica se o Aeroporto está no Horário de Verão
	IF (SELECT COUNT(*) FROM T_HRV WHERE GETDATE() BETWEEN DT_HRV_INI AND DT_HRV_FIM) &gt; 0
		SELECT @HR_REP_ZUL = @HR_HOR_VER
	ELSE
		SELECT @HR_REP_ZUL = @HR_HOR_NRM
END
-- Alexei 12/12/00
IF 	UPDATE(CD_CHG_AEN_ANT)
BEGIN
	-- Vôos de PAR cujas aeronaves antecessoras estão sendo atualizadas e cuja primeira escala 
	-- posterior do vôo de PAR é um dos aeroportos ativos existentes na tabela T_RED
	DECLARE REP2 CURSOR FOR
	SELECT 	INS.CD_PAR, SG_COM_IAT_003, NR_VOO = INS.NR_PAR_VOO, NR_AEN
	FROM 	INSERTED INS, T_CHG CHG, T_COM COM, T_AEN AEN
	WHERE	INS.CD_CHG_AEN_ANT = CHG.CD_CHG AND
		INS.CD_PAR IN (	SELECT	CD_PAR 	FROM T_ECP001 ECP
				WHERE	ECP.CD_PAR = INS.CD_PAR AND
					ECP.CD_ECP = (SELECT MIN(CD_ECP) FROM T_ECP001 ECP1 WHERE ECP1.CD_PAR = ECP.CD_PAR) AND
					ECP.CD_AER IN (SELECT CD_AER FROM T_AER WHERE SG_AER_ICA IN (SELECT SG_AER_ICA FROM T_RED WHERE FL_RED_ATI = 1))) AND
		COM.CD_COM = INS.CD_COM AND AEN.CD_AEN =* CHG.CD_AEN_CHG
	/* Declaração das variáveis */
	DECLARE @NR_AEN CHAR(10)
	/* Abre curso e posiciona no primeiro registro */
	OPEN REP2
	FETCH REP2 INTO @CD_PAR, @SG_COM_IAT_003, @NR_VOO, @NR_AEN
	/* Processar todos os registros de REP2 */
	WHILE @@FETCH_STATUS = 0
	BEGIN
		/* Inserir registro na tabela T_REP001 */
		INSERT INTO T_REP001 (
			SG_AER_ICA_ORI, SG_AER_ICA_DES, SG_COM_IAT_003, NR_VOO, 
			DH_VOO_EFE, QT_VOO_DIF, NM_SIT, NR_AEN,
			FL_CHG_CON, FL_PAR_CON, FL_AEN, DH_REP, DH_REP_ORI, HR_REP_ZUL)
		SELECT 	(SELECT SG_AER_ICA FROM T_AER WHERE CD_AER = (SELECT CD_AER FROM T_PSI)),
			(SELECT SG_AER_ICA FROM T_ECP001 ECP, T_AER AER WHERE ECP.CD_PAR = @CD_PAR AND ECP.CD_ECP = (SELECT MIN(CD_ECP) FROM T_ECP001 WHERE CD_PAR = @CD_PAR) AND ECP.CD_AER = AER.CD_AER),
			@SG_COM_IAT_003, @NR_VOO,
			NULL, NULL, NULL, @NR_AEN, 0, 0, 1, GETDATE(), GETDATE(), @HR_REP_ZUL

		/* Ir para o próximo registro */
		FETCH NEXT FROM REP2 INTO @CD_PAR, @SG_COM_IAT_003, @NR_VOO, @NR_AEN
	END
	CLOSE REP2
	DEALLOCATE REP2
	-- Fim Alexei 12/12/00
END
IF 	UPDATE(CD_SIT) OR UPDATE(DH_PAR_EFE)
BEGIN
	-- -------------------------------------------------- Declaração do Cursor --------------------------------------------------
	-- Vôos de Partida cujas situações estão sendo atualizadas para uma situação diferente de &quot;Etapa Concluída&quot; e 
	-- cuja primeira escala posterior do vôo de Partida associado é um dos aeroportos ativos existentes na tabela T_RED
	DECLARE REP3 CURSOR FOR
	SELECT 	INS.CD_PAR, SG_COM_IAT_003, NR_VOO = INS.NR_PAR_VOO, 
		DH_VOO_EFE = INS.DH_PAR_EFE, QT_VOO_DIF = DATEDIFF(MI, INS.DH_PAR_NRM, INS.DH_PAR_EFE),
		NM_SIT = NM_SIT_LOC
	FROM 	INSERTED INS, T_SIT SIT, T_COM COM
	WHERE	SIT.CD_SIT = INS.CD_SIT AND
		SIT.FL_SIT_CON_VOO = 0 AND	-- Não Concluído
		INS.CD_PAR IN (	SELECT	CD_PAR
				FROM 	T_ECP001 ECP
				WHERE	ECP.CD_PAR = INS.CD_PAR AND
					ECP.CD_ECP = (SELECT MIN(CD_ECP) FROM T_ECP001 ECP1 WHERE ECP1.CD_PAR = ECP.CD_PAR) AND
					ECP.CD_AER IN (SELECT CD_AER FROM T_AER WHERE SG_AER_ICA IN (SELECT SG_AER_ICA FROM T_RED WHERE FL_RED_ATI = 1))) AND
		COM.CD_COM = INS.CD_COM

	-- Declaração das variáveis
	DECLARE	@DH_VOO_EFE		SMALLDATETIME,
			@QT_VOO_DIF		INT,
			@NM_SIT		VARCHAR(30)
		 
	-- Abertura do Cursor
	OPEN REP3

	-- Posiciona no primeiro registro
	FETCH	REP3
	INTO	@CD_PAR, @SG_COM_IAT_003, @NR_VOO, @DH_VOO_EFE, @QT_VOO_DIF, @NM_SIT

	-- Processar todos os registros de REP3
	WHILE @@FETCH_STATUS = 0
	BEGIN
		-- Inserir registro na tabela T_REP001
		INSERT INTO T_REP001 (
			SG_AER_ICA_ORI, SG_AER_ICA_DES, SG_COM_IAT_003, NR_VOO, 
			DH_VOO_EFE, QT_VOO_DIF, NM_SIT, 
			NR_AEN,
			FL_CHG_CON, FL_PAR_CON, FL_AEN, DH_REP, DH_REP_ORI, HR_REP_ZUL)
		SELECT 	(SELECT SG_AER_ICA FROM T_AER WHERE CD_AER = (SELECT CD_AER FROM T_PSI)),
			(SELECT SG_AER_ICA FROM T_ECP001 ECP, T_AER AER WHERE ECP.CD_PAR = @CD_PAR AND ECP.CD_ECP = (SELECT MIN(CD_ECP) FROM T_ECP001 WHERE CD_PAR = @CD_PAR) AND ECP.CD_AER = AER.CD_AER),
			@SG_COM_IAT_003, @NR_VOO,
			@DH_VOO_EFE, @QT_VOO_DIF, @NM_SIT,
			NULL,
			0, 0, 0, GETDATE(), GETDATE(), @HR_REP_ZUL

		-- Ir para o próximo registro
		FETCH NEXT FROM REP3
		INTO	@CD_PAR, @SG_COM_IAT_003, @NR_VOO, @DH_VOO_EFE, @QT_VOO_DIF, @NM_SIT
	END
	CLOSE REP3
	DEALLOCATE REP3
END

IF 	UPDATE(CD_SIT)
BEGIN
	-- -------------------------------------------------- Declaração do Cursor -------------------------------------------------- 
	-- Vôos de Partida cujas situações estão sendo atualizadas para &quot;Etapa Concluída&quot; e cuja primeira 
	-- escala posterior do vôo de Partida associado é um dos aeroportos ativos existentes na tabela T_RED
	DECLARE REP4 CURSOR FOR
	SELECT 	PAR.CD_PAR, SG_COM_IAT_003, NR_VOO = PAR.NR_PAR_VOO, 
		DH_VOO_EFE = INS.DH_PAR_EFE, QT_VOO_DIF = DATEDIFF(MI, INS.DH_PAR_NRM, INS.DH_PAR_EFE),
		NM_SIT = NM_SIT_LOC
	FROM 	INSERTED INS, T_PAR PAR, T_SIT SIT, T_COM COM
	WHERE	INS.CD_PAR = PAR.CD_PAR AND
		SIT.CD_SIT = INS.CD_SIT AND
		SIT.FL_SIT_CON_VOO = 1 AND	-- Concluído
		PAR.FL_PAR_CAN = 0 AND		-- Não Cancelado
		PAR.CD_PAR IN (	SELECT	CD_PAR
				FROM 	T_ECP001 ECP
				WHERE	ECP.CD_PAR = PAR.CD_PAR AND
					ECP.CD_ECP = (SELECT MIN(CD_ECP) FROM T_ECP001 ECP1 WHERE ECP1.CD_PAR = ECP.CD_PAR) AND
					ECP.CD_AER IN (SELECT CD_AER FROM T_AER WHERE SG_AER_ICA IN (SELECT SG_AER_ICA FROM T_RED WHERE FL_RED_ATI = 1))) AND
		COM.CD_COM = PAR.CD_COM

	-- Abertura do Cursor
	OPEN REP4

	-- Posiciona no primeiro registro
	FETCH	REP4
	INTO	@CD_PAR, @SG_COM_IAT_003, @NR_VOO, @DH_VOO_EFE, @QT_VOO_DIF, @NM_SIT

	-- Processar todos os registros de REP4
	WHILE @@FETCH_STATUS = 0
	BEGIN
		-- Inserir registro na tabela T_REP001
		INSERT INTO T_REP001 (
			SG_AER_ICA_ORI, SG_AER_ICA_DES, SG_COM_IAT_003, NR_VOO, 
			DH_VOO_EFE, QT_VOO_DIF, NM_SIT, 
			NR_AEN,
			FL_CHG_CON, FL_PAR_CON, FL_AEN, DH_REP, DH_REP_ORI, HR_REP_ZUL)
		SELECT 	(SELECT SG_AER_ICA FROM T_AER WHERE CD_AER = (SELECT CD_AER FROM T_PSI)),
			(SELECT SG_AER_ICA FROM T_ECP001 ECP, T_AER AER WHERE ECP.CD_PAR = @CD_PAR AND ECP.CD_ECP = (SELECT MIN(CD_ECP) FROM T_ECP001 WHERE CD_PAR = @CD_PAR) AND ECP.CD_AER = AER.CD_AER),
			@SG_COM_IAT_003, @NR_VOO,
			@DH_VOO_EFE, @QT_VOO_DIF, @NM_SIT,
			NULL,
			0, 1, 0, GETDATE(), GETDATE(), @HR_REP_ZUL

		-- Ir para o próximo registro
		FETCH NEXT FROM REP4
		INTO	@CD_PAR, @SG_COM_IAT_003, @NR_VOO, @DH_VOO_EFE, @QT_VOO_DIF, @NM_SIT
	END
	CLOSE REP4
	DEALLOCATE REP4
END

/* INCLUIR REGISTROS EM T_APA */
INSERT	T_APA (DH_APA, CD_PAR)
SELECT GETDATE(), CD_PAR FROM INSERTED

/* Incluir registros em T_AHP */
IF 	UPDATE(NR_PAR_VOO) OR UPDATE(TP_PAR_GRU) OR UPDATE (CD_CHG_AEN_ANT) OR 
	UPDATE(CD_POR) OR UPDATE(CD_COM)
BEGIN
	INSERT	T_AHP (CD_HPA, DH_AHP)
	Select 	DISTINCT CD_HPA, GETDATE()
	From 	T_HPA001 HPA, T_CHG CHG, T_SIT SIT, T_PAR PAR, INSERTED INS
	Where	HPA.CD_CHG = CHG.CD_CHG AND
		SIT.CD_SIT = CHG.CD_SIT AND
		HPA.CD_AER = (Select CD_AER From T_PSI) AND
		(HPA.FL_HPA_ENT = 1 OR SIT.FL_SIT_AEN_PAT = 1) AND
		HPA.FL_HPA_SAI = 0 AND
		HPA.CD_AEN IS NOT NULL AND
		PAR.CD_CHG_AEN_ANT = HPA.CD_CHG AND
		PAR.CD_PAR = INS.CD_PAR
END

End
go</a:Text>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Trigger.Type>U</a:Trigger.Type>
</o:Trigger>
</c:Triggers>
<c:PrimaryKey>
<o:Key Ref="o355"/>
</c:PrimaryKey>
</o:Table>
</c:Object>
</o:TableSymbol>
</c:DestinationSymbol>
<c:Object>
<o:Reference Id="o384">
<a:ObjectID>6958B267-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>Reference_18</a:Name>
<a:Code>REFERENCE_18</a:Code>
<a:CreationDate>1081701223</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081701272</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Cardinality>0..*</a:Cardinality>
<a:UpdateConstraint>1</a:UpdateConstraint>
<a:DeleteConstraint>1</a:DeleteConstraint>
<c:Object1>
<o:Table Ref="o329"/>
</c:Object1>
<c:Object2>
<o:Table Ref="o7"/>
</c:Object2>
<c:Joins>
<o:ReferenceJoin Id="o385">
<a:ObjectID>6958B26D-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081701272</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081701272</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<c:Object1>
<o:Column Ref="o330"/>
</c:Object1>
<c:Object2>
<o:Column Ref="o16"/>
</c:Object2>
</o:ReferenceJoin>
</c:Joins>
</o:Reference>
</c:Object>
</o:ReferenceSymbol>
<o:ReferenceSymbol Id="o386">
<a:CenterTextOffset>(7, 0)</a:CenterTextOffset>
<a:Rect>((-722823,695775), (-714949,720525))</a:Rect>
<a:ListOfPoints>((-718893,695775),(-718893,720525))</a:ListOfPoints>
<a:ArrowStyle>4882</a:ArrowStyle>
<a:LineColor>8388736</a:LineColor>
<a:ShadowColor>12632256</a:ShadowColor>
<a:FontList>DISPNAME 0 arial,8,N</a:FontList>
<c:SourceSymbol>
<o:TableSymbol Ref="o6"/>
</c:SourceSymbol>
<c:DestinationSymbol>
<o:TableSymbol Ref="o60"/>
</c:DestinationSymbol>
<c:Object>
<o:Reference Id="o387">
<a:ObjectID>6958B270-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>Reference_19</a:Name>
<a:Code>REFERENCE_19</a:Code>
<a:CreationDate>1081701383</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081701412</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Cardinality>0..*</a:Cardinality>
<a:UpdateConstraint>1</a:UpdateConstraint>
<a:DeleteConstraint>1</a:DeleteConstraint>
<c:Object1>
<o:Table Ref="o61"/>
</c:Object1>
<c:Object2>
<o:Table Ref="o7"/>
</c:Object2>
<c:Joins>
<o:ReferenceJoin Id="o388">
<a:ObjectID>6958B275-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081701412</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081701412</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<c:Object1>
<o:Column Ref="o62"/>
</c:Object1>
<c:Object2>
<o:Column Ref="o13"/>
</c:Object2>
</o:ReferenceJoin>
</c:Joins>
</o:Reference>
</c:Object>
</o:ReferenceSymbol>
<o:ReferenceSymbol Id="o389">
<a:CenterTextOffset>(2325, -300)</a:CenterTextOffset>
<a:Rect>((-715406,673725), (-705656,675825))</a:Rect>
<a:ListOfPoints>((-714056,675825),(-710456,675825),(-710531,674925),(-710531,673725),(-713981,673725))</a:ListOfPoints>
<a:ArrowStyle>4881</a:ArrowStyle>
<a:LineColor>8388736</a:LineColor>
<a:ShadowColor>12632256</a:ShadowColor>
<a:FontList>DISPNAME 0 arial,8,N</a:FontList>
<c:SourceSymbol>
<o:TableSymbol Ref="o296"/>
</c:SourceSymbol>
<c:DestinationSymbol>
<o:TableSymbol Ref="o296"/>
</c:DestinationSymbol>
<c:Object>
<o:Reference Id="o390">
<a:ObjectID>6958B27B-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>Reference_20</a:Name>
<a:Code>REFERENCE_20</a:Code>
<a:CreationDate>1081701489</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081701522</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:Cardinality>0..*</a:Cardinality>
<a:UpdateConstraint>1</a:UpdateConstraint>
<a:DeleteConstraint>1</a:DeleteConstraint>
<c:Object1>
<o:Table Ref="o297"/>
</c:Object1>
<c:Object2>
<o:Table Ref="o297"/>
</c:Object2>
<c:Joins>
<o:ReferenceJoin Id="o391">
<a:ObjectID>6958B282-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:CreationDate>1081701522</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081701522</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<c:Object1>
<o:Column Ref="o298"/>
</c:Object1>
<c:Object2>
<o:Column Ref="o304"/>
</c:Object2>
</o:ReferenceJoin>
</c:Joins>
</o:Reference>
</c:Object>
</o:ReferenceSymbol>
<o:TableSymbol Ref="o38"/>
<o:TableSymbol Ref="o96"/>
<o:TableSymbol Ref="o119"/>
<o:TableSymbol Ref="o158"/>
<o:TableSymbol Ref="o128"/>
<o:TableSymbol Ref="o176"/>
<o:TableSymbol Ref="o60"/>
<o:TableSymbol Ref="o188"/>
<o:TableSymbol Ref="o242"/>
<o:TableSymbol Ref="o271"/>
<o:TableSymbol Ref="o6"/>
<o:TableSymbol Ref="o328"/>
<o:TableSymbol Ref="o296"/>
<o:TableSymbol Ref="o146"/>
</c:Symbols>
</o:PhysicalDiagram>
</c:PhysicalDiagrams>
<c:DefaultDiagram>
<o:PhysicalDiagram Ref="o4"/>
</c:DefaultDiagram>
<c:Users>
<o:User Ref="o34"/>
</c:Users>
<c:Tables>
<o:Table Ref="o39"/>
<o:Table Ref="o97"/>
<o:Table Ref="o120"/>
<o:Table Ref="o159"/>
<o:Table Ref="o129"/>
<o:Table Ref="o147"/>
<o:Table Ref="o177"/>
<o:Table Ref="o61"/>
<o:Table Ref="o189"/>
<o:Table Ref="o243"/>
<o:Table Ref="o272"/>
<o:Table Ref="o7"/>
<o:Table Ref="o329"/>
<o:Table Ref="o297"/>
</c:Tables>
<c:References>
<o:Reference Ref="o57"/>
<o:Reference Ref="o113"/>
<o:Reference Ref="o116"/>
<o:Reference Ref="o143"/>
<o:Reference Ref="o154"/>
<o:Reference Ref="o167"/>
<o:Reference Ref="o170"/>
<o:Reference Ref="o173"/>
<o:Reference Ref="o185"/>
<o:Reference Ref="o239"/>
<o:Reference Ref="o265"/>
<o:Reference Ref="o268"/>
<o:Reference Ref="o290"/>
<o:Reference Ref="o293"/>
<o:Reference Ref="o322"/>
<o:Reference Ref="o325"/>
<o:Reference Ref="o384"/>
<o:Reference Ref="o387"/>
<o:Reference Ref="o390"/>
</c:References>
<c:TargetModels>
<o:TargetModel Id="o392">
<a:ObjectID>6958B21D-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>Microsoft SQL Server 7.x</a:Name>
<a:Code>SQL SERVER 7</a:Code>
<a:CreationDate>1081543070</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543070</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:TargetModelURL>file:///%_DBMS%/sqlserv7.xdb</a:TargetModelURL>
<a:TargetModelID>986CB218-1936-4245-823C-883D7AF59B86</a:TargetModelID>
<a:TargetModelClassID>4BA9F647-DAB1-11D1-9944-006097355D9B</a:TargetModelClassID>
<c:SessionShortcuts>
<o:Shortcut Ref="o3"/>
<o:Shortcut Id="o393">
<a:ObjectID>6958B221-8FBB-11D8-B6CA-00024416849C</a:ObjectID>
<a:Name>Microsoft SQL Server 7.x</a:Name>
<a:Code>SQL SERVER 7</a:Code>
<a:CreationDate>1081543073</a:CreationDate>
<a:Creator>prsi_ronei</a:Creator>
<a:ModificationDate>1081543073</a:ModificationDate>
<a:Modifier>prsi_ronei</a:Modifier>
<a:TargetID>986CB218-1936-4245-823C-883D7AF59B86</a:TargetID>
<a:TargetClassID>4BA9F647-DAB1-11D1-9944-006097355D9B</a:TargetClassID>
<a:TargetPackagePath/>
</o:Shortcut>
</c:SessionShortcuts>
</o:TargetModel>
</c:TargetModels>
</o:Model>
</c:Children>
</o:RootObject>

</Model>