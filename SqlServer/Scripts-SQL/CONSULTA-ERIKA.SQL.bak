DECLARE
  V_POINTNUM VARCHAR(30) :='T';
  V_COUNT NUMBER(3) := 1;

  CURSOR  C1 IS
  SELECT  MEASUREPOINT.POINTNUM
       ,  MEASUREMENT.MEASUREDATE 
    FROM  MEASUREPOINT INNER JOIN MEASUREMENT 
                               ON MEASUREPOINT.POINTNUM = MEASUREMENT.POINTNUM
   ORDER 
      BY  MEASUREPOINT.POINTNUM ASC
       ,  MEASUREMENT.MEASUREDATE DESC;  

BEGIN
  
  FOR X IN C1 LOOP
    BEGIN
    
      IF ( V_POINTNUM != X.POINTNUM) THEN
          INSERT INTO IFRMAXIMO.GTT_RELMAX01 VALUES (X.POINTNUM, X.MEASUREDATE);
          V_COUNT := 1;
      ELSIF ( V_POINTNUM = X.POINTNUM AND V_COUNT <= 11) THEN
          INSERT INTO IFRMAXIMO.GTT_RELMAX01 VALUES (X.POINTNUM, X.MEASUREDATE);
          V_COUNT := V_COUNT + 1;
      ELSIF ( V_POINTNUM = X.POINTNUM AND V_COUNT > 12) THEN
          V_COUNT := V_COUNT + 1;   
      END IF;
      
      V_POINTNUM := X.POINTNUM;
    END;
  END LOOP;   
END;


--SELECT * FROM IFRMAXIMO.GTT_RELMAX01 ORDER BY 1 ASC, 2 DESC;
--COMMIT;

--SELECT POINTNUM, COUNT(1) FROM IFRMAXIMO.GTT_RELMAX01 GROUP BY POINTNUM


