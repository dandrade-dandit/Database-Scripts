USE [IFRSIVNET]
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBAR]    Script Date: 12/07/2010 14:08:47 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBAR]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBAR'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [S-ARSN01\PRDSBAR01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[S-ARSN01\PRDSBAR01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[S-ARSN01\PRDSBAR01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [S-ARSN01\PRDSBAR01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[S-ARSN01\PRDSBAR01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[S-ARSN01\PRDSBAR01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBBE]    Script Date: 12/07/2010 14:08:47 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBBE]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBBE'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [10.7.17.11\PRDSRBE01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[10.7.17.11\PRDSRBE01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[10.7.17.11\PRDSRBE01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [10.7.17.11\PRDSRBE01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[10.7.17.11\PRDSRBE01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[10.7.17.11\PRDSRBE01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBBH]    Script Date: 12/07/2010 14:08:47 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBBH]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBBH'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [s-bhbn23\prdsbbh01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[s-bhbn23\prdsbbh01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[s-bhbn23\prdsbbh01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [s-bhbn23\prdsbbh01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[s-bhbn23\prdsbbh01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
			DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[s-bhbn23\prdsbbh01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBBR]    Script Date: 12/07/2010 14:08:47 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBBR]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBBR'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [S-BRBN19\PRDSBBR01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[S-BRBN19\PRDSBBR01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[S-BRBN19\PRDSBBR01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [S-BRBN19\PRDSBBR01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[S-BRBN19\PRDSBBR01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[S-BRBN19\PRDSBBR01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBBV]    Script Date: 12/07/2010 14:08:47 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBBV]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBBV'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [s-bvsiv01\prdsbbv01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[s-bvsiv01\prdsbbv01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[s-bvsiv01\prdsbbv01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [s-bvsiv01\prdsbbv01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[s-bvsiv01\prdsbbv01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[s-bvsiv01\prdsbbv01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBCF]    Script Date: 12/07/2010 14:08:47 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBCF]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBCF'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [S-CFBN32\PRDSBCF02].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[S-CFBN32\PRDSBCF02].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[S-CFBN32\PRDSBCF02].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [S-CFBN32\PRDSBCF02].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[S-CFBN32\PRDSBCF02].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[S-CFBN32\PRDSBCF02].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBCG]    Script Date: 12/07/2010 14:08:47 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBCG]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBCG'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [10.44.17.30\PRDSBCG01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[10.44.17.30\PRDSBCG01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[10.44.17.30\PRDSBCG01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [10.44.17.30\PRDSBCG01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[10.44.17.30\PRDSBCG01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[10.44.17.30\PRDSBCG01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBCJ]    Script Date: 12/07/2010 14:08:47 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBCJ]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBCJ'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [10.96.17.4\prdsbcj03].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[10.96.17.4\prdsbcj03].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[10.96.17.4\prdsbcj03].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [10.96.17.4\prdsbcj03].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[10.96.17.4\prdsbcj03].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[10.96.17.4\prdsbcj03].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBCM]    Script Date: 12/07/2010 14:08:47 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBCM]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBCM'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [S-CMGN02\prdsbcm01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[S-CMGN02\prdsbcm01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[S-CMGN02\prdsbcm01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [S-CMGN02\prdsbcm01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[S-CMGN02\prdsbcm01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
			DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[S-CMGN02\prdsbcm01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBCP]    Script Date: 12/07/2010 14:08:47 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBCP]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBCP'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [s-cpbn03\prdsbcp01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[s-cpbn03\prdsbcp01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[s-cpbn03\prdsbcp01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [s-cpbn03\prdsbcp01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[s-cpbn03\prdsbcp01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[s-cpbn03\prdsbcp01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBCR]    Script Date: 12/07/2010 14:08:47 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBCR]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBCR'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [S-CRBN03\PRDSBCR01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[S-CRBN03\PRDSBCR01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[S-CRBN03\PRDSBCR01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [S-CRBN03\PRDSBCR01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[S-CRBN03\PRDSBCR01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[S-CRBN03\PRDSBCR01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBCT]    Script Date: 12/07/2010 14:08:47 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBCT]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBCT'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [S-CTBN24\PRDSBCT01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[S-CTBN24\PRDSBCT01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[S-CTBN24\PRDSBCT01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [S-CTBN24\PRDSBCT01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[S-CTBN24\PRDSBCT01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[S-CTBN24\PRDSBCT01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBCY]    Script Date: 12/07/2010 14:08:47 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBCY]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBCY'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [S-CYBN12\PRDSBCY01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[S-CYBN12\PRDSBCY01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[S-CYBN12\PRDSBCY01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [S-CYBN12\PRDSBCY01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[S-CYBN12\PRDSBCY01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[S-CYBN12\PRDSBCY01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBCZ]    Script Date: 12/07/2010 14:08:47 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBCZ]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBCZ'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [s-czsiv01\prdsbcz01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[s-czsiv01\prdsbcz01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[s-czsiv01\prdsbcz01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [s-czsiv01\prdsbcz01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[s-czsiv01\prdsbcz01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[s-czsiv01\prdsbcz01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBEG]    Script Date: 12/07/2010 14:08:47 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBEG]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBEG'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [S-MNSIV01\PRDSBEG01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[S-MNSIV01\PRDSBEG01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[S-MNSIV01\PRDSBEG01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [S-MNSIV01\PRDSBEG01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[S-MNSIV01\PRDSBEG01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[S-MNSIV01\PRDSBEG01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBFI]    Script Date: 12/07/2010 14:08:48 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBFI]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBFI'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [S-FIBN09\PRDSBFI02].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[S-FIBN09\PRDSBFI02].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[S-FIBN09\PRDSBFI02].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [S-FIBN09\PRDSBFI02].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[S-FIBN09\PRDSBFI02].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
			DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[S-FIBN09\PRDSBFI02].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBFL]    Script Date: 12/07/2010 14:08:48 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBFL]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBFL'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [S-FLBN06\prdsbfl01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[S-FLBN06\prdsbfl01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[S-FLBN06\prdsbfl01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [S-FLBN06\prdsbfl01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[S-FLBN06\prdsbfl01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
			DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[S-FLBN06\prdsbfl01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBFZ]    Script Date: 12/07/2010 14:08:48 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBFZ]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBFZ'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [S-FZSN01\PRDSBFZ01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[S-FZSN01\PRDSBFZ01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[S-FZSN01\PRDSBFZ01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [S-FZSN01\PRDSBFZ01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[S-FZSN01\PRDSBFZ01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[S-FZSN01\PRDSBFZ01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBGL]    Script Date: 12/07/2010 14:08:48 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBGL]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBGL'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [S-RJBN135\PRDSBGL01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[S-RJBN135\PRDSBGL01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[S-RJBN135\PRDSBGL01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [S-RJBN135\PRDSBGL01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[S-RJBN135\PRDSBGL01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[S-RJBN135\PRDSBGL01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBGO]    Script Date: 12/07/2010 14:08:48 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBGO]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBGO'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [S-GOBN17\PRDSBGO01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[S-GOBN17\PRDSBGO01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[S-GOBN17\PRDSBGO01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [S-GOBN17\PRDSBGO01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[S-GOBN17\PRDSBGO01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[S-GOBN17\PRDSBGO01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBGR]    Script Date: 12/07/2010 14:08:48 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBGR]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBGR'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [SQLSISOGRU\PRDSBGR01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[SQLSISOGRU\PRDSBGR01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[SQLSISOGRU\PRDSBGR01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [SQLSISOGRU\PRDSBGR01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[SQLSISOGRU\PRDSBGR01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[SQLSISOGRU\PRDSBGR01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBHT]    Script Date: 12/07/2010 14:08:48 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBHT]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBHT'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [S-HTGN07\PRODSBHT02].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[S-HTGN07\PRODSBHT02].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[S-HTGN07\PRODSBHT02].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [S-HTGN07\PRODSBHT02].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[S-HTGN07\PRODSBHT02].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[S-HTGN07\PRODSBHT02].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBIL]    Script Date: 12/07/2010 14:08:48 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBIL]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBIL'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [ODBC-SBIL].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[ODBC-SBIL].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[ODBC-SBIL].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [ODBC-SBIL].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[ODBC-SBIL].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[ODBC-SBIL].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBIZ]    Script Date: 12/07/2010 14:08:48 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBIZ]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBIZ'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [S-IZGN07\PRDSBIZ01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[S-IZGN07\PRDSBIZ01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[S-IZGN07\PRDSBIZ01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [S-IZGN07\PRDSBIZ01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[S-IZGN07\PRDSBIZ01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[S-IZGN07\PRDSBIZ01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBJP]    Script Date: 12/07/2010 14:08:48 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBJP]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBJP'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [ODBC-SBJP].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[ODBC-SBJP].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[ODBC-SBJP].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [ODBC-SBJP].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[ODBC-SBJP].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[ODBC-SBJP].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBJU]    Script Date: 12/07/2010 14:08:48 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBJU]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBJU'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [ODBC-SBJU].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[ODBC-SBJU].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[ODBC-SBJU].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [ODBC-SBJU].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[ODBC-SBJU].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[ODBC-SBJU].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBJV]    Script Date: 12/07/2010 14:08:48 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBJV]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBJV'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [S-JVBN10\PRDSBJV01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[S-JVBN10\PRDSBJV01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[S-JVBN10\PRDSBJV01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [S-JVBN10\PRDSBJV01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[S-JVBN10\PRDSBJV01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
			DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[S-JVBN10\PRDSBJV01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBKG]    Script Date: 12/07/2010 14:08:48 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBKG]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBKG'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [ODBC-SBKG].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[ODBC-SBKG].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[ODBC-SBKG].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [ODBC-SBKG].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[ODBC-SBKG].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[ODBC-SBKG].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBKP]    Script Date: 12/07/2010 14:08:48 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBKP]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBKP'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [SQLSISOVCP\PRDSBKP01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[SQLSISOVCP\PRDSBKP01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[SQLSISOVCP\PRDSBKP01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [SQLSISOVCP\PRDSBKP01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[SQLSISOVCP\PRDSBKP01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[SQLSISOVCP\PRDSBKP01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBLO]    Script Date: 12/07/2010 14:08:48 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBLO]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBLO'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [S_LOBN08\PRDSBLO01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[S_LOBN08\PRDSBLO01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[S_LOBN08\PRDSBLO01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [S_LOBN08\PRDSBLO01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[S_LOBN08\PRDSBLO01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
			DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[S_LOBN08\PRDSBLO01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBMA]    Script Date: 12/07/2010 14:08:48 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBMA]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBMA'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [10.94.17.6\PRDSBMA01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[10.94.17.6\PRDSBMA01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[10.94.17.6\PRDSBMA01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [10.94.17.6\PRDSBMA01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[10.94.17.6\PRDSBMA01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
			DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[10.94.17.6\PRDSBMA01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBME]    Script Date: 12/07/2010 14:08:48 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBME]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBME'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [ODBC-SBME].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[ODBC-SBME].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[ODBC-SBME].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [ODBC-SBME].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[ODBC-SBME].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[ODBC-SBME].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBMK]    Script Date: 12/07/2010 14:08:48 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBMK]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBMK'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [S-MKAN02\PRDSBMK01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[S-MKAN02\PRDSBMK01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[S-MKAN02\PRDSBMK01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [S-MKAN02\PRDSBMK01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[S-MKAN02\PRDSBMK01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
			DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[S-MKAN02\PRDSBMK01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBMO]    Script Date: 12/07/2010 14:08:48 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBMO]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBMO'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [S-MOSN01\PRDSBMO01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[S-MOSN01\PRDSBMO01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[S-MOSN01\PRDSBMO01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [S-MOSN01\PRDSBMO01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[S-MOSN01\PRDSBMO01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[S-MOSN01\PRDSBMO01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBMQ]    Script Date: 12/07/2010 14:08:48 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBMQ]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBMQ'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [S_MQGN06\PRODSBMQ01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[S_MQGN06\PRODSBMQ01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[S_MQGN06\PRODSBMQ01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [S_MQGN06\PRODSBMQ01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[S_MQGN06\PRODSBMQ01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[S_MQGN06\PRODSBMQ01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBNF]    Script Date: 12/07/2010 14:08:48 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBNF]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBNF'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [S-NFBN06\PRDSBNF01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[S-NFBN06\PRDSBNF01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[S-NFBN06\PRDSBNF01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [S-NFBN06\PRDSBNF01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[S-NFBN06\PRDSBNF01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
			DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[S-NFBN06\PRDSBNF01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBNT]    Script Date: 12/07/2010 14:08:48 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBNT]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBNT'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [ODBC-SBNT].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[ODBC-SBNT].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[ODBC-SBNT].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [ODBC-SBNT].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[ODBC-SBNT].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
			DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[ODBC-SBNT].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBPA]    Script Date: 12/07/2010 14:08:48 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBPA]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBPA'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [S-PABN05\PRDSBPA01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[S-PABN05\PRDSBPA01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[S-PABN05\PRDSBPA01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [S-PABN05\PRDSBPA01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[S-PABN05\PRDSBPA01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
			DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[S-PABN05\PRDSBPA01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBPJ]    Script Date: 12/07/2010 14:08:48 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBPJ]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBPJ'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [S-PJBN18\PRDSBPJ01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[S-PJBN18\PRDSBPJ01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[S-PJBN18\PRDSBPJ01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [S-PJBN18\PRDSBPJ01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[S-PJBN18\PRDSBPJ01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[S-PJBN18\PRDSBPJ01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBPK]    Script Date: 12/07/2010 14:08:48 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBPK]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBPK'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [10.68.17.3\prdsbpk02].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[10.68.17.3\prdsbpk02].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[10.68.17.3\prdsbpk02].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [10.68.17.3\prdsbpk02].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[10.68.17.3\prdsbpk02].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
			DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[10.68.17.3\prdsbpk02].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBPL]    Script Date: 12/07/2010 14:08:48 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBPL]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBPL'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [ODBC-SBPL].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[ODBC-SBPL].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[ODBC-SBPL].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [ODBC-SBPL].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[ODBC-SBPL].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
			DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[ODBC-SBPL].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBPV]    Script Date: 12/07/2010 14:08:48 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBPV]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBPV'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [10.54.17.12\PRDSBPV01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[10.54.17.12\PRDSBPV01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[10.54.17.12\PRDSBPV01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [10.54.17.12\PRDSBPV01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[10.54.17.12\PRDSBPV01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
			DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[10.54.17.12\PRDSBPV01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBRB]    Script Date: 12/07/2010 14:08:48 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBRB]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBRB'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [10.50.17.16\PRDSBRB01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[10.50.17.16\PRDSBRB01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[10.50.17.16\PRDSBRB01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [10.50.17.16\PRDSBRB01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[10.50.17.16\PRDSBRB01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
			DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[10.50.17.16\PRDSBRB01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBRF]    Script Date: 12/07/2010 14:08:48 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBRF]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBRF'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [SQL1SBRF\PRDSBRF01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[SQL1SBRF\PRDSBRF01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[SQL1SBRF\PRDSBRF01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [SQL1SBRF\PRDSBRF01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[SQL1SBRF\PRDSBRF01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
			DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[SQL1SBRF\PRDSBRF01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBRJ]    Script Date: 12/07/2010 14:08:48 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBRJ]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBRJ'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [10.31.17.20\PRDSBRJ01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[10.31.17.20\PRDSBRJ01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[10.31.17.20\PRDSBRJ01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [10.31.17.20\PRDSBRJ01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[10.31.17.20\PRDSBRJ01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
			DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[10.31.17.20\PRDSBRJ01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBSJ]    Script Date: 12/07/2010 14:08:48 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBSJ]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBSJ'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [ODBC-SBSJ].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[ODBC-SBSJ].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[ODBC-SBSJ].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [ODBC-SBSJ].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[ODBC-SBSJ].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[ODBC-SBSJ].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBSL]    Script Date: 12/07/2010 14:08:48 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBSL]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBSL'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [10.91.17.9\PRODSBSL01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[10.91.17.9\PRODSBSL01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[10.91.17.9\PRODSBSL01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [10.91.17.9\PRODSBSL01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[10.91.17.9\PRODSBSL01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
			DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[10.91.17.9\PRODSBSL01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBSN]    Script Date: 12/07/2010 14:08:48 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBSN]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBSN'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [S_SNGN06\PRODSBSN01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[S_SNGN06\PRODSBSN01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[S_SNGN06\PRODSBSN01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [S_SNGN06\PRODSBSN01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[S_SNGN06\PRODSBSN01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
			DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[S_SNGN06\PRODSBSN01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBSP]    Script Date: 12/07/2010 14:08:48 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBSP]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBSP'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [sqlsbsp\prdsbsp01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[sqlsbsp\prdsbsp01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[sqlsbsp\prdsbsp01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [sqlsbsp\prdsbsp01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[sqlsbsp\prdsbsp01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[sqlsbsp\prdsbsp01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBSV]    Script Date: 12/07/2010 14:08:48 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBSV]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBSV'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [S-SVBN25\PRDSBSV01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[S-SVBN25\PRDSBSV01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[S-SVBN25\PRDSBSV01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [S-SVBN25\PRDSBSV01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[S-SVBN25\PRDSBSV01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[S-SVBN25\PRDSBSV01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBTE]    Script Date: 12/07/2010 14:08:49 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBTE]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBTE'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [10.76.17.31\PRDSBTE01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[10.76.17.31\PRDSBTE01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[10.76.17.31\PRDSBTE01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [10.76.17.31\PRDSBTE01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[10.76.17.31\PRDSBTE01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
			DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[10.76.17.31\PRDSBTE01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBTF]    Script Date: 12/07/2010 14:08:49 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBTF]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBTF'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [S-TFSIV01\PRDSBTF01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[S-TFSIV01\PRDSBTF01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[S-TFSIV01\PRDSBTF01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [S-TFSIV01\PRDSBTF01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[S-TFSIV01\PRDSBTF01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
			DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[S-TFSIV01\PRDSBTF01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBTT]    Script Date: 12/07/2010 14:08:49 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBTT]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBTT'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [S-TTSIV01\PRDSBTT01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[S-TTSIV01\PRDSBTT01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[S-TTSIV01\PRDSBTT01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [S-TTSIV01\PRDSBTT01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[S-TTSIV01\PRDSBTT01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
			DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[S-TTSIV01\PRDSBTT01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBUG]    Script Date: 12/07/2010 14:08:49 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBUG]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBUG'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [S_UGGN01\PRDSBUG01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[S_UGGN01\PRDSBUG01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[S_UGGN01\PRDSBUG01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [S_UGGN01\PRDSBUG01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[S_UGGN01\PRDSBUG01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
			DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[S_UGGN01\PRDSBUG01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBUL]    Script Date: 12/07/2010 14:08:49 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBUL]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBUL'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [s-ulbn18\PRDSBUL01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[s-ulbn18\PRDSBUL01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[s-ulbn18\PRDSBUL01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [s-ulbn18\PRDSBUL01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[s-ulbn18\PRDSBUL01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
			DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[s-ulbn18\PRDSBUL01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBUR]    Script Date: 12/07/2010 14:08:49 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBUR]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBUR'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [s-urbn18\prdsbur01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[s-urbn18\prdsbur01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[s-urbn18\prdsbur01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [s-urbn18\prdsbur01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[s-urbn18\prdsbur01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[s-urbn18\prdsbur01].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

/****** Object:  StoredProcedure [dbo].[PRC_IMPORTACAO_SISO_SBVT]    Script Date: 12/07/2010 14:08:49 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRC_IMPORTACAO_SISO_SBVT]
AS
BEGIN 
	SET NOCOUNT ON
	
	DECLARE @DATA_ULTIMA_IMPORTACAO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_PROG AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_FINAL AS DATETIME
	DECLARE @DATA_ULTIMA_IMPORTACAO_SISO_FINAL AS DATETIME
	DECLARE @ICAO_AEROPORTO AS VARCHAR(4)
	
	SET @ICAO_AEROPORTO ='SBVT'
	
	--ARMAZENA NAS VARIÁVEIS AS ÚLTIMAS DATAS IMPORTADAS DO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_FINAL = DTH_ULTIMA_IMPORTACAO_FINAL,
		   @DATA_ULTIMA_IMPORTACAO_PROG = DTH_ULTIMA_IMPORTACAO_PROG
	FROM TAB_AEROPORTO 
	WHERE COD_ICAO=@ICAO_AEROPORTO

	--FAZ A IMPORTAÇÃO DE VOOS EM OPERAÇÃO
	--ARMAZENA NA VARIÁVEL A MAIOR DATA, DE VOOS EM OPERAÇÃO, PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_PROG = MAX(DTH_ATUALIZACAO)
	FROM [s-vtbn08\prdsbvt02].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
	
	IF EXISTS(SELECT  SEQ_CODIGO
			  FROM	[s-vtbn08\prdsbvt02].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_PROGRAMADO
		(
			SIG_AEROPORTO,
			SEQ_PROGRAMADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,	
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO
		FROM	[s-vtbn08\prdsbvt02].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_OPER
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_PROG,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_PROG

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_PROG= @DATA_ULTIMA_IMPORTACAO_SISO_PROG
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	
	
	
	
	--FAZ A IMPORTAÇÃO DE VOOS FINALIZADOS
	--ARMAZENA NA VARIÁVEL A MAIOR DATA DE VOOS FINALIZADOS PRESENTE NO SISO
	SELECT @DATA_ULTIMA_IMPORTACAO_SISO_FINAL = MAX(DTH_ATUALIZACAO)
	FROM [s-vtbn08\prdsbvt02].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
	
	
	
	IF EXISTS(SELECT SEQ_CODIGO
			  FROM	[s-vtbn08\prdsbvt02].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
			  WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
				AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL)
	BEGIN
		INSERT INTO IFRSIVNET.dbo.TAB_LOAD_VOO_FINALIZADO
		(
			SIG_AEROPORTO,
			SEQ_FINALIZADO,
			FLG_STATUS,
			SIG_CIA,
			NUM_VOO,
			DSC_DEST_ORIG_IATA,
			DSC_ESCALAS_IATA,
			DSC_DEST_ORIG_ICAO,
			DSC_ESCALAS_ICAO,
			DTH_PREVISTA,
			DTH_CONFIRMADA,
			DSC_EQUIPAMENTO,
			DSC_MATRICULA,
			DSC_CHECK_IN,
			DSC_GATE,
			DAT_VOO,
			FLG_NATUREZA_VOO,
			FLG_IND_CHEG_PART,
			FLG_TERMINAL,
			DSC_BOX,
			DSC_OBS,
			DSC_STATUS_ANAC,
			DTH_CALCO,
			DTH_POUSO,
			FLG_CATEGORIA,
			DTH_ATUALIZACAO,
			DTH_CANCELAMENTO
		)
		SELECT  @ICAO_AEROPORTO, 
				SEQ_CODIGO,	
				FLG_STATUS,	
				SIG_CIA,	
				NUM_VOO,	
				DSC_DEST_ORIG_IATA,	
				DSC_ESCALAS_IATA,	
				DSC_DEST_ORIG_ICAO,	
				DSC_ESCALAS_ICAO,	
				DTH_PREVISTA,	
				DTH_CONFIRMADA,	
				DSC_EQUIPAMENTO,
				DSC_MATRICULA,	
				DSC_CHECK_IN,	
				DSC_GATE,	
				DAT_VOO,	
				FLG_NATUREZA_VOO,	
				FLG_IND_CHEG_PART,	
				FLG_TERMINAL,	
				DSC_BOX,
				DSC_OBS,
				DSC_STATUS_ANAC,			
				DTH_CALCO,	
				DTH_POUSO,
				FLG_CATEGORIA,	
				DTH_ATUALIZACAO,
				DAT_CANCELAMENTO
		FROM	[s-vtbn08\prdsbvt02].INTEGRACAO.dbo.INTEGRACAO_SISO_SIVNET_FINALZ
		WHERE DTH_ATUALIZACAO > ISNULL(@DATA_ULTIMA_IMPORTACAO_FINAL,'01/01/1900')
			AND DTH_ATUALIZACAO <= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL

		--ATUALIZA A ÚLTIMA DATA IMPORTADA DO SISO
		UPDATE TAB_AEROPORTO 
		SET DTH_ULTIMA_IMPORTACAO_FINAL= @DATA_ULTIMA_IMPORTACAO_SISO_FINAL
		WHERE COD_ICAO=@ICAO_AEROPORTO
	END
	
	UPDATE TAB_AEROPORTO 
	SET DTH_EXECUCAO_IMPORTACAO = GETDATE()
	WHERE COD_ICAO=@ICAO_AEROPORTO
END
GO

